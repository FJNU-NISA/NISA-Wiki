
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NISA Wiki 是 NISA 的知识库，旨在总结网络安全领域的知识和经验。">
      
      
        <meta name="author" content="NISA">
      
      
        <link rel="canonical" href="https://wiki.fjnusec.cn/04-CRYPTO/03-%E5%85%B8%E5%9E%8B%E9%A2%98%E7%9B%AE/RSA%E5%85%A5%E9%97%A8.html">
      
      
        <link rel="prev" href="01-%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81.html">
      
      
        <link rel="next" href="../../05-RE/index.html">
      
      
      <link rel="icon" href="../../assets/NISA_LOGO.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>RSA入门 - NISA Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rsa" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="https://www.fjnusec.cn/" title="NISA Wiki" class="md-header__button md-logo" aria-label="NISA Wiki" data-md-component="logo">
      
  <img src="../../assets/NISA_LOGO.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NISA Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RSA入门
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭切换亮暗模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭切换亮暗模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到暗黑模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换到暗黑模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 2c-1.05 0-2.05.16-3 .46 4.06 1.27 7 5.04 7 9.54s-2.94 8.27-7 9.54c.95.3 1.95.46 3 .46a10 10 0 0 0 10-10A10 10 0 0 0 9 2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到亮色模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换到亮色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-2.69L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/FJNU-NISA/NISA-Wiki" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    FJNU-NISA/NISA-Wiki
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../index.html" class="md-tabs__link">
        
  
  
    
  
  00 简介

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../01-QUICK%20START/index.html" class="md-tabs__link">
          
  
  
    
  
  01 QUICK START

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../02-WEB/index.html" class="md-tabs__link">
          
  
  
    
  
  02 WEB

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../03-MISC/index.html" class="md-tabs__link">
          
  
  
    
  
  03 MISC

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index.html" class="md-tabs__link">
          
  
  
    
  
  04 CRYPTO

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../05-RE/index.html" class="md-tabs__link">
          
  
  
    
  
  05 RE

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../06-PWN/index.html" class="md-tabs__link">
          
  
  
    
  
  06 PWN

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../07-%E6%B8%97%E9%80%8F/index.html" class="md-tabs__link">
          
  
  
    
  
  07 渗透

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../08-SRC/index.html" class="md-tabs__link">
          
  
  
    
  
  08 SRC

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../09-%E8%BF%90%E7%BB%B4/index.html" class="md-tabs__link">
          
  
  
    
  
  09 运维

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../10-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/index.html" class="md-tabs__link">
          
  
  
    
  
  10 应急响应

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../11-IOT/index.html" class="md-tabs__link">
          
  
  
    
  
  11 IOT

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../12-FORENSIC/index.html" class="md-tabs__link">
          
  
  
    
  
  12 FORENSIC

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../13-%E5%8C%BA%E5%9D%97%E9%93%BE/index.html" class="md-tabs__link">
          
  
  
    
  
  13 区块链

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../14-%E6%AF%94%E8%B5%9B%E9%A2%98%E8%A7%A3%E5%BD%92%E6%A1%A3/index.html" class="md-tabs__link">
          
  
  
    
  
  14 比赛题解归档

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://www.fjnusec.cn/" title="NISA Wiki" class="md-nav__button md-logo" aria-label="NISA Wiki" data-md-component="logo">
      
  <img src="../../assets/NISA_LOGO.svg" alt="logo">

    </a>
    NISA Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FJNU-NISA/NISA-Wiki" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    FJNU-NISA/NISA-Wiki
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    00 简介
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../01-QUICK%20START/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    01 QUICK START
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../02-WEB/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    02 WEB
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../03-MISC/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    03 MISC
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    04 CRYPTO
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            04 CRYPTO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../01-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%A4%A7%E8%87%B4%E5%AD%A6%E4%BA%9B%E4%BB%80%E4%B9%88/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    01 密码学大致学些什么
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_2" id="__nav_5_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            01 密码学大致学些什么
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%A4%A7%E8%87%B4%E5%AD%A6%E4%BA%9B%E4%BB%80%E4%B9%88/01-%E5%AF%86%E7%A0%81%E5%AD%A6%E9%80%9A%E7%94%A8%E5%9F%BA%E7%A1%80.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    密码学通用基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%A4%A7%E8%87%B4%E5%AD%A6%E4%BA%9B%E4%BB%80%E4%B9%88/02-CTF%E4%B8%AD%E7%9A%84%E5%AF%86%E7%A0%81%E5%AD%A6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CTF中的密码学
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%A4%A7%E8%87%B4%E5%AD%A6%E4%BA%9B%E4%BB%80%E4%B9%88/03-%E5%AF%86%E7%A0%81%E5%AD%A6%E7%A7%91%E7%A0%94%E6%96%B9%E5%90%91.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    密码学科研方向
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../02-SageMath%E7%AE%80%E8%A6%81%E6%95%99%E7%A8%8B/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    02 SageMath简要教程
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_3" id="__nav_5_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            02 SageMath简要教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-SageMath%E7%AE%80%E8%A6%81%E6%95%99%E7%A8%8B/01-%E9%AB%98%E7%89%88%E6%9C%ACSageMath%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8Aflatter%E9%85%8D%E7%BD%AE.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    高版本SageMath安装以及flatter配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-SageMath%E7%AE%80%E8%A6%81%E6%95%99%E7%A8%8B/02-SageMath%E7%AE%80%E4%BB%8B.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SageMath简介
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    03 典型题目
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_4" id="__nav_5_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            03 典型题目
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="01-%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    古典密码
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    RSA入门
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="RSA%E5%85%A5%E9%97%A8.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    RSA入门
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rsa_1" class="md-nav__link">
    <span class="md-ellipsis">
      一、RSA算法原理简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、RSA算法原理简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1.密钥的产生
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2.加密
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.解密
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4.证明解密的正确性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      二、基础工具
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、基础工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1yafu" class="md-nav__link">
    <span class="md-ellipsis">
      1.yafu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.网站分解
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      三、密钥生成和读取
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、密钥生成和读取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      密钥生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="密钥生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      生成公钥
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      生成私钥
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      读取密钥
    </span>
  </a>
  
    <nav class="md-nav" aria-label="读取密钥">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      例题1 泄露私钥
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-oaep" class="md-nav__link">
    <span class="md-ellipsis">
      例题2 OAEP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cr4-poor-rsa" class="md-nav__link">
    <span class="md-ellipsis">
      攻防世界——cr4-poor-rsa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      四、共模攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、共模攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      例题2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      五、低加密指数攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五、低加密指数攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      六、广播攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="六、广播攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    <span class="md-ellipsis">
      第一种情况 多组n之间可能存在公因数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第一种情况 多组n之间可能存在公因数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buuctf-rsa5" class="md-nav__link">
    <span class="md-ellipsis">
      例题 BUUCTF-RSA5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例题 BUUCTF-RSA5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      思路
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      第二种情况 用中国剩余定理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第二种情况 用中国剩余定理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2021crazy_tech_rsa" class="md-nav__link">
    <span class="md-ellipsis">
      例题2 鹤城杯2021——Crazy_Tech_RSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      七、维纳攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="七、维纳攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      多因子的维纳攻击
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      八、共享素数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="八、共享素数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dp" class="md-nav__link">
    <span class="md-ellipsis">
      九、dp泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="九、dp泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      原理推导
    </span>
  </a>
  
    <nav class="md-nav" aria-label="原理推导">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-e" class="md-nav__link">
    <span class="md-ellipsis">
      例题2 e很大
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例题2 e很大">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#m-powcdpp" class="md-nav__link">
    <span class="md-ellipsis">
      关于m = pow(c,dp,p)的证明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dp" class="md-nav__link">
    <span class="md-ellipsis">
      例题3 dp高位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例题3 dp高位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    <span class="md-ellipsis">
      e不是很大
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e_1" class="md-nav__link">
    <span class="md-ellipsis">
      e很大
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dpdq" class="md-nav__link">
    <span class="md-ellipsis">
      十、dp,dq泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十、dp,dq泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      十一、考察欧拉函数计算
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十一、考察欧拉函数计算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      例题2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      例题3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ephi" class="md-nav__link">
    <span class="md-ellipsis">
      十二、e和phi不互素
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十二、e和phi不互素">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      处理方式1:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="处理方式1:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      处理方式2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      两种处理方式的综合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="两种处理方式的综合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#12022ctfshow" class="md-nav__link">
    <span class="md-ellipsis">
      例题1——2022ctfshow卷王杯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22018azurersa" class="md-nav__link">
    <span class="md-ellipsis">
      例题2——2018高校运维挑战赛AzureRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      处理方式3：
    </span>
  </a>
  
    <nav class="md-nav" aria-label="处理方式3：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2021crypto1" class="md-nav__link">
    <span class="md-ellipsis">
      例题 2021黑盾杯Crypto1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rabin" class="md-nav__link">
    <span class="md-ellipsis">
      十三、Rabin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十三、Rabin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      密钥生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      加密过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      解密过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rabin_1" class="md-nav__link">
    <span class="md-ellipsis">
      多次解Rabin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#m" class="md-nav__link">
    <span class="md-ellipsis">
      十四、m高位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十四、m高位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1m" class="md-nav__link">
    <span class="md-ellipsis">
      情况1：直接给出m的高位
    </span>
  </a>
  
    <nav class="md-nav" aria-label="情况1：直接给出m的高位">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2flag" class="md-nav__link">
    <span class="md-ellipsis">
      情况2:利用flag头等已知信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="情况2:利用flag头等已知信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2024xyctf" class="md-nav__link">
    <span class="md-ellipsis">
      例题——2024XYCTF 反方向的密码 相思
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p" class="md-nav__link">
    <span class="md-ellipsis">
      十五、p高位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十五、p高位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22023litctf-babyxor" class="md-nav__link">
    <span class="md-ellipsis">
      例题2——2023LitCTF Babyxor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      例题3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      十六、d低位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十六、d低位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2023badrsa" class="md-nav__link">
    <span class="md-ellipsis">
      2023强网拟态决赛——BadRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#franklin-reiter" class="md-nav__link">
    <span class="md-ellipsis">
      十七、Franklin-Reiter相关消息攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十七、Franklin-Reiter相关消息攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2sictfround2" class="md-nav__link">
    <span class="md-ellipsis">
      例题2——SICTFround2 签到题来咯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32023-rsa3" class="md-nav__link">
    <span class="md-ellipsis">
      例题3——2023领航杯 RSA3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boneh-durfee" class="md-nav__link">
    <span class="md-ellipsis">
      十八、Boneh-Durfee攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十八、Boneh-Durfee攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2023so-large-e" class="md-nav__link">
    <span class="md-ellipsis">
      例题 2023楚慧杯——so large e
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2023-bd" class="md-nav__link">
    <span class="md-ellipsis">
      例题 2023领航杯 bd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      十九、一些和数论推导相关的题目
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十九、一些和数论推导相关的题目">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1hint-powapbqn" class="md-nav__link">
    <span class="md-ellipsis">
      1.hint = pow(ap+b,q,n)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2hint-powapben" class="md-nav__link">
    <span class="md-ellipsis">
      2.hint = pow(ap+b,e,n)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3q-inverseep" class="md-nav__link">
    <span class="md-ellipsis">
      3.q = inverse(e,p)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4powmpnpowmqn" class="md-nav__link">
    <span class="md-ellipsis">
      4.pow(m,p,n)和pow(m,q,n)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5leak-d-p" class="md-nav__link">
    <span class="md-ellipsis">
      5.leak = d + p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6leak-n-p-q-1" class="md-nav__link">
    <span class="md-ellipsis">
      6.leak = (n + p) % (q-1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7leak-d-p-q" class="md-nav__link">
    <span class="md-ellipsis">
      7.leak = d + p + q
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8leak-powpqn-powqpn-n" class="md-nav__link">
    <span class="md-ellipsis">
      8.leak = pow(p,q,n) + pow(q,p,n) % n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.leak = pow(p,q,n) + pow(q,p,n) % n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2023math_exam" class="md-nav__link">
    <span class="md-ellipsis">
      2023数据安全产业人才能力挑战赛——math_exam
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      二十、剪枝相关
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十、剪枝相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1gift-p-q" class="md-nav__link">
    <span class="md-ellipsis">
      1.gift = p ^ q
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2gift-p-q-16" class="md-nav__link">
    <span class="md-ellipsis">
      2.gift = p ^ （q &gt;&gt; 16）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    <span class="md-ellipsis">
      3.不会取名字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.不会取名字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5.剪枝高位泄露
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#n_1" class="md-nav__link">
    <span class="md-ellipsis">
      二十一、一些分解n常用的方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十一、一些分解n常用的方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    <span class="md-ellipsis">
      1.费马分解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.费马分解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#moectf2023-p-q" class="md-nav__link">
    <span class="md-ellipsis">
      例题——MoeCTF2023 |p-q|
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2p-1" class="md-nav__link">
    <span class="md-ellipsis">
      2.p-1光滑
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.p-1光滑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nctf2019-childrsa" class="md-nav__link">
    <span class="md-ellipsis">
      例题——NCTF2019 childRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3p1" class="md-nav__link">
    <span class="md-ellipsis">
      3.p+1光滑
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4phinn" class="md-nav__link">
    <span class="md-ellipsis">
      4.已知phi和n分解n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.已知phi和n分解n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nkctf2023-ezrsa" class="md-nav__link">
    <span class="md-ellipsis">
      例题——NKCTF2023 ezRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5edn" class="md-nav__link">
    <span class="md-ellipsis">
      5.已知e,d分解n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      二十二、不知道叫什么分类的题目
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十二、不知道叫什么分类的题目">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p-q" class="md-nav__link">
    <span class="md-ellipsis">
      给出p + q低位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p-q_1" class="md-nav__link">
    <span class="md-ellipsis">
      给出p + q高位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p2-q2n-pq" class="md-nav__link">
    <span class="md-ellipsis">
      已知p^2 + q^2分解n = p*q
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      二十三、私钥文件提取参数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十三、私钥文件提取参数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nssctfround16break" class="md-nav__link">
    <span class="md-ellipsis">
      NSSCTFRound16——break
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2022corrupted_key" class="md-nav__link">
    <span class="md-ellipsis">
      2022蓝帽杯——corrupted_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2024ciscnezrsa" class="md-nav__link">
    <span class="md-ellipsis">
      2024CISCN——ezrsa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../05-RE/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    05 RE
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../06-PWN/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    06 PWN
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../07-%E6%B8%97%E9%80%8F/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    07 渗透
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../08-SRC/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    08 SRC
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../09-%E8%BF%90%E7%BB%B4/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    09 运维
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../10-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    10 应急响应
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../11-IOT/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    11 IOT
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../12-FORENSIC/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    12 FORENSIC
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../13-%E5%8C%BA%E5%9D%97%E9%93%BE/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    13 区块链
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../14-%E6%AF%94%E8%B5%9B%E9%A2%98%E8%A7%A3%E5%BD%92%E6%A1%A3/index.html" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    14 比赛题解归档
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rsa_1" class="md-nav__link">
    <span class="md-ellipsis">
      一、RSA算法原理简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一、RSA算法原理简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1.密钥的产生
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2.加密
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3.解密
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4.证明解密的正确性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      二、基础工具
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二、基础工具">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1yafu" class="md-nav__link">
    <span class="md-ellipsis">
      1.yafu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.网站分解
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      三、密钥生成和读取
    </span>
  </a>
  
    <nav class="md-nav" aria-label="三、密钥生成和读取">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      密钥生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="密钥生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      生成公钥
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      生成私钥
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      读取密钥
    </span>
  </a>
  
    <nav class="md-nav" aria-label="读取密钥">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      例题1 泄露私钥
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-oaep" class="md-nav__link">
    <span class="md-ellipsis">
      例题2 OAEP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cr4-poor-rsa" class="md-nav__link">
    <span class="md-ellipsis">
      攻防世界——cr4-poor-rsa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      四、共模攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="四、共模攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      例题2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      五、低加密指数攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="五、低加密指数攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      六、广播攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="六、广播攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#n" class="md-nav__link">
    <span class="md-ellipsis">
      第一种情况 多组n之间可能存在公因数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第一种情况 多组n之间可能存在公因数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buuctf-rsa5" class="md-nav__link">
    <span class="md-ellipsis">
      例题 BUUCTF-RSA5
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例题 BUUCTF-RSA5">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      思路
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      第二种情况 用中国剩余定理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第二种情况 用中国剩余定理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-2021crazy_tech_rsa" class="md-nav__link">
    <span class="md-ellipsis">
      例题2 鹤城杯2021——Crazy_Tech_RSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      七、维纳攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="七、维纳攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      多因子的维纳攻击
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      八、共享素数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="八、共享素数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dp" class="md-nav__link">
    <span class="md-ellipsis">
      九、dp泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="九、dp泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      原理推导
    </span>
  </a>
  
    <nav class="md-nav" aria-label="原理推导">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-e" class="md-nav__link">
    <span class="md-ellipsis">
      例题2 e很大
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例题2 e很大">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#m-powcdpp" class="md-nav__link">
    <span class="md-ellipsis">
      关于m = pow(c,dp,p)的证明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-dp" class="md-nav__link">
    <span class="md-ellipsis">
      例题3 dp高位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="例题3 dp高位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#e" class="md-nav__link">
    <span class="md-ellipsis">
      e不是很大
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#e_1" class="md-nav__link">
    <span class="md-ellipsis">
      e很大
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dpdq" class="md-nav__link">
    <span class="md-ellipsis">
      十、dp,dq泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十、dp,dq泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      十一、考察欧拉函数计算
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十一、考察欧拉函数计算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      例题2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      例题3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ephi" class="md-nav__link">
    <span class="md-ellipsis">
      十二、e和phi不互素
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十二、e和phi不互素">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      处理方式1:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="处理方式1:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      处理方式2:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      两种处理方式的综合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="两种处理方式的综合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#12022ctfshow" class="md-nav__link">
    <span class="md-ellipsis">
      例题1——2022ctfshow卷王杯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22018azurersa" class="md-nav__link">
    <span class="md-ellipsis">
      例题2——2018高校运维挑战赛AzureRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      处理方式3：
    </span>
  </a>
  
    <nav class="md-nav" aria-label="处理方式3：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2021crypto1" class="md-nav__link">
    <span class="md-ellipsis">
      例题 2021黑盾杯Crypto1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rabin" class="md-nav__link">
    <span class="md-ellipsis">
      十三、Rabin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十三、Rabin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      密钥生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      加密过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      解密过程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rabin_1" class="md-nav__link">
    <span class="md-ellipsis">
      多次解Rabin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#m" class="md-nav__link">
    <span class="md-ellipsis">
      十四、m高位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十四、m高位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1m" class="md-nav__link">
    <span class="md-ellipsis">
      情况1：直接给出m的高位
    </span>
  </a>
  
    <nav class="md-nav" aria-label="情况1：直接给出m的高位">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2flag" class="md-nav__link">
    <span class="md-ellipsis">
      情况2:利用flag头等已知信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="情况2:利用flag头等已知信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2024xyctf" class="md-nav__link">
    <span class="md-ellipsis">
      例题——2024XYCTF 反方向的密码 相思
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p" class="md-nav__link">
    <span class="md-ellipsis">
      十五、p高位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十五、p高位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22023litctf-babyxor" class="md-nav__link">
    <span class="md-ellipsis">
      例题2——2023LitCTF Babyxor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      例题3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#d" class="md-nav__link">
    <span class="md-ellipsis">
      十六、d低位泄露
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十六、d低位泄露">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2023badrsa" class="md-nav__link">
    <span class="md-ellipsis">
      2023强网拟态决赛——BadRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#franklin-reiter" class="md-nav__link">
    <span class="md-ellipsis">
      十七、Franklin-Reiter相关消息攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十七、Franklin-Reiter相关消息攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_10" class="md-nav__link">
    <span class="md-ellipsis">
      例题1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2sictfround2" class="md-nav__link">
    <span class="md-ellipsis">
      例题2——SICTFround2 签到题来咯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32023-rsa3" class="md-nav__link">
    <span class="md-ellipsis">
      例题3——2023领航杯 RSA3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boneh-durfee" class="md-nav__link">
    <span class="md-ellipsis">
      十八、Boneh-Durfee攻击
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十八、Boneh-Durfee攻击">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2023so-large-e" class="md-nav__link">
    <span class="md-ellipsis">
      例题 2023楚慧杯——so large e
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2023-bd" class="md-nav__link">
    <span class="md-ellipsis">
      例题 2023领航杯 bd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      十九、一些和数论推导相关的题目
    </span>
  </a>
  
    <nav class="md-nav" aria-label="十九、一些和数论推导相关的题目">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1hint-powapbqn" class="md-nav__link">
    <span class="md-ellipsis">
      1.hint = pow(ap+b,q,n)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2hint-powapben" class="md-nav__link">
    <span class="md-ellipsis">
      2.hint = pow(ap+b,e,n)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3q-inverseep" class="md-nav__link">
    <span class="md-ellipsis">
      3.q = inverse(e,p)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4powmpnpowmqn" class="md-nav__link">
    <span class="md-ellipsis">
      4.pow(m,p,n)和pow(m,q,n)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5leak-d-p" class="md-nav__link">
    <span class="md-ellipsis">
      5.leak = d + p
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6leak-n-p-q-1" class="md-nav__link">
    <span class="md-ellipsis">
      6.leak = (n + p) % (q-1)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7leak-d-p-q" class="md-nav__link">
    <span class="md-ellipsis">
      7.leak = d + p + q
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8leak-powpqn-powqpn-n" class="md-nav__link">
    <span class="md-ellipsis">
      8.leak = pow(p,q,n) + pow(q,p,n) % n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8.leak = pow(p,q,n) + pow(q,p,n) % n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2023math_exam" class="md-nav__link">
    <span class="md-ellipsis">
      2023数据安全产业人才能力挑战赛——math_exam
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      二十、剪枝相关
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十、剪枝相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1gift-p-q" class="md-nav__link">
    <span class="md-ellipsis">
      1.gift = p ^ q
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2gift-p-q-16" class="md-nav__link">
    <span class="md-ellipsis">
      2.gift = p ^ （q &gt;&gt; 16）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_4" class="md-nav__link">
    <span class="md-ellipsis">
      3.不会取名字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4.不会取名字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5.剪枝高位泄露
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#n_1" class="md-nav__link">
    <span class="md-ellipsis">
      二十一、一些分解n常用的方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十一、一些分解n常用的方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_11" class="md-nav__link">
    <span class="md-ellipsis">
      1.费马分解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.费马分解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#moectf2023-p-q" class="md-nav__link">
    <span class="md-ellipsis">
      例题——MoeCTF2023 |p-q|
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2p-1" class="md-nav__link">
    <span class="md-ellipsis">
      2.p-1光滑
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.p-1光滑">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nctf2019-childrsa" class="md-nav__link">
    <span class="md-ellipsis">
      例题——NCTF2019 childRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3p1" class="md-nav__link">
    <span class="md-ellipsis">
      3.p+1光滑
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4phinn" class="md-nav__link">
    <span class="md-ellipsis">
      4.已知phi和n分解n
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.已知phi和n分解n">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nkctf2023-ezrsa" class="md-nav__link">
    <span class="md-ellipsis">
      例题——NKCTF2023 ezRSA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5edn" class="md-nav__link">
    <span class="md-ellipsis">
      5.已知e,d分解n
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      二十二、不知道叫什么分类的题目
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十二、不知道叫什么分类的题目">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p-q" class="md-nav__link">
    <span class="md-ellipsis">
      给出p + q低位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p-q_1" class="md-nav__link">
    <span class="md-ellipsis">
      给出p + q高位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p2-q2n-pq" class="md-nav__link">
    <span class="md-ellipsis">
      已知p^2 + q^2分解n = p*q
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      二十三、私钥文件提取参数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二十三、私钥文件提取参数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nssctfround16break" class="md-nav__link">
    <span class="md-ellipsis">
      NSSCTFRound16——break
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2022corrupted_key" class="md-nav__link">
    <span class="md-ellipsis">
      2022蓝帽杯——corrupted_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2024ciscnezrsa" class="md-nav__link">
    <span class="md-ellipsis">
      2024CISCN——ezrsa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="rsa">RSA入门<a class="headerlink" href="#rsa" title="Permanent link">&para;</a></h1>
<p><a href="https://dexterjie.github.io/">原文链接</a></p>
<p>RSA学习过程，对常见题型进行了整合</p>
<p>发表于2023年7月6日。于2024年7月15日进行更新，把以前三篇有关RSA的内容整合成一篇，添加了一些题目，并且去除了冗余的内容</p>
<h2 id="rsa_1">一、RSA算法原理简介<a class="headerlink" href="#rsa_1" title="Permanent link">&para;</a></h2>
<h3 id="1">1.密钥的产生<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>选择两个保密的大素数<span class="arithmatex">\(p\)</span>和<span class="arithmatex">\(q\)</span></p>
</li>
<li>
<p>计算<span class="arithmatex">\(n = p \times q,\phi(n) = (p-1)(q-1)\)</span>，其中<span class="arithmatex">\(\phi(n)\)</span>是n的欧拉函数值</p>
</li>
<li>
<p>选一整数<span class="arithmatex">\(e\)</span>，满足<span class="arithmatex">\(1 &lt; e &lt; \phi(n)\)</span>，且<span class="arithmatex">\(gcd(\phi(n),e) = 1\)</span></p>
</li>
<li>
<p>计算<span class="arithmatex">\(d\)</span>，满足<span class="arithmatex">\(ed \equiv 1 \mod \phi(n)\)</span>。即<span class="arithmatex">\(d\)</span>是e在模<span class="arithmatex">\(\phi(n)\)</span>下的乘法逆元，因为<span class="arithmatex">\(e\)</span>和<span class="arithmatex">\(\phi(n)\)</span>互素，所以<span class="arithmatex">\(d\)</span>必定存在</p>
</li>
<li>
<p>以<span class="arithmatex">\((e,n)\)</span>为公开钥，<span class="arithmatex">\((d,n)\)</span>为秘密钥</p>
</li>
</ol>
<h3 id="2">2.加密<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>加密时，先把明文比特串分组，使得每个分组对应的十进制数<span class="arithmatex">\(&lt;n\)</span>，即分组长度小于<span class="arithmatex">\(log_2n\)</span>。如然后对每个明文分组<span class="arithmatex">\(m\)</span>，作加密运算:</p>
<div class="arithmatex">\[
c \equiv m^e \mod n
\]</div>
<h3 id="3">3.解密<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<p>对密文分组的解密运算:</p>
<div class="arithmatex">\[
m \equiv c ^d \mod n
\]</div>
<h3 id="4">4.证明解密的正确性<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<p>情况1:<span class="arithmatex">\(m,n\)</span>互素。由欧拉定理:</p>
<div class="arithmatex">\[
c^d \equiv m^{ed} \equiv m^{k\phi(n)+1} \equiv m\times (m^{\phi(n)})^k \equiv m \mod n
\]</div>
<p>即<span class="arithmatex">\(c^d \equiv m \mod n\)</span></p>
<p>情况2:<span class="arithmatex">\(m,n\)</span>不互素。</p>
<p>因为<span class="arithmatex">\(m,n\)</span>不互素，注意到<span class="arithmatex">\(n = pq\)</span>，所以此时<span class="arithmatex">\(m\)</span>是<span class="arithmatex">\(p\)</span>或者<span class="arithmatex">\(q\)</span>的倍数。假设<span class="arithmatex">\(m\)</span>是<span class="arithmatex">\(p\)</span>的倍数，即<span class="arithmatex">\(m = tp\)</span></p>
<p>此时<span class="arithmatex">\(gcd(m,q) = 1\)</span>，否则<span class="arithmatex">\(m\)</span>也是<span class="arithmatex">\(q\)</span>的倍数，从而<span class="arithmatex">\(m\)</span>是n的倍数，这与明文分组<span class="arithmatex">\(m &lt; n\)</span>矛盾。所以不可能</p>
<p>由<span class="arithmatex">\(gcd(m,q) = 1\)</span>得</p>
<div class="arithmatex">\[
m ^{\phi(q)} \equiv 1 \mod q 
\]</div>
<p>所以</p>
<div class="arithmatex">\[
m^{k\phi(p)\phi(q)} \equiv (m^{\phi(q)})^{k\phi(p)} \equiv 1\mod q
\]</div>
<p>即<span class="arithmatex">\(m^{k\phi(n)} \equiv 1 \mod q\)</span>，也就是<span class="arithmatex">\(m^{k\phi(n)} = kq + 1\)</span></p>
<p>两边同时乘上<span class="arithmatex">\(m = tp\)</span>，得<span class="arithmatex">\(m^{k\phi(n)+1} \equiv ktpq + m = m+tkn\)</span></p>
<p>也就是<span class="arithmatex">\(m^{k\phi(n)+1} \equiv m \mod n\)</span></p>
<h2 id="_1">二、基础工具<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="1yafu">1.yafu<a class="headerlink" href="#1yafu" title="Permanent link">&para;</a></h3>
<p>使用方法:进入yafu所在的文件夹，输入命令<code>yafu-x64 factor(n)</code></p>
<p><img alt="" src="../../images/RSA/52.png" /></p>
<h3 id="2_1">2.网站分解<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<p>http://www.factordb.com/index.php</p>
<h2 id="_2">三、密钥生成和读取<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="_3">密钥生成<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>通过<code>Crypto.PublicKey.RSA</code>中的<code>construct</code>函数可以生成公钥和私钥。</p>
<p>对于生成公钥，需要两个参数<span class="arithmatex">\(n,e\)</span>，生成私钥需要<span class="arithmatex">\(n,e,d\)</span></p>
<p>需要配合<code>exprot_Key</code>使用</p>
<h4 id="_4">生成公钥<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><a href="#__codelineno-0-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><a href="#__codelineno-0-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><a href="#__codelineno-0-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><a href="#__codelineno-0-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><a href="#__codelineno-0-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><a href="#__codelineno-0-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><a href="#__codelineno-0-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><a href="#__codelineno-0-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><a href="#__codelineno-0-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><a href="#__codelineno-0-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">publickey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><a href="#__codelineno-0-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;publickey.pem&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><a href="#__codelineno-0-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">publickey</span><span class="o">.</span><span class="n">export_key</span><span class="p">())</span>
</code></pre></div>
<h4 id="_5">生成私钥<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>必需参数是<span class="arithmatex">\(n,e,d\)</span>，可添参数是<span class="arithmatex">\(p,q\)</span></p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><a href="#__codelineno-1-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><a href="#__codelineno-1-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><a href="#__codelineno-1-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><a href="#__codelineno-1-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><a href="#__codelineno-1-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><a href="#__codelineno-1-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><a href="#__codelineno-1-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><a href="#__codelineno-1-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><a href="#__codelineno-1-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><a href="#__codelineno-1-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><a href="#__codelineno-1-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><a href="#__codelineno-1-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><a href="#__codelineno-1-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><a href="#__codelineno-1-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">publickey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><a href="#__codelineno-1-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">privatekey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><a href="#__codelineno-1-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><a href="#__codelineno-1-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;publickey.pem&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><a href="#__codelineno-1-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">publickey</span><span class="o">.</span><span class="n">export_key</span><span class="p">())</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><a href="#__codelineno-1-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><a href="#__codelineno-1-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;privatekey.pem&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><a href="#__codelineno-1-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">privatekey</span><span class="o">.</span><span class="n">export_key</span><span class="p">())</span>
</code></pre></div>
<h3 id="_6">读取密钥<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><a href="#__codelineno-2-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><a href="#__codelineno-2-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><a href="#__codelineno-2-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_Key</span><span class="p">(</span><span class="n">文件</span><span class="p">)</span>
</code></pre></div>
<p>key中有p,q,n,e,d五个属性，一般题目也就给了公钥，所以只有n,e是能读取的</p>
<h4 id="1_1">例题1 泄露私钥<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><a href="#__codelineno-3-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><a href="#__codelineno-3-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><a href="#__codelineno-3-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><a href="#__codelineno-3-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><a href="#__codelineno-3-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><a href="#__codelineno-3-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><a href="#__codelineno-3-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><a href="#__codelineno-3-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><a href="#__codelineno-3-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><a href="#__codelineno-3-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><a href="#__codelineno-3-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><a href="#__codelineno-3-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><a href="#__codelineno-3-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><a href="#__codelineno-3-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><a href="#__codelineno-3-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><a href="#__codelineno-3-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><a href="#__codelineno-3-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><a href="#__codelineno-3-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">#</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><a href="#__codelineno-3-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><a href="#__codelineno-3-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><a href="#__codelineno-3-21"><span class="linenos" data-linenos="21 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><a href="#__codelineno-3-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><a href="#__codelineno-3-23"><span class="linenos" data-linenos="23 "></span></a><span class="c1">## 生成公钥</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><a href="#__codelineno-3-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">rsa_components</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><a href="#__codelineno-3-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">keypair</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">rsa_components</span><span class="p">)</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><a href="#__codelineno-3-26"><span class="linenos" data-linenos="26 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;pubckey.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><a href="#__codelineno-3-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">keypair</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>
</code></pre></div>
<p>题目中把d也传入数据了，直接读取d解密即可</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><a href="#__codelineno-4-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><a href="#__codelineno-4-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><a href="#__codelineno-4-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><a href="#__codelineno-4-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.pem&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><a href="#__codelineno-4-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;publickey.pem&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><a href="#__codelineno-4-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">e</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><a href="#__codelineno-4-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">n</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><a href="#__codelineno-4-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">d</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><a href="#__codelineno-4-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><a href="#__codelineno-4-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><a href="#__codelineno-4-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><a href="#__codelineno-4-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1">## flag{947ce8a3-40ee-46c0-a00e-0026e583f8da}</span>
</code></pre></div>
<h4 id="2-oaep">例题2 OAEP<a class="headerlink" href="#2-oaep" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><a href="#__codelineno-5-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><a href="#__codelineno-5-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><a href="#__codelineno-5-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><a href="#__codelineno-5-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><a href="#__codelineno-5-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><a href="#__codelineno-5-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><a href="#__codelineno-5-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><a href="#__codelineno-5-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><a href="#__codelineno-5-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><a href="#__codelineno-5-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><a href="#__codelineno-5-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><a href="#__codelineno-5-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><a href="#__codelineno-5-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><a href="#__codelineno-5-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><a href="#__codelineno-5-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><a href="#__codelineno-5-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><a href="#__codelineno-5-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><a href="#__codelineno-5-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">#</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><a href="#__codelineno-5-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">## 生成公钥</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><a href="#__codelineno-5-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">rsa_components</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><a href="#__codelineno-5-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">keypair</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">rsa_components</span><span class="p">)</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><a href="#__codelineno-5-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;prikey2.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><a href="#__codelineno-5-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">keypair</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><a href="#__codelineno-5-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><a href="#__codelineno-5-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">rsa_components</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">e</span><span class="p">,)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><a href="#__codelineno-5-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">arsa</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">rsa_components</span><span class="p">)</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><a href="#__codelineno-5-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">rsakey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">arsa</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><a href="#__codelineno-5-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">rsakey</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">rsakey</span><span class="p">)</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><a href="#__codelineno-5-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="n">rsakey</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><a href="#__codelineno-5-30"><span class="linenos" data-linenos="30 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag2.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><a href="#__codelineno-5-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</code></pre></div>
<p>了解了一下函数</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><a href="#__codelineno-6-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">hashAlgo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mgfunc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>
<p>参数含义如下：</p>
<blockquote>
<p>key:RSA密钥，可以是公钥或私钥；</p>
<p>hashAlgo:哈希算法，默认为SHA-1；</p>
<p>myfunc:消息生成函数，默认为MGF1；</p>
<p>label:可选的附加数据，默认为空。</p>
</blockquote>
<p>key是必需参数</p>
<p>使用<code>PKCS1_OAEP.new</code>初始化后，可以调用其实例方法<code>encrypt</code>和<code>decrypt</code>实现RSA-OAEP算法的加密和解密操作</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><a href="#__codelineno-7-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><a href="#__codelineno-7-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey.RSA</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><a href="#__codelineno-7-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><a href="#__codelineno-7-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag2.pem&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><a href="#__codelineno-7-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="n">import_key</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;prikey2.pem&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><a href="#__codelineno-7-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><a href="#__codelineno-7-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">newkey</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><a href="#__codelineno-7-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">newkey</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><a href="#__codelineno-7-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><a href="#__codelineno-7-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><a href="#__codelineno-7-11"><span class="linenos" data-linenos="11 "></span></a><span class="c1">#flag{04bbaad0-9241-42a4-9fd4-7d6e0d8bc5f1}</span>
</code></pre></div>
<h4 id="cr4-poor-rsa">攻防世界——cr4-poor-rsa<a class="headerlink" href="#cr4-poor-rsa" title="Permanent link">&para;</a></h4>
<p>题目给了个无后缀的文件，拖到010发现里面有藏两个文件，于是把后缀改成了zip</p>
<p>打开后得到两个文件，<strong>分别是key.pub和flag.b64</strong></p>
<blockquote>
<p>key.pub</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><a href="#__codelineno-8-1"><span class="linenos" data-linenos="1 "></span></a>-----BEGIN PUBLIC KEY-----
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><a href="#__codelineno-8-2"><span class="linenos" data-linenos="2 "></span></a>ME0wDQYJKoZIhvcNAQEBBQADPAAwOQIyUqmeJJ7nzzwMv5Y6AJZhdyvJzfbh4/v8
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><a href="#__codelineno-8-3"><span class="linenos" data-linenos="3 "></span></a>bkSgel4PiURXqfgcOuEyrFaD01soulwyQkMCAwEAAQ==
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><a href="#__codelineno-8-4"><span class="linenos" data-linenos="4 "></span></a>-----END PUBLIC KEY-----
</code></pre></div>
<blockquote>
<p>flag.b64</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><a href="#__codelineno-9-1"><span class="linenos" data-linenos="1 "></span></a>Ni45iH4UnXSttNuf0Oy80+G5J7tm8sBJuDNN7qfTIdEKJow4siF2cpSbP/qIWDjSi+w=
</code></pre></div>
<p>先试着读取公钥，发现n可以分解，于是就按常规流程做了</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><a href="#__codelineno-10-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><a href="#__codelineno-10-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey.RSA</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><a href="#__codelineno-10-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><a href="#__codelineno-10-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><a href="#__codelineno-10-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><a href="#__codelineno-10-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.b64&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><a href="#__codelineno-10-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><a href="#__codelineno-10-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="n">import_key</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;key.pub&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><a href="#__codelineno-10-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><a href="#__codelineno-10-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">863653476616376575308866344984576466644942572246900013156919</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><a href="#__codelineno-10-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">965445304326998194798282228842484732438457170595999523426901</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><a href="#__codelineno-10-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><a href="#__codelineno-10-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><a href="#__codelineno-10-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><a href="#__codelineno-10-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><a href="#__codelineno-10-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><a href="#__codelineno-10-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">#XCTF{SMALL_PRIMES_ARE_BAD}</span>
</code></pre></div>
<h2 id="_7">四、共模攻击<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>共模攻击：</p>
<p><strong>在对同一明文的加密过程中使用相同的模数n，对同一明文，用不同的密钥e（两个密钥是互素的）进行加密</strong></p>
<p><strong>结果是得到两个不同的c</strong></p>
<p>原理：</p>
<div class="arithmatex">\[
\begin{align}
c_1 \equiv m^{e_1} \mod n\\\\
c_2 \equiv m^{e_2} \mod n
\end{align}
\]</div>
<p>通过欧几里得扩展算法我们能得到<span class="arithmatex">\(x,y\)</span>满足<span class="arithmatex">\(e_1x+e_2y = 1\)</span></p>
<div class="arithmatex">\[
\therefore c_1^x \times c_2^y \equiv m^{e_1x + e_2y} \equiv m \mod n
\]</div>
<h3 id="1_2">例题1<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><a href="#__codelineno-11-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><a href="#__codelineno-11-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><a href="#__codelineno-11-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><a href="#__codelineno-11-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><a href="#__codelineno-11-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><a href="#__codelineno-11-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><a href="#__codelineno-11-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><a href="#__codelineno-11-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><a href="#__codelineno-11-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><a href="#__codelineno-11-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e1</span> <span class="o">=</span> <span class="mi">2333</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><a href="#__codelineno-11-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">e2</span> <span class="o">=</span> <span class="mi">23333</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><a href="#__codelineno-11-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><a href="#__codelineno-11-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><a href="#__codelineno-11-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><a href="#__codelineno-11-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n1=&quot;</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><a href="#__codelineno-11-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n2=&quot;</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><a href="#__codelineno-11-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1=&quot;</span><span class="p">,</span> <span class="n">e1</span><span class="p">)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><a href="#__codelineno-11-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2=&quot;</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a><a href="#__codelineno-11-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c1=&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a><a href="#__codelineno-11-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c2=&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a><a href="#__codelineno-11-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a><a href="#__codelineno-11-22"><span class="linenos" data-linenos="22 "></span></a><span class="c1">#n1 = 12023886737570921683430494088148056717464277480371493354080633886982376602419433228186314817561301719123238737516332784081267153425832030515178119047675516911098595227477026283152544604891747727831780305507300318674027062554009254728767714650522432836286987070040177863862115871377017779058128916872854380528430193235920536818893053943407063308419618772087299760070707222914961338101044775521373972076936552277418325268112523349134412986872504187930360266568935217397303420305220796347316727211659529079762169876950534044014924448371804442314283893083178368082712851107281302456671010073505430574108861981588149293779</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a><a href="#__codelineno-11-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="mi">12023886737570921683430494088148056717464277480371493354080633886982376602419433228186314817561301719123238737516332784081267153425832030515178119047675516911098595227477026283152544604891747727831780305507300318674027062554009254728767714650522432836286987070040177863862115871377017779058128916872854380528430193235920536818893053943407063308419618772087299760070707222914961338101044775521373972076936552277418325268112523349134412986872504187930360266568935217397303420305220796347316727211659529079762169876950534044014924448371804442314283893083178368082712851107281302456671010073505430574108861981588149293779</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a><a href="#__codelineno-11-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">e1</span> <span class="o">=</span> <span class="mi">2333</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a><a href="#__codelineno-11-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">e2</span> <span class="o">=</span> <span class="mi">23333</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a><a href="#__codelineno-11-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="mi">1316116662134770690879814362103839780623420120527248536043840592146479052480574077985474161623763978563721124073172820410730492348846200098142706235343164470686127445583938273863894304189618247054649514955176136464273395879832878841555224421879457659795562326746943199675846414637238040550327393009642569894024250271081839428945999237716296592560124669418322569188493036148885333003876760965512925618500360394774816066758106739359762817644284120811162065280330204951295150904138010974815308787047834776406610525102814356091515999954110712767658162496023213125548829820563945272374105274832862682574678195529192009516</span>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a><a href="#__codelineno-11-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">c2</span> <span class="o">=</span><span class="mi">6485241395763328009719746130709898541269729483150505308808259329749145687803066648274311801821624527910483266170666538736992203392620205417714840881369386852010836477498279266591695876758050686740322941452286584178315830797555697887040771666991377055060541491757349967338300117181859105577325308779010792879713808168285776399372981366988860647334022480774711504685240194804912592209253106123423232743785805952113875347267336118332317990496240807273787216894980604742600774512296661048914646776553393778079057461747246478299158814839681875752645552215714984659603917168300453505504140987829883479097467840565806608012</span>
</code></pre></div>
<p><code>m = pow(c1,x,n) * pow(c2,y,n) % n</code></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><a href="#__codelineno-12-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><a href="#__codelineno-12-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><a href="#__codelineno-12-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><a href="#__codelineno-12-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">12023886737570921683430494088148056717464277480371493354080633886982376602419433228186314817561301719123238737516332784081267153425832030515178119047675516911098595227477026283152544604891747727831780305507300318674027062554009254728767714650522432836286987070040177863862115871377017779058128916872854380528430193235920536818893053943407063308419618772087299760070707222914961338101044775521373972076936552277418325268112523349134412986872504187930360266568935217397303420305220796347316727211659529079762169876950534044014924448371804442314283893083178368082712851107281302456671010073505430574108861981588149293779</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><a href="#__codelineno-12-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e1</span> <span class="o">=</span> <span class="mi">2333</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><a href="#__codelineno-12-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e2</span> <span class="o">=</span> <span class="mi">23333</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><a href="#__codelineno-12-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c1</span> <span class="o">=</span><span class="mi">1316116662134770690879814362103839780623420120527248536043840592146479052480574077985474161623763978563721124073172820410730492348846200098142706235343164470686127445583938273863894304189618247054649514955176136464273395879832878841555224421879457659795562326746943199675846414637238040550327393009642569894024250271081839428945999237716296592560124669418322569188493036148885333003876760965512925618500360394774816066758106739359762817644284120811162065280330204951295150904138010974815308787047834776406610525102814356091515999954110712767658162496023213125548829820563945272374105274832862682574678195529192009516</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><a href="#__codelineno-12-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">c2</span> <span class="o">=</span><span class="mi">6485241395763328009719746130709898541269729483150505308808259329749145687803066648274311801821624527910483266170666538736992203392620205417714840881369386852010836477498279266591695876758050686740322941452286584178315830797555697887040771666991377055060541491757349967338300117181859105577325308779010792879713808168285776399372981366988860647334022480774711504685240194804912592209253106123423232743785805952113875347267336118332317990496240807273787216894980604742600774512296661048914646776553393778079057461747246478299158814839681875752645552215714984659603917168300453505504140987829883479097467840565806608012</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><a href="#__codelineno-12-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><a href="#__codelineno-12-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">s</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcdext</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><a href="#__codelineno-12-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">))</span><span class="o">%</span><span class="n">n</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><a href="#__codelineno-12-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><a href="#__codelineno-12-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><a href="#__codelineno-12-14"><span class="linenos" data-linenos="14 "></span></a><span class="c1">#flag{01d80670b01b654fe4831a3e81870734}</span>
</code></pre></div>
<p><code>gcdext(e1,e2)</code>返回3个元素</p>
<p>第一个元素是<span class="arithmatex">\(Boolean\)</span>类型的数据，判断存不存在<span class="arithmatex">\(x,y\)</span>使得<span class="arithmatex">\(e_1x+e_2y = 1\)</span></p>
<p>返回得第二个和第三个元素是<span class="arithmatex">\(x,y\)</span></p>
<h3 id="2_2">例题2<a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h3>
<p>这个例题的情况是<span class="arithmatex">\(gcd(e_1,e_2)\ne 1\)</span></p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><a href="#__codelineno-13-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><a href="#__codelineno-13-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">getrandbits</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><a href="#__codelineno-13-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><a href="#__codelineno-13-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><a href="#__codelineno-13-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><a href="#__codelineno-13-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><a href="#__codelineno-13-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><a href="#__codelineno-13-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><a href="#__codelineno-13-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><a href="#__codelineno-13-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><a href="#__codelineno-13-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><a href="#__codelineno-13-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">e1</span> <span class="o">=</span> <span class="n">getrandbits</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><a href="#__codelineno-13-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">e2</span> <span class="o">=</span> <span class="n">getrandbits</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><a href="#__codelineno-13-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">if</span> <span class="n">e1</span> <span class="o">!=</span> <span class="n">e2</span> <span class="ow">and</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><a href="#__codelineno-13-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="k">break</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><a href="#__codelineno-13-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><a href="#__codelineno-13-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a><a href="#__codelineno-13-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><a href="#__codelineno-13-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1 =&quot;</span><span class="p">,</span> <span class="n">e1</span><span class="p">)</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><a href="#__codelineno-13-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2 =&quot;</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a><a href="#__codelineno-13-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n =&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a><a href="#__codelineno-13-22"><span class="linenos" data-linenos="22 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c1 =&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a><a href="#__codelineno-13-23"><span class="linenos" data-linenos="23 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c2 =&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
</code></pre></div>
<p>这种题目我们还是正常推导，设<span class="arithmatex">\(t = gcd(e_1,e_2)\)</span>，通过扩展欧几里得算法，有</p>
<div class="arithmatex">\[
e_1x + e_2y = t
\]</div>
<p>则</p>
<div class="arithmatex">\[
c_1^x \times c_2^y \equiv m^{e_1x+e_2y} \equiv m^t \mod n
\]</div>
<p>根据t的大小再进行不同的处理，比如t=3，那么可以试着用低加密指数的思路进行处理。</p>
<p>如果t比较大，那么可以再次当作一次RSA进行求解。</p>
<p>本例t = 2，直接开根就行</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><a href="#__codelineno-14-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><a href="#__codelineno-14-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><a href="#__codelineno-14-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><a href="#__codelineno-14-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">e1</span> <span class="o">=</span> <span class="mi">578</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><a href="#__codelineno-14-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e2</span> <span class="o">=</span> <span class="mi">392</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><a href="#__codelineno-14-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">21792499489446653209359648268647408248484077502636323240941263512972521642966446318685589383376089358615828479732487823375467576966410911798574546152698546172208644494120844910028661801069139412883722092087841337354582470102991346201250757430966278341015814968426027288609918021263801588485143246793300627932938615206724828284751003817198828431954277335825721403220979778254648036632075276172476930299390290573025768956364488376300510746252434716167769851984446036711610150897081622960442923737196929758209816434803424884970510663599653463189492521652184966337230394292288573277654840483815385709060428243829968709733</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><a href="#__codelineno-14-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="mi">1295899105546936416711955776176786556954959764395004520666273768220642845167647126115394711085928049897436984534359683209799926877399786065216458011526399070534983898250382591372240231327810785046739203554803467534631081973525005181861203752320250219830020069663762443152692331055158533035896110900630817135766754326408199206651276750278716441636585609321276880631239079781048185864263400051324827820941692502756433463495216541801444097560942509859140724554853380906157874504969878938634453309110942314571026225239704634981956565844426060346340677136929914119932647724346392582368980017754022031748246759437397697793</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><a href="#__codelineno-14-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="mi">6100251841868768392049795926373721745054594119167283623934416754665831830741776139556785242664295441966913393337547165974512844660057299278828165715333417692799802949938590574117892067491764731548261988101287152727657523152041485072722017224763458684855801781252103126948392647769522681887089175624603484575515518773338807587100984947122699045372679023951413797420560947466351031076552444459222063798664625809884979352261000568340687804017980769948161583294444251776973765636460565633962599948356942127522339715718463747197473475842874431177106692482361060930677857750098337273277996678196019443721319477484374253966</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><a href="#__codelineno-14-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><a href="#__codelineno-14-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><a href="#__codelineno-14-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">s</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcdext</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><a href="#__codelineno-14-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">((</span><span class="nb">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">))</span><span class="o">%</span><span class="n">n</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><a href="#__codelineno-14-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
<h2 id="_8">五、低加密指数攻击<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>原理：</p>
<p>加密指数e很小一般是3，导致出现两个情况</p>
<p>第一种情况：<span class="arithmatex">\(m^e &lt; n\)</span> 则 <span class="arithmatex">\(c \equiv m^{e} \mod  n \longrightarrow c = m^e\)</span> 这种情况下对c开e次方就可以得到m的值</p>
<p>第二种情况：<span class="arithmatex">\(m^e &gt; n\)</span>(略大一点点)，则<span class="arithmatex">\(m^e = k*n + c\)</span>这种情况需要爆破k</p>
<h3 id="_9">例题<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><a href="#__codelineno-15-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><a href="#__codelineno-15-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><a href="#__codelineno-15-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><a href="#__codelineno-15-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><a href="#__codelineno-15-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><a href="#__codelineno-15-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(</span><span class="n">m</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><a href="#__codelineno-15-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><a href="#__codelineno-15-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">504</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><a href="#__codelineno-15-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">504</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><a href="#__codelineno-15-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><a href="#__codelineno-15-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">phi_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><a href="#__codelineno-15-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><a href="#__codelineno-15-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">if</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>  <span class="n">phi_n</span><span class="o">%</span><span class="n">e</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><a href="#__codelineno-15-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">break</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><a href="#__codelineno-15-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><a href="#__codelineno-15-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><a href="#__codelineno-15-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><a href="#__codelineno-15-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><a href="#__codelineno-15-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><a href="#__codelineno-15-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><a href="#__codelineno-15-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1">#c= 17567615026662297423639652671128685098763112348521263232850922784902991105809108670614334001294254886850775709702759646022208238160649099765454315761185950859820327234504422026634432251632399712621439201146</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><a href="#__codelineno-15-22"><span class="linenos" data-linenos="22 "></span></a><span class="mi">3091635444512796333373451321795475333496092463760390199602320265733668648810943598505902205569125</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><a href="#__codelineno-15-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">1101676297168703265566511587913652821222614528632844563918598090813090976948138058144049294690727841463413972173051671908835164088465174349647584948964206244648736138253802417241570633968307801570794459668533128958442296813160786428069813867034205462528763830205245218089660432399549540588101288362866463</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><a href="#__codelineno-15-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><a href="#__codelineno-16-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><a href="#__codelineno-16-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><a href="#__codelineno-16-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><a href="#__codelineno-16-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">1101676297168703265566511587913652821222614528632844563918598090813090976948138058144049294690727841463413972173051671908835164088465174349647584948964206244648736138253802417241570633968307801570794459668533128958442296813160786428069813867034205462528763830205245218089660432399549540588101288362866463</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><a href="#__codelineno-16-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><a href="#__codelineno-16-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">175676150266622974236396526711286850987631123485212632328509227849029911058091086706143340012942548868507757097027596460222082381606490997654543157611859508598203272345044220266344322516323997126214392011463091635444512796333373451321795475333496092463760390199602320265733668648810943598505902205569125</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><a href="#__codelineno-16-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><a href="#__codelineno-16-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><a href="#__codelineno-16-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><a href="#__codelineno-16-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><a href="#__codelineno-16-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><a href="#__codelineno-16-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><a href="#__codelineno-16-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">()</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><a href="#__codelineno-16-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">c</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><a href="#__codelineno-16-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><a href="#__codelineno-16-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><a href="#__codelineno-16-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="k">break</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><a href="#__codelineno-16-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><a href="#__codelineno-16-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
<h2 id="_10">六、广播攻击<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>原理：</p>
<p>明文<span class="arithmatex">\(m\)</span>用相同的密钥<span class="arithmatex">\(e\)</span>和不同的模<span class="arithmatex">\(n\)</span>进行加密</p>
<p>一般会得到几组不同的<span class="arithmatex">\(n\)</span>和<span class="arithmatex">\(c\)</span></p>
<h3 id="n">第一种情况 多组n之间可能存在公因数<a class="headerlink" href="#n" title="Permanent link">&para;</a></h3>
<h4 id="buuctf-rsa5">例题 BUUCTF-RSA5<a class="headerlink" href="#buuctf-rsa5" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.txt</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><a href="#__codelineno-17-1"><span class="linenos" data-linenos=" 1 "></span></a>m = xxxxxxxx
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><a href="#__codelineno-17-2"><span class="linenos" data-linenos=" 2 "></span></a>e = 65537
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><a href="#__codelineno-17-3"><span class="linenos" data-linenos=" 3 "></span></a>========== n c ==========
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><a href="#__codelineno-17-4"><span class="linenos" data-linenos=" 4 "></span></a>n = 20474918894051778533305262345601880928088284471121823754049725354072477155873778848055073843345820697886641086842612486541250183965966001591342031562953561793332341641334302847996108417466360688139866505179689516589305636902137210185624650854906780037204412206309949199080005576922775773722438863762117750429327585792093447423980002401200613302943834212820909269713876683465817369158585822294675056978970612202885426436071950214538262921077409076160417436699836138801162621314845608796870206834704116707763169847387223307828908570944984416973019427529790029089766264949078038669523465243837675263858062854739083634207
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><a href="#__codelineno-17-5"><span class="linenos" data-linenos=" 5 "></span></a>c = 974463908243330865728978769213595400782053398596897741316275722596415018912929508637393850919224969271766388710025195039896961956062895570062146947736340342927974992616678893372744261954172873490878805483241196345881721164078651156067119957816422768524442025688079462656755605982104174001635345874022133045402344010045961111720151990412034477755851802769069309069018738541854130183692204758761427121279982002993939745343695671900015296790637464880337375511536424796890996526681200633086841036320395847725935744757993013352804650575068136129295591306569213300156333650910795946800820067494143364885842896291126137320
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><a href="#__codelineno-17-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><a href="#__codelineno-17-7"><span class="linenos" data-linenos=" 7 "></span></a>n = 20918819960648891349438263046954902210959146407860980742165930253781318759285692492511475263234242002509419079545644051755251311392635763412553499744506421566074721268822337321637265942226790343839856182100575539845358877493718334237585821263388181126545189723429262149630651289446553402190531135520836104217160268349688525168375213462570213612845898989694324269410202496871688649978370284661017399056903931840656757330859626183773396574056413017367606446540199973155630466239453637232936904063706551160650295031273385619470740593510267285957905801566362502262757750629162937373721291789527659531499435235261620309759
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><a href="#__codelineno-17-8"><span class="linenos" data-linenos=" 8 "></span></a>c = 15819636201971185538694880505120469332582151856714070824521803121848292387556864177196229718923770810072104155432038682511434979353089791861087415144087855679134383396897817458726543883093567600325204596156649305930352575274039425470836355002691145864435755333821133969266951545158052745938252574301327696822347115053614052423028835532509220641378760800693351542633860702225772638930501021571415907348128269681224178300248272689705308911282208685459668200507057183420662959113956077584781737983254788703048275698921427029884282557468334399677849962342196140864403989162117738206246183665814938783122909930082802031855
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><a href="#__codelineno-17-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><a href="#__codelineno-17-10"><span class="linenos" data-linenos="10 "></span></a>n = 25033254625906757272369609119214202033162128625171246436639570615263949157363273213121556825878737923265290579551873824374870957467163989542063489416636713654642486717219231225074115269684119428086352535471683359486248203644461465935500517901513233739152882943010177276545128308412934555830087776128355125932914846459470221102007666912211992310538890654396487111705385730502843589727289829692152177134753098649781412247065660637826282055169991824099110916576856188876975621376606634258927784025787142263367152947108720757222446686415627479703666031871635656314282727051189190889008763055811680040315277078928068816491
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><a href="#__codelineno-17-11"><span class="linenos" data-linenos="11 "></span></a>c = 4185308529416874005831230781014092407198451385955677399668501833902623478395669279404883990725184332709152443372583701076198786635291739356770857286702107156730020004358955622511061410661058982622055199736820808203841446796305284394651714430918690389486920560834672316158146453183789412140939029029324756035358081754426645160033262924330248675216108270980157049705488620263485129480952814764002865280019185127662449318324279383277766416258142275143923532168798413011028271543085249029048997452212503111742302302065401051458066585395360468447460658672952851643547193822775218387853623453638025492389122204507555908862
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><a href="#__codelineno-17-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><a href="#__codelineno-17-13"><span class="linenos" data-linenos="13 "></span></a>n = 21206968097314131007183427944486801953583151151443627943113736996776787181111063957960698092696800555044199156765677935373149598221184792286812213294617749834607696302116136745662816658117055427803315230042700695125718401646810484873064775005221089174056824724922160855810527236751389605017579545235876864998419873065217294820244730785120525126565815560229001887622837549118168081685183371092395128598125004730268910276024806808565802081366898904032509920453785997056150497645234925528883879419642189109649009132381586673390027614766605038951015853086721168018787523459264932165046816881682774229243688581614306480751
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><a href="#__codelineno-17-14"><span class="linenos" data-linenos="14 "></span></a>c = 4521038011044758441891128468467233088493885750850588985708519911154778090597136126150289041893454126674468141393472662337350361712212694867311622970440707727941113263832357173141775855227973742571088974593476302084111770625764222838366277559560887042948859892138551472680654517814916609279748365580610712259856677740518477086531592233107175470068291903607505799432931989663707477017904611426213770238397005743730386080031955694158466558475599751940245039167629126576784024482348452868313417471542956778285567779435940267140679906686531862467627238401003459101637191297209422470388121802536569761414457618258343550613
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><a href="#__codelineno-17-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><a href="#__codelineno-17-16"><span class="linenos" data-linenos="16 "></span></a>n = 22822039733049388110936778173014765663663303811791283234361230649775805923902173438553927805407463106104699773994158375704033093471761387799852168337898526980521753614307899669015931387819927421875316304591521901592823814417756447695701045846773508629371397013053684553042185725059996791532391626429712416994990889693732805181947970071429309599614973772736556299404246424791660679253884940021728846906344198854779191951739719342908761330661910477119933428550774242910420952496929605686154799487839923424336353747442153571678064520763149793294360787821751703543288696726923909670396821551053048035619499706391118145067
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><a href="#__codelineno-17-17"><span class="linenos" data-linenos="17 "></span></a>c = 15406498580761780108625891878008526815145372096234083936681442225155097299264808624358826686906535594853622687379268969468433072388149786607395396424104318820879443743112358706546753935215756078345959375299650718555759698887852318017597503074317356745122514481807843745626429797861463012940172797612589031686718185390345389295851075279278516147076602270178540690147808314172798987497259330037810328523464851895621851859027823681655934104713689539848047163088666896473665500158179046196538210778897730209572708430067658411755959866033531700460551556380993982706171848970460224304996455600503982223448904878212849412357
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><a href="#__codelineno-17-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><a href="#__codelineno-17-19"><span class="linenos" data-linenos="19 "></span></a>n = 21574139855341432908474064784318462018475296809327285532337706940126942575349507668289214078026102682252713757703081553093108823214063791518482289846780197329821139507974763780260290309600884920811959842925540583967085670848765317877441480914852329276375776405689784571404635852204097622600656222714808541872252335877037561388406257181715278766652824786376262249274960467193961956690974853679795249158751078422296580367506219719738762159965958877806187461070689071290948181949561254144310776943334859775121650186245846031720507944987838489723127897223416802436021278671237227993686791944711422345000479751187704426369
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><a href="#__codelineno-17-20"><span class="linenos" data-linenos="20 "></span></a>c = 20366856150710305124583065375297661819795242238376485264951185336996083744604593418983336285185491197426018595031444652123288461491879021096028203694136683203441692987069563513026001861435722117985559909692670907347563594578265880806540396777223906955491026286843168637367593400342814725694366078337030937104035993569672959361347287894143027186846856772983058328919716702982222142848848117768499996617588305301483085428547267337070998767412540225911508196842253134355901263861121500650240296746702967594224401650220168780537141654489215019142122284308116284129004257364769474080721001708734051264841350424152506027932
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><a href="#__codelineno-17-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><a href="#__codelineno-17-22"><span class="linenos" data-linenos="22 "></span></a>n = 25360227412666612490102161131174584819240931803196448481224305250583841439581008528535930814167338381983764991296575637231916547647970573758269411168219302370541684789125112505021148506809643081950237623703181025696585998044695691322012183660424636496897073045557400768745943787342548267386564625462143150176113656264450210023925571945961405709276631990731602198104287528528055650050486159837612279600415259486306154947514005408907590083747758953115486124865486720633820559135063440942528031402951958557630833503775112010715604278114325528993771081233535247118481765852273252404963430792898948219539473312462979849137
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><a href="#__codelineno-17-23"><span class="linenos" data-linenos="23 "></span></a>c = 19892772524651452341027595619482734356243435671592398172680379981502759695784087900669089919987705675899945658648623800090272599154590123082189645021800958076861518397325439521139995652026377132368232502108620033400051346127757698623886142621793423225749240286511666556091787851683978017506983310073524398287279737680091787333547538239920607761080988243639547570818363788673249582783015475682109984715293163137324439862838574460108793714172603672477766831356411304446881998674779501188163600664488032943639694828698984739492200699684462748922883550002652913518229322945040819064133350314536378694523704793396169065179
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><a href="#__codelineno-17-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><a href="#__codelineno-17-25"><span class="linenos" data-linenos="25 "></span></a>n = 22726855244632356029159691753451822163331519237547639938779517751496498713174588935566576167329576494790219360727877166074136496129927296296996970048082870488804456564986667129388136556137013346228118981936899510687589585286517151323048293150257036847475424044378109168179412287889340596394755257704938006162677656581509375471102546261355748251869048003600520034656264521931808651038524134185732929570384705918563982065684145766427962502261522481994191989820110575981906998431553107525542001187655703534683231777988419268338249547641335718393312295800044734534761692799403469497954062897856299031257454735945867491191
<a id="__codelineno-17-26" name="__codelineno-17-26"></a><a href="#__codelineno-17-26"><span class="linenos" data-linenos="26 "></span></a>c = 6040119795175856407541082360023532204614723858688636724822712717572759793960246341800308149739809871234313049629732934797569781053000686185666374833978403290525072598774001731350244744590772795701065129561898116576499984185920661271123665356132719193665474235596884239108030605882777868856122378222681140570519180321286976947154042272622411303981011302586225630859892731724640574658125478287115198406253847367979883768000812605395482952698689604477719478947595442185921480652637868335673233200662100621025061500895729605305665864693122952557361871523165300206070325660353095592778037767395360329231331322823610060006
<a id="__codelineno-17-27" name="__codelineno-17-27"></a><a href="#__codelineno-17-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a><a href="#__codelineno-17-28"><span class="linenos" data-linenos="28 "></span></a>n = 23297333791443053297363000786835336095252290818461950054542658327484507406594632785712767459958917943095522594228205423428207345128899745800927319147257669773812669542782839237744305180098276578841929496345963997512244219376701787616046235397139381894837435562662591060768476997333538748065294033141610502252325292801816812268934171361934399951548627267791401089703937389012586581080223313060159456238857080740699528666411303029934807011214953984169785844714159627792016926490955282697877141614638806397689306795328344778478692084754216753425842557818899467945102646776342655167655384224860504086083147841252232760941
<a id="__codelineno-17-29" name="__codelineno-17-29"></a><a href="#__codelineno-17-29"><span class="linenos" data-linenos="29 "></span></a>c = 5418120301208378713115889465579964257871814114515046096090960159737859076829258516920361577853903925954198406843757303687557848302302200229295916902430205737843601806700738234756698575708612424928480440868739120075888681672062206529156566421276611107802917418993625029690627196813830326369874249777619239603300605876865967515719079797115910578653562787899019310139945904958024882417833736304894765433489476234575356755275147256577387022873348906900149634940747104513850154118106991137072643308620284663108283052245750945228995387803432128842152251549292698947407663643895853432650029352092018372834457054271102816934
<a id="__codelineno-17-30" name="__codelineno-17-30"></a><a href="#__codelineno-17-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a><a href="#__codelineno-17-31"><span class="linenos" data-linenos="31 "></span></a>n = 28873667904715682722987234293493200306976947898711255064125115933666968678742598858722431426218914462903521596341771131695619382266194233561677824357379805303885993804266436810606263022097900266975250431575654686915049693091467864820512767070713267708993899899011156106766178906700336111712803362113039613548672937053397875663144794018087017731949087794894903737682383916173267421403408140967713071026001874733487295007501068871044649170615709891451856792232315526696220161842742664778581287321318748202431466508948902745314372299799561625186955234673012098210919745879882268512656931714326782335211089576897310591491
<a id="__codelineno-17-32" name="__codelineno-17-32"></a><a href="#__codelineno-17-32"><span class="linenos" data-linenos="32 "></span></a>c = 9919880463786836684987957979091527477471444996392375244075527841865509160181666543016317634963512437510324198702416322841377489417029572388474450075801462996825244657530286107428186354172836716502817609070590929769261932324275353289939302536440310628698349244872064005700644520223727670950787924296004296883032978941200883362653993351638545860207179022472492671256630427228461852668118035317021428675954874947015197745916918197725121122236369382741533983023462255913924692806249387449016629865823316402366017657844166919846683497851842388058283856219900535567427103603869955066193425501385255322097901531402103883869
<a id="__codelineno-17-33" name="__codelineno-17-33"></a><a href="#__codelineno-17-33"><span class="linenos" data-linenos="33 "></span></a>
<a id="__codelineno-17-34" name="__codelineno-17-34"></a><a href="#__codelineno-17-34"><span class="linenos" data-linenos="34 "></span></a>n = 22324685947539653722499932469409607533065419157347813961958075689047690465266404384199483683908594787312445528159635527833904475801890381455653807265501217328757871352731293000303438205315816792663917579066674842307743845261771032363928568844669895768092515658328756229245837025261744260614860746997931503548788509983868038349720225305730985576293675269073709022350700836510054067641753713212999954307022524495885583361707378513742162566339010134354907863733205921845038918224463903789841881400814074587261720283879760122070901466517118265422863420376921536734845502100251460872499122236686832189549698020737176683019
<a id="__codelineno-17-35" name="__codelineno-17-35"></a><a href="#__codelineno-17-35"><span class="linenos" data-linenos="35 "></span></a>c = 1491527050203294989882829248560395184804977277747126143103957219164624187528441047837351263580440686474767380464005540264627910126483129930668344095814547592115061057843470131498075060420395111008619027199037019925701236660166563068245683975787762804359520164701691690916482591026138582705558246869496162759780878437137960823000043988227303003876410503121370163303711603359430764539337597866862508451528158285103251810058741879687875218384160282506172706613359477657215420734816049393339593755489218588796607060261897905233453268671411610631047340459487937479511933450369462213795738933019001471803157607791738538467
<a id="__codelineno-17-36" name="__codelineno-17-36"></a><a href="#__codelineno-17-36"><span class="linenos" data-linenos="36 "></span></a>
<a id="__codelineno-17-37" name="__codelineno-17-37"></a><a href="#__codelineno-17-37"><span class="linenos" data-linenos="37 "></span></a>n = 27646746423759020111007828653264027999257847645666129907789026054594393648800236117046769112762641778865620892443423100189619327585811384883515424918752749559627553637785037359639801125213256163008431942593727931931898199727552768626775618479833029101249692573716030706695702510982283555740851047022672485743432464647772882314215176114732257497240284164016914018689044557218920300262234652840632406067273375269301008409860193180822366735877288205783314326102263756503786736122321348320031950012144905869556204017430593656052867939493633163499580242224763404338807022510136217187779084917996171602737036564991036724299
<a id="__codelineno-17-38" name="__codelineno-17-38"></a><a href="#__codelineno-17-38"><span class="linenos" data-linenos="38 "></span></a>c = 21991524128957260536043771284854920393105808126700128222125856775506885721971193109361315961129190814674647136464887087893990660894961612838205086401018885457667488911898654270235561980111174603323721280911197488286585269356849579263043456316319476495888696219344219866516861187654180509247881251251278919346267129904739277386289240394384575124331135655943513831009934023397457082184699737734388823763306805326430395849935770213817533387235486307008892410920611669932693018165569417445885810825749609388627231235840912644654685819620931663346297596334834498661789016450371769203650109994771872404185770230172934013971
<a id="__codelineno-17-39" name="__codelineno-17-39"></a><a href="#__codelineno-17-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-17-40" name="__codelineno-17-40"></a><a href="#__codelineno-17-40"><span class="linenos" data-linenos="40 "></span></a>n = 20545487405816928731738988374475012686827933709789784391855706835136270270933401203019329136937650878386117187776530639342572123237188053978622697282521473917978282830432161153221216194169879669541998840691383025487220850872075436064308499924958517979727954402965612196081404341651517326364041519250125036424822634354268773895465698920883439222996581226358595873993976604699830613932320720554130011671297944433515047180565484495191003887599891289037982010216357831078328159028953222056918189365840711588671093333013117454034313622855082795813122338562446223041211192277089225078324682108033843023903550172891959673551
<a id="__codelineno-17-41" name="__codelineno-17-41"></a><a href="#__codelineno-17-41"><span class="linenos" data-linenos="41 "></span></a>c = 14227439188191029461250476692790539654619199888487319429114414557975376308688908028140817157205579804059783807641305577385724758530138514972962209062230576107406142402603484375626077345190883094097636019771377866339531511965136650567412363889183159616188449263752475328663245311059988337996047359263288837436305588848044572937759424466586870280512424336807064729894515840552404756879590698797046333336445465120445087587621743906624279621779634772378802959109714400516183718323267273824736540168545946444437586299214110424738159957388350785999348535171553569373088251552712391288365295267665691357719616011613628772175
<a id="__codelineno-17-42" name="__codelineno-17-42"></a><a href="#__codelineno-17-42"><span class="linenos" data-linenos="42 "></span></a>
<a id="__codelineno-17-43" name="__codelineno-17-43"></a><a href="#__codelineno-17-43"><span class="linenos" data-linenos="43 "></span></a>n = 27359727711584277234897157724055852794019216845229798938655814269460046384353568138598567755392559653460949444557879120040796798142218939251844762461270251672399546774067275348291003962551964648742053215424620256999345448398805278592777049668281558312871773979931343097806878701114056030041506690476954254006592555275342579529625231194321357904668512121539514880704046969974898412095675082585315458267591016734924646294357666924293908418345508902112711075232047998775303603175363964055048589769318562104883659754974955561725694779754279606726358588862479198815999276839234952142017210593887371950645418417355912567987
<a id="__codelineno-17-44" name="__codelineno-17-44"></a><a href="#__codelineno-17-44"><span class="linenos" data-linenos="44 "></span></a>c = 3788529784248255027081674540877016372807848222776887920453488878247137930578296797437647922494510483767651150492933356093288965943741570268943861987024276610712717409139946409513963043114463933146088430004237747163422802959250296602570649363016151581364006795894226599584708072582696996740518887606785460775851029814280359385763091078902301957226484620428513604630585131511167015763190591225884202772840456563643159507805711004113901417503751181050823638207803533111429510911616160851391754754434764819568054850823810901159821297849790005646102129354035735350124476838786661542089045509656910348676742844957008857457
<a id="__codelineno-17-45" name="__codelineno-17-45"></a><a href="#__codelineno-17-45"><span class="linenos" data-linenos="45 "></span></a>
<a id="__codelineno-17-46" name="__codelineno-17-46"></a><a href="#__codelineno-17-46"><span class="linenos" data-linenos="46 "></span></a>n = 27545937603751737248785220891735796468973329738076209144079921449967292572349424539010502287564030116831261268197384650511043068738911429169730640135947800885987171539267214611907687570587001933829208655100828045651391618089603288456570334500533178695238407684702251252671579371018651675054368606282524673369983034682330578308769886456335818733827237294570476853673552685361689144261552895758266522393004116017849397346259119221063821663280935820440671825601452417487330105280889520007917979115568067161590058277418371493228631232457972494285014767469893647892888681433965857496916110704944758070268626897045014782837
<a id="__codelineno-17-47" name="__codelineno-17-47"></a><a href="#__codelineno-17-47"><span class="linenos" data-linenos="47 "></span></a>c = 14069112970608895732417039977542732665796601893762401500878786871680645798754783315693511261740059725171342404186571066972546332813667711135661176659424619936101038903439144294886379322591635766682645179888058617577572409307484708171144488708410543462972008179994594087473935638026612679389759756811490524127195628741262871304427908481214992471182859308828778119005750928935764927967212343526503410515793717201360360437981322576798056276657140363332700714732224848346808963992302409037706094588964170239521193589470070839790404597252990818583717869140229811712295005710540476356743378906642267045723633874011649259842
<a id="__codelineno-17-48" name="__codelineno-17-48"></a><a href="#__codelineno-17-48"><span class="linenos" data-linenos="48 "></span></a>
<a id="__codelineno-17-49" name="__codelineno-17-49"></a><a href="#__codelineno-17-49"><span class="linenos" data-linenos="49 "></span></a>n = 25746162075697911560263181791216433062574178572424600336856278176112733054431463253903433128232709054141607100891177804285813783247735063753406524678030561284491481221681954564804141454666928657549670266775659862814924386584148785453647316864935942772919140563506305666207816897601862713092809234429096584753263707828899780979223118181009293655563146526792388913462557306433664296966331469906428665127438829399703002867800269947855869262036714256550075520193125987011945192273531732276641728008406855871598678936585324782438668746810516660152018244253008092470066555687277138937298747951929576231036251316270602513451
<a id="__codelineno-17-50" name="__codelineno-17-50"></a><a href="#__codelineno-17-50"><span class="linenos" data-linenos="50 "></span></a>c = 17344284860275489477491525819922855326792275128719709401292545608122859829827462088390044612234967551682879954301458425842831995513832410355328065562098763660326163262033200347338773439095709944202252494552172589503915965931524326523663289777583152664722241920800537867331030623906674081852296232306336271542832728410803631170229642717524942332390842467035143631504401140727083270732464237443915263865880580308776111219718961746378842924644142127243573824972533819479079381023103585862099063382129757560124074676150622288706094110075567706403442920696472627797607697962873026112240527498308535903232663939028587036724
<a id="__codelineno-17-51" name="__codelineno-17-51"></a><a href="#__codelineno-17-51"><span class="linenos" data-linenos="51 "></span></a>
<a id="__codelineno-17-52" name="__codelineno-17-52"></a><a href="#__codelineno-17-52"><span class="linenos" data-linenos="52 "></span></a>n = 23288486934117120315036919418588136227028485494137930196323715336208849327833965693894670567217971727921243839129969128783853015760155446770590696037582684845937132790047363216362087277861336964760890214059732779383020349204803205725870225429985939570141508220041286857810048164696707018663758416807708910671477407366098883430811861933014973409390179948577712579749352299440310543689035651465399867908428885541237776143404376333442949397063249223702355051571790555151203866821867908531733788784978667478707672984539512431549558672467752712004519300318999208102076732501412589104904734983789895358753664077486894529499
<a id="__codelineno-17-53" name="__codelineno-17-53"></a><a href="#__codelineno-17-53"><span class="linenos" data-linenos="53 "></span></a>c = 10738254418114076548071448844964046468141621740603214384986354189105236977071001429271560636428075970459890958274941762528116445171161040040833357876134689749846940052619392750394683504816081193432350669452446113285638982551762586656329109007214019944975816434827768882704630460001209452239162896576191876324662333153835533956600295255158377025198426950944040643235430211011063586032467724329735785947372051759042138171054165854842472990583800899984893232549092766400510300083585513014171220423103452292891496141806956300396540682381668367564569427813092064053993103537635994311143010708814851867239706492577203899024
<a id="__codelineno-17-54" name="__codelineno-17-54"></a><a href="#__codelineno-17-54"><span class="linenos" data-linenos="54 "></span></a>
<a id="__codelineno-17-55" name="__codelineno-17-55"></a><a href="#__codelineno-17-55"><span class="linenos" data-linenos="55 "></span></a>n = 19591441383958529435598729113936346657001352578357909347657257239777540424811749817783061233235817916560689138344041497732749011519736303038986277394036718790971374656832741054547056417771501234494768509780369075443550907847298246275717420562375114406055733620258777905222169702036494045086017381084272496162770259955811174440490126514747876661317750649488774992348005044389081101686016446219264069971370646319546429782904810063020324704138495608761532563310699753322444871060383693044481932265801505819646998535192083036872551683405766123968487907648980900712118052346174533513978009131757167547595857552370586353973
<a id="__codelineno-17-56" name="__codelineno-17-56"></a><a href="#__codelineno-17-56"><span class="linenos" data-linenos="56 "></span></a>c = 3834917098887202931981968704659119341624432294759361919553937551053499607440333234018189141970246302299385742548278589896033282894981200353270637127213483172182529890495903425649116755901631101665876301799865612717750360089085179142750664603454193642053016384714515855868368723508922271767190285521137785688075622832924829248362774476456232826885801046969384519549385428259591566716890844604696258783639390854153039329480726205147199247183621535172450825979047132495439603840806501254997167051142427157381799890725323765558803808030109468048682252028720241357478614704610089120810367192414352034177484688502364022887
<a id="__codelineno-17-57" name="__codelineno-17-57"></a><a href="#__codelineno-17-57"><span class="linenos" data-linenos="57 "></span></a>
<a id="__codelineno-17-58" name="__codelineno-17-58"></a><a href="#__codelineno-17-58"><span class="linenos" data-linenos="58 "></span></a>n = 19254242571588430171308191757871261075358521158624745702744057556054652332495961196795369630484782930292003238730267396462491733557715379956969694238267908985251699834707734400775311452868924330866502429576951934279223234676654749272932769107390976321208605516299532560054081301829440688796904635446986081691156842271268059970762004259219036753174909942343204432795076377432107630203621754552804124408792358220071862369443201584155711893388877350138023238624566616551246804054720492816226651467017802504094070614892556444425915920269485861799532473383304622064493223627552558344088839860178294589481899206318863310603
<a id="__codelineno-17-59" name="__codelineno-17-59"></a><a href="#__codelineno-17-59"><span class="linenos" data-linenos="59 "></span></a>c = 6790553533991297205804561991225493105312398825187682250780197510784765226429663284220400480563039341938599783346724051076211265663468643826430109013245014035811178295081939958687087477312867720289964506097819762095244479129359998867671811819738196687884696680463458661374310994610760009474264115750204920875527434486437536623589684519411519100170291423367424938566820315486507444202022408003879118465761273916755290898112991525546114191064022991329724370064632569903856189236177894007766690782630247443895358893983735822824243487181851098787271270256780891094405121947631088729917398317652320497765101790132679171889
<a id="__codelineno-17-60" name="__codelineno-17-60"></a><a href="#__codelineno-17-60"><span class="linenos" data-linenos="60 "></span></a>
<a id="__codelineno-17-61" name="__codelineno-17-61"></a><a href="#__codelineno-17-61"><span class="linenos" data-linenos="61 "></span></a>n = 26809700251171279102974962949184411136459372267620535198421449833298448092580497485301953796619185339316064387798092220298630428207556482805739803420279056191194360049651767412572609187680508073074653291350998253938793269214230457117194434853888765303403385824786231859450351212449404870776320297419712486574804794325602760347306432927281716160368830187944940128907971027838510079519466846176106565164730963988892400240063089397720414921398936399927948235195085202171264728816184532651138221862240969655185596628285814057082448321749567943946273776184657698104465062749244327092588237927996419620170254423837876806659
<a id="__codelineno-17-62" name="__codelineno-17-62"></a><a href="#__codelineno-17-62"><span class="linenos" data-linenos="62 "></span></a>c = 386213556608434013769864727123879412041991271528990528548507451210692618986652870424632219424601677524265011043146748309774067894985069288067952546139416819404039688454756044862784630882833496090822568580572859029800646671301748901528132153712913301179254879877441322285914544974519727307311002330350534857867516466612474769753577858660075830592891403551867246057397839688329172530177187042229028685862036140779065771061933528137423019407311473581832405899089709251747002788032002094495379614686544672969073249309703482556386024622814731015767810042969813752548617464974915714425595351940266077021672409858645427346
</code></pre></div>
<h5 id="_11">思路<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h5>
<p>每两个n求一次公约数，看看是否有不为1的一组n，如果有的话，p就是这个公约数，之后就可以求其他量了</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><a href="#__codelineno-18-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><a href="#__codelineno-18-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><a href="#__codelineno-18-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><a href="#__codelineno-18-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><a href="#__codelineno-18-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><a href="#__codelineno-18-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="n">n0</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n3</span><span class="p">,</span><span class="n">n4</span><span class="p">,</span><span class="n">n5</span><span class="p">,</span><span class="n">n6</span><span class="p">,</span><span class="n">n7</span><span class="p">,</span><span class="n">n8</span><span class="p">,</span><span class="n">n9</span><span class="p">,</span><span class="n">n10</span><span class="p">,</span><span class="n">n11</span><span class="p">,</span><span class="n">n12</span><span class="p">,</span><span class="n">n13</span><span class="p">,</span><span class="n">n14</span><span class="p">,</span><span class="n">n15</span><span class="p">,</span><span class="n">n16</span><span class="p">,</span><span class="n">n17</span><span class="p">,</span><span class="n">n18</span><span class="p">,</span><span class="n">n19</span><span class="p">]</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><a href="#__codelineno-18-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c0</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">,</span><span class="n">c4</span><span class="p">,</span><span class="n">c5</span><span class="p">,</span><span class="n">c6</span><span class="p">,</span><span class="n">c7</span><span class="p">,</span><span class="n">c8</span><span class="p">,</span><span class="n">c9</span><span class="p">,</span><span class="n">c10</span><span class="p">,</span><span class="n">c11</span><span class="p">,</span><span class="n">c12</span><span class="p">,</span><span class="n">c13</span><span class="p">,</span><span class="n">c14</span><span class="p">,</span><span class="n">c15</span><span class="p">,</span><span class="n">c16</span><span class="p">,</span><span class="n">c17</span><span class="p">,</span><span class="n">c18</span><span class="p">,</span><span class="n">c19</span><span class="p">]</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><a href="#__codelineno-18-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><a href="#__codelineno-18-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><a href="#__codelineno-18-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><a href="#__codelineno-18-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">!=</span><span class="n">j</span><span class="p">):</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><a href="#__codelineno-18-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><a href="#__codelineno-18-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><a href="#__codelineno-18-14"><span class="linenos" data-linenos="14 "></span></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">t</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a><a href="#__codelineno-18-15"><span class="linenos" data-linenos="15 "></span></a>                <span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><a href="#__codelineno-18-16"><span class="linenos" data-linenos="16 "></span></a>                <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><a href="#__codelineno-18-17"><span class="linenos" data-linenos="17 "></span></a>                <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><a href="#__codelineno-18-18"><span class="linenos" data-linenos="18 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><a href="#__codelineno-18-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><a href="#__codelineno-18-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">#flag{abdcbe5fd94e23b3de429223ab9c2fdf}</span>
</code></pre></div>
<h3 id="_12">第二种情况 用中国剩余定理<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>简要说明中国剩余定理的作用就是把一个同余式组变成一个同余式,eg:</p>
<div class="arithmatex">\[
c_1 \equiv m^e \mod n_1
\]</div>
<div class="arithmatex">\[
c_2 \equiv m ^e \mod n_2
\]</div>
<div class="arithmatex">\[
c_3 \equiv m ^e \mod n_3
\]</div>
<p>转换为一个<span class="arithmatex">\(C \equiv m ^ e \mod N\)</span>，<span class="arithmatex">\(N = lcm(n_1,n_2,n_3)\)</span></p>
<h4 id="1_3">例题1<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><a href="#__codelineno-19-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><a href="#__codelineno-19-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><a href="#__codelineno-19-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><a href="#__codelineno-19-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><a href="#__codelineno-19-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><a href="#__codelineno-19-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><a href="#__codelineno-19-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><a href="#__codelineno-19-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><a href="#__codelineno-19-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><a href="#__codelineno-19-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><a href="#__codelineno-19-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><a href="#__codelineno-19-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><a href="#__codelineno-19-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><a href="#__codelineno-19-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><a href="#__codelineno-19-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><a href="#__codelineno-19-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><a href="#__codelineno-19-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">n3</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><a href="#__codelineno-19-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><a href="#__codelineno-19-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><a href="#__codelineno-19-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><a href="#__codelineno-19-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="k">if</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><a href="#__codelineno-19-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="k">break</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><a href="#__codelineno-19-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><a href="#__codelineno-19-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><a href="#__codelineno-19-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">c3</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><a href="#__codelineno-19-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a><a href="#__codelineno-19-27"><span class="linenos" data-linenos="27 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n1=&quot;</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><a href="#__codelineno-19-28"><span class="linenos" data-linenos="28 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n2=&quot;</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><a href="#__codelineno-19-29"><span class="linenos" data-linenos="29 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n3=&quot;</span><span class="p">,</span> <span class="n">n3</span><span class="p">)</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a><a href="#__codelineno-19-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a><a href="#__codelineno-19-31"><span class="linenos" data-linenos="31 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c1=&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a><a href="#__codelineno-19-32"><span class="linenos" data-linenos="32 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c2=&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a><a href="#__codelineno-19-33"><span class="linenos" data-linenos="33 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c3=&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="p">)</span>
</code></pre></div>
<p><strong>先根据中国剩余定理求出<span class="arithmatex">\(m^e\)</span>，这题的e只给范围，要爆破一下</strong></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><a href="#__codelineno-20-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><a href="#__codelineno-20-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><a href="#__codelineno-20-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><a href="#__codelineno-20-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Get_Mi</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>               <span class="c1">#求衍数</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><a href="#__codelineno-20-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">M_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><a href="#__codelineno-20-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m_list</span><span class="p">:</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><a href="#__codelineno-20-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">M_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="n">mi</span><span class="p">)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><a href="#__codelineno-20-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">return</span> <span class="n">M_list</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><a href="#__codelineno-20-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><a href="#__codelineno-20-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Get_resMi</span><span class="p">(</span><span class="n">M_list</span><span class="p">,</span><span class="n">m_list</span><span class="p">):</span>       <span class="c1">#求乘率</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><a href="#__codelineno-20-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">resM_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><a href="#__codelineno-20-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_list</span><span class="p">)):</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><a href="#__codelineno-20-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">resM_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">M_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">m_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><a href="#__codelineno-20-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">return</span> <span class="n">resM_list</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><a href="#__codelineno-20-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><a href="#__codelineno-20-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Get_result</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><a href="#__codelineno-20-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">M_list</span> <span class="o">=</span> <span class="n">Get_Mi</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><a href="#__codelineno-20-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">resM_list</span> <span class="o">=</span> <span class="n">Get_resMi</span><span class="p">(</span><span class="n">M_list</span><span class="p">,</span><span class="n">m_list</span><span class="p">)</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><a href="#__codelineno-20-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><a href="#__codelineno-20-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_list</span><span class="p">)):</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><a href="#__codelineno-20-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">result</span> <span class="o">+=</span> <span class="n">M_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">resM_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">a_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><a href="#__codelineno-20-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">result</span> <span class="o">%=</span> <span class="n">m</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><a href="#__codelineno-20-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><a href="#__codelineno-20-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><a href="#__codelineno-20-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="mi">16655230929893303490818415854457831426545038662809855283873228642358207995734291242944120042612699642460820594813654718158395826755230956722936107927889550129166619245152453353908373751380196656611349200623414836128383308653618062999595622747482867683840133843768870236300348203389275090871132570173650238774275209757683812077533989960172822335488251744796657926473009279723460304257252876756936524918018903158795894385111046938638194925881670388700872760201130485273663156422785999102754192840209476417602399017445296045070405343876349687582470436774316410697773759057621576657298096301937899052773787116133124199739</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><a href="#__codelineno-20-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="mi">17197151926745749646602149115445210421300330711044282276861045275221683290586877554048509794473112203880585601275129330843554946888863132721219683639579200702355880529569042889789589005950061966309684759066705732225014741164779016525568884409690021988879475589545329149547046975086877521757237117008484775731784935960191717287332176327498377273179740487245459081737196777751408106728622513560888261855065717079007065635401835089216224111969668029246916986663313301660909538148574652809266532053889578734157117390082522831069594417637550812101652367765364077901612478983024721669687150628356918237152414368862535409859</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><a href="#__codelineno-20-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">n3</span> <span class="o">=</span> <span class="mi">18719461901666732419189610536735130974364055134601694187780706398369536769336080321122034942831217438281120989017698755904233940669427542442488330152862658754609065361849067002424120904308655036927580582916373684567047102601602588472175947665724244201887952599804681827419266055359412641159981152796138695901074514583606207162167385730873921563442166111892785482387108299191119048884993267729877797586421940344366636285656854837470348603688925980178978612114344024951042846249621559376348599687263736342957456838732355009637030035658212442442824658869094581324944034490700706979663405137522294780606800571433058912041</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><a href="#__codelineno-20-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><a href="#__codelineno-20-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="mi">3530761236149189046680124371485374220252032991305088864647979778627799354583229731576585900490173357726425570018182390597284149666834264690795437972634538596441103368165128688664787322126097802985602065455316693754513332761284857157982201975554297034291092099307950246864758375115838291339394148547902128382917596947095456178572561422004708150053706114994560773293625641699691472764190426577272488084620105693964419578988589192873196530900413833531923536786853211065167782657153004342018675666293830194703777994380600060782651326623229047839109994778831432598543154184891096335217588164509636922274833553782288823349</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a><a href="#__codelineno-20-30"><span class="linenos" data-linenos="30 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="mi">7557835478962501903223351987016911891266554255050134264644805724502475848487138948948076311894495847429608136390014902405718084026208891531815323418707377349405409096779206918831458396991602033494429461919844309109113047361743133772636443322195238900874786548606687215969337920658068807801603115402783849082788527952834594443136756890747461628705174983562847145588532659589787532039981477468881131005056101092222499397893730056830156407331988257383965698358904379729558105489119604343081747549319382873235286788453435066434264212954607441597606413293491628299838317713381567250093086011058119721189087729804152444980</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a><a href="#__codelineno-20-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">c3</span> <span class="o">=</span><span class="mi">8471234074077377509408346140986116360421840978074779990698043926601850838824365885362094731657766299393262223086536737448516669969503891677808275285733096884405583100485903641986516527279324847718603091709062689898441711907846902050004165404073776422495381050861998133576074526490209080137421773440295749900582039873013319584167081936219517593826232230971430937112005615502869367413205660317010303160932970748420125111225082886082306332340892549579826854620461821084886193470846195356695313518639669516456574134135244251956477677377976434266541164893562226872334598362396368708087248848222008201970781942468960022694</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a><a href="#__codelineno-20-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a><a href="#__codelineno-20-33"><span class="linenos" data-linenos="33 "></span></a><span class="n">m_list</span><span class="o">=</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="n">n3</span><span class="p">]</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a><a href="#__codelineno-20-34"><span class="linenos" data-linenos="34 "></span></a><span class="n">a_list</span><span class="o">=</span> <span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">c3</span><span class="p">]</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a><a href="#__codelineno-20-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a><a href="#__codelineno-20-36"><span class="linenos" data-linenos="36 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a><a href="#__codelineno-20-37"><span class="linenos" data-linenos="37 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m_list</span><span class="p">:</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a><a href="#__codelineno-20-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="n">m</span> <span class="o">*=</span> <span class="n">i</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a><a href="#__codelineno-20-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a><a href="#__codelineno-20-40"><span class="linenos" data-linenos="40 "></span></a><span class="n">result</span> <span class="o">=</span> <span class="n">Get_result</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a><a href="#__codelineno-20-41"><span class="linenos" data-linenos="41 "></span></a><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-20-42" name="__codelineno-20-42"></a><a href="#__codelineno-20-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-20-43" name="__codelineno-20-43"></a><a href="#__codelineno-20-43"><span class="linenos" data-linenos="43 "></span></a>    <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-20-44" name="__codelineno-20-44"></a><a href="#__codelineno-20-44"><span class="linenos" data-linenos="44 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
<h4 id="2-2021crazy_tech_rsa">例题2 鹤城杯2021——Crazy_Tech_RSA<a class="headerlink" href="#2-2021crazy_tech_rsa" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><a href="#__codelineno-21-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><a href="#__codelineno-21-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.Padding</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><a href="#__codelineno-21-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><a href="#__codelineno-21-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">FLAG</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;flag{??????}&quot;</span><span class="p">,</span><span class="mi">64</span><span class="p">))</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><a href="#__codelineno-21-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">init_key</span><span class="p">():</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><a href="#__codelineno-21-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><a href="#__codelineno-21-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><a href="#__codelineno-21-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mi">9</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><a href="#__codelineno-21-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">while</span><span class="p">(</span><span class="n">GCD</span><span class="p">((</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">e</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><a href="#__codelineno-21-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><a href="#__codelineno-21-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><a href="#__codelineno-21-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><a href="#__codelineno-21-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">return</span> <span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">d</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><a href="#__codelineno-21-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><a href="#__codelineno-21-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">n_list</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><a href="#__codelineno-21-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">c_list</span><span class="o">=</span><span class="nb">list</span><span class="p">()</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><a href="#__codelineno-21-17"><span class="linenos" data-linenos="17 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><a href="#__codelineno-21-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">N</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">init_key</span><span class="p">()</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><a href="#__codelineno-21-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">n_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><a href="#__codelineno-21-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">FLAG</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a><a href="#__codelineno-21-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">c_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">FLAG</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a><a href="#__codelineno-21-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="k">assert</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">==</span><span class="n">FLAG</span><span class="p">)</span>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a><a href="#__codelineno-21-23"><span class="linenos" data-linenos="23 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n_list:&quot;</span><span class="p">,</span><span class="n">n_list</span><span class="p">)</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a><a href="#__codelineno-21-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c_list:&quot;</span><span class="p">,</span><span class="n">c_list</span><span class="p">)</span>
</code></pre></div>
<p>先用中国剩余定理解出<span class="arithmatex">\(m^e\)</span></p>
<p><strong>再开根号</strong></p>
<p>这道题的e是给出，如果e没有给出的话，需要爆破e</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><a href="#__codelineno-22-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><a href="#__codelineno-22-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><a href="#__codelineno-22-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><a href="#__codelineno-22-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Get_Mi</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>               <span class="c1">#求衍数</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><a href="#__codelineno-22-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">M_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><a href="#__codelineno-22-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="n">m_list</span><span class="p">:</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><a href="#__codelineno-22-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">M_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="n">mi</span><span class="p">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><a href="#__codelineno-22-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">return</span> <span class="n">M_list</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><a href="#__codelineno-22-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><a href="#__codelineno-22-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Get_resMi</span><span class="p">(</span><span class="n">M_list</span><span class="p">,</span><span class="n">m_list</span><span class="p">):</span>       <span class="c1">#求乘率</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><a href="#__codelineno-22-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">resM_list</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><a href="#__codelineno-22-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_list</span><span class="p">)):</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><a href="#__codelineno-22-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">resM_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">M_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">m_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><a href="#__codelineno-22-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">return</span> <span class="n">resM_list</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><a href="#__codelineno-22-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><a href="#__codelineno-22-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Get_result</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><a href="#__codelineno-22-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">M_list</span> <span class="o">=</span> <span class="n">Get_Mi</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><a href="#__codelineno-22-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">resM_list</span> <span class="o">=</span> <span class="n">Get_resMi</span><span class="p">(</span><span class="n">M_list</span><span class="p">,</span><span class="n">m_list</span><span class="p">)</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><a href="#__codelineno-22-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><a href="#__codelineno-22-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M_list</span><span class="p">)):</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><a href="#__codelineno-22-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">result</span> <span class="o">+=</span> <span class="n">M_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">resM_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">a_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><a href="#__codelineno-22-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">result</span> <span class="o">%=</span> <span class="n">m</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><a href="#__codelineno-22-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><a href="#__codelineno-22-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">m_list</span><span class="o">=</span><span class="p">[</span><span class="mi">71189786319102608575263218254922479901008514616376166401353025325668690465852130559783959409002115897148828732231478529655075366072137059589917001875303598680931962384468363842379833044123189276199264340224973914079447846845897807085694711541719515881377391200011269924562049643835131619086349617062034608799</span><span class="p">,</span> <span class="mi">92503831027754984321994282254005318198418454777812045042619263533423066848097985191386666241913483806726751133691867010696758828674382946375162423033994046273252417389169779506788545647848951018539441971140081528915876529645525880324658212147388232683347292192795975558548712504744297104487514691170935149949</span><span class="p">,</span> <span class="mi">100993952830138414466948640139083231443558390127247779484027818354177479632421980458019929149817002579508423291678953554090956334137167905685261724759487245658147039684536216616744746196651390112540237050493468689520465897258378216693418610879245129435268327315158194612110422630337395790254881602124839071919</span><span class="p">,</span> <span class="mi">59138293747457431012165762343997972673625934330232909935732464725128776212729547237438509546925172847581735769773563840639187946741161318153031173864953372796950422229629824699580131369991913883136821374596762214064774480548532035315344368010507644630655604478651898097886873485265848973185431559958627423847</span><span class="p">,</span> <span class="mi">66827868958054485359731420968595906328820823695638132426084478524423658597714990545142120448668257273436546456116147999073797943388584861050133103137697812149742551913704341990467090049650721713913812069904136198912314243175309387952328961054617877059134151915723594900209641163321839502908705301293546584147</span><span class="p">,</span> <span class="mi">120940513339890268554625391482989102665030083707530690312336379356969219966820079510946652021721814016286307318930536030308296265425674637215009052078834615196224917417698019787514831973471113022781129000531459800329018133248426080717653298100515701379374786486337920294380753805825328119757649844054966712377</span><span class="p">,</span> <span class="mi">72186594495190221129349814154999705524005203343018940547856004977368023856950836974465616291478257156860734574686154136925776069045232149725101769594505766718123155028300703627531567850035682448632166309129911061492630709698934310123778699316856399909549674138453085885820110724923723830686564968967391721281</span><span class="p">,</span> <span class="mi">69105037583161467265649176715175579387938714721653281201847973223975467813529036844308693237404592381480367515044829190066606146105800243199497182114398931410844901178842049915914390117503986044951461783780327749665912369177733246873697481544777183820939967036346862056795919812693669387731294595126647751951</span><span class="p">,</span> <span class="mi">76194219445824867986050004226602973283400885106636660263597964027139613163638212828932901192009131346530898961165310615466747046710743013409318156266326090650584190382130795884514074647833949281109675170830565650006906028402714868781834693473191228256626654011772428115359653448111208831188721505467497494581</span><span class="p">]</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><a href="#__codelineno-22-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">a_list</span><span class="o">=</span><span class="p">[</span><span class="mi">62580922178008480377006528793506649089253164524883696044759651305970802215270721223149734532870729533611357047595181907404222690394917605617029675103788705320032707977225447998111744887898039756375876685711148857676502670812333076878964148863713993853526715855758799502735753454247721711366497722251078739585</span><span class="p">,</span> <span class="mi">46186240819076690248235492196228128599822002268014359444368898414937734806009161030424589993541799877081745454934484263188270879142125136786221625234555265815513136730416539407710862948861531339065039071959576035606192732936477944770308784472646015244527805057990939765708793705044236665364664490419874206900</span><span class="p">,</span> <span class="mi">85756449024868529058704599481168414715291172247059370174556127800630896693021701121075838517372920466708826412897794900729896389468152213884232173410022054605870785910461728567377769960823103334874807744107855490558726013068890632637193410610478514663078901021307258078678427928255699031215654693270240640198</span><span class="p">,</span> <span class="mi">14388767329946097216670270960679686032536707277732968784379505904021622612991917314721678940833050736745004078559116326396233622519356703639737886289595860359630019239654690312132039876082685046329079266785042428947147658321799501605837784127004536996628492065409017175037161261039765340032473048737319069656</span><span class="p">,</span> <span class="mi">1143736792108232890306863524988028098730927600066491485326214420279375304665896453544100447027809433141790331191324806205845009336228331138326163746853197990596700523328423791764843694671580875538251166864957646807184041817863314204516355683663859246677105132100377322669627893863885482167305919925159944839</span><span class="p">,</span> <span class="mi">2978800921927631161807562509445310353414810029862911925227583943849942080514132963605492727604495513988707849133045851539412276254555228149742924149242124724864770049898278052042163392380895275970574317984638058768854065506927848951716677514095183559625442889028813635385408810698294574175092159389388091981</span><span class="p">,</span> <span class="mi">16200944263352278316040095503540249310705602580329203494665614035841657418101517016718103326928336623132935178377208651067093136976383774189554806135146237406248538919915426183225265103769259990252162411307338473817114996409705345401251435268136647166395894099897737607312110866874944619080871831772376466376</span><span class="p">,</span> <span class="mi">31551601425575677138046998360378916515711528548963089502535903329268089950335615563205720969393649713416910860593823506545030969355111753902391336139384464585775439245735448030993755229554555004154084649002801255396359097917380427525820249562148313977941413268787799534165652742114031759562268691233834820996</span><span class="p">,</span> <span class="mi">25288164985739570635307839193110091356864302148147148153228604718807817833935053919412276187989509493755136905193728864674684139319708358686431424793278248263545370628718355096523088238513079652226028236137381367215156975121794485995030822902933639803569133458328681148758392333073624280222354763268512333515</span><span class="p">]</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><a href="#__codelineno-22-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a><a href="#__codelineno-22-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a><a href="#__codelineno-22-28"><span class="linenos" data-linenos="28 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">m_list</span><span class="p">:</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a><a href="#__codelineno-22-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="n">m</span> <span class="o">*=</span> <span class="n">i</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a><a href="#__codelineno-22-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a><a href="#__codelineno-22-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">result</span> <span class="o">=</span> <span class="n">Get_result</span><span class="p">(</span><span class="n">a_list</span><span class="p">)</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a><a href="#__codelineno-22-32"><span class="linenos" data-linenos="32 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">9</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a><a href="#__codelineno-22-33"><span class="linenos" data-linenos="33 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a><a href="#__codelineno-22-34"><span class="linenos" data-linenos="34 "></span></a><span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a><a href="#__codelineno-22-35"><span class="linenos" data-linenos="35 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
<h2 id="_13">七、维纳攻击<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<p>攻击条件:<span class="arithmatex">\(d &lt; \frac{1}{3}N^{0.25}\)</span></p>
<p>原理:</p>
<div class="arithmatex">\[
ed \equiv 1 \mod \phi(n)
\]</div>
<p>有</p>
<div class="arithmatex">\[
ed = k\phi(n) + 1
\]</div>
<p>因为<span class="arithmatex">\(\phi(n) \approx n\)</span></p>
<div class="arithmatex">\[
\therefore ed \approx kn + 1
\]</div>
<p>两边同除<span class="arithmatex">\(dn\)</span>有</p>
<div class="arithmatex">\[
\frac{e}{n} \approx \frac{k}{d} + \frac{1}{dn}
\]</div>
<p>则</p>
<div class="arithmatex">\[
\frac{e}{n} - \frac{k}{d} \approx \frac{1}{dn}
\]</div>
<p>满足勒让德定理(这个定理网上可以搜得到，根据这个定理，不同形式的n是不一样的，比如说这个例子需要<span class="arithmatex">\(n=p\times q\)</span>才可使用)，因此<span class="arithmatex">\(\frac{e}{n}\)</span>可以作为<span class="arithmatex">\(\frac{k}{d}\)</span>的收敛子</p>
<p>连分数展开即可</p>
<h3 id="_14">例题<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><a href="#__codelineno-23-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><a href="#__codelineno-23-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><a href="#__codelineno-23-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><a href="#__codelineno-23-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><a href="#__codelineno-23-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="c1">## 生成随机素数</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><a href="#__codelineno-23-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><a href="#__codelineno-23-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><a href="#__codelineno-23-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;flag</span><span class="si">{20d6e2da95dcc1fa5f5432a436c4be18}</span><span class="s2">&quot;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><a href="#__codelineno-23-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">## 字符串转数字</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><a href="#__codelineno-23-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><a href="#__codelineno-23-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><a href="#__codelineno-23-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">phi_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><a href="#__codelineno-23-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><a href="#__codelineno-23-14"><span class="linenos" data-linenos="14 "></span></a><span class="c1">## 计算d</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><a href="#__codelineno-23-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><a href="#__codelineno-23-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">nbits</span> <span class="o">=</span> <span class="mi">1024</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><a href="#__codelineno-23-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="n">nbits</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><a href="#__codelineno-23-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">36</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><a href="#__codelineno-23-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="k">break</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><a href="#__codelineno-23-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">## 计算e</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><a href="#__codelineno-23-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">invmod</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><a href="#__codelineno-23-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><a href="#__codelineno-23-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><a href="#__codelineno-23-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><a href="#__codelineno-23-25"><span class="linenos" data-linenos="25 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><a href="#__codelineno-23-26"><span class="linenos" data-linenos="26 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><a href="#__codelineno-23-27"><span class="linenos" data-linenos="27 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><a href="#__codelineno-24-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><a href="#__codelineno-24-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><a href="#__codelineno-24-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><a href="#__codelineno-24-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><a href="#__codelineno-24-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">continuedFra</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><a href="#__codelineno-24-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;计算连分数</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><a href="#__codelineno-24-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="sd">    :param x: 分子</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><a href="#__codelineno-24-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="sd">    :param y: 分母</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><a href="#__codelineno-24-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="sd">    :return: 连分数列表</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><a href="#__codelineno-24-10"><span class="linenos" data-linenos="10 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><a href="#__codelineno-24-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">cf</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><a href="#__codelineno-24-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">while</span> <span class="n">y</span><span class="p">:</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><a href="#__codelineno-24-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">cf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">//</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><a href="#__codelineno-24-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><a href="#__codelineno-24-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">return</span> <span class="n">cf</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><a href="#__codelineno-24-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><a href="#__codelineno-24-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><a href="#__codelineno-24-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">gradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">):</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><a href="#__codelineno-24-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;计算传入列表最后的渐进分数</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a><a href="#__codelineno-24-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">    :param cf: 连分数列表</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a><a href="#__codelineno-24-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">    :return: 该列表最后的渐近分数</span>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a><a href="#__codelineno-24-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a><a href="#__codelineno-24-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a><a href="#__codelineno-24-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-24-25" name="__codelineno-24-25"></a><a href="#__codelineno-24-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cf</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a><a href="#__codelineno-24-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="c1">## 这里的渐进分数分子分母要分开</span>
<a id="__codelineno-24-27" name="__codelineno-24-27"></a><a href="#__codelineno-24-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">denominator</span> <span class="o">+</span> <span class="n">numerator</span>
<a id="__codelineno-24-28" name="__codelineno-24-28"></a><a href="#__codelineno-24-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="k">return</span> <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a><a href="#__codelineno-24-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a><a href="#__codelineno-24-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a><a href="#__codelineno-24-31"><span class="linenos" data-linenos="31 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">solve_pq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a><a href="#__codelineno-24-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;使用韦达定理解出pq，x^2−(p+q)∗x+pq=0</span>
<a id="__codelineno-24-33" name="__codelineno-24-33"></a><a href="#__codelineno-24-33"><span class="linenos" data-linenos="33 "></span></a><span class="sd">    :param a:x^2的系数</span>
<a id="__codelineno-24-34" name="__codelineno-24-34"></a><a href="#__codelineno-24-34"><span class="linenos" data-linenos="34 "></span></a><span class="sd">    :param b:x的系数</span>
<a id="__codelineno-24-35" name="__codelineno-24-35"></a><a href="#__codelineno-24-35"><span class="linenos" data-linenos="35 "></span></a><span class="sd">    :param c:pq</span>
<a id="__codelineno-24-36" name="__codelineno-24-36"></a><a href="#__codelineno-24-36"><span class="linenos" data-linenos="36 "></span></a><span class="sd">    :return:p，q</span>
<a id="__codelineno-24-37" name="__codelineno-24-37"></a><a href="#__codelineno-24-37"><span class="linenos" data-linenos="37 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-38" name="__codelineno-24-38"></a><a href="#__codelineno-24-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="n">par</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">isqrt</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-24-39" name="__codelineno-24-39"></a><a href="#__codelineno-24-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">par</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">par</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<a id="__codelineno-24-40" name="__codelineno-24-40"></a><a href="#__codelineno-24-40"><span class="linenos" data-linenos="40 "></span></a>
<a id="__codelineno-24-41" name="__codelineno-24-41"></a><a href="#__codelineno-24-41"><span class="linenos" data-linenos="41 "></span></a>
<a id="__codelineno-24-42" name="__codelineno-24-42"></a><a href="#__codelineno-24-42"><span class="linenos" data-linenos="42 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">getGradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">):</span>
<a id="__codelineno-24-43" name="__codelineno-24-43"></a><a href="#__codelineno-24-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;计算列表所有的渐近分数</span>
<a id="__codelineno-24-44" name="__codelineno-24-44"></a><a href="#__codelineno-24-44"><span class="linenos" data-linenos="44 "></span></a><span class="sd">    :param cf: 连分数列表</span>
<a id="__codelineno-24-45" name="__codelineno-24-45"></a><a href="#__codelineno-24-45"><span class="linenos" data-linenos="45 "></span></a><span class="sd">    :return: 该列表所有的渐近分数</span>
<a id="__codelineno-24-46" name="__codelineno-24-46"></a><a href="#__codelineno-24-46"><span class="linenos" data-linenos="46 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-47" name="__codelineno-24-47"></a><a href="#__codelineno-24-47"><span class="linenos" data-linenos="47 "></span></a>    <span class="n">gf</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-24-48" name="__codelineno-24-48"></a><a href="#__codelineno-24-48"><span class="linenos" data-linenos="48 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-24-49" name="__codelineno-24-49"></a><a href="#__codelineno-24-49"><span class="linenos" data-linenos="49 "></span></a>        <span class="n">gf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">[:</span><span class="n">i</span><span class="p">]))</span>
<a id="__codelineno-24-50" name="__codelineno-24-50"></a><a href="#__codelineno-24-50"><span class="linenos" data-linenos="50 "></span></a>    <span class="k">return</span> <span class="n">gf</span>
<a id="__codelineno-24-51" name="__codelineno-24-51"></a><a href="#__codelineno-24-51"><span class="linenos" data-linenos="51 "></span></a>
<a id="__codelineno-24-52" name="__codelineno-24-52"></a><a href="#__codelineno-24-52"><span class="linenos" data-linenos="52 "></span></a>
<a id="__codelineno-24-53" name="__codelineno-24-53"></a><a href="#__codelineno-24-53"><span class="linenos" data-linenos="53 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">wienerAttack</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-24-54" name="__codelineno-24-54"></a><a href="#__codelineno-24-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-55" name="__codelineno-24-55"></a><a href="#__codelineno-24-55"><span class="linenos" data-linenos="55 "></span></a><span class="sd">    :param e:</span>
<a id="__codelineno-24-56" name="__codelineno-24-56"></a><a href="#__codelineno-24-56"><span class="linenos" data-linenos="56 "></span></a><span class="sd">    :param n:</span>
<a id="__codelineno-24-57" name="__codelineno-24-57"></a><a href="#__codelineno-24-57"><span class="linenos" data-linenos="57 "></span></a><span class="sd">    :return: 私钥d</span>
<a id="__codelineno-24-58" name="__codelineno-24-58"></a><a href="#__codelineno-24-58"><span class="linenos" data-linenos="58 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-59" name="__codelineno-24-59"></a><a href="#__codelineno-24-59"><span class="linenos" data-linenos="59 "></span></a>    <span class="n">cf</span> <span class="o">=</span> <span class="n">continuedFra</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-24-60" name="__codelineno-24-60"></a><a href="#__codelineno-24-60"><span class="linenos" data-linenos="60 "></span></a>    <span class="n">gf</span> <span class="o">=</span> <span class="n">getGradualFra</span><span class="p">(</span><span class="n">cf</span><span class="p">)</span>
<a id="__codelineno-24-61" name="__codelineno-24-61"></a><a href="#__codelineno-24-61"><span class="linenos" data-linenos="61 "></span></a>    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gf</span><span class="p">:</span>
<a id="__codelineno-24-62" name="__codelineno-24-62"></a><a href="#__codelineno-24-62"><span class="linenos" data-linenos="62 "></span></a>        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
<a id="__codelineno-24-63" name="__codelineno-24-63"></a><a href="#__codelineno-24-63"><span class="linenos" data-linenos="63 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-24-64" name="__codelineno-24-64"></a><a href="#__codelineno-24-64"><span class="linenos" data-linenos="64 "></span></a>            <span class="k">continue</span>
<a id="__codelineno-24-65" name="__codelineno-24-65"></a><a href="#__codelineno-24-65"><span class="linenos" data-linenos="65 "></span></a>        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">k</span>
<a id="__codelineno-24-66" name="__codelineno-24-66"></a><a href="#__codelineno-24-66"><span class="linenos" data-linenos="66 "></span></a>        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">solve_pq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-24-67" name="__codelineno-24-67"></a><a href="#__codelineno-24-67"><span class="linenos" data-linenos="67 "></span></a>        <span class="k">if</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
<a id="__codelineno-24-68" name="__codelineno-24-68"></a><a href="#__codelineno-24-68"><span class="linenos" data-linenos="68 "></span></a>            <span class="k">return</span> <span class="n">d</span>
<a id="__codelineno-24-69" name="__codelineno-24-69"></a><a href="#__codelineno-24-69"><span class="linenos" data-linenos="69 "></span></a>
<a id="__codelineno-24-70" name="__codelineno-24-70"></a><a href="#__codelineno-24-70"><span class="linenos" data-linenos="70 "></span></a>
<a id="__codelineno-24-71" name="__codelineno-24-71"></a><a href="#__codelineno-24-71"><span class="linenos" data-linenos="71 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">113881698992379349039968368927979997900777221951663104697020683691495129639829918739755194174063944178083527489820939138302751895652076620380510013941997706327553964127612610209509889011613768847759318892303231846117914554931459295347697888260576901354448014917692680573408654658384481284699735788978230690197</span>
<a id="__codelineno-24-72" name="__codelineno-24-72"></a><a href="#__codelineno-24-72"><span class="linenos" data-linenos="72 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">39068960413447607023613035707248214114819409621234801785480423979473767995171860917209502861408393208940683687475760366491413173744775811644295874981290403938714121977201901942939425294427737703229098649131737380098596135730392902019429964095866394165971291108245774407908011073271822915371753470010435225545</span>
<a id="__codelineno-24-73" name="__codelineno-24-73"></a><a href="#__codelineno-24-73"><span class="linenos" data-linenos="73 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">32897925577913728659288168937025744709859960639901500169867896018406263110205704273203287172003057450591000201857719871686024077615520906540631374442504017489026298422189715372129838501090730593164075113452055617571409044743698645392909829425374093273187125709095368164744188182156849031225036001381531504057</span>
<a id="__codelineno-24-74" name="__codelineno-24-74"></a><a href="#__codelineno-24-74"><span class="linenos" data-linenos="74 "></span></a>
<a id="__codelineno-24-75" name="__codelineno-24-75"></a><a href="#__codelineno-24-75"><span class="linenos" data-linenos="75 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">wienerAttack</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-24-76" name="__codelineno-24-76"></a><a href="#__codelineno-24-76"><span class="linenos" data-linenos="76 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-24-77" name="__codelineno-24-77"></a><a href="#__codelineno-24-77"><span class="linenos" data-linenos="77 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-24-78" name="__codelineno-24-78"></a><a href="#__codelineno-24-78"><span class="linenos" data-linenos="78 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</code></pre></div>
<p>exp也可以用sagemath写，这里就不展示了</p>
<h3 id="_15">多因子的维纳攻击<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>例题来源：2023NKCTF——complex_matrix</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><a href="#__codelineno-25-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><a href="#__codelineno-25-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gy</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><a href="#__codelineno-25-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><a href="#__codelineno-25-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><a href="#__codelineno-25-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">k</span> <span class="o">=</span> <span class="mi">400</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><a href="#__codelineno-25-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">741</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">741</span><span class="p">)</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><a href="#__codelineno-25-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><a href="#__codelineno-25-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><a href="#__codelineno-25-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">_flag</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><a href="#__codelineno-25-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><a href="#__codelineno-25-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">d_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">getPrime</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span> 
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><a href="#__codelineno-25-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">e_array</span> <span class="o">=</span> <span class="p">[</span><span class="n">inverse</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">d_array</span><span class="p">]</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><a href="#__codelineno-25-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">_flag</span><span class="p">,</span> <span class="mi">65537</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><a href="#__codelineno-25-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N:&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><a href="#__codelineno-25-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="n">e_array</span><span class="p">)</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><a href="#__codelineno-25-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c:&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><a href="#__codelineno-25-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><a href="#__codelineno-25-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">#N: 71841248095369087024928175623295380241516644434969868335504061065977014103487197287619667598363486210886674500469383623511906399909335989202774281795855975972913438448899231650449810696539722877903606541112937729384851506921675290984316325565141178015123381439392534417225128922398194700511937668809140024838070124095703585627058463137549632965723304713166804084673075651182998654091113119667582720831809458721072371364839503563819080226784026253</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><a href="#__codelineno-25-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">#e: [65128799196671634905309494529154568614228788035735808211836905142007976099865571126946706559109393187772126407982007858423859147772762638898854472065889939549916077695303157760259717113616428849798058080633047516455513870697383339784816006154279428812359241282979297285283850338964993773227397528608557211742425548651971558377656644211835094019462699301650412862894391885325969143805924684662849869947172175608502179438901337558870349697233790535, 58756559706647121529575085912021603170286163639572075337348109911506627489265537716060463072086480156516641723700802217411122982693536541892986623158818442274840863016647800896033363360822503445344748132842451806511693779600370832206455202293028402486647422212959763287987847280322100701242139127654031151565924132562837893975505159702015125483479126108892709063135006366792197127007229210558758401679638300464111782814561428899998471531067163715, 34828685390969672139784723764579499920301439564705391196519314224159563070870933754477650614819514127121146216049444888554338415587165719098661141454627820126445291802801256297252654045398330613075575527685542980264993711077876535643646746742646371967302159565887123638001580042027272379341650995728849759541960087953160211696369079708787543303742132161742979856720539914370868829868891655221361545648778590685232034703220732697083024449894197969, 26717968456600556973167180286909817773394160817933525240720067057464671317174201540556176814203780603153696663101158205367554829261808020426363683474848952397963507069306452835776851274959389849223566030857588019845781623271395012194869024566879791449466064832273531795430185178486425688475688634844530106740480643866537205900809400383304665727460014210405339697947582657505028211149470787536144302545259243549176816653560626044921521516818788487]</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><a href="#__codelineno-25-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">#c: 39297018404565022956251803918747154798377576057123078716166221329195959669756819453426741569480551313085435037629493881038383709458043802420338889323233368852331387845200216275712388921820794980987541224782392553528127093154957890356084331463340193478391679540506421250562554424770350351514435220782124981277580072039637811543914983033300225131364246910828188727043248991987332274929827173923543187017105236008487756190002204169623313222748976369</span>
</code></pre></div>
<p>存个脚本，来源<a href="https://www.nssctf.cn/note/set/51">文章列表 | NSSCTF</a></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><a href="#__codelineno-26-1"><span class="linenos" data-linenos="  1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><a href="#__codelineno-26-2"><span class="linenos" data-linenos="  2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><a href="#__codelineno-26-3"><span class="linenos" data-linenos="  3 "></span></a><span class="n">isdigit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;9&#39;</span><span class="p">)</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><a href="#__codelineno-26-4"><span class="linenos" data-linenos="  4 "></span></a>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><a href="#__codelineno-26-5"><span class="linenos" data-linenos="  5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">my_permutations</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><a href="#__codelineno-26-6"><span class="linenos" data-linenos="  6 "></span></a>    <span class="n">sub</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><a href="#__codelineno-26-7"><span class="linenos" data-linenos="  7 "></span></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><a href="#__codelineno-26-8"><span class="linenos" data-linenos="  8 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prev</span><span class="p">):</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><a href="#__codelineno-26-9"><span class="linenos" data-linenos="  9 "></span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><a href="#__codelineno-26-10"><span class="linenos" data-linenos=" 10 "></span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">[::])</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><a href="#__codelineno-26-11"><span class="linenos" data-linenos=" 11 "></span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">g</span><span class="p">:</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><a href="#__codelineno-26-12"><span class="linenos" data-linenos=" 12 "></span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">prev</span><span class="p">:</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><a href="#__codelineno-26-13"><span class="linenos" data-linenos=" 13 "></span></a>                <span class="k">continue</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><a href="#__codelineno-26-14"><span class="linenos" data-linenos=" 14 "></span></a>            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><a href="#__codelineno-26-15"><span class="linenos" data-linenos=" 15 "></span></a>            <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><a href="#__codelineno-26-16"><span class="linenos" data-linenos=" 16 "></span></a>            <span class="n">s</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><a href="#__codelineno-26-17"><span class="linenos" data-linenos=" 17 "></span></a>    <span class="n">dfs</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><a href="#__codelineno-26-18"><span class="linenos" data-linenos=" 18 "></span></a>    <span class="k">return</span> <span class="n">res</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a><a href="#__codelineno-26-19"><span class="linenos" data-linenos=" 19 "></span></a>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a><a href="#__codelineno-26-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">X3NNY</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a><a href="#__codelineno-26-21"><span class="linenos" data-linenos=" 21 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">exp2</span><span class="p">):</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a><a href="#__codelineno-26-22"><span class="linenos" data-linenos=" 22 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exp1</span> <span class="o">=</span> <span class="n">exp1</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a><a href="#__codelineno-26-23"><span class="linenos" data-linenos=" 23 "></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exp2</span> <span class="o">=</span> <span class="n">exp2</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a><a href="#__codelineno-26-24"><span class="linenos" data-linenos=" 24 "></span></a>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a><a href="#__codelineno-26-25"><span class="linenos" data-linenos=" 25 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a><a href="#__codelineno-26-26"><span class="linenos" data-linenos=" 26 "></span></a>        <span class="k">return</span> <span class="n">X3NNY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp1</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">exp1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp2</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">exp2</span><span class="p">)</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a><a href="#__codelineno-26-27"><span class="linenos" data-linenos=" 27 "></span></a>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a><a href="#__codelineno-26-28"><span class="linenos" data-linenos=" 28 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a><a href="#__codelineno-26-29"><span class="linenos" data-linenos=" 29 "></span></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp1</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span><span class="o">.</span><span class="n">collect_common_factors</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp2</span><span class="p">)</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a><a href="#__codelineno-26-30"><span class="linenos" data-linenos=" 30 "></span></a>
<a id="__codelineno-26-31" name="__codelineno-26-31"></a><a href="#__codelineno-26-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="k">class</span><span class="w"> </span><span class="nc">X_Complex</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a id="__codelineno-26-32" name="__codelineno-26-32"></a><a href="#__codelineno-26-32"><span class="linenos" data-linenos=" 32 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
<a id="__codelineno-26-33" name="__codelineno-26-33"></a><a href="#__codelineno-26-33"><span class="linenos" data-linenos=" 33 "></span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-34" name="__codelineno-26-34"></a><a href="#__codelineno-26-34"><span class="linenos" data-linenos=" 34 "></span></a>        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">exp</span>
<a id="__codelineno-26-35" name="__codelineno-26-35"></a><a href="#__codelineno-26-35"><span class="linenos" data-linenos=" 35 "></span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<a id="__codelineno-26-36" name="__codelineno-26-36"></a><a href="#__codelineno-26-36"><span class="linenos" data-linenos=" 36 "></span></a>            <span class="k">if</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
<a id="__codelineno-26-37" name="__codelineno-26-37"></a><a href="#__codelineno-26-37"><span class="linenos" data-linenos=" 37 "></span></a>                <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-38" name="__codelineno-26-38"></a><a href="#__codelineno-26-38"><span class="linenos" data-linenos=" 38 "></span></a>                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
<a id="__codelineno-26-39" name="__codelineno-26-39"></a><a href="#__codelineno-26-39"><span class="linenos" data-linenos=" 39 "></span></a>                    <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-26-40" name="__codelineno-26-40"></a><a href="#__codelineno-26-40"><span class="linenos" data-linenos=" 40 "></span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-41" name="__codelineno-26-41"></a><a href="#__codelineno-26-41"><span class="linenos" data-linenos=" 41 "></span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<a id="__codelineno-26-42" name="__codelineno-26-42"></a><a href="#__codelineno-26-42"><span class="linenos" data-linenos=" 42 "></span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">num</span>
<a id="__codelineno-26-43" name="__codelineno-26-43"></a><a href="#__codelineno-26-43"><span class="linenos" data-linenos=" 43 "></span></a>                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
<a id="__codelineno-26-44" name="__codelineno-26-44"></a><a href="#__codelineno-26-44"><span class="linenos" data-linenos=" 44 "></span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">num</span>
<a id="__codelineno-26-45" name="__codelineno-26-45"></a><a href="#__codelineno-26-45"><span class="linenos" data-linenos=" 45 "></span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
<a id="__codelineno-26-46" name="__codelineno-26-46"></a><a href="#__codelineno-26-46"><span class="linenos" data-linenos=" 46 "></span></a>                <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
<a id="__codelineno-26-47" name="__codelineno-26-47"></a><a href="#__codelineno-26-47"><span class="linenos" data-linenos=" 47 "></span></a>                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-48" name="__codelineno-26-48"></a><a href="#__codelineno-26-48"><span class="linenos" data-linenos=" 48 "></span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-49" name="__codelineno-26-49"></a><a href="#__codelineno-26-49"><span class="linenos" data-linenos=" 49 "></span></a>                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
<a id="__codelineno-26-50" name="__codelineno-26-50"></a><a href="#__codelineno-26-50"><span class="linenos" data-linenos=" 50 "></span></a>                        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-26-51" name="__codelineno-26-51"></a><a href="#__codelineno-26-51"><span class="linenos" data-linenos=" 51 "></span></a>                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-52" name="__codelineno-26-52"></a><a href="#__codelineno-26-52"><span class="linenos" data-linenos=" 52 "></span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">num</span><span class="o">/</span><span class="n">r</span>
<a id="__codelineno-26-53" name="__codelineno-26-53"></a><a href="#__codelineno-26-53"><span class="linenos" data-linenos=" 53 "></span></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-54" name="__codelineno-26-54"></a><a href="#__codelineno-26-54"><span class="linenos" data-linenos=" 54 "></span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-55" name="__codelineno-26-55"></a><a href="#__codelineno-26-55"><span class="linenos" data-linenos=" 55 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">):</span>
<a id="__codelineno-26-56" name="__codelineno-26-56"></a><a href="#__codelineno-26-56"><span class="linenos" data-linenos=" 56 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-26-57" name="__codelineno-26-57"></a><a href="#__codelineno-26-57"><span class="linenos" data-linenos=" 57 "></span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">):</span>
<a id="__codelineno-26-58" name="__codelineno-26-58"></a><a href="#__codelineno-26-58"><span class="linenos" data-linenos=" 58 "></span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-59" name="__codelineno-26-59"></a><a href="#__codelineno-26-59"><span class="linenos" data-linenos=" 59 "></span></a>
<a id="__codelineno-26-60" name="__codelineno-26-60"></a><a href="#__codelineno-26-60"><span class="linenos" data-linenos=" 60 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">WW</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<a id="__codelineno-26-61" name="__codelineno-26-61"></a><a href="#__codelineno-26-61"><span class="linenos" data-linenos=" 61 "></span></a>    <span class="k">return</span> <span class="n">X3NNY</span><span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">g</span><span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">N</span><span class="p">,</span> <span class="n">g</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-26-62" name="__codelineno-26-62"></a><a href="#__codelineno-26-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">GG</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
<a id="__codelineno-26-63" name="__codelineno-26-63"></a><a href="#__codelineno-26-63"><span class="linenos" data-linenos=" 63 "></span></a>    <span class="k">return</span> <span class="n">X3NNY</span><span class="p">(</span><span class="n">e1</span><span class="o">*</span><span class="n">d1</span><span class="o">*</span><span class="n">k2</span><span class="o">-</span> <span class="n">e2</span><span class="o">*</span><span class="n">d2</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span> <span class="o">-</span> <span class="n">k1</span><span class="p">)</span>
<a id="__codelineno-26-64" name="__codelineno-26-64"></a><a href="#__codelineno-26-64"><span class="linenos" data-linenos=" 64 "></span></a>
<a id="__codelineno-26-65" name="__codelineno-26-65"></a><a href="#__codelineno-26-65"><span class="linenos" data-linenos=" 65 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">W</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<a id="__codelineno-26-66" name="__codelineno-26-66"></a><a href="#__codelineno-26-66"><span class="linenos" data-linenos=" 66 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;e</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-67" name="__codelineno-26-67"></a><a href="#__codelineno-26-67"><span class="linenos" data-linenos=" 67 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;d</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-68" name="__codelineno-26-68"></a><a href="#__codelineno-26-68"><span class="linenos" data-linenos=" 68 "></span></a>    <span class="n">k</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;k</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-69" name="__codelineno-26-69"></a><a href="#__codelineno-26-69"><span class="linenos" data-linenos=" 69 "></span></a>    <span class="k">return</span> <span class="n">WW</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-26-70" name="__codelineno-26-70"></a><a href="#__codelineno-26-70"><span class="linenos" data-linenos=" 70 "></span></a>
<a id="__codelineno-26-71" name="__codelineno-26-71"></a><a href="#__codelineno-26-71"><span class="linenos" data-linenos=" 71 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">G</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<a id="__codelineno-26-72" name="__codelineno-26-72"></a><a href="#__codelineno-26-72"><span class="linenos" data-linenos=" 72 "></span></a>    <span class="n">e1</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;e</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-73" name="__codelineno-26-73"></a><a href="#__codelineno-26-73"><span class="linenos" data-linenos=" 73 "></span></a>    <span class="n">d1</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;d</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-74" name="__codelineno-26-74"></a><a href="#__codelineno-26-74"><span class="linenos" data-linenos=" 74 "></span></a>    <span class="n">k1</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;k</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-75" name="__codelineno-26-75"></a><a href="#__codelineno-26-75"><span class="linenos" data-linenos=" 75 "></span></a>
<a id="__codelineno-26-76" name="__codelineno-26-76"></a><a href="#__codelineno-26-76"><span class="linenos" data-linenos=" 76 "></span></a>    <span class="n">e2</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;e</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">j</span><span class="p">)</span>
<a id="__codelineno-26-77" name="__codelineno-26-77"></a><a href="#__codelineno-26-77"><span class="linenos" data-linenos=" 77 "></span></a>    <span class="n">d2</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;d</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">j</span><span class="p">)</span>
<a id="__codelineno-26-78" name="__codelineno-26-78"></a><a href="#__codelineno-26-78"><span class="linenos" data-linenos=" 78 "></span></a>    <span class="n">k2</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">&quot;k</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">j</span><span class="p">)</span>
<a id="__codelineno-26-79" name="__codelineno-26-79"></a><a href="#__codelineno-26-79"><span class="linenos" data-linenos=" 79 "></span></a>
<a id="__codelineno-26-80" name="__codelineno-26-80"></a><a href="#__codelineno-26-80"><span class="linenos" data-linenos=" 80 "></span></a>    <span class="k">return</span> <span class="n">GG</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
<a id="__codelineno-26-81" name="__codelineno-26-81"></a><a href="#__codelineno-26-81"><span class="linenos" data-linenos=" 81 "></span></a>
<a id="__codelineno-26-82" name="__codelineno-26-82"></a><a href="#__codelineno-26-82"><span class="linenos" data-linenos=" 82 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">R</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sn</span><span class="p">):</span> <span class="c1">## min u max v</span>
<a id="__codelineno-26-83" name="__codelineno-26-83"></a><a href="#__codelineno-26-83"><span class="linenos" data-linenos=" 83 "></span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="n">X3NNY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-84" name="__codelineno-26-84"></a><a href="#__codelineno-26-84"><span class="linenos" data-linenos=" 84 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-26-85" name="__codelineno-26-85"></a><a href="#__codelineno-26-85"><span class="linenos" data-linenos=" 85 "></span></a>    <span class="n">nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-26-86" name="__codelineno-26-86"></a><a href="#__codelineno-26-86"><span class="linenos" data-linenos=" 86 "></span></a>    <span class="n">l</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-26-87" name="__codelineno-26-87"></a><a href="#__codelineno-26-87"><span class="linenos" data-linenos=" 87 "></span></a>    <span class="n">debug</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<a id="__codelineno-26-88" name="__codelineno-26-88"></a><a href="#__codelineno-26-88"><span class="linenos" data-linenos=" 88 "></span></a>    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-26-89" name="__codelineno-26-89"></a><a href="#__codelineno-26-89"><span class="linenos" data-linenos=" 89 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-26-90" name="__codelineno-26-90"></a><a href="#__codelineno-26-90"><span class="linenos" data-linenos=" 90 "></span></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-26-91" name="__codelineno-26-91"></a><a href="#__codelineno-26-91"><span class="linenos" data-linenos=" 91 "></span></a>            <span class="n">ret</span> <span class="o">*=</span> <span class="n">W</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-92" name="__codelineno-26-92"></a><a href="#__codelineno-26-92"><span class="linenos" data-linenos=" 92 "></span></a>            <span class="n">debug</span> <span class="o">+=</span> <span class="s1">&#39;W(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">i</span>
<a id="__codelineno-26-93" name="__codelineno-26-93"></a><a href="#__codelineno-26-93"><span class="linenos" data-linenos=" 93 "></span></a>            <span class="n">nn</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-26-94" name="__codelineno-26-94"></a><a href="#__codelineno-26-94"><span class="linenos" data-linenos=" 94 "></span></a>            <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-95" name="__codelineno-26-95"></a><a href="#__codelineno-26-95"><span class="linenos" data-linenos=" 95 "></span></a>            <span class="n">u</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-96" name="__codelineno-26-96"></a><a href="#__codelineno-26-96"><span class="linenos" data-linenos=" 96 "></span></a>        <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">nn</span><span class="p">:</span>
<a id="__codelineno-26-97" name="__codelineno-26-97"></a><a href="#__codelineno-26-97"><span class="linenos" data-linenos=" 97 "></span></a>            <span class="n">ret</span> <span class="o">*=</span> <span class="n">G</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-98" name="__codelineno-26-98"></a><a href="#__codelineno-26-98"><span class="linenos" data-linenos=" 98 "></span></a>            <span class="n">nn</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-26-99" name="__codelineno-26-99"></a><a href="#__codelineno-26-99"><span class="linenos" data-linenos=" 99 "></span></a>            <span class="n">debug</span> <span class="o">+=</span> <span class="s1">&#39;G(</span><span class="si">%d</span><span class="s1">, </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-100" name="__codelineno-26-100"></a><a href="#__codelineno-26-100"><span class="linenos" data-linenos="100 "></span></a>            <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
<a id="__codelineno-26-101" name="__codelineno-26-101"></a><a href="#__codelineno-26-101"><span class="linenos" data-linenos="101 "></span></a>            <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-102" name="__codelineno-26-102"></a><a href="#__codelineno-26-102"><span class="linenos" data-linenos="102 "></span></a>            <span class="n">v</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-103" name="__codelineno-26-103"></a><a href="#__codelineno-26-103"><span class="linenos" data-linenos="103 "></span></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-104" name="__codelineno-26-104"></a><a href="#__codelineno-26-104"><span class="linenos" data-linenos="104 "></span></a>            <span class="n">ret</span> <span class="o">*=</span> <span class="n">W</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-105" name="__codelineno-26-105"></a><a href="#__codelineno-26-105"><span class="linenos" data-linenos="105 "></span></a>            <span class="n">l</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-106" name="__codelineno-26-106"></a><a href="#__codelineno-26-106"><span class="linenos" data-linenos="106 "></span></a>            <span class="n">debug</span> <span class="o">+=</span> <span class="s1">&#39;W(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">i</span>
<a id="__codelineno-26-107" name="__codelineno-26-107"></a><a href="#__codelineno-26-107"><span class="linenos" data-linenos="107 "></span></a>            <span class="n">nn</span> <span class="o">-=</span> <span class="mi">1</span>
<a id="__codelineno-26-108" name="__codelineno-26-108"></a><a href="#__codelineno-26-108"><span class="linenos" data-linenos="108 "></span></a>            <span class="n">u</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-109" name="__codelineno-26-109"></a><a href="#__codelineno-26-109"><span class="linenos" data-linenos="109 "></span></a>    <span class="c1">## print(debug, end = &#39; &#39;)</span>
<a id="__codelineno-26-110" name="__codelineno-26-110"></a><a href="#__codelineno-26-110"><span class="linenos" data-linenos="110 "></span></a>    <span class="k">return</span> <span class="n">ret</span><span class="p">,</span> <span class="n">u</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">sn</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span>
<a id="__codelineno-26-111" name="__codelineno-26-111"></a><a href="#__codelineno-26-111"><span class="linenos" data-linenos="111 "></span></a>
<a id="__codelineno-26-112" name="__codelineno-26-112"></a><a href="#__codelineno-26-112"><span class="linenos" data-linenos="112 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">H</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-26-113" name="__codelineno-26-113"></a><a href="#__codelineno-26-113"><span class="linenos" data-linenos="113 "></span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-26-114" name="__codelineno-26-114"></a><a href="#__codelineno-26-114"><span class="linenos" data-linenos="114 "></span></a>        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-26-115" name="__codelineno-26-115"></a><a href="#__codelineno-26-115"><span class="linenos" data-linenos="115 "></span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-26-116" name="__codelineno-26-116"></a><a href="#__codelineno-26-116"><span class="linenos" data-linenos="116 "></span></a>        <span class="k">return</span> <span class="p">[(),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-26-117" name="__codelineno-26-117"></a><a href="#__codelineno-26-117"><span class="linenos" data-linenos="117 "></span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-118" name="__codelineno-26-118"></a><a href="#__codelineno-26-118"><span class="linenos" data-linenos="118 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-26-119" name="__codelineno-26-119"></a><a href="#__codelineno-26-119"><span class="linenos" data-linenos="119 "></span></a>        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,))</span>
<a id="__codelineno-26-120" name="__codelineno-26-120"></a><a href="#__codelineno-26-120"><span class="linenos" data-linenos="120 "></span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<a id="__codelineno-26-121" name="__codelineno-26-121"></a><a href="#__codelineno-26-121"><span class="linenos" data-linenos="121 "></span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">my_permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">j</span><span class="p">):</span>
<a id="__codelineno-26-122" name="__codelineno-26-122"></a><a href="#__codelineno-26-122"><span class="linenos" data-linenos="122 "></span></a>                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<a id="__codelineno-26-123" name="__codelineno-26-123"></a><a href="#__codelineno-26-123"><span class="linenos" data-linenos="123 "></span></a>    <span class="k">return</span> <span class="n">H</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">ret</span>
<a id="__codelineno-26-124" name="__codelineno-26-124"></a><a href="#__codelineno-26-124"><span class="linenos" data-linenos="124 "></span></a>
<a id="__codelineno-26-125" name="__codelineno-26-125"></a><a href="#__codelineno-26-125"><span class="linenos" data-linenos="125 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">CC</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-26-126" name="__codelineno-26-126"></a><a href="#__codelineno-26-126"><span class="linenos" data-linenos="126 "></span></a>    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">n</span><span class="p">)]</span>
<a id="__codelineno-26-127" name="__codelineno-26-127"></a><a href="#__codelineno-26-127"><span class="linenos" data-linenos="127 "></span></a>
<a id="__codelineno-26-128" name="__codelineno-26-128"></a><a href="#__codelineno-26-128"><span class="linenos" data-linenos="128 "></span></a>    <span class="c1">## split exp</span>
<a id="__codelineno-26-129" name="__codelineno-26-129"></a><a href="#__codelineno-26-129"><span class="linenos" data-linenos="129 "></span></a>    <span class="n">texps</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">exp</span><span class="o">.</span><span class="n">exp1</span><span class="o">.</span><span class="n">expand</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">)</span>
<a id="__codelineno-26-130" name="__codelineno-26-130"></a><a href="#__codelineno-26-130"><span class="linenos" data-linenos="130 "></span></a>    <span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-131" name="__codelineno-26-131"></a><a href="#__codelineno-26-131"><span class="linenos" data-linenos="131 "></span></a>    <span class="n">exps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-132" name="__codelineno-26-132"></a><a href="#__codelineno-26-132"><span class="linenos" data-linenos="132 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">texps</span><span class="p">)):</span>
<a id="__codelineno-26-133" name="__codelineno-26-133"></a><a href="#__codelineno-26-133"><span class="linenos" data-linenos="133 "></span></a>        <span class="k">if</span> <span class="n">texps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-26-134" name="__codelineno-26-134"></a><a href="#__codelineno-26-134"><span class="linenos" data-linenos="134 "></span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">texps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; + &#39;</span><span class="p">)</span>
<a id="__codelineno-26-135" name="__codelineno-26-135"></a><a href="#__codelineno-26-135"><span class="linenos" data-linenos="135 "></span></a>            <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-26-136" name="__codelineno-26-136"></a><a href="#__codelineno-26-136"><span class="linenos" data-linenos="136 "></span></a>            <span class="n">exps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-26-137" name="__codelineno-26-137"></a><a href="#__codelineno-26-137"><span class="linenos" data-linenos="137 "></span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
<a id="__codelineno-26-138" name="__codelineno-26-138"></a><a href="#__codelineno-26-138"><span class="linenos" data-linenos="138 "></span></a>                <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-139" name="__codelineno-26-139"></a><a href="#__codelineno-26-139"><span class="linenos" data-linenos="139 "></span></a>                <span class="n">exps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-26-140" name="__codelineno-26-140"></a><a href="#__codelineno-26-140"><span class="linenos" data-linenos="140 "></span></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-141" name="__codelineno-26-141"></a><a href="#__codelineno-26-141"><span class="linenos" data-linenos="141 "></span></a>            <span class="n">ops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-26-142" name="__codelineno-26-142"></a><a href="#__codelineno-26-142"><span class="linenos" data-linenos="142 "></span></a>            <span class="n">exps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">texps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-26-143" name="__codelineno-26-143"></a><a href="#__codelineno-26-143"><span class="linenos" data-linenos="143 "></span></a>    <span class="k">if</span> <span class="n">exps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
<a id="__codelineno-26-144" name="__codelineno-26-144"></a><a href="#__codelineno-26-144"><span class="linenos" data-linenos="144 "></span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exps</span><span class="p">)):</span>
<a id="__codelineno-26-145" name="__codelineno-26-145"></a><a href="#__codelineno-26-145"><span class="linenos" data-linenos="145 "></span></a>            <span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-26-146" name="__codelineno-26-146"></a><a href="#__codelineno-26-146"><span class="linenos" data-linenos="146 "></span></a>        <span class="n">exps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">exps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-26-147" name="__codelineno-26-147"></a><a href="#__codelineno-26-147"><span class="linenos" data-linenos="147 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-148" name="__codelineno-26-148"></a><a href="#__codelineno-26-148"><span class="linenos" data-linenos="148 "></span></a>        <span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-26-149" name="__codelineno-26-149"></a><a href="#__codelineno-26-149"><span class="linenos" data-linenos="149 "></span></a>    <span class="c1">## find e and N</span>
<a id="__codelineno-26-150" name="__codelineno-26-150"></a><a href="#__codelineno-26-150"><span class="linenos" data-linenos="150 "></span></a>    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-151" name="__codelineno-26-151"></a><a href="#__codelineno-26-151"><span class="linenos" data-linenos="151 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exps</span><span class="p">)):</span>
<a id="__codelineno-26-152" name="__codelineno-26-152"></a><a href="#__codelineno-26-152"><span class="linenos" data-linenos="152 "></span></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-26-153" name="__codelineno-26-153"></a><a href="#__codelineno-26-153"><span class="linenos" data-linenos="153 "></span></a>        <span class="n">en</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-154" name="__codelineno-26-154"></a><a href="#__codelineno-26-154"><span class="linenos" data-linenos="154 "></span></a>        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-155" name="__codelineno-26-155"></a><a href="#__codelineno-26-155"><span class="linenos" data-linenos="155 "></span></a>        <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
<a id="__codelineno-26-156" name="__codelineno-26-156"></a><a href="#__codelineno-26-156"><span class="linenos" data-linenos="156 "></span></a>            <span class="k">if</span> <span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span>
<a id="__codelineno-26-157" name="__codelineno-26-157"></a><a href="#__codelineno-26-157"><span class="linenos" data-linenos="157 "></span></a>                <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-158" name="__codelineno-26-158"></a><a href="#__codelineno-26-158"><span class="linenos" data-linenos="158 "></span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-159" name="__codelineno-26-159"></a><a href="#__codelineno-26-159"><span class="linenos" data-linenos="159 "></span></a>                <span class="k">while</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
<a id="__codelineno-26-160" name="__codelineno-26-160"></a><a href="#__codelineno-26-160"><span class="linenos" data-linenos="160 "></span></a>                    <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
<a id="__codelineno-26-161" name="__codelineno-26-161"></a><a href="#__codelineno-26-161"><span class="linenos" data-linenos="161 "></span></a>                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-162" name="__codelineno-26-162"></a><a href="#__codelineno-26-162"><span class="linenos" data-linenos="162 "></span></a>                <span class="n">tmp</span> <span class="o">*=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;e</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">num</span><span class="p">)</span>
<a id="__codelineno-26-163" name="__codelineno-26-163"></a><a href="#__codelineno-26-163"><span class="linenos" data-linenos="163 "></span></a>                <span class="n">en</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<a id="__codelineno-26-164" name="__codelineno-26-164"></a><a href="#__codelineno-26-164"><span class="linenos" data-linenos="164 "></span></a>            <span class="k">elif</span> <span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
<a id="__codelineno-26-165" name="__codelineno-26-165"></a><a href="#__codelineno-26-165"><span class="linenos" data-linenos="165 "></span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-166" name="__codelineno-26-166"></a><a href="#__codelineno-26-166"><span class="linenos" data-linenos="166 "></span></a>                <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-26-167" name="__codelineno-26-167"></a><a href="#__codelineno-26-167"><span class="linenos" data-linenos="167 "></span></a>                <span class="k">if</span> <span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;^&#39;</span><span class="p">:</span>
<a id="__codelineno-26-168" name="__codelineno-26-168"></a><a href="#__codelineno-26-168"><span class="linenos" data-linenos="168 "></span></a>                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-169" name="__codelineno-26-169"></a><a href="#__codelineno-26-169"><span class="linenos" data-linenos="169 "></span></a>                    <span class="k">while</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
<a id="__codelineno-26-170" name="__codelineno-26-170"></a><a href="#__codelineno-26-170"><span class="linenos" data-linenos="170 "></span></a>                        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">exps</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
<a id="__codelineno-26-171" name="__codelineno-26-171"></a><a href="#__codelineno-26-171"><span class="linenos" data-linenos="171 "></span></a>                        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-172" name="__codelineno-26-172"></a><a href="#__codelineno-26-172"><span class="linenos" data-linenos="172 "></span></a>                <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-26-173" name="__codelineno-26-173"></a><a href="#__codelineno-26-173"><span class="linenos" data-linenos="173 "></span></a>                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-26-174" name="__codelineno-26-174"></a><a href="#__codelineno-26-174"><span class="linenos" data-linenos="174 "></span></a>                <span class="n">tmp</span> <span class="o">*=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;N**</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">num</span><span class="p">)</span>
<a id="__codelineno-26-175" name="__codelineno-26-175"></a><a href="#__codelineno-26-175"><span class="linenos" data-linenos="175 "></span></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-176" name="__codelineno-26-176"></a><a href="#__codelineno-26-176"><span class="linenos" data-linenos="176 "></span></a>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-26-177" name="__codelineno-26-177"></a><a href="#__codelineno-26-177"><span class="linenos" data-linenos="177 "></span></a>        <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">tmp</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-26-178" name="__codelineno-26-178"></a><a href="#__codelineno-26-178"><span class="linenos" data-linenos="178 "></span></a>            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="p">()))</span>
<a id="__codelineno-26-179" name="__codelineno-26-179"></a><a href="#__codelineno-26-179"><span class="linenos" data-linenos="179 "></span></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-26-180" name="__codelineno-26-180"></a><a href="#__codelineno-26-180"><span class="linenos" data-linenos="180 "></span></a>            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tmp</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">en</span><span class="p">))))</span>
<a id="__codelineno-26-181" name="__codelineno-26-181"></a><a href="#__codelineno-26-181"><span class="linenos" data-linenos="181 "></span></a>
<a id="__codelineno-26-182" name="__codelineno-26-182"></a><a href="#__codelineno-26-182"><span class="linenos" data-linenos="182 "></span></a>    <span class="c1">## construct h</span>
<a id="__codelineno-26-183" name="__codelineno-26-183"></a><a href="#__codelineno-26-183"><span class="linenos" data-linenos="183 "></span></a>    <span class="n">mp</span> <span class="o">=</span> <span class="n">H</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-26-184" name="__codelineno-26-184"></a><a href="#__codelineno-26-184"><span class="linenos" data-linenos="184 "></span></a>    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">en</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
<a id="__codelineno-26-185" name="__codelineno-26-185"></a><a href="#__codelineno-26-185"><span class="linenos" data-linenos="185 "></span></a>        <span class="n">cols</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">en</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
<a id="__codelineno-26-186" name="__codelineno-26-186"></a><a href="#__codelineno-26-186"><span class="linenos" data-linenos="186 "></span></a>    <span class="c1">## print(cols)</span>
<a id="__codelineno-26-187" name="__codelineno-26-187"></a><a href="#__codelineno-26-187"><span class="linenos" data-linenos="187 "></span></a>    <span class="k">return</span> <span class="n">cols</span>
<a id="__codelineno-26-188" name="__codelineno-26-188"></a><a href="#__codelineno-26-188"><span class="linenos" data-linenos="188 "></span></a>
<a id="__codelineno-26-189" name="__codelineno-26-189"></a><a href="#__codelineno-26-189"><span class="linenos" data-linenos="189 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">EWA</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">elist</span><span class="p">,</span> <span class="n">NN</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<a id="__codelineno-26-190" name="__codelineno-26-190"></a><a href="#__codelineno-26-190"><span class="linenos" data-linenos="190 "></span></a>    <span class="n">mp</span> <span class="o">=</span> <span class="n">H</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-26-191" name="__codelineno-26-191"></a><a href="#__codelineno-26-191"><span class="linenos" data-linenos="191 "></span></a>    <span class="n">var</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<a id="__codelineno-26-192" name="__codelineno-26-192"></a><a href="#__codelineno-26-192"><span class="linenos" data-linenos="192 "></span></a>    <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="n">X_Complex</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="p">)]</span>
<a id="__codelineno-26-193" name="__codelineno-26-193"></a><a href="#__codelineno-26-193"><span class="linenos" data-linenos="193 "></span></a>    <span class="n">cols</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="n">n</span><span class="p">)]]</span>
<a id="__codelineno-26-194" name="__codelineno-26-194"></a><a href="#__codelineno-26-194"><span class="linenos" data-linenos="194 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<a id="__codelineno-26-195" name="__codelineno-26-195"></a><a href="#__codelineno-26-195"><span class="linenos" data-linenos="195 "></span></a>        <span class="n">eL</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-26-196" name="__codelineno-26-196"></a><a href="#__codelineno-26-196"><span class="linenos" data-linenos="196 "></span></a>        <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CC</span><span class="p">(</span><span class="n">eL</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-26-197" name="__codelineno-26-197"></a><a href="#__codelineno-26-197"><span class="linenos" data-linenos="197 "></span></a>        <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_Complex</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<a id="__codelineno-26-198" name="__codelineno-26-198"></a><a href="#__codelineno-26-198"><span class="linenos" data-linenos="198 "></span></a>
<a id="__codelineno-26-199" name="__codelineno-26-199"></a><a href="#__codelineno-26-199"><span class="linenos" data-linenos="199 "></span></a>    <span class="n">alphaA</span><span class="p">,</span><span class="n">alphaB</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-26-200" name="__codelineno-26-200"></a><a href="#__codelineno-26-200"><span class="linenos" data-linenos="200 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">S</span><span class="p">:</span>
<a id="__codelineno-26-201" name="__codelineno-26-201"></a><a href="#__codelineno-26-201"><span class="linenos" data-linenos="201 "></span></a>        <span class="n">alphaA</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">alphaA</span><span class="p">)</span>
<a id="__codelineno-26-202" name="__codelineno-26-202"></a><a href="#__codelineno-26-202"><span class="linenos" data-linenos="202 "></span></a>        <span class="n">alphaB</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">alphaB</span><span class="p">)</span>
<a id="__codelineno-26-203" name="__codelineno-26-203"></a><a href="#__codelineno-26-203"><span class="linenos" data-linenos="203 "></span></a>    <span class="c1">## print(alphaA, alphaB)</span>
<a id="__codelineno-26-204" name="__codelineno-26-204"></a><a href="#__codelineno-26-204"><span class="linenos" data-linenos="204 "></span></a>    <span class="n">D</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-205" name="__codelineno-26-205"></a><a href="#__codelineno-26-205"><span class="linenos" data-linenos="205 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)):</span>
<a id="__codelineno-26-206" name="__codelineno-26-206"></a><a href="#__codelineno-26-206"><span class="linenos" data-linenos="206 "></span></a>        <span class="c1">## print((alphaA-S[i].a), (alphaB - S[i].b))</span>
<a id="__codelineno-26-207" name="__codelineno-26-207"></a><a href="#__codelineno-26-207"><span class="linenos" data-linenos="207 "></span></a>        <span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-26-208" name="__codelineno-26-208"></a><a href="#__codelineno-26-208"><span class="linenos" data-linenos="208 "></span></a>            <span class="nb">int</span><span class="p">(</span><span class="n">NN</span><span class="o">^</span><span class="p">((</span><span class="n">alphaA</span><span class="o">-</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">alpha</span> <span class="o">+</span> <span class="p">(</span><span class="n">alphaB</span> <span class="o">-</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">b</span><span class="p">)))</span>
<a id="__codelineno-26-209" name="__codelineno-26-209"></a><a href="#__codelineno-26-209"><span class="linenos" data-linenos="209 "></span></a>        <span class="p">)</span>
<a id="__codelineno-26-210" name="__codelineno-26-210"></a><a href="#__codelineno-26-210"><span class="linenos" data-linenos="210 "></span></a>    <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">NN</span><span class="p">}</span>
<a id="__codelineno-26-211" name="__codelineno-26-211"></a><a href="#__codelineno-26-211"><span class="linenos" data-linenos="211 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">)):</span>
<a id="__codelineno-26-212" name="__codelineno-26-212"></a><a href="#__codelineno-26-212"><span class="linenos" data-linenos="212 "></span></a>        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;e</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">elist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-26-213" name="__codelineno-26-213"></a><a href="#__codelineno-26-213"><span class="linenos" data-linenos="213 "></span></a>
<a id="__codelineno-26-214" name="__codelineno-26-214"></a><a href="#__codelineno-26-214"><span class="linenos" data-linenos="214 "></span></a>    <span class="n">B</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span> <span class="o">*</span> <span class="n">diagonal_matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
<a id="__codelineno-26-215" name="__codelineno-26-215"></a><a href="#__codelineno-26-215"><span class="linenos" data-linenos="215 "></span></a>    <span class="n">L</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">LLL</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-26-216" name="__codelineno-26-216"></a><a href="#__codelineno-26-216"><span class="linenos" data-linenos="216 "></span></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-26-217" name="__codelineno-26-217"></a><a href="#__codelineno-26-217"><span class="linenos" data-linenos="217 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-218" name="__codelineno-26-218"></a><a href="#__codelineno-26-218"><span class="linenos" data-linenos="218 "></span></a>    <span class="n">phi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">elist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-26-219" name="__codelineno-26-219"></a><a href="#__codelineno-26-219"><span class="linenos" data-linenos="219 "></span></a>    <span class="k">return</span> <span class="n">phi</span>
<a id="__codelineno-26-220" name="__codelineno-26-220"></a><a href="#__codelineno-26-220"><span class="linenos" data-linenos="220 "></span></a>
<a id="__codelineno-26-221" name="__codelineno-26-221"></a><a href="#__codelineno-26-221"><span class="linenos" data-linenos="221 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">attack</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span> <span class="n">elist</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<a id="__codelineno-26-222" name="__codelineno-26-222"></a><a href="#__codelineno-26-222"><span class="linenos" data-linenos="222 "></span></a>    <span class="n">phi</span> <span class="o">=</span> <span class="n">EWA</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">),</span> <span class="n">elist</span><span class="p">,</span> <span class="n">NN</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<a id="__codelineno-26-223" name="__codelineno-26-223"></a><a href="#__codelineno-26-223"><span class="linenos" data-linenos="223 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-26-224" name="__codelineno-26-224"></a><a href="#__codelineno-26-224"><span class="linenos" data-linenos="224 "></span></a>    <span class="k">return</span> <span class="n">phi</span>
<a id="__codelineno-26-225" name="__codelineno-26-225"></a><a href="#__codelineno-26-225"><span class="linenos" data-linenos="225 "></span></a>
<a id="__codelineno-26-226" name="__codelineno-26-226"></a><a href="#__codelineno-26-226"><span class="linenos" data-linenos="226 "></span></a>
<a id="__codelineno-26-227" name="__codelineno-26-227"></a><a href="#__codelineno-26-227"><span class="linenos" data-linenos="227 "></span></a><span class="n">NN</span> <span class="o">=</span> <span class="mi">71841248095369087024928175623295380241516644434969868335504061065977014103487197287619667598363486210886674500469383623511906399909335989202774281795855975972913438448899231650449810696539722877903606541112937729384851506921675290984316325565141178015123381439392534417225128922398194700511937668809140024838070124095703585627058463137549632965723304713166804084673075651182998654091113119667582720831809458721072371364839503563819080226784026253</span>
<a id="__codelineno-26-228" name="__codelineno-26-228"></a><a href="#__codelineno-26-228"><span class="linenos" data-linenos="228 "></span></a><span class="n">elist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">65128799196671634905309494529154568614228788035735808211836905142007976099865571126946706559109393187772126407982007858423859147772762638898854472065889939549916077695303157760259717113616428849798058080633047516455513870697383339784816006154279428812359241282979297285283850338964993773227397528608557211742425548651971558377656644211835094019462699301650412862894391885325969143805924684662849869947172175608502179438901337558870349697233790535</span><span class="p">,</span> <span class="mi">58756559706647121529575085912021603170286163639572075337348109911506627489265537716060463072086480156516641723700802217411122982693536541892986623158818442274840863016647800896033363360822503445344748132842451806511693779600370832206455202293028402486647422212959763287987847280322100701242139127654031151565924132562837893975505159702015125483479126108892709063135006366792197127007229210558758401679638300464111782814561428899998471531067163715</span><span class="p">,</span> <span class="mi">34828685390969672139784723764579499920301439564705391196519314224159563070870933754477650614819514127121146216049444888554338415587165719098661141454627820126445291802801256297252654045398330613075575527685542980264993711077876535643646746742646371967302159565887123638001580042027272379341650995728849759541960087953160211696369079708787543303742132161742979856720539914370868829868891655221361545648778590685232034703220732697083024449894197969</span><span class="p">,</span> <span class="mi">26717968456600556973167180286909817773394160817933525240720067057464671317174201540556176814203780603153696663101158205367554829261808020426363683474848952397963507069306452835776851274959389849223566030857588019845781623271395012194869024566879791449466064832273531795430185178486425688475688634844530106740480643866537205900809400383304665727460014210405339697947582657505028211149470787536144302545259243549176816653560626044921521516818788487</span><span class="p">]</span>
<a id="__codelineno-26-229" name="__codelineno-26-229"></a><a href="#__codelineno-26-229"><span class="linenos" data-linenos="229 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">39297018404565022956251803918747154798377576057123078716166221329195959669756819453426741569480551313085435037629493881038383709458043802420338889323233368852331387845200216275712388921820794980987541224782392553528127093154957890356084331463340193478391679540506421250562554424770350351514435220782124981277580072039637811543914983033300225131364246910828188727043248991987332274929827173923543187017105236008487756190002204169623313222748976369</span>
<a id="__codelineno-26-230" name="__codelineno-26-230"></a><a href="#__codelineno-26-230"><span class="linenos" data-linenos="230 "></span></a><span class="n">alpha</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">/</span> <span class="nb">int</span><span class="p">(</span><span class="n">NN</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>              <span class="c1">#400指的是d的比特</span>
<a id="__codelineno-26-231" name="__codelineno-26-231"></a><a href="#__codelineno-26-231"><span class="linenos" data-linenos="231 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-26-232" name="__codelineno-26-232"></a><a href="#__codelineno-26-232"><span class="linenos" data-linenos="232 "></span></a>    <span class="n">var</span><span class="p">(</span><span class="s2">&quot;e</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-233" name="__codelineno-26-233"></a><a href="#__codelineno-26-233"><span class="linenos" data-linenos="233 "></span></a>    <span class="n">var</span><span class="p">(</span><span class="s2">&quot;d</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-234" name="__codelineno-26-234"></a><a href="#__codelineno-26-234"><span class="linenos" data-linenos="234 "></span></a>    <span class="n">var</span><span class="p">(</span><span class="s2">&quot;k</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-26-235" name="__codelineno-26-235"></a><a href="#__codelineno-26-235"><span class="linenos" data-linenos="235 "></span></a><span class="n">g</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">var</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">),</span> <span class="n">var</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">),</span> <span class="n">var</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<a id="__codelineno-26-236" name="__codelineno-26-236"></a><a href="#__codelineno-26-236"><span class="linenos" data-linenos="236 "></span></a>
<a id="__codelineno-26-237" name="__codelineno-26-237"></a><a href="#__codelineno-26-237"><span class="linenos" data-linenos="237 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elist</span><span class="p">)):</span>
<a id="__codelineno-26-238" name="__codelineno-26-238"></a><a href="#__codelineno-26-238"><span class="linenos" data-linenos="238 "></span></a>    <span class="n">elist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">(</span><span class="n">elist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-26-239" name="__codelineno-26-239"></a><a href="#__codelineno-26-239"><span class="linenos" data-linenos="239 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="n">attack</span><span class="p">(</span><span class="n">NN</span><span class="p">,</span> <span class="n">elist</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<a id="__codelineno-26-240" name="__codelineno-26-240"></a><a href="#__codelineno-26-240"><span class="linenos" data-linenos="240 "></span></a>
<a id="__codelineno-26-241" name="__codelineno-26-241"></a><a href="#__codelineno-26-241"><span class="linenos" data-linenos="241 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="mi">65537</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-26-242" name="__codelineno-26-242"></a><a href="#__codelineno-26-242"><span class="linenos" data-linenos="242 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">NN</span><span class="p">))</span>
<a id="__codelineno-26-243" name="__codelineno-26-243"></a><a href="#__codelineno-26-243"><span class="linenos" data-linenos="243 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-26-244" name="__codelineno-26-244"></a><a href="#__codelineno-26-244"><span class="linenos" data-linenos="244 "></span></a><span class="c1">## NKCTF{F10w3r_Hav3_r3start_Day_N0_Man_iS_Y0ung_Aga1n}</span>
</code></pre></div>
<h2 id="_16">八、共享素数<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h2>
<p>两个n有相同的因子，直接求公因数就好了</p>
<h3 id="_17">例题<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><a href="#__codelineno-27-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><a href="#__codelineno-27-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><a href="#__codelineno-27-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><a href="#__codelineno-27-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><a href="#__codelineno-27-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><a href="#__codelineno-27-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><a href="#__codelineno-27-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><a href="#__codelineno-27-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">q1</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><a href="#__codelineno-27-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q2</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><a href="#__codelineno-27-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q1</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><a href="#__codelineno-27-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q2</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><a href="#__codelineno-27-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><a href="#__codelineno-27-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><a href="#__codelineno-27-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><a href="#__codelineno-27-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n1=&quot;</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a><a href="#__codelineno-27-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n2=&quot;</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a><a href="#__codelineno-27-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c1=&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a><a href="#__codelineno-27-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c2=&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><a href="#__codelineno-28-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><a href="#__codelineno-28-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><a href="#__codelineno-28-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><a href="#__codelineno-28-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n1</span> <span class="o">=</span><span class="mi">22036096414750333101406538757625812613248444424049684758772058140377463618250795867832853117902163257003301132932490853355450673043991381637053778653821758783435921283322439267628837074056789021611782010444749024512216306961829453158759193969454712080047205883631153040900193575534288719429526169135614695862857156639195562501217424283401364740789214390377624598500939079307163832197534297642842744345373413423859103414676878739674227554029537817890874031594311152843060524913028526429344172693584167398664817727426767686424415189580527939256633114120720308173788544194669684834369132677253418971615644691719536820433</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><a href="#__codelineno-28-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n2</span> <span class="o">=</span><span class="mi">17251653165250011947306159769694143433212298910745609670733920118632739529605426957617875166211610794383631191273183964010346725508667657137931394653419082978603166138439632713627832321960586938891805262605225424775586397813147240201440036009395991700175612039074317131837185920131565272816639771739150718839592250080325774556601865770352479323350280393818365902570673799584200153846520860657815432981116910233453207519365604533077996449249223280685559491369393277114405166293011856168173778428700718404816038991911974902005969923746846815798515831172402122367026339135245751136695128279659872423027539333024854133659</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><a href="#__codelineno-28-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c1</span> <span class="o">=</span><span class="mi">1408937404754902028814920445701404613476983383738408959873219805755187459225302977012340464647741276263048769176603562703588286152102079561897286480939341184453940846603761664643956274520695676061184610702912592321357240109665885587701906369214592438887065694062151546241739122722790261888290706296747328780758965559093085406877315628139811554345214347799361309288949307776501119359571116522001853935560023530705364795364624152061166945046882418058831567088890277747158775876953662285842999920594778445526224560016361787941610542255000514402493843548068271595134879195073239601085319795505131267697387692179944010772</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><a href="#__codelineno-28-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c2</span> <span class="o">=</span><span class="mi">12175155463891225370775786368564999885751076529394005420368968241428058465831204925081389807872272508968531564921996276054143112205083003561546962102395368677755381589762565680900651699885381615975236663522025080384481537727180649424984636506390139648492522347366656322729441290553251505232488994951243521740296115895651926783520321289129993169836271218322014443396220481361007479796234525990954874013729001502984583162486353287639655447340498584591591009224750835072707121652727119580764546240945763088815277130694950594020142961659318737857067755125666395542079926757603295535345281657293981259718286213812909191174</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><a href="#__codelineno-28-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><a href="#__codelineno-28-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><a href="#__codelineno-28-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><a href="#__codelineno-28-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><a href="#__codelineno-28-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">t</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><a href="#__codelineno-28-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><a href="#__codelineno-28-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a><a href="#__codelineno-28-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n1</span><span class="p">)))</span>
</code></pre></div>
<h2 id="dp">九、dp泄露<a class="headerlink" href="#dp" title="Permanent link">&para;</a></h2>
<h3 id="_18">原理推导<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\because d_p \equiv d \mod (p-1)
\]</div>
<p>左右同乘e得</p>
<div class="arithmatex">\[
d_p\times e \equiv d\times e \mod (p-1)
\]</div>
<p>即</p>
<div class="arithmatex">\[
d\times e = k_1(p-1) +d_p\times e
\]</div>
<div class="arithmatex">\[
\because d\times e \equiv 1 \mod \phi(n)
\]</div>
<div class="arithmatex">\[
\therefore d\times e = k_2(p-1)(q-1)+1
\]</div>
<div class="arithmatex">\[
\therefore k_1(p-1)+dp×e = k_2(p-1)(q-1)+1
\]</div>
<p>化简得</p>
<div class="arithmatex">\[
d_p\times e = (p-1)[k_2(q-1)-k_1] + 1
\]</div>
<div class="arithmatex">\[
\because d_p &lt; p-1
\]</div>
<div class="arithmatex">\[
\therefore 0&lt; k_2(q-1)-k_1
\]</div>
<p>遍历<span class="arithmatex">\(i \in (0,e)\)</span>的所有值，如果<span class="arithmatex">\(d_p\times e-1\)</span>能够整除<span class="arithmatex">\(i\)</span>则，我们就可以求得<span class="arithmatex">\(p-1\)</span></p>
<h4 id="1_4">例题1<a class="headerlink" href="#1_4" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><a href="#__codelineno-29-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><a href="#__codelineno-29-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><a href="#__codelineno-29-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><a href="#__codelineno-29-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><a href="#__codelineno-29-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><a href="#__codelineno-29-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><a href="#__codelineno-29-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><a href="#__codelineno-29-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><a href="#__codelineno-29-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><a href="#__codelineno-29-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><a href="#__codelineno-29-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a><a href="#__codelineno-29-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><a href="#__codelineno-29-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><a href="#__codelineno-29-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d=&quot;</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a><a href="#__codelineno-29-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">dp</span> <span class="o">=</span> <span class="n">d</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a><a href="#__codelineno-29-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a><a href="#__codelineno-29-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a><a href="#__codelineno-29-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-29-19" name="__codelineno-29-19"></a><a href="#__codelineno-29-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-29-20" name="__codelineno-29-20"></a><a href="#__codelineno-29-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dp=&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><a href="#__codelineno-30-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><a href="#__codelineno-30-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><a href="#__codelineno-30-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><a href="#__codelineno-30-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">17954000555185130679232377513216924086370205717680723426279833171815673097846434355592747466782173529597978954062272371758852339605432963940809244445748900431763988392120156128524694217746804744076348205536430811607694098089294013508111154514184079159181563040241302764793111632189829652065825442796716027051750043654503172469553222784393034067341575558782690547449884992414106322578261286526556856377419622164651917718772498388922129465042492616904419638034789576380038341882418547113136903862482397767904921157094396562770484669239932933837196899640811033424030302285885080504355934919967693498648701839252087380477</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><a href="#__codelineno-30-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">1808490145328726635638705291306162339133116115672167390186563455429486046847680827004544020052978814401354685508506555963361065725012891622174617670820924531959433674273579973778657669162210657120785539629874456938159379512635932223403818177582242406964621317531188027900758868453176575753681627336133481701182056262584118645398172089436811174776978418919803975809158758707062473122656821152108292060156091196577573172937093806159669057467094718771367509856968694209472630329096814023864642219783061245777457366202879949123915168571990229277326042767587009623951348541055835347386485900505749475571895673653225741649</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><a href="#__codelineno-30-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">dp</span> <span class="o">=</span><span class="mi">114993440308125678369350484461242628405806013372930792337329972720600942891053460367721272956155528263465552939386621554396883112994907299126303463171544968629898544811159986442249990975328659373544491636958873255689808151391606942912468529923159009459712396428051292828093059494024457367637991626193487727331</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><a href="#__codelineno-30-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span><span class="mi">65537</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><a href="#__codelineno-30-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a><a href="#__codelineno-30-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><a href="#__codelineno-30-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">dp</span> <span class="o">*</span> <span class="n">e</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">i</span>        <span class="c1">#这是p-1前面的系数</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><a href="#__codelineno-30-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><a href="#__codelineno-30-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">dp</span> <span class="o">*</span> <span class="n">e</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a><a href="#__codelineno-30-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a><a href="#__codelineno-30-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a><a href="#__codelineno-30-15"><span class="linenos" data-linenos="15 "></span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a><a href="#__codelineno-30-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
</code></pre></div>
<h4 id="2-e">例题2 e很大<a class="headerlink" href="#2-e" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><a href="#__codelineno-31-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><a href="#__codelineno-31-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><a href="#__codelineno-31-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><a href="#__codelineno-31-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><a href="#__codelineno-31-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><a href="#__codelineno-31-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><a href="#__codelineno-31-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><a href="#__codelineno-31-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><a href="#__codelineno-31-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><a href="#__codelineno-31-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><a href="#__codelineno-31-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><a href="#__codelineno-31-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><a href="#__codelineno-31-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><a href="#__codelineno-31-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">dp</span> <span class="o">=</span> <span class="n">d</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><a href="#__codelineno-31-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><a href="#__codelineno-31-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><a href="#__codelineno-31-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><a href="#__codelineno-31-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><a href="#__codelineno-31-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dp=&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
</code></pre></div>
<p>在e很大的情况下，我们爆破<span class="arithmatex">\((0,e)\)</span>的值就显得不现实。需要用其他方法
$$
\because d_p \times e = k(p-1)+1
$$</p>
<div class="arithmatex">\[
\therefore dp ×e \equiv 1 \mod (p-1)
\]</div>
<p>取一个与<span class="arithmatex">\(p\)</span>互素的常数<span class="arithmatex">\(a\)</span>，则有</p>
<div class="arithmatex">\[
a^{d_p\times e} \equiv a^{k(p-1)+1} \equiv a \mod p
\]</div>
<div class="arithmatex">\[
\therefore a^{dp×e}-a =kp
\]</div>
<p>然后与n求公因数即可得到p</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><a href="#__codelineno-32-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">getPrime</span><span class="p">,</span><span class="n">long_to_bytes</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><a href="#__codelineno-32-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><a href="#__codelineno-32-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><a href="#__codelineno-32-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span><span class="o">=</span> <span class="mi">18150086749964030204952772593650655354407282168407543480518017821905322058792108409169209539752974177937328703466169798097779231540410352308736251888449285307132274903811942187361234788236374036493935354342502760429195828731474432692281516115002087485890105917067613983079156790015275611914738187418424730456416770000646598861170179898016595068557049151791620868027603590052357726580431487083778514163249201637184318559165989454489485258667170883129099757366657203826319909509544670881866298317938263281638296241860739828567999093491297970389142395080780768892194380031018324855383292685388767246393785705551231780899</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><a href="#__codelineno-32-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span><span class="o">=</span> <span class="mi">278817530653170259039233683650169866189</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><a href="#__codelineno-32-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span><span class="o">=</span> <span class="mi">10813189255953686674328168562592345253502176950586624384555229875947895107088800774325110599057171743065073092283651992594106863499561887773348061509184951920329015539552207920010924284253109754443530283215130327152416667309504455641730629770856098336299767661535526880065006664806270833698497579073641076473649621250873969544362062393319711114090739414415757921473984666129110213417578310035188480139392986280529932137364474426391469019554935239234968517869914506321750458197587849623935306068749435995413807906558975073047215241796461878288003366415184144140612947217041288538376514085070670565572628317388808356563</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><a href="#__codelineno-32-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">dp</span><span class="o">=</span> <span class="mi">25015362092988139281045705051525732988903355826221062953430054346210238749256645995431509510448988062597830708438496723137288693056422683942336451600173722142331077900759633024803467824277121463213906905346623305038031660927650043841899168305106293747254814365869018331032172781810238397508103692878400636333</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><a href="#__codelineno-32-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><a href="#__codelineno-32-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><a href="#__codelineno-32-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><a href="#__codelineno-32-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">dp</span><span class="o">*</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>    <span class="c1">#pow(a,dp*e,n)-a 就是kp</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><a href="#__codelineno-32-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">dp</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><a href="#__codelineno-32-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><a href="#__codelineno-32-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><a href="#__codelineno-32-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a><a href="#__codelineno-32-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><a href="#__codelineno-32-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><a href="#__codelineno-32-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h5 id="m-powcdpp">关于m = pow(c,dp,p)的证明<a class="headerlink" href="#m-powcdpp" title="Permanent link">&para;</a></h5>
<p>很多题目会出现在mod p下求解的情况，需要注意的是前提条件为<span class="arithmatex">\(m &lt; p\)</span>，证明如下</p>
<div class="arithmatex">\[
\because c \equiv m^e \mod n
\]</div>
<div class="arithmatex">\[
ed \equiv 1 \mod \phi(n)
\]</div>
<div class="arithmatex">\[
d_p \equiv d \mod p-1
\]</div>
<p>所以有</p>
<div class="arithmatex">\[
e \times d_p \equiv 1 \mod p-1
\]</div>
<p>即</p>
<div class="arithmatex">\[
e\times d_p = k \times (p-1) + 1
\]</div>
<div class="arithmatex">\[
\therefore c ^{d_p} \equiv m ^{e\times d_p} \equiv m ^{k(p-1)+1} \equiv m \mod p
\]</div>
<h4 id="3-dp">例题3 dp高位泄露<a class="headerlink" href="#3-dp" title="Permanent link">&para;</a></h4>
<h5 id="e"><code>e</code>不是很大<a class="headerlink" href="#e" title="Permanent link">&para;</a></h5>
<div class="arithmatex">\[
\because ed_p \equiv 1 \mod p-1
\]</div>
<div class="arithmatex">\[
\therefore e(d_{phigh} + x) \equiv 1 \mod p-1
\]</div>
<div class="arithmatex">\[
\therefore e(d_{phigh} + x) = k(p-1) + 1
\]</div>
<div class="arithmatex">\[
\therefore e(d_{phigh}+x) + k - 1\equiv 0 \mod p
\]</div>
<p>如果e不大的话，直接爆破k解这个方程即可</p>
<h5 id="e_1">e很大<a class="headerlink" href="#e_1" title="Permanent link">&para;</a></h5>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><a href="#__codelineno-33-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><a href="#__codelineno-33-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><a href="#__codelineno-33-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><a href="#__codelineno-33-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><a href="#__codelineno-33-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><a href="#__codelineno-33-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><a href="#__codelineno-33-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><a href="#__codelineno-33-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><a href="#__codelineno-33-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><a href="#__codelineno-33-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><a href="#__codelineno-33-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">dp</span> <span class="o">=</span> <span class="n">d</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><a href="#__codelineno-33-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="n">dp</span> <span class="o">&gt;&gt;</span> <span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">64</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><a href="#__codelineno-33-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><a href="#__codelineno-33-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><a href="#__codelineno-33-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><a href="#__codelineno-33-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><a href="#__codelineno-33-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;leak = </span><span class="si">{</span><span class="n">leak</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><a href="#__codelineno-33-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><a href="#__codelineno-33-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">n = 108867023585283899312601516631596145998654767437612286040742902945694826711187570537876759789643259431350352590412655898964386234903475482280911808566497936037152171435317938413515356868240854632004961172899360272761406519077380255802700944002126599829184693692273637230349297388495886988988512631044494610227</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><a href="#__codelineno-33-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">c = 55610391226438079690691299914193010897347055835338032942001645697966587672596937470425142446679815934940962159432814479063990621696064239924347523289515556844359094065042974221093712989000153444928594999529082105262409273370242062803004814801742763253605838374098344711160380314529928211369000469059015996052</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><a href="#__codelineno-33-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">e = 14257237624892167181</span>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><a href="#__codelineno-33-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">leak = 2451130625204471881762267484243564297625381377098677997721378436579042927693972537775392209546509688501306219327699327137859174235486735043842710630825984</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a><a href="#__codelineno-33-23"><span class="linenos" data-linenos="23 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<div class="arithmatex">\[
\because ed_p \equiv 1 \mod p-1
\]</div>
<div class="arithmatex">\[
\therefore e(d_{phigh} + x) \equiv 1 \mod p-1
\]</div>
<div class="arithmatex">\[
\therefore e(d_{phigh} + x) = k(p-1) + 1
\]</div>
<div class="arithmatex">\[
\therefore e(d_{phigh}+x) + k - 1\equiv 0 \mod p 
\]</div>
<p>k和x都是64bit的值，用二元copper即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><a href="#__codelineno-34-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><a href="#__codelineno-34-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><a href="#__codelineno-34-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><a href="#__codelineno-34-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><a href="#__codelineno-34-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">small_roots</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><a href="#__codelineno-34-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><a href="#__codelineno-34-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><a href="#__codelineno-34-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><a href="#__codelineno-34-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">R</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">base_ring</span><span class="p">()</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><a href="#__codelineno-34-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">cardinality</span><span class="p">()</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><a href="#__codelineno-34-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">f</span> <span class="o">/=</span> <span class="n">f</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><a href="#__codelineno-34-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><a href="#__codelineno-34-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">G</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">([],</span> <span class="n">f</span><span class="o">.</span><span class="n">parent</span><span class="p">())</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><a href="#__codelineno-34-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><a href="#__codelineno-34-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">base</span> <span class="o">=</span> <span class="n">N</span> <span class="o">^</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">^</span> <span class="n">i</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><a href="#__codelineno-34-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">for</span> <span class="n">shifts</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">repeat</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">nvariables</span><span class="p">()):</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><a href="#__codelineno-34-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="n">g</span> <span class="o">=</span> <span class="n">base</span> <span class="o">*</span> <span class="n">prod</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">(),</span> <span class="n">shifts</span><span class="p">))</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><a href="#__codelineno-34-18"><span class="linenos" data-linenos="18 "></span></a>            <span class="n">G</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><a href="#__codelineno-34-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">B</span><span class="p">,</span> <span class="n">monomials</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">coefficient_matrix</span><span class="p">()</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a><a href="#__codelineno-34-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">monomials</span> <span class="o">=</span> <span class="n">vector</span><span class="p">(</span><span class="n">monomials</span><span class="p">)</span>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a><a href="#__codelineno-34-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monomial</span><span class="p">(</span><span class="o">*</span><span class="n">bounds</span><span class="p">)</span> <span class="k">for</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">monomials</span><span class="p">]</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a><a href="#__codelineno-34-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">factors</span><span class="p">):</span>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a><a href="#__codelineno-34-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">B</span><span class="o">.</span><span class="n">rescale_col</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
<a id="__codelineno-34-24" name="__codelineno-34-24"></a><a href="#__codelineno-34-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">dense_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">LLL</span><span class="p">()</span>
<a id="__codelineno-34-25" name="__codelineno-34-25"></a><a href="#__codelineno-34-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">QQ</span><span class="p">)</span>
<a id="__codelineno-34-26" name="__codelineno-34-26"></a><a href="#__codelineno-34-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">factor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">factors</span><span class="p">):</span>
<a id="__codelineno-34-27" name="__codelineno-34-27"></a><a href="#__codelineno-34-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">B</span><span class="o">.</span><span class="n">rescale_col</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">factor</span><span class="p">)</span>
<a id="__codelineno-34-28" name="__codelineno-34-28"></a><a href="#__codelineno-34-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="n">H</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">([],</span> <span class="n">f</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">change_ring</span><span class="p">(</span><span class="n">QQ</span><span class="p">))</span>
<a id="__codelineno-34-29" name="__codelineno-34-29"></a><a href="#__codelineno-34-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">B</span> <span class="o">*</span> <span class="n">monomials</span><span class="p">):</span>
<a id="__codelineno-34-30" name="__codelineno-34-30"></a><a href="#__codelineno-34-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="n">H</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<a id="__codelineno-34-31" name="__codelineno-34-31"></a><a href="#__codelineno-34-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">ideal</span><span class="p">()</span>
<a id="__codelineno-34-32" name="__codelineno-34-32"></a><a href="#__codelineno-34-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="k">if</span> <span class="n">I</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-34-33" name="__codelineno-34-33"></a><a href="#__codelineno-34-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="n">H</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-34-34" name="__codelineno-34-34"></a><a href="#__codelineno-34-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="k">elif</span> <span class="n">I</span><span class="o">.</span><span class="n">dimension</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-34-35" name="__codelineno-34-35"></a><a href="#__codelineno-34-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-34-36" name="__codelineno-34-36"></a><a href="#__codelineno-34-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">variety</span><span class="p">(</span><span class="n">ring</span><span class="o">=</span><span class="n">ZZ</span><span class="p">):</span>
<a id="__codelineno-34-37" name="__codelineno-34-37"></a><a href="#__codelineno-34-37"><span class="linenos" data-linenos="37 "></span></a>                <span class="n">root</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">R</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">())</span>
<a id="__codelineno-34-38" name="__codelineno-34-38"></a><a href="#__codelineno-34-38"><span class="linenos" data-linenos="38 "></span></a>                <span class="n">roots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<a id="__codelineno-34-39" name="__codelineno-34-39"></a><a href="#__codelineno-34-39"><span class="linenos" data-linenos="39 "></span></a>            <span class="k">return</span> <span class="n">roots</span>
<a id="__codelineno-34-40" name="__codelineno-34-40"></a><a href="#__codelineno-34-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-34-41" name="__codelineno-34-41"></a><a href="#__codelineno-34-41"><span class="linenos" data-linenos="41 "></span></a>
<a id="__codelineno-34-42" name="__codelineno-34-42"></a><a href="#__codelineno-34-42"><span class="linenos" data-linenos="42 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">108867023585283899312601516631596145998654767437612286040742902945694826711187570537876759789643259431350352590412655898964386234903475482280911808566497936037152171435317938413515356868240854632004961172899360272761406519077380255802700944002126599829184693692273637230349297388495886988988512631044494610227</span>
<a id="__codelineno-34-43" name="__codelineno-34-43"></a><a href="#__codelineno-34-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">55610391226438079690691299914193010897347055835338032942001645697966587672596937470425142446679815934940962159432814479063990621696064239924347523289515556844359094065042974221093712989000153444928594999529082105262409273370242062803004814801742763253605838374098344711160380314529928211369000469059015996052</span>
<a id="__codelineno-34-44" name="__codelineno-34-44"></a><a href="#__codelineno-34-44"><span class="linenos" data-linenos="44 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">14257237624892167181</span>
<a id="__codelineno-34-45" name="__codelineno-34-45"></a><a href="#__codelineno-34-45"><span class="linenos" data-linenos="45 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="mi">2451130625204471881762267484243564297625381377098677997721378436579042927693972537775392209546509688501306219327699327137859174235486735043842710630825984</span>
<a id="__codelineno-34-46" name="__codelineno-34-46"></a><a href="#__codelineno-34-46"><span class="linenos" data-linenos="46 "></span></a>
<a id="__codelineno-34-47" name="__codelineno-34-47"></a><a href="#__codelineno-34-47"><span class="linenos" data-linenos="47 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-34-48" name="__codelineno-34-48"></a><a href="#__codelineno-34-48"><span class="linenos" data-linenos="48 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="n">leak</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-34-49" name="__codelineno-34-49"></a><a href="#__codelineno-34-49"><span class="linenos" data-linenos="49 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">small_roots</span><span class="p">(</span><span class="n">f</span><span class="p">,(</span><span class="mi">2</span><span class="o">^</span><span class="mi">64</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">64</span><span class="p">),</span><span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-34-50" name="__codelineno-34-50"></a><a href="#__codelineno-34-50"><span class="linenos" data-linenos="50 "></span></a><span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
<a id="__codelineno-34-51" name="__codelineno-34-51"></a><a href="#__codelineno-34-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="n">dp_low</span> <span class="o">=</span> <span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-34-52" name="__codelineno-34-52"></a><a href="#__codelineno-34-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="n">dp</span> <span class="o">=</span> <span class="n">leak</span> <span class="o">+</span> <span class="n">dp_low</span>
<a id="__codelineno-34-53" name="__codelineno-34-53"></a><a href="#__codelineno-34-53"><span class="linenos" data-linenos="53 "></span></a>    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">e</span><span class="o">*</span><span class="n">dp</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
<a id="__codelineno-34-54" name="__codelineno-34-54"></a><a href="#__codelineno-34-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-34-55" name="__codelineno-34-55"></a><a href="#__codelineno-34-55"><span class="linenos" data-linenos="55 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-34-56" name="__codelineno-34-56"></a><a href="#__codelineno-34-56"><span class="linenos" data-linenos="56 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-34-57" name="__codelineno-34-57"></a><a href="#__codelineno-34-57"><span class="linenos" data-linenos="57 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-34-58" name="__codelineno-34-58"></a><a href="#__codelineno-34-58"><span class="linenos" data-linenos="58 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h2 id="dpdq">十、dp,dq泄露<a class="headerlink" href="#dpdq" title="Permanent link">&para;</a></h2>
<p>如果题目给出<span class="arithmatex">\(p,q,d_p,d_q\)</span>，那么直接在模p和模q下求解即可，如果模不够大，再用中国剩余定理即可</p>
<h3 id="1_5">例题1<a class="headerlink" href="#1_5" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><a href="#__codelineno-35-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><a href="#__codelineno-35-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><a href="#__codelineno-35-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><a href="#__codelineno-35-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><a href="#__codelineno-35-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><a href="#__codelineno-35-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><a href="#__codelineno-35-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><a href="#__codelineno-35-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><a href="#__codelineno-35-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><a href="#__codelineno-35-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><a href="#__codelineno-35-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><a href="#__codelineno-35-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a><a href="#__codelineno-35-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><a href="#__codelineno-35-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d=&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a><a href="#__codelineno-35-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">dp</span> <span class="o">=</span> <span class="n">d</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a><a href="#__codelineno-35-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">dq</span> <span class="o">=</span> <span class="n">d</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a><a href="#__codelineno-35-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-35-18" name="__codelineno-35-18"></a><a href="#__codelineno-35-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-35-19" name="__codelineno-35-19"></a><a href="#__codelineno-35-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p=&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-35-20" name="__codelineno-35-20"></a><a href="#__codelineno-35-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q=&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-35-21" name="__codelineno-35-21"></a><a href="#__codelineno-35-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-35-22" name="__codelineno-35-22"></a><a href="#__codelineno-35-22"><span class="linenos" data-linenos="22 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dp=&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
<a id="__codelineno-35-23" name="__codelineno-35-23"></a><a href="#__codelineno-35-23"><span class="linenos" data-linenos="23 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dq=&quot;</span><span class="p">,</span> <span class="n">dq</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><a href="#__codelineno-36-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><a href="#__codelineno-36-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><a href="#__codelineno-36-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><a href="#__codelineno-36-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">112454994630978850005784651276022327545786198205744597431888680937657203192943</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><a href="#__codelineno-36-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">111081771780978300442208201256251933100607227308819156491182881723714968913833</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><a href="#__codelineno-36-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">7847140580627012782899798457736961376953768684667159008470556786390887805253326211691923724846808704462396746105331991924048819814322540306282164012066426</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><a href="#__codelineno-36-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">dp</span> <span class="o">=</span> <span class="mi">99016059099144522019375365089687785694029213535292918424815544402513220169503</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><a href="#__codelineno-36-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">dq</span> <span class="o">=</span> <span class="mi">79504900574184798493105575420403885224379864982754477219462523963780735261625</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><a href="#__codelineno-36-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><a href="#__codelineno-36-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><a href="#__codelineno-36-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">mp</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">dp</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><a href="#__codelineno-36-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">mq</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">dq</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><a href="#__codelineno-36-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">mp</span><span class="p">))</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><a href="#__codelineno-36-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">mq</span><span class="p">))</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><a href="#__codelineno-36-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><a href="#__codelineno-36-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">crt</span><span class="p">([</span><span class="n">mp</span><span class="p">,</span><span class="n">mq</span><span class="p">],[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">])</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><a href="#__codelineno-36-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h2 id="_19">十一、考察欧拉函数计算<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h2>
<p>欧拉函数计算方法:</p>
<ol>
<li>
<p><span class="arithmatex">\(n = 1\)</span>，则<span class="arithmatex">\(\phi(n)= 1\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(n\)</span>是素数，则<span class="arithmatex">\(\phi(n) = n - 1\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(n = p^r\)</span>(<span class="arithmatex">\(p\)</span>为素数，<span class="arithmatex">\(r\)</span>为大于等于1的整数)，则<span class="arithmatex">\(\phi(n) = p^{r-1}(p-1)\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(n = \prod_{i=1}^kp_i\)</span>，则<span class="arithmatex">\(\phi(n) = \prod_{i=1}^{k}(p_i-1)\)</span></p>
</li>
</ol>
<h3 id="1_6">例题1<a class="headerlink" href="#1_6" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><a href="#__codelineno-37-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><a href="#__codelineno-37-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><a href="#__codelineno-37-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><a href="#__codelineno-37-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><a href="#__codelineno-37-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><a href="#__codelineno-37-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><a href="#__codelineno-37-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><a href="#__codelineno-37-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><a href="#__codelineno-37-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">5</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><a href="#__codelineno-37-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><a href="#__codelineno-37-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><a href="#__codelineno-37-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><a href="#__codelineno-37-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><a href="#__codelineno-37-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div>
<p>本题考查<span class="arithmatex">\(n = p^r\)</span></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><a href="#__codelineno-38-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><a href="#__codelineno-38-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><a href="#__codelineno-38-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><a href="#__codelineno-38-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">109671394618534156590716540772306636060550711465455829526382945168271125218007503161807386153286648328529071790130095763349089936429151343426469415497138306284842512691195220650548494501337831207724397925027651025644976364368511262187227825083865690186591571250267479440100917127211656877566179258870510690665025580200477574123634259670039152125607834855408269848826938902407472374892693266119859709658788565014195766992713646832624001067898323913639712284673673557898135411273837250194079399384826384835709060797351332323930309379071015140548478132323474993964925055399350661600068568602468295748573856804293659942047543032878436316918991716636681116631322082919386178460096115355963882313682994343822128626370850455024905542367255179074441679461101331332093019368492643</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><a href="#__codelineno-38-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><a href="#__codelineno-38-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">83166081100602571613112201467626632459949037182633475449066025299006894059443612622701975752551708249083077180755342065457682925338233793688583913228361068561515321097016501900442865692643652803949920987493441500744743553498018003210308290969303190355756775977367324120441564693220728163622472865572357639056734898022442794130514936425334924283145153496702507951466618177405870656868713199816223765264228006032228439676574053839549440372521050502986043855511540855864034336902304414848547480112182226920285820386643015671106933140105835060319823245206934565859078021518312305243997612804935774414840491355098017977514736057368000596388974956265042651277403519473262257945986199408278855335170546242641727930526697102351648388874227840119205560199015181257296591985205818</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><a href="#__codelineno-38-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">10186351850605898834333098258639828910824016865517013383611935945131883947448223014077315468253377357594775340263769153442019216205089695821439736926082483</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><a href="#__codelineno-38-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><a href="#__codelineno-38-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="n">p</span><span class="o">**</span><span class="mi">5</span><span class="o">-</span><span class="n">p</span><span class="o">**</span><span class="mi">4</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><a href="#__codelineno-38-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><a href="#__codelineno-38-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
</code></pre></div>
<h3 id="2_3">例题2<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><a href="#__codelineno-39-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><a href="#__codelineno-39-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><a href="#__codelineno-39-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><a href="#__codelineno-39-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><a href="#__codelineno-39-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><a href="#__codelineno-39-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><a href="#__codelineno-39-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><a href="#__codelineno-39-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><a href="#__codelineno-39-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><a href="#__codelineno-39-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><a href="#__codelineno-39-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><a href="#__codelineno-39-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q=&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><a href="#__codelineno-39-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><a href="#__codelineno-39-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><a href="#__codelineno-39-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div>
<p><span class="arithmatex">\(\because n = p^{3}×q\)</span></p>
<p><span class="arithmatex">\(\therefore \phi(n) = (p^{3}-p^{2})×(q-1)\)</span></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><a href="#__codelineno-40-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><a href="#__codelineno-40-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><a href="#__codelineno-40-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><a href="#__codelineno-40-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">13345672330679418443866848695749753384841350112452462690350565885192764753702964893062035116023096943358384379827500462723016224486435032522188166109529147</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><a href="#__codelineno-40-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">4663711063632671446966617442890809468548735750386480905820144168615122369358088158709822723959108989276525102755551604204514586528122441075489492157644479194671784485228731421500391142158401889177506319977349707503678947872777602384171260874359045585814189677748712566088220734735479518470883541166059233676170283938881683675790979128058243582825012415020019043126740915522571217495119060031729061070896580899732991209113679151755713858497630999746612658308778711613697038750661479517187094033129979714688161348844542070263109259258937863241431480105798790363889436471998002323269704182369356300287043940743500087239</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><a href="#__codelineno-40-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><a href="#__codelineno-40-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">4050303218893912343776312253598257474375000778822229482734626960955864773175090306426885201033332266573903303684635688485414725284644108123459136702775991157244389086147955395682206311752151842740679445903864544823592773331496589661187968392779340028173948172003460012051289357755574536619241969492822938688821287700132262703677149526846356206143053559703859606442209340834979412336031660590507709503830013770022485005101363701272279629510056964018618212014677531338026866748075406283893942248599825641124694672878533987994699411744521757385858889763503705242690212615083634186373933214686193717950163215308138805348</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><a href="#__codelineno-40-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><a href="#__codelineno-40-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">q</span> 
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><a href="#__codelineno-40-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><a href="#__codelineno-40-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><a href="#__codelineno-40-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
</code></pre></div>
<h3 id="3_1">例题3<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><a href="#__codelineno-41-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><a href="#__codelineno-41-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><a href="#__codelineno-41-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><a href="#__codelineno-41-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><a href="#__codelineno-41-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><a href="#__codelineno-41-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><a href="#__codelineno-41-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><a href="#__codelineno-41-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><a href="#__codelineno-41-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">r</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><a href="#__codelineno-41-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">r</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><a href="#__codelineno-41-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><a href="#__codelineno-41-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><a href="#__codelineno-41-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;r=&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><a href="#__codelineno-41-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><a href="#__codelineno-41-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><a href="#__codelineno-41-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><a href="#__codelineno-41-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><a href="#__codelineno-41-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">r</span> <span class="o">=</span> <span class="mi">12328943069972158868300333965019293732240349172933398867374450193780676916633106046545397891902123683693837126404908611670219604587587151306224914062663729</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a><a href="#__codelineno-41-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">928445951911850156618541782850215900925329423880533465612155142015978599609287623859912813317551629221695490535012732781489396534420011145723987610606038091488823086647363964394753700158320900867101659445170118179077194271099520502633316318889163873291574934282498061117736456183503867870294570083013883365868242889035609602940685335912371326827533418614992221705810476710807373254363162373986374486325350746366851935451369892949745302442034805629514003196071631</span>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><a href="#__codelineno-41-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a><a href="#__codelineno-41-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">327716655224470059950709685055600963837116578216483343492948888372401723689223347212508532985781828794786448842515029515358422017875793926582832247025212149474404973170422295165602666360784347416812528617973764432916955654602356835327769633635513894485943553309743509322858937973710628023758816806471875016815994664897320150855163109437521642800230902661034555151514311149333258071668655344069451897282357234220538922127548822361859943829665459953651351620958628</span>
</code></pre></div>
<div class="arithmatex">\[
\because n = p\times q \times r
\]</div>
<div class="arithmatex">\[
\therefore \phi(n)=(p-1)×(q-1)×(r-1)
\]</div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><a href="#__codelineno-42-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><a href="#__codelineno-42-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><a href="#__codelineno-42-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><a href="#__codelineno-42-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">r</span> <span class="o">=</span> <span class="mi">12328943069972158868300333965019293732240349172933398867374450193780676916633106046545397891902123683693837126404908611670219604587587151306224914062663729</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><a href="#__codelineno-42-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">928445951911850156618541782850215900925329423880533465612155142015978599609287623859912813317551629221695490535012732781489396534420011145723987610606038091488823086647363964394753700158320900867101659445170118179077194271099520502633316318889163873291574934282498061117736456183503867870294570083013883365868242889035609602940685335912371326827533418614992221705810476710807373254363162373986374486325350746366851935451369892949745302442034805629514003196071631</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><a href="#__codelineno-42-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><a href="#__codelineno-42-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">327716655224470059950709685055600963837116578216483343492948888372401723689223347212508532985781828794786448842515029515358422017875793926582832247025212149474404973170422295165602666360784347416812528617973764432916955654602356835327769633635513894485943553309743509322858937973710628023758816806471875016815994664897320150855163109437521642800230902661034555151514311149333258071668655344069451897282357234220538922127548822361859943829665459953651351620958628</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><a href="#__codelineno-42-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a><a href="#__codelineno-42-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="n">r</span><span class="p">,</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><a href="#__codelineno-42-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">next_prime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><a href="#__codelineno-42-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span> <span class="o">//</span> <span class="n">r</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a><a href="#__codelineno-42-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><a href="#__codelineno-42-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><a href="#__codelineno-42-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><a href="#__codelineno-42-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
</code></pre></div>
<h2 id="ephi">十二、e和phi不互素<a class="headerlink" href="#ephi" title="Permanent link">&para;</a></h2>
<p>这种情况在比赛中比较常见。在做这类题目之前，建议先了解sagemath基本使用方法</p>
<p>当<span class="arithmatex">\(e\)</span>与<span class="arithmatex">\(\phi(n)\)</span>不互素时，则不存在模<span class="arithmatex">\(\phi(n)\)</span>的逆元<span class="arithmatex">\(d\)</span>使得<span class="arithmatex">\(ed \equiv 1(mod \quad \phi(n))\)</span></p>
<h3 id="1_7">处理方式1:<a class="headerlink" href="#1_7" title="Permanent link">&para;</a></h3>
<p>这种处理方式是最简单也是最常规的</p>
<p>令<span class="arithmatex">\(t = gcd(e,\phi(n))\)</span></p>
<p>设<span class="arithmatex">\(e = e'\times t\)</span>，则<span class="arithmatex">\(e' = \frac{e}{t}\)</span></p>
<p>则<span class="arithmatex">\(c \equiv m^e \mod n \longrightarrow c \equiv (m ^t)^{e'} \mod n\)</span></p>
<p>求<span class="arithmatex">\(e'\)</span>对应的<span class="arithmatex">\(d\)</span>，解出<span class="arithmatex">\(m^t \equiv c^d \mod n\)</span></p>
<p>在<span class="arithmatex">\(m^t &lt; n\)</span>的情况下开根即可获得<span class="arithmatex">\(m\)</span></p>
<h4 id="1_8">例题1<a class="headerlink" href="#1_8" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><a href="#__codelineno-43-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><a href="#__codelineno-43-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><a href="#__codelineno-43-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><a href="#__codelineno-43-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><a href="#__codelineno-43-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><a href="#__codelineno-43-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><a href="#__codelineno-43-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><a href="#__codelineno-43-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><a href="#__codelineno-43-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><a href="#__codelineno-43-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><a href="#__codelineno-43-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><a href="#__codelineno-43-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><a href="#__codelineno-43-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><a href="#__codelineno-43-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">phi_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><a href="#__codelineno-43-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><a href="#__codelineno-43-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><a href="#__codelineno-43-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">continue</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a><a href="#__codelineno-43-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">t1</span> <span class="o">=</span> <span class="n">e</span> <span class="o">//</span> <span class="n">t</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><a href="#__codelineno-43-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">if</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a><a href="#__codelineno-43-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">break</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><a href="#__codelineno-43-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><a href="#__codelineno-43-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a><a href="#__codelineno-43-23"><span class="linenos" data-linenos="23 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p=&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a><a href="#__codelineno-43-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q=&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-43-25" name="__codelineno-43-25"></a><a href="#__codelineno-43-25"><span class="linenos" data-linenos="25 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a><a href="#__codelineno-43-26"><span class="linenos" data-linenos="26 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><a href="#__codelineno-44-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><a href="#__codelineno-44-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><a href="#__codelineno-44-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><a href="#__codelineno-44-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">171854505164939390402295426493389586289972154851849140728417624619463988154808053805729538974688869671559032639921300088271234681410193379381085714252211392886408792711387524667824537369266846649573070209815436507363007636943912350208275895292853801665488228125846058987049326903498661007035974420392738723323</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><a href="#__codelineno-44-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">145951936627745243523384785325963094339728144811023266133546816860787405503371056873662508073284279180417626507724315776654624382665743082805910036891739754019932290977071276850239245644056698685966997752654383650764557358649666141576105936215709831181842086893228254304235678475375978464394818353375373451573</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><a href="#__codelineno-44-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><a href="#__codelineno-44-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">830</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><a href="#__codelineno-44-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">c</span><span class="o">=</span> <span class="mi">4413268199893347044741276120215584703428167052744516280494996526431559720190092261631829389527634625276020346166956540800884139234489942113764564139232948414263452549927818365096023041932432723988241639527832673120924732407691135173154085803338322715604275530735968992726708155724384432557207264839248502158712330572704509492520346044648676055223193900826626346707083590815897507927683083455678855000344499804465073698745769989966769567497677402668725931090596642504740789789740965769347050166069295727209131555338513809368814890255851742010120871635378654904140016065148709710206173069000137023824698858539843753921</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><a href="#__codelineno-44-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><a href="#__codelineno-44-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><a href="#__codelineno-44-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><a href="#__codelineno-44-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><a href="#__codelineno-44-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><a href="#__codelineno-44-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">e1</span> <span class="o">=</span> <span class="n">e</span> <span class="o">//</span> <span class="n">t</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><a href="#__codelineno-44-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a><a href="#__codelineno-44-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><a href="#__codelineno-44-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</code></pre></div>
<h3 id="2_4">处理方式2:<a class="headerlink" href="#2_4" title="Permanent link">&para;</a></h3>
<p>使用sagemath，建立有限域，然后开根，以一个例题简要说明</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><a href="#__codelineno-45-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><a href="#__codelineno-45-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><a href="#__codelineno-45-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><a href="#__codelineno-45-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><a href="#__codelineno-45-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><a href="#__codelineno-45-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><a href="#__codelineno-45-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><a href="#__codelineno-45-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><a href="#__codelineno-45-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><a href="#__codelineno-45-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><a href="#__codelineno-45-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><a href="#__codelineno-45-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p = </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><a href="#__codelineno-45-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><a href="#__codelineno-45-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><a href="#__codelineno-45-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><a href="#__codelineno-45-16"><span class="linenos" data-linenos="16 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><a href="#__codelineno-45-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">c = 3136716033729406787100895984031132591372408032397380657110411936279557864804613451803228203558942365572618855741582340710496951283998288077886684480798840909615843832888291672118118174611935731391325961</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><a href="#__codelineno-45-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">p = 6995170125828760803175021463861846748101755707034027896253692749933464491557662142860042836548188827042797130278821285624095121174944527912522028416084887</span>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a><a href="#__codelineno-45-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">q = 12272700813225623560132355056448185486009112345760462061684545263916365691442580749089054915285013385322910087693364777427389347919562222271368766699836367</span>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a><a href="#__codelineno-45-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">n = 85849630091910220195429598000499270755938566349764235961421375317755949910077610512936495968854306764812963460054159547290157103999299511719875933657730205460710045409434205381402766954402709130620384187298033137488697869180531872534818830013412093865496100309052022972165149312556870258314510623053681685529</span>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a><a href="#__codelineno-45-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><a href="#__codelineno-46-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><a href="#__codelineno-46-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><a href="#__codelineno-46-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">3136716033729406787100895984031132591372408032397380657110411936279557864804613451803228203558942365572618855741582340710496951283998288077886684480798840909615843832888291672118118174611935731391325961</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><a href="#__codelineno-46-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">6995170125828760803175021463861846748101755707034027896253692749933464491557662142860042836548188827042797130278821285624095121174944527912522028416084887</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><a href="#__codelineno-46-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">12272700813225623560132355056448185486009112345760462061684545263916365691442580749089054915285013385322910087693364777427389347919562222271368766699836367</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><a href="#__codelineno-46-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">85849630091910220195429598000499270755938566349764235961421375317755949910077610512936495968854306764812963460054159547290157103999299511719875933657730205460710045409434205381402766954402709130620384187298033137488697869180531872534818830013412093865496100309052022972165149312556870258314510623053681685529</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><a href="#__codelineno-46-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><a href="#__codelineno-46-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><a href="#__codelineno-46-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><a href="#__codelineno-46-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">res1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><a href="#__codelineno-46-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><a href="#__codelineno-46-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><a href="#__codelineno-46-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><a href="#__codelineno-46-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">res2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a><a href="#__codelineno-46-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><a href="#__codelineno-46-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res1</span><span class="p">:</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><a href="#__codelineno-46-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res2</span><span class="p">:</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a><a href="#__codelineno-46-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">crt</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])],[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">])</span>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a><a href="#__codelineno-46-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<p>当<span class="arithmatex">\(m &lt; p\)</span>的时候，不需要中国剩余定理也能出</p>
<h3 id="_20">两种处理方式的综合<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<h4 id="12022ctfshow">例题1——2022ctfshow卷王杯<a class="headerlink" href="#12022ctfshow" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><a href="#__codelineno-47-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">bytes_to_long</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><a href="#__codelineno-47-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secrets</span><span class="w"> </span><span class="kn">import</span> <span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">flag</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><a href="#__codelineno-47-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><a href="#__codelineno-47-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">t</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><a href="#__codelineno-47-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><a href="#__codelineno-47-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="o">+</span> <span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><a href="#__codelineno-47-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><a href="#__codelineno-47-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><a href="#__codelineno-47-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><a href="#__codelineno-47-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><a href="#__codelineno-47-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><a href="#__codelineno-47-12"><span class="linenos" data-linenos="12 "></span></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><a href="#__codelineno-47-13"><span class="linenos" data-linenos="13 "></span></a><span class="sd">145332367700944303747548912160113939198078051436029477960348968315913956664143693347226702600438608693933768134575289286283267810723137895903153829001826223446477799895493265422562348917012216790077395795861238257357035152687833639085415763850743538206986781418939737511715957738982536382066693822159860701263</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><a href="#__codelineno-47-14"><span class="linenos" data-linenos="14 "></span></a><span class="sd">116660458253067608044065523310547233337730583902133756095473339390057738510707447906971188577217274861047379404014140178165569604404468897712846876108444468370709141219302291601408652742006268186059762087155933131837323952675627966299810891805398890428420575425160696531236660480933905879208166090591482794763</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><a href="#__codelineno-47-15"><span class="linenos" data-linenos="15 "></span></a><span class="sd">157931722402853245421436270609912823260313730941283152856444641969403238646482562190531038393124087232554754746464603598717356255570166081501573727336977292059427220330169044611674973569766966838498453232642731737958791706086957762244686953294662693939604300864961637325536379321027705854708492453330690705531</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><a href="#__codelineno-47-16"><span class="linenos" data-linenos="16 "></span></a><span class="sd">100973451687449518854742673778783266158999451072058606348222018797891147675959983616210003484476577612134482311993701677242007759556951494382833070563369964294544839433671087037596159753825249018950693369209927951667775267086896180395776150188902057785214767230658487267587289809918132337927575673868568976679</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a><a href="#__codelineno-47-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">93960345071948255233882121683650797512129333868351496468898834736770441398743300745703393838320587998953678254272245400344928586394089488734271897540051673996675973642347859306921527430850673334243441180183460927865980713929789963587608547554858491264614271309608925634272282292964002897650355047792764365447</span>
<a id="__codelineno-47-18" name="__codelineno-47-18"></a><a href="#__codelineno-47-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">9144597920381774885442906257311149465702295057238600973973598305004391534618770363098565074541384771979931799878381439264848137810353858418200992191234142740194489573540381681161219332611454834544291634628456257670178843484698324641739324687497388018406214041657278323855749902661752448796122517061920880552011343608609622885787617238758769398972009949575526258430282648817039091284796330585349957724522615105102735930258969562103112238020133587096826386028128471852377225525357348919204333121695432662339443004327748973224423132988376298843862056631045488285859621661802413201793962883794915513510467912312842687601478117040419013468059983777273699192408773551806581458197324620065210523913467414181480875280203580147077789063808832356486197271376615883221558265591069223727607585313240243619515521180600435114131162272519949101464089935441251751426683447701142156416866113627126765919641034042927519834229168536331952275698122511502745177547569813354280565828372968703810158857859460406828090199683324760956105682902577189283246483314689365570862217407333103243336691401424548702387876409228977278498691200028282744239512091373110111792177228979867318546462714521296256938374618636206565791541769138267080789842400796973226733816939794717596194090232425688504890234304977612220790858557639246367437740975495450011676714198668471438814299689325208882261918460708833888406187912527346628912894921059735420931656953236560178909180587372589456926690219114173193202048332172538564489660440225377822914097420807957784201785024166011709377791129</span>
<a id="__codelineno-47-19" name="__codelineno-47-19"></a><a href="#__codelineno-47-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">&#39;&#39;&#39;</span>
</code></pre></div>
<p>看似白给，其实<span class="arithmatex">\(e\)</span>和<span class="arithmatex">\(\phi(n)\)</span>不互素</p>
<p>而且在flag前面填充了一些数据，导致<span class="arithmatex">\(m^e &gt; n\)</span>，所以直接开根号也不可取</p>
<p>本题<span class="arithmatex">\(c \equiv m^e \mod n\)</span>，等价于m满足下面五个式子:</p>
<div class="arithmatex">\[
m^2 \equiv c \mod p
\]</div>
<div class="arithmatex">\[
m^2 \equiv c \mod q
\]</div>
<div class="arithmatex">\[
m^2 \equiv c \mod r
\]</div>
<div class="arithmatex">\[
m^2 \equiv c \mod s
\]</div>
<div class="arithmatex">\[
m^2 \equiv c \mod t
\]</div>
<p>我们在5个因子下求解，再用中国剩余定理组合即可</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><a href="#__codelineno-48-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sympy.ntheory.modular</span><span class="w"> </span><span class="kn">import</span> <span class="n">crt</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><a href="#__codelineno-48-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><a href="#__codelineno-48-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><a href="#__codelineno-48-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><a href="#__codelineno-48-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">145332367700944303747548912160113939198078051436029477960348968315913956664143693347226702600438608693933768134575289286283267810723137895903153829001826223446477799895493265422562348917012216790077395795861238257357035152687833639085415763850743538206986781418939737511715957738982536382066693822159860701263</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><a href="#__codelineno-48-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">116660458253067608044065523310547233337730583902133756095473339390057738510707447906971188577217274861047379404014140178165569604404468897712846876108444468370709141219302291601408652742006268186059762087155933131837323952675627966299810891805398890428420575425160696531236660480933905879208166090591482794763</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><a href="#__codelineno-48-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">r</span> <span class="o">=</span> <span class="mi">157931722402853245421436270609912823260313730941283152856444641969403238646482562190531038393124087232554754746464603598717356255570166081501573727336977292059427220330169044611674973569766966838498453232642731737958791706086957762244686953294662693939604300864961637325536379321027705854708492453330690705531</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><a href="#__codelineno-48-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">s</span> <span class="o">=</span> <span class="mi">100973451687449518854742673778783266158999451072058606348222018797891147675959983616210003484476577612134482311993701677242007759556951494382833070563369964294544839433671087037596159753825249018950693369209927951667775267086896180395776150188902057785214767230658487267587289809918132337927575673868568976679</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><a href="#__codelineno-48-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">t</span> <span class="o">=</span> <span class="mi">93960345071948255233882121683650797512129333868351496468898834736770441398743300745703393838320587998953678254272245400344928586394089488734271897540051673996675973642347859306921527430850673334243441180183460927865980713929789963587608547554858491264614271309608925634272282292964002897650355047792764365447</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><a href="#__codelineno-48-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">9144597920381774885442906257311149465702295057238600973973598305004391534618770363098565074541384771979931799878381439264848137810353858418200992191234142740194489573540381681161219332611454834544291634628456257670178843484698324641739324687497388018406214041657278323855749902661752448796122517061920880552011343608609622885787617238758769398972009949575526258430282648817039091284796330585349957724522615105102735930258969562103112238020133587096826386028128471852377225525357348919204333121695432662339443004327748973224423132988376298843862056631045488285859621661802413201793962883794915513510467912312842687601478117040419013468059983777273699192408773551806581458197324620065210523913467414181480875280203580147077789063808832356486197271376615883221558265591069223727607585313240243619515521180600435114131162272519949101464089935441251751426683447701142156416866113627126765919641034042927519834229168536331952275698122511502745177547569813354280565828372968703810158857859460406828090199683324760956105682902577189283246483314689365570862217407333103243336691401424548702387876409228977278498691200028282744239512091373110111792177228979867318546462714521296256938374618636206565791541769138267080789842400796973226733816939794717596194090232425688504890234304977612220790858557639246367437740975495450011676714198668471438814299689325208882261918460708833888406187912527346628912894921059735420931656953236560178909180587372589456926690219114173193202048332172538564489660440225377822914097420807957784201785024166011709377791129</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><a href="#__codelineno-48-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a><a href="#__codelineno-48-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a><a href="#__codelineno-48-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a><a href="#__codelineno-48-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a><a href="#__codelineno-48-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a><a href="#__codelineno-48-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">res1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a><a href="#__codelineno-48-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a><a href="#__codelineno-48-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a><a href="#__codelineno-48-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a><a href="#__codelineno-48-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a><a href="#__codelineno-48-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">res2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a><a href="#__codelineno-48-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a><a href="#__codelineno-48-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a><a href="#__codelineno-48-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a><a href="#__codelineno-48-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-48-26" name="__codelineno-48-26"></a><a href="#__codelineno-48-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">res3</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-48-27" name="__codelineno-48-27"></a><a href="#__codelineno-48-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-48-28" name="__codelineno-48-28"></a><a href="#__codelineno-48-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<a id="__codelineno-48-29" name="__codelineno-48-29"></a><a href="#__codelineno-48-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-48-30" name="__codelineno-48-30"></a><a href="#__codelineno-48-30"><span class="linenos" data-linenos="30 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-48-31" name="__codelineno-48-31"></a><a href="#__codelineno-48-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">res4</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-48-32" name="__codelineno-48-32"></a><a href="#__codelineno-48-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-48-33" name="__codelineno-48-33"></a><a href="#__codelineno-48-33"><span class="linenos" data-linenos="33 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<a id="__codelineno-48-34" name="__codelineno-48-34"></a><a href="#__codelineno-48-34"><span class="linenos" data-linenos="34 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-48-35" name="__codelineno-48-35"></a><a href="#__codelineno-48-35"><span class="linenos" data-linenos="35 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-48-36" name="__codelineno-48-36"></a><a href="#__codelineno-48-36"><span class="linenos" data-linenos="36 "></span></a><span class="n">res5</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-48-37" name="__codelineno-48-37"></a><a href="#__codelineno-48-37"><span class="linenos" data-linenos="37 "></span></a>
<a id="__codelineno-48-38" name="__codelineno-48-38"></a><a href="#__codelineno-48-38"><span class="linenos" data-linenos="38 "></span></a>
<a id="__codelineno-48-39" name="__codelineno-48-39"></a><a href="#__codelineno-48-39"><span class="linenos" data-linenos="39 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res1</span><span class="p">:</span>
<a id="__codelineno-48-40" name="__codelineno-48-40"></a><a href="#__codelineno-48-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res2</span><span class="p">:</span>
<a id="__codelineno-48-41" name="__codelineno-48-41"></a><a href="#__codelineno-48-41"><span class="linenos" data-linenos="41 "></span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">res3</span><span class="p">:</span>
<a id="__codelineno-48-42" name="__codelineno-48-42"></a><a href="#__codelineno-48-42"><span class="linenos" data-linenos="42 "></span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">res4</span><span class="p">:</span>
<a id="__codelineno-48-43" name="__codelineno-48-43"></a><a href="#__codelineno-48-43"><span class="linenos" data-linenos="43 "></span></a>                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">res5</span><span class="p">:</span>
<a id="__codelineno-48-44" name="__codelineno-48-44"></a><a href="#__codelineno-48-44"><span class="linenos" data-linenos="44 "></span></a>                    <span class="n">m_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
<a id="__codelineno-48-45" name="__codelineno-48-45"></a><a href="#__codelineno-48-45"><span class="linenos" data-linenos="45 "></span></a>                    <span class="n">a_list</span><span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]</span>
<a id="__codelineno-48-46" name="__codelineno-48-46"></a><a href="#__codelineno-48-46"><span class="linenos" data-linenos="46 "></span></a>                    <span class="n">solve</span> <span class="o">=</span> <span class="n">CRT_list</span><span class="p">(</span><span class="n">m_list</span><span class="p">,</span><span class="n">a_list</span><span class="p">)</span>
<a id="__codelineno-48-47" name="__codelineno-48-47"></a><a href="#__codelineno-48-47"><span class="linenos" data-linenos="47 "></span></a>                    <span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">solve</span><span class="p">)</span>
<a id="__codelineno-48-48" name="__codelineno-48-48"></a><a href="#__codelineno-48-48"><span class="linenos" data-linenos="48 "></span></a>                    <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;ctfshow&#39;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
<a id="__codelineno-48-49" name="__codelineno-48-49"></a><a href="#__codelineno-48-49"><span class="linenos" data-linenos="49 "></span></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-48-50" name="__codelineno-48-50"></a><a href="#__codelineno-48-50"><span class="linenos" data-linenos="50 "></span></a><span class="c1">## ctfshow{D0_y0u_R3aLly_Kn0w_Ra8IN_alg0RI7HM?}</span>
</code></pre></div>
<h4 id="22018azurersa">例题2——2018高校运维挑战赛AzureRSA<a class="headerlink" href="#22018azurersa" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.txt</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><a href="#__codelineno-49-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">n1</span><span class="o">=</span><span class="mh">0xcfc59d54b4b2e9ab1b5d90920ae88f430d39fee60d18dddbc623d15aae645e4e50db1c07a02d472b2eebb075a547618e1154a15b1657fbf66ed7e714d23ac70bdfba4c809bbb1e27687163cb09258a07ab2533568192e29a3b8e31a5de886050b28b3ed58e81952487714dd7ae012708db30eaf007620cdeb34f150836a4b723</span><span class="n">L</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><a href="#__codelineno-49-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">e1</span><span class="o">=</span><span class="mh">0xfae3a</span><span class="n">L</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><a href="#__codelineno-49-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">c1</span><span class="o">=</span><span class="mh">0x81523a330fb15125b6184e4461dadac7601340960840c5213b67a788c84aecfcdc3caf0bf3e27e4c95bb3c154db7055376981972b1565c22c100c47f3fa1dd2994e56090067b4e66f1c3905f9f780145cdf8d0fea88a45bae5113da37c8879c9cdb8ee9a55892bac3bae11fbbabcba0626163d0e2e12c04d99f4eeba5071cbea</span><span class="n">L</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><a href="#__codelineno-49-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n2</span><span class="o">=</span><span class="mh">0xd45304b186dc82e40bd387afc831c32a4c7ba514a64ae051b62f483f27951065a6a04a030d285bdc1cb457b24c2f8701f574094d46d8de37b5a6d55356d1d368b89e16fa71b6603bd037c7f329a3096ce903937bb0c4f112a678c88fd5d84016f745b8281aea8fd5bcc28b68c293e4ef4a62a62e478a8b6cd46f3da73fa34c63</span><span class="n">L</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><a href="#__codelineno-49-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e2</span><span class="o">=</span><span class="mh">0x1f9eae</span><span class="n">L</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><a href="#__codelineno-49-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c2</span><span class="o">=</span><span class="mh">0x4d7ceaadf5e662ab2e0149a8d18a4777b4cd4a7712ab825cf913206c325e6abb88954ebc37b2bda19aed16c5938ac43f43966e96a86913129e38c853ecd4ebc89e806f823ffb802e3ddef0ac6c5ba078d3983393a91cd7a1b59660d47d2045c03ff529c341f3ed994235a68c57f8195f75d61fc8cac37e936d9a6b75c4bd2347</span><span class="n">L</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><a href="#__codelineno-49-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">assert</span> <span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">e1</span><span class="p">,</span><span class="n">n1</span><span class="p">)</span><span class="o">==</span><span class="n">c1</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><a href="#__codelineno-49-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">assert</span> <span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="o">==</span><span class="n">c2</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><a href="#__codelineno-49-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="n">e1</span><span class="p">,(</span><span class="n">p1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">==</span><span class="mi">14</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><a href="#__codelineno-49-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">assert</span> <span class="n">gcd</span><span class="p">(</span><span class="n">e2</span><span class="p">,(</span><span class="n">p2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">==</span><span class="mi">14</span>
</code></pre></div>
<p>本题两个n均可分解</p>
<p>分解情况如下:</p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><a href="#__codelineno-50-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">p1</span> <span class="o">=</span> <span class="mi">12037827528067911684278967221392433256129944002157200272548317200308481572950474775891360447285969682243206009995242277136633522897723532096467191105943909</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><a href="#__codelineno-50-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">q1</span> <span class="o">=</span> <span class="mi">12120327527644543811107783655014863098833219936714394976342507913322405566177432644931575840816861543106701611662013978324877080018872656490603706071067111</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><a href="#__codelineno-50-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">p2</span> <span class="o">=</span> <span class="mi">12120327527644543811107783655014863098833219936714394976342507913322405566177432644931575840816861543106701611662013978324877080018872656490603706071067111</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><a href="#__codelineno-50-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">q2</span> <span class="o">=</span> <span class="mi">12301580698247665838432962460247894405698817646605188562297985838079356879336309758823376086396761749681729993573203954506346863479448531269351981555913253</span>
</code></pre></div>
<p>我们可以发现<span class="arithmatex">\(n_1,n_2\)</span>之间存在公因数</p>
<p>设<span class="arithmatex">\(e\)</span>和<span class="arithmatex">\(\phi(n)\)</span>的公因数为<span class="arithmatex">\(t\)</span>，则<span class="arithmatex">\(e = e't\)</span>，<span class="arithmatex">\(e' = \frac{e}{t}\)</span>，有<span class="arithmatex">\(e'd \equiv 1 \mod \phi(n)\)</span></p>
<p><span class="arithmatex">\(\therefore m^t \equiv c^d \mod n\)</span></p>
<p>本题<span class="arithmatex">\(t = 14\)</span>，于是我们有</p>
<div class="arithmatex">\[
res_1 \equiv m^{14} \mod n_1
\]</div>
<div class="arithmatex">\[
res_2 \equiv m^{14} \mod n_2
\]</div>
<p>用中国剩余定理解出其特解<span class="arithmatex">\(res\)</span>，即<span class="arithmatex">\(res \equiv m^{14} \mod lcm(n_1,n_2) \longrightarrow res \equiv m^{14} \mod pq_1q_2\)</span></p>
<p>把它当作一个<span class="arithmatex">\(e=14\)</span>的RSA加密，此时我们计算<span class="arithmatex">\(\phi(n) = (p_1 - 1)(q_1-1)(q_2-1)\)</span></p>
<p>我们分别求<span class="arithmatex">\(e = 14\)</span>和<span class="arithmatex">\(p_1 -1\)</span>,<span class="arithmatex">\(q_1-1\)</span>,<span class="arithmatex">\(q_2-1\)</span>的公因数，结果分别是2,14,2</p>
<p>那么我们转换成<span class="arithmatex">\(res \equiv m^{14} \mod p_1q_2\)</span></p>
<p>我们分别在<span class="arithmatex">\(\mod p_1\)</span>和<span class="arithmatex">\(\mod q_2\)</span>下用有限域开根求出解，再用中国剩余定理</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><a href="#__codelineno-51-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="mh">0xcfc59d54b4b2e9ab1b5d90920ae88f430d39fee60d18dddbc623d15aae645e4e50db1c07a02d472b2eebb075a547618e1154a15b1657fbf66ed7e714d23ac70bdfba4c809bbb1e27687163cb09258a07ab2533568192e29a3b8e31a5de886050b28b3ed58e81952487714dd7ae012708db30eaf007620cdeb34f150836a4b723</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><a href="#__codelineno-51-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">e1</span> <span class="o">=</span> <span class="mh">0xfae3a</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><a href="#__codelineno-51-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="mh">0x81523a330fb15125b6184e4461dadac7601340960840c5213b67a788c84aecfcdc3caf0bf3e27e4c95bb3c154db7055376981972b1565c22c100c47f3fa1dd2994e56090067b4e66f1c3905f9f780145cdf8d0fea88a45bae5113da37c8879c9cdb8ee9a55892bac3bae11fbbabcba0626163d0e2e12c04d99f4eeba5071cbea</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><a href="#__codelineno-51-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="mh">0xd45304b186dc82e40bd387afc831c32a4c7ba514a64ae051b62f483f27951065a6a04a030d285bdc1cb457b24c2f8701f574094d46d8de37b5a6d55356d1d368b89e16fa71b6603bd037c7f329a3096ce903937bb0c4f112a678c88fd5d84016f745b8281aea8fd5bcc28b68c293e4ef4a62a62e478a8b6cd46f3da73fa34c63</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><a href="#__codelineno-51-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e2</span> <span class="o">=</span> <span class="mh">0x1f9eae</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><a href="#__codelineno-51-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="mh">0x4d7ceaadf5e662ab2e0149a8d18a4777b4cd4a7712ab825cf913206c325e6abb88954ebc37b2bda19aed16c5938ac43f43966e96a86913129e38c853ecd4ebc89e806f823ffb802e3ddef0ac6c5ba078d3983393a91cd7a1b59660d47d2045c03ff529c341f3ed994235a68c57f8195f75d61fc8cac37e936d9a6b75c4bd2347</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><a href="#__codelineno-51-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><a href="#__codelineno-51-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p1</span> <span class="o">=</span> <span class="mi">12037827528067911684278967221392433256129944002157200272548317200308481572950474775891360447285969682243206009995242277136633522897723532096467191105943909</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><a href="#__codelineno-51-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q1</span> <span class="o">=</span> <span class="mi">12120327527644543811107783655014863098833219936714394976342507913322405566177432644931575840816861543106701611662013978324877080018872656490603706071067111</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><a href="#__codelineno-51-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p2</span> <span class="o">=</span> <span class="mi">12120327527644543811107783655014863098833219936714394976342507913322405566177432644931575840816861543106701611662013978324877080018872656490603706071067111</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><a href="#__codelineno-51-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q2</span> <span class="o">=</span> <span class="mi">12301580698247665838432962460247894405698817646605188562297985838079356879336309758823376086396761749681729993573203954506346863479448531269351981555913253</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a><a href="#__codelineno-51-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a><a href="#__codelineno-51-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a><a href="#__codelineno-51-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">phi1</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a><a href="#__codelineno-51-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">phi2</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a><a href="#__codelineno-51-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a><a href="#__codelineno-51-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a><a href="#__codelineno-51-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">if</span> <span class="n">t</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a><a href="#__codelineno-51-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">e1</span> <span class="o">=</span> <span class="n">e</span> <span class="o">//</span> <span class="n">t</span>
<a id="__codelineno-51-20" name="__codelineno-51-20"></a><a href="#__codelineno-51-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-51-21" name="__codelineno-51-21"></a><a href="#__codelineno-51-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-51-22" name="__codelineno-51-22"></a><a href="#__codelineno-51-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="k">return</span> <span class="n">m</span>
<a id="__codelineno-51-23" name="__codelineno-51-23"></a><a href="#__codelineno-51-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-51-24" name="__codelineno-51-24"></a><a href="#__codelineno-51-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">res1</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">e1</span><span class="p">,</span><span class="n">phi1</span><span class="p">,</span><span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-51-25" name="__codelineno-51-25"></a><a href="#__codelineno-51-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">res2</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span><span class="n">phi2</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-51-26" name="__codelineno-51-26"></a><a href="#__codelineno-51-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-51-27" name="__codelineno-51-27"></a><a href="#__codelineno-51-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-51-28" name="__codelineno-51-28"></a><a href="#__codelineno-51-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">crt</span><span class="p">([</span><span class="n">res1</span><span class="p">,</span><span class="n">res2</span><span class="p">],[</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">])</span>
<a id="__codelineno-51-29" name="__codelineno-51-29"></a><a href="#__codelineno-51-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-51-30" name="__codelineno-51-30"></a><a href="#__codelineno-51-30"><span class="linenos" data-linenos="30 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">*</span> <span class="n">q2</span>
<a id="__codelineno-51-31" name="__codelineno-51-31"></a><a href="#__codelineno-51-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">m2</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-51-32" name="__codelineno-51-32"></a><a href="#__codelineno-51-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-51-33" name="__codelineno-51-33"></a><a href="#__codelineno-51-33"><span class="linenos" data-linenos="33 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span>
<a id="__codelineno-51-34" name="__codelineno-51-34"></a><a href="#__codelineno-51-34"><span class="linenos" data-linenos="34 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m2</span>
<a id="__codelineno-51-35" name="__codelineno-51-35"></a><a href="#__codelineno-51-35"><span class="linenos" data-linenos="35 "></span></a><span class="n">sol1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-51-36" name="__codelineno-51-36"></a><a href="#__codelineno-51-36"><span class="linenos" data-linenos="36 "></span></a>
<a id="__codelineno-51-37" name="__codelineno-51-37"></a><a href="#__codelineno-51-37"><span class="linenos" data-linenos="37 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span>
<a id="__codelineno-51-38" name="__codelineno-51-38"></a><a href="#__codelineno-51-38"><span class="linenos" data-linenos="38 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m2</span>
<a id="__codelineno-51-39" name="__codelineno-51-39"></a><a href="#__codelineno-51-39"><span class="linenos" data-linenos="39 "></span></a><span class="n">sol2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-51-40" name="__codelineno-51-40"></a><a href="#__codelineno-51-40"><span class="linenos" data-linenos="40 "></span></a>
<a id="__codelineno-51-41" name="__codelineno-51-41"></a><a href="#__codelineno-51-41"><span class="linenos" data-linenos="41 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sol1</span><span class="p">:</span>
<a id="__codelineno-51-42" name="__codelineno-51-42"></a><a href="#__codelineno-51-42"><span class="linenos" data-linenos="42 "></span></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">sol2</span><span class="p">:</span>
<a id="__codelineno-51-43" name="__codelineno-51-43"></a><a href="#__codelineno-51-43"><span class="linenos" data-linenos="43 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">crt</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])],[</span><span class="n">p1</span><span class="p">,</span><span class="n">q2</span><span class="p">])</span>
<a id="__codelineno-51-44" name="__codelineno-51-44"></a><a href="#__codelineno-51-44"><span class="linenos" data-linenos="44 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-51-45" name="__codelineno-51-45"></a><a href="#__codelineno-51-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="c1">## EIS{Comm0n_Div15or_plus_CRT_is_so_easy|cb2733b9e69ab3a9bd526fa1}</span>
</code></pre></div>
<h3 id="3_2">处理方式3：<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h3>
<p>AMM开根，具体原理可以参考:<a href="https://forum.butian.net/share/1689">奇安信攻防社区-有限域上的高次开根AMM算法在RSA上的应用 (butian.net)</a></p>
<h4 id="2021crypto1">例题 2021黑盾杯Crypto1<a class="headerlink" href="#2021crypto1" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.txt</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><a href="#__codelineno-52-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">1801</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><a href="#__codelineno-52-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><a href="#__codelineno-52-3"><span class="linenos" data-linenos="3 "></span></a>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><a href="#__codelineno-52-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">c</span> <span class="o">=</span><span class="mi">821562155714228494350968286343241874202753771452745916900616612053610190986294297934462409534126095213198464996196364868528238538372119009517541428785632007137206972918081643841690069171088425923887930051635578719252415693144672179185417101210954906623326286804995637775062840407550493095027500638719998</span> 
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><a href="#__codelineno-52-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">p</span> <span class="o">=</span><span class="mi">19897846550210846565807788524492364050901480736489979129040638436463635149815428186161001280958415730930156556581274966745574164608778242980049611665461488306439665507971670397595035647317930606555771720849158745264269952668944940061576328219674721623208805067371087817766416300084129945316973502412996143</span> 
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><a href="#__codelineno-53-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><a href="#__codelineno-53-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><a href="#__codelineno-53-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><a href="#__codelineno-53-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><a href="#__codelineno-53-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><a href="#__codelineno-53-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><a href="#__codelineno-53-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">1801</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><a href="#__codelineno-53-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">821562155714228494350968286343241874202753771452745916900616612053610190986294297934462409534126095213198464996196364868528238538372119009517541428785632007137206972918081643841690069171088425923887930051635578719252415693144672179185417101210954906623326286804995637775062840407550493095027500638719998</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><a href="#__codelineno-53-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">19897846550210846565807788524492364050901480736489979129040638436463635149815428186161001280958415730930156556581274966745574164608778242980049611665461488306439665507971670397595035647317930606555771720849158745264269952668944940061576328219674721623208805067371087817766416300084129945316973502412996143</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><a href="#__codelineno-53-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><a href="#__codelineno-53-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">AMM</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><a href="#__codelineno-53-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><a href="#__codelineno-53-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----------------------------------------------------------------------------------&#39;</span><span class="p">)</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><a href="#__codelineno-53-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Start to run Adleman-Manders-Miller Root Extraction Method&#39;</span><span class="p">)</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><a href="#__codelineno-53-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Try to find one </span><span class="si">{:#x}</span><span class="s1">th root of </span><span class="si">{}</span><span class="s1"> modulo </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><a href="#__codelineno-53-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">g</span> <span class="o">=</span> <span class="n">GF</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><a href="#__codelineno-53-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">o</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a><a href="#__codelineno-53-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a><a href="#__codelineno-53-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">while</span> <span class="n">p</span> <span class="o">^</span> <span class="p">((</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a><a href="#__codelineno-53-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
<a id="__codelineno-53-21" name="__codelineno-53-21"></a><a href="#__codelineno-53-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Find p:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a id="__codelineno-53-22" name="__codelineno-53-22"></a><a href="#__codelineno-53-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-53-23" name="__codelineno-53-23"></a><a href="#__codelineno-53-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">q</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-53-24" name="__codelineno-53-24"></a><a href="#__codelineno-53-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">while</span> <span class="n">s</span> <span class="o">%</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-53-25" name="__codelineno-53-25"></a><a href="#__codelineno-53-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">t</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-53-26" name="__codelineno-53-26"></a><a href="#__codelineno-53-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">//</span> <span class="n">r</span>
<a id="__codelineno-53-27" name="__codelineno-53-27"></a><a href="#__codelineno-53-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Find s:</span><span class="si">{}</span><span class="s1">, t:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
<a id="__codelineno-53-28" name="__codelineno-53-28"></a><a href="#__codelineno-53-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-53-29" name="__codelineno-53-29"></a><a href="#__codelineno-53-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="k">while</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-53-30" name="__codelineno-53-30"></a><a href="#__codelineno-53-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-53-31" name="__codelineno-53-31"></a><a href="#__codelineno-53-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="n">alp</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">r</span>
<a id="__codelineno-53-32" name="__codelineno-53-32"></a><a href="#__codelineno-53-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Find alp:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alp</span><span class="p">))</span>
<a id="__codelineno-53-33" name="__codelineno-53-33"></a><a href="#__codelineno-53-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">p</span> <span class="o">^</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
<a id="__codelineno-53-34" name="__codelineno-53-34"></a><a href="#__codelineno-53-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">o</span> <span class="o">^</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">alp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-53-35" name="__codelineno-53-35"></a><a href="#__codelineno-53-35"><span class="linenos" data-linenos="35 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">p</span> <span class="o">^</span> <span class="n">s</span>
<a id="__codelineno-53-36" name="__codelineno-53-36"></a><a href="#__codelineno-53-36"><span class="linenos" data-linenos="36 "></span></a>    <span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-53-37" name="__codelineno-53-37"></a><a href="#__codelineno-53-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<a id="__codelineno-53-38" name="__codelineno-53-38"></a><a href="#__codelineno-53-38"><span class="linenos" data-linenos="38 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">b</span> <span class="o">^</span> <span class="p">(</span><span class="n">r</span><span class="o">^</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-53-39" name="__codelineno-53-39"></a><a href="#__codelineno-53-39"><span class="linenos" data-linenos="39 "></span></a>        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-53-40" name="__codelineno-53-40"></a><a href="#__codelineno-53-40"><span class="linenos" data-linenos="40 "></span></a>            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-53-41" name="__codelineno-53-41"></a><a href="#__codelineno-53-41"><span class="linenos" data-linenos="41 "></span></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-53-42" name="__codelineno-53-42"></a><a href="#__codelineno-53-42"><span class="linenos" data-linenos="42 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Calculating DLP...&#39;</span><span class="p">)</span>
<a id="__codelineno-53-43" name="__codelineno-53-43"></a><a href="#__codelineno-53-43"><span class="linenos" data-linenos="43 "></span></a>            <span class="n">j</span> <span class="o">=</span> <span class="o">-</span> <span class="n">discrete_log</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a id="__codelineno-53-44" name="__codelineno-53-44"></a><a href="#__codelineno-53-44"><span class="linenos" data-linenos="44 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[+] Finish DLP...&#39;</span><span class="p">)</span>
<a id="__codelineno-53-45" name="__codelineno-53-45"></a><a href="#__codelineno-53-45"><span class="linenos" data-linenos="45 "></span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">^</span><span class="n">r</span><span class="p">)</span><span class="o">^</span><span class="n">j</span>
<a id="__codelineno-53-46" name="__codelineno-53-46"></a><a href="#__codelineno-53-46"><span class="linenos" data-linenos="46 "></span></a>        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">c</span><span class="o">^</span><span class="n">j</span>
<a id="__codelineno-53-47" name="__codelineno-53-47"></a><a href="#__codelineno-53-47"><span class="linenos" data-linenos="47 "></span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">^</span> <span class="n">r</span>
<a id="__codelineno-53-48" name="__codelineno-53-48"></a><a href="#__codelineno-53-48"><span class="linenos" data-linenos="48 "></span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">o</span><span class="o">^</span><span class="n">alp</span> <span class="o">*</span> <span class="n">h</span>
<a id="__codelineno-53-49" name="__codelineno-53-49"></a><a href="#__codelineno-53-49"><span class="linenos" data-linenos="49 "></span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-53-50" name="__codelineno-53-50"></a><a href="#__codelineno-53-50"><span class="linenos" data-linenos="50 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished in </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a id="__codelineno-53-51" name="__codelineno-53-51"></a><a href="#__codelineno-53-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Find one solution: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<a id="__codelineno-53-52" name="__codelineno-53-52"></a><a href="#__codelineno-53-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-53-53" name="__codelineno-53-53"></a><a href="#__codelineno-53-53"><span class="linenos" data-linenos="53 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">findAllPRoot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<a id="__codelineno-53-54" name="__codelineno-53-54"></a><a href="#__codelineno-53-54"><span class="linenos" data-linenos="54 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start to find all the Primitive </span><span class="si">{:#x}</span><span class="s2">th root of 1 modulo </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<a id="__codelineno-53-55" name="__codelineno-53-55"></a><a href="#__codelineno-53-55"><span class="linenos" data-linenos="55 "></span></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-53-56" name="__codelineno-53-56"></a><a href="#__codelineno-53-56"><span class="linenos" data-linenos="56 "></span></a>    <span class="n">proot</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-53-57" name="__codelineno-53-57"></a><a href="#__codelineno-53-57"><span class="linenos" data-linenos="57 "></span></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">proot</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-53-58" name="__codelineno-53-58"></a><a href="#__codelineno-53-58"><span class="linenos" data-linenos="58 "></span></a>        <span class="n">proot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<a id="__codelineno-53-59" name="__codelineno-53-59"></a><a href="#__codelineno-53-59"><span class="linenos" data-linenos="59 "></span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-53-60" name="__codelineno-53-60"></a><a href="#__codelineno-53-60"><span class="linenos" data-linenos="60 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished in </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a id="__codelineno-53-61" name="__codelineno-53-61"></a><a href="#__codelineno-53-61"><span class="linenos" data-linenos="61 "></span></a>    <span class="k">return</span> <span class="n">proot</span>
<a id="__codelineno-53-62" name="__codelineno-53-62"></a><a href="#__codelineno-53-62"><span class="linenos" data-linenos="62 "></span></a>
<a id="__codelineno-53-63" name="__codelineno-53-63"></a><a href="#__codelineno-53-63"><span class="linenos" data-linenos="63 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">findAllSolutions</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">proot</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
<a id="__codelineno-53-64" name="__codelineno-53-64"></a><a href="#__codelineno-53-64"><span class="linenos" data-linenos="64 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start to find all the </span><span class="si">{:#x}</span><span class="s2">th root of </span><span class="si">{}</span><span class="s2"> modulo </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
<a id="__codelineno-53-65" name="__codelineno-53-65"></a><a href="#__codelineno-53-65"><span class="linenos" data-linenos="65 "></span></a>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-53-66" name="__codelineno-53-66"></a><a href="#__codelineno-53-66"><span class="linenos" data-linenos="66 "></span></a>    <span class="n">all_mp</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-53-67" name="__codelineno-53-67"></a><a href="#__codelineno-53-67"><span class="linenos" data-linenos="67 "></span></a>    <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">proot</span><span class="p">:</span>
<a id="__codelineno-53-68" name="__codelineno-53-68"></a><a href="#__codelineno-53-68"><span class="linenos" data-linenos="68 "></span></a>        <span class="n">mp2</span> <span class="o">=</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">root</span> <span class="o">%</span> <span class="n">p</span>
<a id="__codelineno-53-69" name="__codelineno-53-69"></a><a href="#__codelineno-53-69"><span class="linenos" data-linenos="69 "></span></a>        <span class="k">assert</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">mp2</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">cp</span><span class="p">)</span>
<a id="__codelineno-53-70" name="__codelineno-53-70"></a><a href="#__codelineno-53-70"><span class="linenos" data-linenos="70 "></span></a>        <span class="n">all_mp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mp2</span><span class="p">)</span>
<a id="__codelineno-53-71" name="__codelineno-53-71"></a><a href="#__codelineno-53-71"><span class="linenos" data-linenos="71 "></span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-53-72" name="__codelineno-53-72"></a><a href="#__codelineno-53-72"><span class="linenos" data-linenos="72 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished in </span><span class="si">{}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>
<a id="__codelineno-53-73" name="__codelineno-53-73"></a><a href="#__codelineno-53-73"><span class="linenos" data-linenos="73 "></span></a>    <span class="k">return</span> <span class="n">all_mp</span>
<a id="__codelineno-53-74" name="__codelineno-53-74"></a><a href="#__codelineno-53-74"><span class="linenos" data-linenos="74 "></span></a>
<a id="__codelineno-53-75" name="__codelineno-53-75"></a><a href="#__codelineno-53-75"><span class="linenos" data-linenos="75 "></span></a><span class="n">mp</span> <span class="o">=</span> <span class="n">AMM</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-53-76" name="__codelineno-53-76"></a><a href="#__codelineno-53-76"><span class="linenos" data-linenos="76 "></span></a><span class="n">p_proot</span> <span class="o">=</span> <span class="n">findAllPRoot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-53-77" name="__codelineno-53-77"></a><a href="#__codelineno-53-77"><span class="linenos" data-linenos="77 "></span></a><span class="n">mps</span> <span class="o">=</span> <span class="n">findAllSolutions</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="n">p_proot</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-53-78" name="__codelineno-53-78"></a><a href="#__codelineno-53-78"><span class="linenos" data-linenos="78 "></span></a>
<a id="__codelineno-53-79" name="__codelineno-53-79"></a><a href="#__codelineno-53-79"><span class="linenos" data-linenos="79 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mps</span><span class="p">:</span>
<a id="__codelineno-53-80" name="__codelineno-53-80"></a><a href="#__codelineno-53-80"><span class="linenos" data-linenos="80 "></span></a>    <span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-53-81" name="__codelineno-53-81"></a><a href="#__codelineno-53-81"><span class="linenos" data-linenos="81 "></span></a>    <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;flag&#39;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
<a id="__codelineno-53-82" name="__codelineno-53-82"></a><a href="#__codelineno-53-82"><span class="linenos" data-linenos="82 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-53-83" name="__codelineno-53-83"></a><a href="#__codelineno-53-83"><span class="linenos" data-linenos="83 "></span></a>        <span class="c1">## flag{Enj01_m1sc_A0d_cr0}</span>
</code></pre></div>
<p>另一种解法:</p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><a href="#__codelineno-54-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><a href="#__codelineno-54-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><a href="#__codelineno-54-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">1801</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><a href="#__codelineno-54-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">821562155714228494350968286343241874202753771452745916900616612053610190986294297934462409534126095213198464996196364868528238538372119009517541428785632007137206972918081643841690069171088425923887930051635578719252415693144672179185417101210954906623326286804995637775062840407550493095027500638719998</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><a href="#__codelineno-54-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">19897846550210846565807788524492364050901480736489979129040638436463635149815428186161001280958415730930156556581274966745574164608778242980049611665461488306439665507971670397595035647317930606555771720849158745264269952668944940061576328219674721623208805067371087817766416300084129945316973502412996143</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><a href="#__codelineno-54-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><a href="#__codelineno-54-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">g</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><a href="#__codelineno-54-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">d0</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><a href="#__codelineno-54-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">m0</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d0</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><a href="#__codelineno-54-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><a href="#__codelineno-54-11"><span class="linenos" data-linenos="11 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><a href="#__codelineno-54-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">m0</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a><a href="#__codelineno-54-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a><a href="#__codelineno-54-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;flag&quot;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a><a href="#__codelineno-54-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</code></pre></div>
<p>没搞懂原理</p>
<h2 id="rabin">十三、Rabin<a class="headerlink" href="#rabin" title="Permanent link">&para;</a></h2>
<p>简单了解一下Rabin加密体制流程</p>
<p><del>一年后回头再看，Rabin只是e=2的RSA</del></p>
<h3 id="_21">密钥生成<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>选取两个大素数<span class="arithmatex">\(p,q\)</span>，并且满足</p>
<div class="arithmatex">\[
p \equiv 3 \mod 4
\]</div>
<div class="arithmatex">\[
q \equiv 3 \mod 4
\]</div>
<p>即<span class="arithmatex">\(p,q\)</span>都是<span class="arithmatex">\(4k + 3\)</span>形式的素数</p>
<p>接下来计算<span class="arithmatex">\(n = p\times q\)</span>，<span class="arithmatex">\((p,q)\)</span>作为私钥，<span class="arithmatex">\(n\)</span>作为公钥</p>
<h3 id="_22">加密过程<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
c \equiv  m^2(mod \quad n)
\]</div>
<h3 id="_23">解密过程<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\because c \equiv m^2 \mod n
\]</div>
<p>即</p>
<div class="arithmatex">\[
c \equiv m ^ 2 \mod p
\]</div>
<div class="arithmatex">\[
c \equiv m ^ 2 \mod q
\]</div>
<p>根据二次剩余得</p>
<p><span class="arithmatex">\(c^{\frac{p-1}{2}} \equiv 1 \mod p\)</span>同乘c得：<span class="arithmatex">\(c^{\frac{p+1}{2}} \equiv c \mod p\)</span>，开根号得<span class="arithmatex">\(c^{\frac{p+1}{4}} \mod p\)</span>，所以<span class="arithmatex">\(m_p =c^{\frac{p+1}{4}}\)</span></p>
<p>同理<span class="arithmatex">\(m_q = c^{\frac{q+1}{4}}\)</span></p>
<p>此时得到两个同余式</p>
<div class="arithmatex">\[
m \equiv m_p \mod p
\]</div>
<div class="arithmatex">\[
m \equiv m_q \mod q
\]</div>
<p>再解中国剩余定理即可</p>
<h3 id="_24">例题<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><a href="#__codelineno-55-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><a href="#__codelineno-55-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><a href="#__codelineno-55-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><a href="#__codelineno-55-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><a href="#__codelineno-55-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><a href="#__codelineno-55-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a><a href="#__codelineno-55-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><a href="#__codelineno-55-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><a href="#__codelineno-55-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><a href="#__codelineno-55-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><a href="#__codelineno-55-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><a href="#__codelineno-55-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a><a href="#__codelineno-55-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a><a href="#__codelineno-55-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p=&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a><a href="#__codelineno-55-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q=&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a><a href="#__codelineno-55-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a><a href="#__codelineno-55-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a><a href="#__codelineno-55-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e=&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><a href="#__codelineno-56-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><a href="#__codelineno-56-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><a href="#__codelineno-56-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><a href="#__codelineno-56-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span><span class="o">=</span> <span class="mi">13314362720917602133969793252481444316247612541287913579795797774897851142465370812511985605994998073433561235021924708067874236781706611485522371488232623</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><a href="#__codelineno-56-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span><span class="o">=</span> <span class="mi">10711516497864529822020903304369858958930042711451857859791558135232705853374332295320094676061294774680048276363750484537945067473851592618816785752809803</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><a href="#__codelineno-56-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span><span class="o">=</span> <span class="mi">142617015943661365869136488949628046624950745436416195175536421279851751774402291519010668496730147866462378904972514253007029491632653461771497495733152729212900224242492221133006321373540619376544526943204146111719397605460529531608654329571698129077171108416638061409327725762114841023226929126272738803269</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><a href="#__codelineno-56-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span><span class="o">=</span> <span class="mi">3136716033731857617369889733308430982192049734478834150612954276064433287574994581343168243135342097712334250357890492021703404008556737899236668582163912130637742227325170121650071435166332685070232329</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><a href="#__codelineno-56-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span><span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><a href="#__codelineno-56-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><a href="#__codelineno-56-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">inv_p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a><a href="#__codelineno-56-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">inv_q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a><a href="#__codelineno-56-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">mp</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a><a href="#__codelineno-56-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">mq</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a><a href="#__codelineno-56-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">inv_p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mq</span> <span class="o">+</span> <span class="n">inv_q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">mp</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a><a href="#__codelineno-56-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a><a href="#__codelineno-56-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">inv_p</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="n">mq</span> <span class="o">-</span> <span class="n">inv_q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">mp</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a><a href="#__codelineno-56-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a><a href="#__codelineno-56-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">## 因为rabin 加密有四种结果，全部列出。</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a><a href="#__codelineno-56-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">aa</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a><a href="#__codelineno-56-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aa</span><span class="p">:</span>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a><a href="#__codelineno-56-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
</code></pre></div>
<p>两次有限域开根再中国剩余定理也可以解</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><a href="#__codelineno-57-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><a href="#__codelineno-57-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><a href="#__codelineno-57-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><a href="#__codelineno-57-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">13314362720917602133969793252481444316247612541287913579795797774897851142465370812511985605994998073433561235021924708067874236781706611485522371488232623</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><a href="#__codelineno-57-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">10711516497864529822020903304369858958930042711451857859791558135232705853374332295320094676061294774680048276363750484537945067473851592618816785752809803</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><a href="#__codelineno-57-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">142617015943661365869136488949628046624950745436416195175536421279851751774402291519010668496730147866462378904972514253007029491632653461771497495733152729212900224242492221133006321373540619376544526943204146111719397605460529531608654329571698129077171108416638061409327725762114841023226929126272738803269</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><a href="#__codelineno-57-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">3136716033731857617369889733308430982192049734478834150612954276064433287574994581343168243135342097712334250357890492021703404008556737899236668582163912130637742227325170121650071435166332685070232329</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><a href="#__codelineno-57-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><a href="#__codelineno-57-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><a href="#__codelineno-57-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><a href="#__codelineno-57-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><a href="#__codelineno-57-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">res1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><a href="#__codelineno-57-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><a href="#__codelineno-57-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><a href="#__codelineno-57-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a><a href="#__codelineno-57-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">res2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a><a href="#__codelineno-57-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a><a href="#__codelineno-57-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res1</span><span class="p">:</span>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a><a href="#__codelineno-57-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res2</span><span class="p">:</span>
<a id="__codelineno-57-20" name="__codelineno-57-20"></a><a href="#__codelineno-57-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">crt</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">])],[</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">])</span>
<a id="__codelineno-57-21" name="__codelineno-57-21"></a><a href="#__codelineno-57-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
</code></pre></div>
<h3 id="rabin_1">多次解Rabin<a class="headerlink" href="#rabin_1" title="Permanent link">&para;</a></h3>
<p>题目来源NSSCTF ROUND#11</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><a href="#__codelineno-58-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><a href="#__codelineno-58-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><a href="#__codelineno-58-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><a href="#__codelineno-58-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><a href="#__codelineno-58-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><a href="#__codelineno-58-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">assert</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">q</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><a href="#__codelineno-58-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><a href="#__codelineno-58-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65536</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><a href="#__codelineno-58-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a><a href="#__codelineno-58-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">num1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><a href="#__codelineno-58-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">num2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">q</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><a href="#__codelineno-58-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><a href="#__codelineno-58-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><a href="#__codelineno-58-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;num1=&quot;</span><span class="p">,</span><span class="n">num1</span><span class="p">)</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><a href="#__codelineno-58-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;num2=&quot;</span><span class="p">,</span><span class="n">num2</span><span class="p">)</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><a href="#__codelineno-58-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a><a href="#__codelineno-58-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</code></pre></div>
<p>先当脚本小子</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><a href="#__codelineno-59-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><a href="#__codelineno-59-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><a href="#__codelineno-59-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><a href="#__codelineno-59-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">num1</span><span class="o">=</span> <span class="mi">134186458247304184975418956047750205959249518467116558944535042073046353646812210914711656218265319503240074967140027248278994209294869476247136854741631971975560846483033205230015783696055443897579440474585892990793595602095853960468928457703619205343030230201261058516219352855127626321847429189498666288452</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><a href="#__codelineno-59-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">num2</span><span class="o">=</span> <span class="mi">142252615203395148320392930915384149783801592719030740337592034613073131106036364733480644482188684184951026866672011061092572389846929838149296357261088256882232316029199097203257003822750826537629358422813658558008420810100860520289261141533787464661186681371090873356089237613080052677646446751824502044253</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><a href="#__codelineno-59-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span><span class="o">=</span> <span class="mi">154128165952806886790805410291540694477027958542517309121222164274741570806324940112942356615458298064007096476638232940977238598879453357856259085001745763666030177657087772721079761302637352680091939676709372354103177660093164629417313468356185431895723026835950366030712541994019375251534778666996491342313</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><a href="#__codelineno-59-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span><span class="o">=</span> <span class="mi">9061020000447780498751583220055526057707259079063266050917693522289697419950637286020502996753375864826169562714946009146452528404466989211057548905704856329650955828939737304126685040898740775635547039660982064419976700425595503919207903099686497044429265908046033565745195837408532764433870408185128447965</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a><a href="#__codelineno-59-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><a href="#__codelineno-59-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">tmp</span> <span class="o">=</span> <span class="n">num1</span><span class="o">+</span><span class="n">num2</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a><a href="#__codelineno-59-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><a href="#__codelineno-59-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><a href="#__codelineno-59-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><a href="#__codelineno-59-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><a href="#__codelineno-59-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">inv_p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a><a href="#__codelineno-59-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">inv_q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a><a href="#__codelineno-59-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a><a href="#__codelineno-59-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">cs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a><a href="#__codelineno-59-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
<a id="__codelineno-59-19" name="__codelineno-59-19"></a><a href="#__codelineno-59-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">ps</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-59-20" name="__codelineno-59-20"></a><a href="#__codelineno-59-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
<a id="__codelineno-59-21" name="__codelineno-59-21"></a><a href="#__codelineno-59-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">r</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-59-22" name="__codelineno-59-22"></a><a href="#__codelineno-59-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-59-23" name="__codelineno-59-23"></a><a href="#__codelineno-59-23"><span class="linenos" data-linenos="23 "></span></a>
<a id="__codelineno-59-24" name="__codelineno-59-24"></a><a href="#__codelineno-59-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">inv_q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">inv_p</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-59-25" name="__codelineno-59-25"></a><a href="#__codelineno-59-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">inv_q</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="n">inv_p</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-59-26" name="__codelineno-59-26"></a><a href="#__codelineno-59-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
<a id="__codelineno-59-27" name="__codelineno-59-27"></a><a href="#__codelineno-59-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-59-28" name="__codelineno-59-28"></a><a href="#__codelineno-59-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">-</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
<a id="__codelineno-59-29" name="__codelineno-59-29"></a><a href="#__codelineno-59-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-59-30" name="__codelineno-59-30"></a><a href="#__codelineno-59-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="k">if</span> <span class="n">y</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
<a id="__codelineno-59-31" name="__codelineno-59-31"></a><a href="#__codelineno-59-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-59-32" name="__codelineno-59-32"></a><a href="#__codelineno-59-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="k">if</span> <span class="n">n</span> <span class="o">-</span> <span class="n">y</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span>
<a id="__codelineno-59-33" name="__codelineno-59-33"></a><a href="#__codelineno-59-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-59-34" name="__codelineno-59-34"></a><a href="#__codelineno-59-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">cs</span> <span class="o">=</span> <span class="n">ps</span>
<a id="__codelineno-59-35" name="__codelineno-59-35"></a><a href="#__codelineno-59-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-59-36" name="__codelineno-59-36"></a><a href="#__codelineno-59-36"><span class="linenos" data-linenos="36 "></span></a><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">:</span>
<a id="__codelineno-59-37" name="__codelineno-59-37"></a><a href="#__codelineno-59-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<p>下面的三个题型将涉及CopperSmith，师傅们可以通读一遍:<a href="https://jayxv.github.io/2020/08/13/密码学学习笔记之coppersmith/">密码学学习笔记 之 Coppersmith’s Method | Van1sh的小屋 (jayxv.github.io)</a></p>
<h2 id="m">十四、m高位泄露<a class="headerlink" href="#m" title="Permanent link">&para;</a></h2>
<p>这类题目会有两种情况，第一种情况是代码很直白的给出m的高位，第二种情况是利用flag头之类的信息来获取高位</p>
<h3 id="1m">情况1：直接给出m的高位<a class="headerlink" href="#1m" title="Permanent link">&para;</a></h3>
<h4 id="_25">例题<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><a href="#__codelineno-60-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><a href="#__codelineno-60-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><a href="#__codelineno-60-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><a href="#__codelineno-60-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a><a href="#__codelineno-60-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a><a href="#__codelineno-60-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a><a href="#__codelineno-60-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a><a href="#__codelineno-60-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a><a href="#__codelineno-60-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a><a href="#__codelineno-60-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a><a href="#__codelineno-60-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">m1</span> <span class="o">=</span> <span class="p">((</span><span class="n">m</span> <span class="o">&gt;&gt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">300</span><span class="p">)</span>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a><a href="#__codelineno-60-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a><a href="#__codelineno-60-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><a href="#__codelineno-60-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a><a href="#__codelineno-60-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n =&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a><a href="#__codelineno-60-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c =&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a><a href="#__codelineno-60-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e =&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a><a href="#__codelineno-60-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;m1 =&quot;</span><span class="p">,</span> <span class="n">m1</span><span class="p">)</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a><a href="#__codelineno-60-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a><a href="#__codelineno-60-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">n = 89449659165373664419599666603079125351786161891254199117045952387178298091726343680198833028457552478360463001966084179577576990766724383528486250298768666097882661565765202949881673799125950008229527772973603379916117935790703989917655837756217393025354969853495238961762669326690100145696530290685977278593</span>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a><a href="#__codelineno-60-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">c = 175676150266637032446485438802315236532165610668245377791442524569846934587347877260997089793552024464242407355427955652050327122630649033488529560135042402737218074153101020540979958586399761415542047850951996733997549252310811350769808163958303048261417309757780500291307110596781699418188514782424677</span>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a><a href="#__codelineno-60-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">e = 3</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a><a href="#__codelineno-60-23"><span class="linenos" data-linenos="23 "></span></a><span class="sd">m1 = 56006392791978632601307849398736624069259692797382051345599538506145258779412417900757721790977933312</span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a><a href="#__codelineno-60-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><a href="#__codelineno-61-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><a href="#__codelineno-61-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><a href="#__codelineno-61-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">89449659165373664419599666603079125351786161891254199117045952387178298091726343680198833028457552478360463001966084179577576990766724383528486250298768666097882661565765202949881673799125950008229527772973603379916117935790703989917655837756217393025354969853495238961762669326690100145696530290685977278593</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><a href="#__codelineno-61-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">175676150266637032446485438802315236532165610668245377791442524569846934587347877260997089793552024464242407355427955652050327122630649033488529560135042402737218074153101020540979958586399761415542047850951996733997549252310811350769808163958303048261417309757780500291307110596781699418188514782424677</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><a href="#__codelineno-61-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><a href="#__codelineno-61-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m1</span> <span class="o">=</span> <span class="mi">56006392791978632601307849398736624069259692797382051345599538506145258779412417900757721790977933312</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><a href="#__codelineno-61-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><a href="#__codelineno-61-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><a href="#__codelineno-61-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><a href="#__codelineno-61-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><a href="#__codelineno-61-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">300</span><span class="p">,</span><span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><a href="#__codelineno-61-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><a href="#__codelineno-61-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><a href="#__codelineno-61-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
</code></pre></div>
<h3 id="2flag">情况2:利用flag头等已知信息<a class="headerlink" href="#2flag" title="Permanent link">&para;</a></h3>
<h4 id="2024xyctf">例题——2024XYCTF 反方向的密码 相思<a class="headerlink" href="#2024xyctf" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><a href="#__codelineno-62-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><a href="#__codelineno-62-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><a href="#__codelineno-62-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secrets</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><a href="#__codelineno-62-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><a href="#__codelineno-62-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">hash</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><a href="#__codelineno-62-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><a href="#__codelineno-62-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a><a href="#__codelineno-62-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">pad</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><a href="#__codelineno-62-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">return</span> <span class="n">message</span> <span class="o">+</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)))</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><a href="#__codelineno-62-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><a href="#__codelineno-62-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><a href="#__codelineno-62-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getStrongPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a><a href="#__codelineno-62-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getStrongPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a><a href="#__codelineno-62-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a><a href="#__codelineno-62-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><a href="#__codelineno-62-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<a id="__codelineno-62-17" name="__codelineno-62-17"></a><a href="#__codelineno-62-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-62-18" name="__codelineno-62-18"></a><a href="#__codelineno-62-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">## 120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span>
<a id="__codelineno-62-19" name="__codelineno-62-19"></a><a href="#__codelineno-62-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">## 143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span>
</code></pre></div>
<p>m可以看为<code>m = bytes_to_long(b"XYCTF{xxxxxxxxxxxxxxxxxxxx}" + pad)</code></p>
<p>pad可以爆破，所以只需要求解中间未知的字符，就相当于一个m高位和低位泄露的题</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><a href="#__codelineno-63-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><a href="#__codelineno-63-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><a href="#__codelineno-63-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><a href="#__codelineno-63-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">120440199294949712392334113337541924034371176306546446428347114627162894108760435789068328282135879182130546564535108930827440004987170619301799710272329673259390065147556073101312748104743572369383346039000998822862286001416166288971531241789864076857299162050026949096919395896174243383291126202796610039053</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><a href="#__codelineno-63-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">143413213355903851638663645270518081058249439863120739973910994223793329606595495141951165221740599158773181585002460087410975579141155680671886930801733174300593785562287068287654547100320094291092508723488470015821072834947151827362715749438612812148855627557719115676595686347541785037035334177162406305243</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><a href="#__codelineno-63-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><a href="#__codelineno-63-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">hash</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><a href="#__codelineno-63-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><a href="#__codelineno-63-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><a href="#__codelineno-63-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">):</span>                                  <span class="c1">#i代表{}中未知数的个数</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><a href="#__codelineno-63-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">prefix</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;XYCTF{&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">256</span><span class="o">^</span><span class="p">(</span><span class="mi">32</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><a href="#__codelineno-63-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><a href="#__codelineno-63-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">pad</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><a href="#__codelineno-63-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;}&quot;</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><a href="#__codelineno-63-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><a href="#__codelineno-63-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><a href="#__codelineno-63-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a><a href="#__codelineno-63-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="mi">256</span><span class="o">^</span><span class="mi">33</span> <span class="o">+</span> <span class="n">low</span><span class="p">)</span><span class="o">^</span><span class="mi">3</span> <span class="o">-</span> <span class="n">c</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a><a href="#__codelineno-63-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-63-20" name="__codelineno-63-20"></a><a href="#__codelineno-63-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">256</span><span class="o">^</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-63-21" name="__codelineno-63-21"></a><a href="#__codelineno-63-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-63-22" name="__codelineno-63-22"></a><a href="#__codelineno-63-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">256</span><span class="o">^</span><span class="mi">33</span> <span class="o">+</span> <span class="n">low</span>
<a id="__codelineno-63-23" name="__codelineno-63-23"></a><a href="#__codelineno-63-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
<a id="__codelineno-63-24" name="__codelineno-63-24"></a><a href="#__codelineno-63-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="c1">## XYCTF{!__d3ng__hu0__1@n__3h@n__Chu__!}</span>
</code></pre></div>
<h2 id="p">十五、p高位泄露<a class="headerlink" href="#p" title="Permanent link">&para;</a></h2>
<p>这类题目也有两种情况，第一种情况是代码很直白的给出p的高位，第二种情况是利用其他信息获取p的高位</p>
<p>p的高位泄露是有条件的，经过我的不完全准确的统计(以512bit的p为例)</p>
<p>当<code>beta=0.4</code>时，在未知位数少于等于227bit时，可以恢复p</p>
<p>当<code>beta=0.4,epsilon=0.01</code>时，在未知位数少于等于248bit时，可以恢复p</p>
<h3 id="1_9">例题1<a class="headerlink" href="#1_9" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><a href="#__codelineno-64-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><a href="#__codelineno-64-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><a href="#__codelineno-64-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><a href="#__codelineno-64-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><a href="#__codelineno-64-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><a href="#__codelineno-64-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a><a href="#__codelineno-64-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><a href="#__codelineno-64-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a><a href="#__codelineno-64-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><a href="#__codelineno-64-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><a href="#__codelineno-64-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">p1</span> <span class="o">=</span> <span class="p">((</span><span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">256</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">256</span><span class="p">)</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a><a href="#__codelineno-64-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a><a href="#__codelineno-64-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n =&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a><a href="#__codelineno-64-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c =&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a><a href="#__codelineno-64-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e =&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a><a href="#__codelineno-64-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p1 =&quot;</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a><a href="#__codelineno-64-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a><a href="#__codelineno-64-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">n = 25412529168113241701978154909309452589891277619233574149177682749114694998754065178357796120946044207438029964927062297462478639487054245771692139625849995546462111249773750389956600652870714030563605023702161513442866609937847422556059608499864578170270126239637444959812121589196901129645564580908045557218006330672260617798453633543627607790892960895904087738679492228779277752739734608284915605638138243297198792777112179909034121738317943791638151509031222745851940804609153731748776002638455252820409482251897734211263626398933847861538578761515233197699408866935293343456161438639398890089434015875977218250399</span>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a><a href="#__codelineno-64-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">c = 11832017536820850822990089557724269863899815227776358234936663617587241671432348464674233033185082415100398087268764691266148966050993867487703853445199053612975005945065305992972854436834255574224203980327515867976652513642869374642661621841855735886358661741631500029948344306194937625466742946921106659582316643893949403548828556819907948714983462986507817955376793071143086032085845182853003634916425312911434933416448638808160541352834497686975061092257675653110414264672490891200433992043618040530275350634723043175666891682239033429796170154980192829798607191555482341170827932551423162833473892514972387547888</span>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a><a href="#__codelineno-64-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">e = 65537</span>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a><a href="#__codelineno-64-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">p1 = 174553077493661081676268351785469032783476528521014320107330821253075206651723812600343204348306643031578070226902979453793372875180300634043015175074746912397887970195415967163417566827459210112867899640388623940244194079258961165834045219906954836822089775153665401751146892024327963835455414059781203165184</span>
<a id="__codelineno-64-22" name="__codelineno-64-22"></a><a href="#__codelineno-64-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><a href="#__codelineno-65-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><a href="#__codelineno-65-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><a href="#__codelineno-65-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><a href="#__codelineno-65-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">25412529168113241701978154909309452589891277619233574149177682749114694998754065178357796120946044207438029964927062297462478639487054245771692139625849995546462111249773750389956600652870714030563605023702161513442866609937847422556059608499864578170270126239637444959812121589196901129645564580908045557218006330672260617798453633543627607790892960895904087738679492228779277752739734608284915605638138243297198792777112179909034121738317943791638151509031222745851940804609153731748776002638455252820409482251897734211263626398933847861538578761515233197699408866935293343456161438639398890089434015875977218250399</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><a href="#__codelineno-65-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">11832017536820850822990089557724269863899815227776358234936663617587241671432348464674233033185082415100398087268764691266148966050993867487703853445199053612975005945065305992972854436834255574224203980327515867976652513642869374642661621841855735886358661741631500029948344306194937625466742946921106659582316643893949403548828556819907948714983462986507817955376793071143086032085845182853003634916425312911434933416448638808160541352834497686975061092257675653110414264672490891200433992043618040530275350634723043175666891682239033429796170154980192829798607191555482341170827932551423162833473892514972387547888</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a><a href="#__codelineno-65-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a><a href="#__codelineno-65-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p_high</span> <span class="o">=</span> <span class="mi">174553077493661081676268351785469032783476528521014320107330821253075206651723812600343204348306643031578070226902979453793372875180300634043015175074746912397887970195415967163417566827459210112867899640388623940244194079258961165834045219906954836822089775153665401751146892024327963835455414059781203165184</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><a href="#__codelineno-65-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><a href="#__codelineno-65-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a><a href="#__codelineno-65-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">p_high</span> <span class="o">+</span> <span class="n">x</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a><a href="#__codelineno-65-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">256</span><span class="p">,</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><a href="#__codelineno-65-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a><a href="#__codelineno-65-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">p_high</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a><a href="#__codelineno-65-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><a href="#__codelineno-65-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a><a href="#__codelineno-65-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a><a href="#__codelineno-65-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
</code></pre></div>
<h3 id="22023litctf-babyxor">例题2——2023LitCTF Babyxor<a class="headerlink" href="#22023litctf-babyxor" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><a href="#__codelineno-66-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><a href="#__codelineno-66-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><a href="#__codelineno-66-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><a href="#__codelineno-66-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a><a href="#__codelineno-66-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">==</span><span class="mi">32</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a><a href="#__codelineno-66-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a><a href="#__codelineno-66-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a><a href="#__codelineno-66-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a><a href="#__codelineno-66-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a><a href="#__codelineno-66-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="n">p</span><span class="o">^</span><span class="n">m</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a><a href="#__codelineno-66-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> 
<a id="__codelineno-66-12" name="__codelineno-66-12"></a><a href="#__codelineno-66-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-66-13" name="__codelineno-66-13"></a><a href="#__codelineno-66-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c1 = </span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-66-14" name="__codelineno-66-14"></a><a href="#__codelineno-66-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c2 = </span><span class="si">{</span><span class="n">c2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-66-15" name="__codelineno-66-15"></a><a href="#__codelineno-66-15"><span class="linenos" data-linenos="15 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-66-16" name="__codelineno-66-16"></a><a href="#__codelineno-66-16"><span class="linenos" data-linenos="16 "></span></a><span class="sd">n = 139167681803392690594490403105432649693546256181767408269202101512534988406137879788255103631885736461742577594980136624933914700779445704490217419248411578290305101891222576080645870988658334799437317221565839991979543660824098367011942169305111105129234902517835649895908656770416774539906212596072334423407</span>
<a id="__codelineno-66-17" name="__codelineno-66-17"></a><a href="#__codelineno-66-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">c1 = 11201139662236758800406931253538295757259990870588609533820056210585752522925690049252488581929717556881067021381940083808024384402885422258545946243513996</span>
<a id="__codelineno-66-18" name="__codelineno-66-18"></a><a href="#__codelineno-66-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">c2 = 112016152270171196606652761990170033221036025260883289104273504703557624964071464062375228351458191745141525003775876044271210498526920529385038130932141551598616579917681815276713386113932345056134302042399379895915706991873687943357627747262597883603999621939794450743982662393955266685255577026078256473601</span>
<a id="__codelineno-66-19" name="__codelineno-66-19"></a><a href="#__codelineno-66-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>因为flag长度为32，转为int的值为256bit，因为p为512的数，所以<code>p ^ m</code>的高256bit和p的高256bit是一样的，间接告诉我们p的高位</p>
<p>这个未知位数不太满足我们前面说的攻击条件，差了8位，因此需要做一点爆破</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><a href="#__codelineno-67-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><a href="#__codelineno-67-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><a href="#__codelineno-67-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><a href="#__codelineno-67-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><a href="#__codelineno-67-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">139167681803392690594490403105432649693546256181767408269202101512534988406137879788255103631885736461742577594980136624933914700779445704490217419248411578290305101891222576080645870988658334799437317221565839991979543660824098367011942169305111105129234902517835649895908656770416774539906212596072334423407</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a><a href="#__codelineno-67-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="mi">11201139662236758800406931253538295757259990870588609533820056210585752522925690049252488581929717556881067021381940083808024384402885422258545946243513996</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a><a href="#__codelineno-67-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="mi">112016152270171196606652761990170033221036025260883289104273504703557624964071464062375228351458191745141525003775876044271210498526920529385038130932141551598616579917681815276713386113932345056134302042399379895915706991873687943357627747262597883603999621939794450743982662393955266685255577026078256473601</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a><a href="#__codelineno-67-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><a href="#__codelineno-67-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">pbits</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a><a href="#__codelineno-67-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-67-11" name="__codelineno-67-11"></a><a href="#__codelineno-67-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">p_high</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">&gt;&gt;</span> <span class="mi">256</span>
<a id="__codelineno-67-12" name="__codelineno-67-12"></a><a href="#__codelineno-67-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-67-13" name="__codelineno-67-13"></a><a href="#__codelineno-67-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">p_high</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>            <span class="c1">#这里需要先爆破8位，使得知道264位以后再恢复p</span>
<a id="__codelineno-67-14" name="__codelineno-67-14"></a><a href="#__codelineno-67-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">p4</span> <span class="o">+</span> <span class="n">i</span>
<a id="__codelineno-67-15" name="__codelineno-67-15"></a><a href="#__codelineno-67-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">kbits</span> <span class="o">=</span> <span class="n">pbits</span> <span class="o">-</span> <span class="n">p4</span><span class="o">.</span><span class="n">nbits</span><span class="p">()</span>
<a id="__codelineno-67-16" name="__codelineno-67-16"></a><a href="#__codelineno-67-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">p4</span> <span class="o">=</span> <span class="n">p4</span> <span class="o">&lt;&lt;</span> <span class="n">kbits</span>
<a id="__codelineno-67-17" name="__codelineno-67-17"></a><a href="#__codelineno-67-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-67-18" name="__codelineno-67-18"></a><a href="#__codelineno-67-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">p4</span>
<a id="__codelineno-67-19" name="__codelineno-67-19"></a><a href="#__codelineno-67-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="o">^</span><span class="n">kbits</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-67-20" name="__codelineno-67-20"></a><a href="#__codelineno-67-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-67-21" name="__codelineno-67-21"></a><a href="#__codelineno-67-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">p4</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-67-22" name="__codelineno-67-22"></a><a href="#__codelineno-67-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-67-23" name="__codelineno-67-23"></a><a href="#__codelineno-67-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-67-24" name="__codelineno-67-24"></a><a href="#__codelineno-67-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-67-25" name="__codelineno-67-25"></a><a href="#__codelineno-67-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
<a id="__codelineno-67-26" name="__codelineno-67-26"></a><a href="#__codelineno-67-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="k">break</span>
<a id="__codelineno-67-27" name="__codelineno-67-27"></a><a href="#__codelineno-67-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-67-28" name="__codelineno-67-28"></a><a href="#__codelineno-67-28"><span class="linenos" data-linenos="28 "></span></a><span class="c1">#LitCTF{oh!!!!coppersmith_is_fun}</span>
</code></pre></div>
<h3 id="3_3">例题3<a class="headerlink" href="#3_3" title="Permanent link">&para;</a></h3>
<p>有些题目不一定给出高位，还有可能给出低位，甚至给出部分高位和部分低位。其本质是一样的，我们只需要改变多项式即可</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><a href="#__codelineno-68-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><a href="#__codelineno-68-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><a href="#__codelineno-68-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><a href="#__codelineno-68-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><a href="#__codelineno-68-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a><a href="#__codelineno-68-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><a href="#__codelineno-68-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p0</span> <span class="o">=</span> <span class="n">p</span> <span class="o">^</span> <span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">444</span><span class="p">)</span>     
<a id="__codelineno-68-8" name="__codelineno-68-8"></a><a href="#__codelineno-68-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a><a href="#__codelineno-68-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">65537</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a><a href="#__codelineno-68-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a><a href="#__codelineno-68-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c=&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a><a href="#__codelineno-68-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;N=&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a><a href="#__codelineno-68-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p0=&#39;</span><span class="p">,</span><span class="n">p0</span><span class="p">)</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a><a href="#__codelineno-68-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a><a href="#__codelineno-68-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a><a href="#__codelineno-68-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1">## 54   </span>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a><a href="#__codelineno-68-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">## c= 6187845844052645335477666563187579997555293403110620879123121166924703361821847984760733842049752886698011561451715570810292323756091403783920480396052120046379755571530451812078574368413924390017994278703794257118954968480994077586245800902748815905644287545189605031883291488844527496906890127546594960138582150272568163575590734246290813150131949296550974206595456421136190026954855755623761557179760444906148376433584795779131477110538212742401420633087881506416368853221110426491868881029814841479615979710066371796507692025126150957315754738584387325388998533227577023142894876376702128870643448600352603905149</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a><a href="#__codelineno-68-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">## N= 14195810221536708489210274086946022255792382922322850338983263099316341767896809249586174293795778082892237356582757544364274847341220303582304283372889068290282580493623042441421715338444710303281638639785784613434328659529884972238348336971186339482788748316527376410510261228354155806341136524162787121212184386900663470590652770503564816948407257603737938414126069053610568675347826390537145556511048774030823322301932088595499671755944744816524811272617200683384649389274196659297432212847319503330409792704612575414010711158873031786577877685578976140462539734553598745329712188216200905451774357282278403189943</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a><a href="#__codelineno-68-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">## p0= 111984935426070810628244029907949697819351004665202173622240566580193974673163315128983603277856218378729883402496424467491406698035050254407170555432448523469880166015507303737468316933545613178461925283040643344197452758878116752692499745309765526523083790825015522124083482964296662782850606081657447935191</span>
</code></pre></div>
<p>因为m左移444位，这样子m后面444位都是0，所以异或之后，不影响p低位444值</p>
<p>根据flag长度是54，转成int数据就432bit，左移444位后是876位，异或之后，p的高(1024 - 876) = 148位也是不变的。所以我们有了p的部分高位和低位</p>
<p>还是利用coppersmith，改个多项式即可</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><a href="#__codelineno-69-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><a href="#__codelineno-69-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><a href="#__codelineno-69-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><a href="#__codelineno-69-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p0</span> <span class="o">=</span> <span class="mi">111984935426070810628244029907949697819351004665202173622240566580193974673163315128983603277856218378729883402496424467491406698035050254407170555432448523469880166015507303737468316933545613178461925283040643344197452758878116752692499745309765526523083790825015522124083482964296662782850606081657447935191</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><a href="#__codelineno-69-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">6187845844052645335477666563187579997555293403110620879123121166924703361821847984760733842049752886698011561451715570810292323756091403783920480396052120046379755571530451812078574368413924390017994278703794257118954968480994077586245800902748815905644287545189605031883291488844527496906890127546594960138582150272568163575590734246290813150131949296550974206595456421136190026954855755623761557179760444906148376433584795779131477110538212742401420633087881506416368853221110426491868881029814841479615979710066371796507692025126150957315754738584387325388998533227577023142894876376702128870643448600352603905149</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a><a href="#__codelineno-69-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">14195810221536708489210274086946022255792382922322850338983263099316341767896809249586174293795778082892237356582757544364274847341220303582304283372889068290282580493623042441421715338444710303281638639785784613434328659529884972238348336971186339482788748316527376410510261228354155806341136524162787121212184386900663470590652770503564816948407257603737938414126069053610568675347826390537145556511048774030823322301932088595499671755944744816524811272617200683384649389274196659297432212847319503330409792704612575414010711158873031786577877685578976140462539734553598745329712188216200905451774357282278403189943</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a><a href="#__codelineno-69-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a><a href="#__codelineno-69-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a><a href="#__codelineno-69-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">phigh</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">&gt;&gt;</span> <span class="mi">876</span> <span class="o">&lt;&lt;</span><span class="mi">876</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a><a href="#__codelineno-69-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">tmp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;1&quot;</span> <span class="o">*</span> <span class="mi">444</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a><a href="#__codelineno-69-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">plow</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">&amp;</span> <span class="n">tmp</span>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a><a href="#__codelineno-69-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a><a href="#__codelineno-69-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a><a href="#__codelineno-69-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a><a href="#__codelineno-69-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">phigh</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="mi">444</span> <span class="o">+</span> <span class="n">plow</span>
<a id="__codelineno-69-16" name="__codelineno-69-16"></a><a href="#__codelineno-69-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-69-17" name="__codelineno-69-17"></a><a href="#__codelineno-69-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="o">^</span><span class="mi">432</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<a id="__codelineno-69-18" name="__codelineno-69-18"></a><a href="#__codelineno-69-18"><span class="linenos" data-linenos="18 "></span></a><span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-69-19" name="__codelineno-69-19"></a><a href="#__codelineno-69-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">phigh</span> <span class="o">+</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">**</span><span class="mi">444</span><span class="o">+</span><span class="n">plow</span><span class="p">)</span>
<a id="__codelineno-69-20" name="__codelineno-69-20"></a><a href="#__codelineno-69-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p =&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-69-21" name="__codelineno-69-21"></a><a href="#__codelineno-69-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-69-22" name="__codelineno-69-22"></a><a href="#__codelineno-69-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-69-23" name="__codelineno-69-23"></a><a href="#__codelineno-69-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-69-24" name="__codelineno-69-24"></a><a href="#__codelineno-69-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
</code></pre></div>
<h2 id="d">十六、d低位泄露<a class="headerlink" href="#d" title="Permanent link">&para;</a></h2>
<p>攻击条件:e在可爆破范围，并且已知d的低位</p>
<p>推导:</p>
<div class="arithmatex">\[
\because ed \equiv 1 \mod \phi(n)
\]</div>
<div class="arithmatex">\[
\therefore ed = k(p-1)(q-1) + 1
\]</div>
<p>即</p>
<div class="arithmatex">\[
ed = kn - kp - kq + k + 1
\]</div>
<p>假设我们知道d的低L位，并且记为<span class="arithmatex">\(d_{low}\)</span>，我们对上式同模<span class="arithmatex">\(2^L\)</span>，于是有</p>
<div class="arithmatex">\[
ed_{low} \equiv kn - kp - kq + k + 1 \mod 2^L
\]</div>
<p>两边同时乘上p得到</p>
<div class="arithmatex">\[
ed_{low} \equiv knp -kp^2 - kn +(k+1)p \mod 2^L
\]</div>
<p>此时上式只有k和p是未知的，因为<span class="arithmatex">\(0 &lt; k &lt; e\)</span>，所以可对k进行爆破，解同余式得到p的低位，再用coppersmith恢复p</p>
<h3 id="_26">例题<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><a href="#__codelineno-70-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><a href="#__codelineno-70-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><a href="#__codelineno-70-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><a href="#__codelineno-70-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><a href="#__codelineno-70-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a><a href="#__codelineno-70-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a><a href="#__codelineno-70-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a><a href="#__codelineno-70-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a><a href="#__codelineno-70-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-70-10" name="__codelineno-70-10"></a><a href="#__codelineno-70-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-70-11" name="__codelineno-70-11"></a><a href="#__codelineno-70-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">phi_n</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-70-12" name="__codelineno-70-12"></a><a href="#__codelineno-70-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-70-13" name="__codelineno-70-13"></a><a href="#__codelineno-70-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">if</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-70-14" name="__codelineno-70-14"></a><a href="#__codelineno-70-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="k">break</span>
<a id="__codelineno-70-15" name="__codelineno-70-15"></a><a href="#__codelineno-70-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-70-16" name="__codelineno-70-16"></a><a href="#__codelineno-70-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">phi_n</span><span class="p">)</span>
<a id="__codelineno-70-17" name="__codelineno-70-17"></a><a href="#__codelineno-70-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">d1</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">486</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-70-18" name="__codelineno-70-18"></a><a href="#__codelineno-70-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-70-19" name="__codelineno-70-19"></a><a href="#__codelineno-70-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n =&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-70-20" name="__codelineno-70-20"></a><a href="#__codelineno-70-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e =&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-70-21" name="__codelineno-70-21"></a><a href="#__codelineno-70-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c =&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-70-22" name="__codelineno-70-22"></a><a href="#__codelineno-70-22"><span class="linenos" data-linenos="22 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dlow =&quot;</span><span class="p">,</span> <span class="n">d1</span><span class="p">)</span>
<a id="__codelineno-70-23" name="__codelineno-70-23"></a><a href="#__codelineno-70-23"><span class="linenos" data-linenos="23 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-70-24" name="__codelineno-70-24"></a><a href="#__codelineno-70-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">n = 52742121495363456830645578439066440260525635701449452038623040460534514676940962601979528301396249463310635013618692939847284377316096998174539886900202801371512846078230196507601167693580439935790730812348102969592553942497201279143623565409782692807615767067494338127711608771029145341503069929345973282553</span>
<a id="__codelineno-70-25" name="__codelineno-70-25"></a><a href="#__codelineno-70-25"><span class="linenos" data-linenos="25 "></span></a><span class="sd">e = 3</span>
<a id="__codelineno-70-26" name="__codelineno-70-26"></a><a href="#__codelineno-70-26"><span class="linenos" data-linenos="26 "></span></a><span class="sd">c = 175676150266403096249431407570554929021369604168136874268275844375181688894753012319267533769923727863698572157250017689244151605424698000831986135513112136594197978237874400825236288135820643994889528170234514127521418132167932446836545721803621236277931291609749528037915073270452302613264065194049125</span>
<a id="__codelineno-70-27" name="__codelineno-70-27"></a><a href="#__codelineno-70-27"><span class="linenos" data-linenos="27 "></span></a><span class="sd">dlow = 8681746171122274095992828774600905650260279086049883317863420271848455130773826835383939352151607850521826888046119078445911475580784484455485323</span>
<a id="__codelineno-70-28" name="__codelineno-70-28"></a><a href="#__codelineno-70-28"><span class="linenos" data-linenos="28 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><a href="#__codelineno-71-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">long_to_bytes</span><span class="p">,</span><span class="n">inverse</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><a href="#__codelineno-71-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><a href="#__codelineno-71-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><a href="#__codelineno-71-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">52742121495363456830645578439066440260525635701449452038623040460534514676940962601979528301396249463310635013618692939847284377316096998174539886900202801371512846078230196507601167693580439935790730812348102969592553942497201279143623565409782692807615767067494338127711608771029145341503069929345973282553</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a><a href="#__codelineno-71-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a><a href="#__codelineno-71-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">175676150266403096249431407570554929021369604168136874268275844375181688894753012319267533769923727863698572157250017689244151605424698000831986135513112136594197978237874400825236288135820643994889528170234514127521418132167932446836545721803621236277931291609749528037915073270452302613264065194049125</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a><a href="#__codelineno-71-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">dlow</span> <span class="o">=</span> <span class="mi">8681746171122274095992828774600905650260279086049883317863420271848455130773826835383939352151607850521826888046119078445911475580784484455485323</span>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a><a href="#__codelineno-71-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a><a href="#__codelineno-71-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_full_p</span><span class="p">(</span><span class="n">p_low</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">pbits</span><span class="p">):</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a><a href="#__codelineno-71-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">kbits</span> <span class="o">=</span> <span class="n">p_low</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a><a href="#__codelineno-71-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-71-12" name="__codelineno-71-12"></a><a href="#__codelineno-71-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="o">^</span><span class="n">kbits</span> <span class="o">+</span> <span class="n">p_low</span>
<a id="__codelineno-71-13" name="__codelineno-71-13"></a><a href="#__codelineno-71-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-71-14" name="__codelineno-71-14"></a><a href="#__codelineno-71-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">pbits</span><span class="o">-</span><span class="n">kbits</span><span class="p">),</span><span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<a id="__codelineno-71-15" name="__codelineno-71-15"></a><a href="#__codelineno-71-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-71-16" name="__codelineno-71-16"></a><a href="#__codelineno-71-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="o">^</span><span class="n">kbits</span> <span class="o">+</span> <span class="n">p_low</span>
<a id="__codelineno-71-17" name="__codelineno-71-17"></a><a href="#__codelineno-71-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">return</span> <span class="n">p</span>
<a id="__codelineno-71-18" name="__codelineno-71-18"></a><a href="#__codelineno-71-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-71-19" name="__codelineno-71-19"></a><a href="#__codelineno-71-19"><span class="linenos" data-linenos="19 "></span></a><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-71-20" name="__codelineno-71-20"></a><a href="#__codelineno-71-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">var</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<a id="__codelineno-71-21" name="__codelineno-71-21"></a><a href="#__codelineno-71-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">f1</span> <span class="o">=</span> <span class="n">e</span><span class="o">*</span><span class="n">dlow</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">p</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-71-22" name="__codelineno-71-22"></a><a href="#__codelineno-71-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">roots</span> <span class="o">=</span> <span class="n">solve_mod</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">486</span><span class="p">)</span>
<a id="__codelineno-71-23" name="__codelineno-71-23"></a><a href="#__codelineno-71-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">if</span> <span class="n">roots</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-71-24" name="__codelineno-71-24"></a><a href="#__codelineno-71-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
<a id="__codelineno-71-25" name="__codelineno-71-25"></a><a href="#__codelineno-71-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">486</span><span class="p">:</span>
<a id="__codelineno-71-26" name="__codelineno-71-26"></a><a href="#__codelineno-71-26"><span class="linenos" data-linenos="26 "></span></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">get_full_p</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">n</span><span class="p">,</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-71-27" name="__codelineno-71-27"></a><a href="#__codelineno-71-27"><span class="linenos" data-linenos="27 "></span></a>                <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
<a id="__codelineno-71-28" name="__codelineno-71-28"></a><a href="#__codelineno-71-28"><span class="linenos" data-linenos="28 "></span></a>                    <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-71-29" name="__codelineno-71-29"></a><a href="#__codelineno-71-29"><span class="linenos" data-linenos="29 "></span></a>                    <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="mi">3</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-71-30" name="__codelineno-71-30"></a><a href="#__codelineno-71-30"><span class="linenos" data-linenos="30 "></span></a>                    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-71-31" name="__codelineno-71-31"></a><a href="#__codelineno-71-31"><span class="linenos" data-linenos="31 "></span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-71-32" name="__codelineno-71-32"></a><a href="#__codelineno-71-32"><span class="linenos" data-linenos="32 "></span></a>                    <span class="k">break</span>
</code></pre></div>
<h3 id="2023badrsa">2023强网拟态决赛——BadRSA<a class="headerlink" href="#2023badrsa" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><a href="#__codelineno-72-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><a href="#__codelineno-72-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><a href="#__codelineno-72-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag.txt&#39;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><a href="#__codelineno-72-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a><a href="#__codelineno-72-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a><a href="#__codelineno-72-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><a href="#__codelineno-72-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a><a href="#__codelineno-72-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a><a href="#__codelineno-72-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a><a href="#__codelineno-72-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a><a href="#__codelineno-72-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a><a href="#__codelineno-72-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">265</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-72-13" name="__codelineno-72-13"></a><a href="#__codelineno-72-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-72-14" name="__codelineno-72-14"></a><a href="#__codelineno-72-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-72-15" name="__codelineno-72-15"></a><a href="#__codelineno-72-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;leak = </span><span class="si">{</span><span class="n">leak</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-72-16" name="__codelineno-72-16"></a><a href="#__codelineno-72-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-72-17" name="__codelineno-72-17"></a><a href="#__codelineno-72-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-72-18" name="__codelineno-72-18"></a><a href="#__codelineno-72-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-72-19" name="__codelineno-72-19"></a><a href="#__codelineno-72-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-72-20" name="__codelineno-72-20"></a><a href="#__codelineno-72-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-72-21" name="__codelineno-72-21"></a><a href="#__codelineno-72-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">e = 149</span>
<a id="__codelineno-72-22" name="__codelineno-72-22"></a><a href="#__codelineno-72-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">leak = 6001958312144157007304943931113872134090201010357773442954181100786589106572169</span>
<a id="__codelineno-72-23" name="__codelineno-72-23"></a><a href="#__codelineno-72-23"><span class="linenos" data-linenos="23 "></span></a><span class="sd">n = 88436063749749362190546240596734626745594171540325086418270903156390958817492063940459108934841028734921718351342152598224670602551497995639921650979296052943953491639892805985538785565357751736799561653032725751622522198746331856539251721033316195306373318196300612386897339425222615697620795751869751705629</span>
<a id="__codelineno-72-24" name="__codelineno-72-24"></a><a href="#__codelineno-72-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">c = 1206332017436789083799133504302957634035030644841294494992108068042941783794804420630684301945366528832108224264145563741764232409333108261614056154508904583078897178425071831580459193200987943565099780857889864631160747321901113496943710282498262354984634755751858251005566753245882185271726628553508627299</span>
<a id="__codelineno-72-25" name="__codelineno-72-25"></a><a href="#__codelineno-72-25"><span class="linenos" data-linenos="25 "></span></a><span class="sd">&#39;&#39;&#39;</span>
</code></pre></div>
<p>由<span class="arithmatex">\(ed \equiv 1 \mod \phi(n)\)</span></p>
<p>即<span class="arithmatex">\(ed = k(p-1)(q-1) + 1\)</span></p>
<p>两边同时模<span class="arithmatex">\(2^{265}\)</span>，得<span class="arithmatex">\(ed_0 \equiv k(p-1)(q-1) + 1 \mod 2^{265}\)</span>，这里<span class="arithmatex">\(d_0 = leak\)</span></p>
<p><span class="arithmatex">\(\therefore ed_0 \equiv k(pq - p - q + 1) + 1 \mod 2^{265}\)</span></p>
<p>再同乘<span class="arithmatex">\(p\)</span>，得到<span class="arithmatex">\(ed_0p \equiv knp - kp^2 - kn + kp + p \mod 2^{265}\)</span></p>
<p>因为<span class="arithmatex">\(d \approx 1023bit\)</span></p>
<p>所以<span class="arithmatex">\(k &lt; e\)</span></p>
<p>爆破<span class="arithmatex">\(k\)</span>，解方程得到<span class="arithmatex">\(p\)</span>的低位，然后用copper恢复<span class="arithmatex">\(p\)</span></p>
<p>要调copper的参数，解方程得到的只有<span class="arithmatex">\(p\)</span>的低265位,还差247位</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><a href="#__codelineno-73-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><a href="#__codelineno-73-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><a href="#__codelineno-73-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a><a href="#__codelineno-73-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">149</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><a href="#__codelineno-73-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">d0</span> <span class="o">=</span> <span class="mi">6001958312144157007304943931113872134090201010357773442954181100786589106572169</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a><a href="#__codelineno-73-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">88436063749749362190546240596734626745594171540325086418270903156390958817492063940459108934841028734921718351342152598224670602551497995639921650979296052943953491639892805985538785565357751736799561653032725751622522198746331856539251721033316195306373318196300612386897339425222615697620795751869751705629</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a><a href="#__codelineno-73-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">1206332017436789083799133504302957634035030644841294494992108068042941783794804420630684301945366528832108224264145563741764232409333108261614056154508904583078897178425071831580459193200987943565099780857889864631160747321901113496943710282498262354984634755751858251005566753245882185271726628553508627299</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a><a href="#__codelineno-73-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a><a href="#__codelineno-73-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a><a href="#__codelineno-73-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">var</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a><a href="#__codelineno-73-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">temp</span> <span class="o">=</span> <span class="n">e</span><span class="o">*</span><span class="n">d0</span><span class="o">*</span><span class="n">p</span>
<a id="__codelineno-73-12" name="__codelineno-73-12"></a><a href="#__codelineno-73-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">p</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">p</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">temp</span>  <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-73-13" name="__codelineno-73-13"></a><a href="#__codelineno-73-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-73-14" name="__codelineno-73-14"></a><a href="#__codelineno-73-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">roots</span> <span class="o">=</span> <span class="n">solve_mod</span><span class="p">([</span><span class="n">f</span><span class="p">],</span><span class="mi">2</span><span class="o">^</span><span class="mi">265</span><span class="p">)</span>
<a id="__codelineno-73-15" name="__codelineno-73-15"></a><a href="#__codelineno-73-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">if</span> <span class="n">roots</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-73-16" name="__codelineno-73-16"></a><a href="#__codelineno-73-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
<a id="__codelineno-73-17" name="__codelineno-73-17"></a><a href="#__codelineno-73-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="n">plow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-73-18" name="__codelineno-73-18"></a><a href="#__codelineno-73-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">##             print(plow)</span>
<a id="__codelineno-73-19" name="__codelineno-73-19"></a><a href="#__codelineno-73-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">## 55136429770900518182274612434328885021714880080534773062619965935822096183916139</span>
<a id="__codelineno-73-20" name="__codelineno-73-20"></a><a href="#__codelineno-73-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-73-21" name="__codelineno-73-21"></a><a href="#__codelineno-73-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-73-22" name="__codelineno-73-22"></a><a href="#__codelineno-73-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="n">f1</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="mi">265</span> <span class="o">+</span> <span class="n">plow</span>
<a id="__codelineno-73-23" name="__codelineno-73-23"></a><a href="#__codelineno-73-23"><span class="linenos" data-linenos="23 "></span></a>            <span class="n">f1</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-73-24" name="__codelineno-73-24"></a><a href="#__codelineno-73-24"><span class="linenos" data-linenos="24 "></span></a>            <span class="n">res</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="o">^</span><span class="mi">247</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-73-25" name="__codelineno-73-25"></a><a href="#__codelineno-73-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-73-26" name="__codelineno-73-26"></a><a href="#__codelineno-73-26"><span class="linenos" data-linenos="26 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="__codelineno-73-27" name="__codelineno-73-27"></a><a href="#__codelineno-73-27"><span class="linenos" data-linenos="27 "></span></a>                <span class="c1">## [188210689227294472160085325314952069542671020803828390144430392548173787275]</span>
<a id="__codelineno-73-28" name="__codelineno-73-28"></a><a href="#__codelineno-73-28"><span class="linenos" data-linenos="28 "></span></a>                <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="mi">265</span> <span class="o">+</span> <span class="n">plow</span>
<a id="__codelineno-73-29" name="__codelineno-73-29"></a><a href="#__codelineno-73-29"><span class="linenos" data-linenos="29 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p =&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-73-30" name="__codelineno-73-30"></a><a href="#__codelineno-73-30"><span class="linenos" data-linenos="30 "></span></a>                <span class="c1">## p = 11158174168280917736979570452068827611755694573672250873587467083259280584739528118050085070475912733864211083865201596017044398008278425498714490994488939</span>
<a id="__codelineno-73-31" name="__codelineno-73-31"></a><a href="#__codelineno-73-31"><span class="linenos" data-linenos="31 "></span></a>                <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-73-32" name="__codelineno-73-32"></a><a href="#__codelineno-73-32"><span class="linenos" data-linenos="32 "></span></a>                <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-73-33" name="__codelineno-73-33"></a><a href="#__codelineno-73-33"><span class="linenos" data-linenos="33 "></span></a>                <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-73-34" name="__codelineno-73-34"></a><a href="#__codelineno-73-34"><span class="linenos" data-linenos="34 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
<a id="__codelineno-73-35" name="__codelineno-73-35"></a><a href="#__codelineno-73-35"><span class="linenos" data-linenos="35 "></span></a>                <span class="c1">## flag{827ccb0eea8a706c4c34a16891f84e7b}</span>
<a id="__codelineno-73-36" name="__codelineno-73-36"></a><a href="#__codelineno-73-36"><span class="linenos" data-linenos="36 "></span></a>                <span class="k">break</span>
</code></pre></div>
<p>这里<code>beta = 0.5</code>是因为，对于度（即最大次方）为<span class="arithmatex">\(d\)</span>的多项式，要求根小于<span class="arithmatex">\(n^{\frac{\beta^2}{d} - \epsilon}\)</span>，而且要求因子<span class="arithmatex">\(p &gt; n^{\beta}\)</span></p>
<p>此题<span class="arithmatex">\(d = 1\)</span>，经过计算我们要求的根的上界为<span class="arithmatex">\(2^{247}\)</span>，<span class="arithmatex">\(\frac{247}{1024} = 0.2412\)</span>，所以取<code>beta = 0.5</code>可以恢复p。界这个东西感觉有点玄学，只能多做题多感受了</p>
<h2 id="franklin-reiter">十七、Franklin-Reiter相关消息攻击<a class="headerlink" href="#franklin-reiter" title="Permanent link">&para;</a></h2>
<p>攻击条件:</p>
<p>当Alice使用同一公钥对两个具有线性关系的消息<span class="arithmatex">\(M_1,M_2\)</span>进行加密，并将加密后的消息<span class="arithmatex">\(C_1,C_2\)</span>发送给了Bob，我们就可能可以获得对应的消息<span class="arithmatex">\(M_1,M_2\)</span>。假设模数为<span class="arithmatex">\(N\)</span>，<span class="arithmatex">\(M_1,M_2\)</span>的线性关系如下：</p>
<p><span class="arithmatex">\(M_1 \equiv f(M_2) \mod N\)</span></p>
<p>其中<span class="arithmatex">\(f\)</span>为一个线性函数，比如<span class="arithmatex">\(f = ax+b\)</span></p>
<p>存脚本就好了</p>
<h3 id="1_10">例题1<a class="headerlink" href="#1_10" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><a href="#__codelineno-74-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><a href="#__codelineno-74-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><a href="#__codelineno-74-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><a href="#__codelineno-74-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m1</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><a href="#__codelineno-74-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span><span class="o">*</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a><a href="#__codelineno-74-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">17</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><a href="#__codelineno-74-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><a href="#__codelineno-74-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a><a href="#__codelineno-74-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a><a href="#__codelineno-74-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">getRandomNBitInteger</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a><a href="#__codelineno-74-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">getRandomNBitInteger</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a><a href="#__codelineno-74-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">m2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">b</span>
<a id="__codelineno-74-13" name="__codelineno-74-13"></a><a href="#__codelineno-74-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-74-14" name="__codelineno-74-14"></a><a href="#__codelineno-74-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-74-15" name="__codelineno-74-15"></a><a href="#__codelineno-74-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-74-16" name="__codelineno-74-16"></a><a href="#__codelineno-74-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-74-17" name="__codelineno-74-17"></a><a href="#__codelineno-74-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">## 51296885372346449295388453471330409021784141081351581975478435681552082076338697136130122011636685327781785488670769096434920591920054441921039812310126089859349902066456998315283909435249794317277620588552441456327265553018986591779396701680997794937951231970194353001576159809798153970829987274504038146741</span>
<a id="__codelineno-74-18" name="__codelineno-74-18"></a><a href="#__codelineno-74-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">## 13256631249970000274738888132534852767685499642889351632072622194777502848070957827974250425805779856662241409663031192870528911932663995606616763982320967</span>
<a id="__codelineno-74-19" name="__codelineno-74-19"></a><a href="#__codelineno-74-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">## 12614470377409090738391280373352373943201882741276992121990944593827605866548572392808272414120477304486154096358852845785437999246453926812759725932442170</span>
<a id="__codelineno-74-20" name="__codelineno-74-20"></a><a href="#__codelineno-74-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">## 18617698095122597355752178584860764221736156139844401400942959000560180868595058572264330257490645079792321778926462300410653970722619332098601515399526245808718518153518824404167374361098424325296872587362792839831578589407441739040578339310283844080111189381106274103089079702496168766831316853664552253142</span>
<a id="__codelineno-74-21" name="__codelineno-74-21"></a><a href="#__codelineno-74-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1">## 14091361528414093900688440242152327115109256507133728799758289918462970724109343410464537203689727409590796472177295835710571700501895484300979622506298961999001641059179449655629481072402234965831697915939034769804437452528921599125823412464950939837343822566667533463393026895985173157447434429906021792720</span>
</code></pre></div>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><a href="#__codelineno-75-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><a href="#__codelineno-75-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><a href="#__codelineno-75-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">51296885372346449295388453471330409021784141081351581975478435681552082076338697136130122011636685327781785488670769096434920591920054441921039812310126089859349902066456998315283909435249794317277620588552441456327265553018986591779396701680997794937951231970194353001576159809798153970829987274504038146741</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><a href="#__codelineno-75-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="mi">13256631249970000274738888132534852767685499642889351632072622194777502848070957827974250425805779856662241409663031192870528911932663995606616763982320967</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a><a href="#__codelineno-75-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="mi">12614470377409090738391280373352373943201882741276992121990944593827605866548572392808272414120477304486154096358852845785437999246453926812759725932442170</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><a href="#__codelineno-75-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="mi">18617698095122597355752178584860764221736156139844401400942959000560180868595058572264330257490645079792321778926462300410653970722619332098601515399526245808718518153518824404167374361098424325296872587362792839831578589407441739040578339310283844080111189381106274103089079702496168766831316853664552253142</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a><a href="#__codelineno-75-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="mi">14091361528414093900688440242152327115109256507133728799758289918462970724109343410464537203689727409590796472177295835710571700501895484300979622506298961999001641059179449655629481072402234965831697915939034769804437452528921599125823412464950939837343822566667533463393026895985173157447434429906021792720</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><a href="#__codelineno-75-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">17</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a><a href="#__codelineno-75-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a><a href="#__codelineno-75-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">franklinReiter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a><a href="#__codelineno-75-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">PR</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a><a href="#__codelineno-75-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">g1</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c1</span>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a><a href="#__codelineno-75-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c2</span>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a><a href="#__codelineno-75-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a><a href="#__codelineno-75-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gcd</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a><a href="#__codelineno-75-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">while</span> <span class="n">g2</span><span class="p">:</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a><a href="#__codelineno-75-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span> <span class="o">%</span> <span class="n">g2</span>
<a id="__codelineno-75-18" name="__codelineno-75-18"></a><a href="#__codelineno-75-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="k">return</span> <span class="n">g1</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span> 
<a id="__codelineno-75-19" name="__codelineno-75-19"></a><a href="#__codelineno-75-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">return</span> <span class="o">-</span><span class="n">gcd</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-75-20" name="__codelineno-75-20"></a><a href="#__codelineno-75-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-75-21" name="__codelineno-75-21"></a><a href="#__codelineno-75-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">franklinReiter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-75-22" name="__codelineno-75-22"></a><a href="#__codelineno-75-22"><span class="linenos" data-linenos="22 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">libnum</span><span class="o">.</span><span class="n">n2s</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
</code></pre></div>
<h3 id="2sictfround2">例题2——SICTFround2 签到题来咯<a class="headerlink" href="#2sictfround2" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><a href="#__codelineno-76-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><a href="#__codelineno-76-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w">  </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><a href="#__codelineno-76-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><a href="#__codelineno-76-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a><a href="#__codelineno-76-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a><a href="#__codelineno-76-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a><a href="#__codelineno-76-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a><a href="#__codelineno-76-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a><a href="#__codelineno-76-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">114</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="mi">2333</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a><a href="#__codelineno-76-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">514</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="mi">4555</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><a href="#__codelineno-76-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a><a href="#__codelineno-76-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c1 = </span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a><a href="#__codelineno-76-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c2 = </span><span class="si">{</span><span class="n">c2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a><a href="#__codelineno-76-14"><span class="linenos" data-linenos="14 "></span></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a><a href="#__codelineno-76-15"><span class="linenos" data-linenos="15 "></span></a><span class="sd">n = 18993579800590288733556762316465854395650778003397512624355925069287661487515652428099677335464809283955351330659278915073219733930542167360381688856732762552737791137784222098296804826261681852699742456526979985201331982720936091963830799430264680941164508709453794113576607749669278887105809727027129736803614327631979056934906547015919204770702496676692691248702461766117271815398943842909579917102217310779431999448597899109808086655029624478062317317442297276087073653945439820988375066353157221370129064423613949039895822016206336117081475698987326594199181180346821431242733826487765566154350269651592993856883</span>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a><a href="#__codelineno-76-16"><span class="linenos" data-linenos="16 "></span></a><span class="sd">c1 = 3089900890429368903963127778258893993015616003863275300568951378177309984878857933740319974151823410060583527905656182419531008417050246901514691111335764182779077027419410717272164998075313101695833565450587029584857433998627248705518025411896438130004108810308599666206694770859843696952378804678690327442746359836105117371144846629293505396610982407985241783168161504309420302314102538231774470927864959064261347913286659384383565379900391857812482728653358741387072374314243068833590379370244368317200796927931678203916569721211768082289529948017340699194622234734381555103898784827642197721866114583358940604520</span>
<a id="__codelineno-76-17" name="__codelineno-76-17"></a><a href="#__codelineno-76-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">c2 = 6062491672599671503583327431533992487890060173533816222838721749216161789662841049274959778509684968479022417053571624473283543736981267659104310293237792925201009775193492423025040929132360886500863823523629213703533794348606076463773478200331006341206053010168741302440409050344170767489936681627020501853981450212305108039373119567034948781143698613084550376070802084805644270376620484786155554275798939105737707005991882264123315436368611647275530607811665999620394422672764116158492214128572456571553281799359243174598812137554860109807481900330449364878168308833006964726761878461761560543284533578701661413931</span>
<a id="__codelineno-76-18" name="__codelineno-76-18"></a><a href="#__codelineno-76-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">&#39;&#39;&#39;</span>
</code></pre></div>
<p>本题未知e，爆破一下e即可</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><a href="#__codelineno-77-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">## sage</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><a href="#__codelineno-77-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><a href="#__codelineno-77-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><a href="#__codelineno-77-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a><a href="#__codelineno-77-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> 
<a id="__codelineno-77-6" name="__codelineno-77-6"></a><a href="#__codelineno-77-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c1</span> <span class="o">=</span> 
<a id="__codelineno-77-7" name="__codelineno-77-7"></a><a href="#__codelineno-77-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c2</span> <span class="o">=</span> 
<a id="__codelineno-77-8" name="__codelineno-77-8"></a><a href="#__codelineno-77-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">E</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a><a href="#__codelineno-77-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a><a href="#__codelineno-77-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a><a href="#__codelineno-77-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
<a id="__codelineno-77-12" name="__codelineno-77-12"></a><a href="#__codelineno-77-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">E</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-77-13" name="__codelineno-77-13"></a><a href="#__codelineno-77-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-77-14" name="__codelineno-77-14"></a><a href="#__codelineno-77-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">franklinReiter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">):</span>
<a id="__codelineno-77-15" name="__codelineno-77-15"></a><a href="#__codelineno-77-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">PR</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-77-16" name="__codelineno-77-16"></a><a href="#__codelineno-77-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">g1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">114</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2333</span><span class="p">)</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c1</span>
<a id="__codelineno-77-17" name="__codelineno-77-17"></a><a href="#__codelineno-77-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">514</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4555</span><span class="p">)</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c2</span>
<a id="__codelineno-77-18" name="__codelineno-77-18"></a><a href="#__codelineno-77-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-77-19" name="__codelineno-77-19"></a><a href="#__codelineno-77-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gcd</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">):</span>
<a id="__codelineno-77-20" name="__codelineno-77-20"></a><a href="#__codelineno-77-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">while</span> <span class="n">g2</span><span class="p">:</span>
<a id="__codelineno-77-21" name="__codelineno-77-21"></a><a href="#__codelineno-77-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span> <span class="o">%</span> <span class="n">g2</span>
<a id="__codelineno-77-22" name="__codelineno-77-22"></a><a href="#__codelineno-77-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="k">return</span> <span class="n">g1</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-77-23" name="__codelineno-77-23"></a><a href="#__codelineno-77-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="k">return</span> <span class="o">-</span><span class="n">gcd</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-77-24" name="__codelineno-77-24"></a><a href="#__codelineno-77-24"><span class="linenos" data-linenos="24 "></span></a>
<a id="__codelineno-77-25" name="__codelineno-77-25"></a><a href="#__codelineno-77-25"><span class="linenos" data-linenos="25 "></span></a><span class="c1">## print(E)</span>
<a id="__codelineno-77-26" name="__codelineno-77-26"></a><a href="#__codelineno-77-26"><span class="linenos" data-linenos="26 "></span></a><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">E</span><span class="p">:</span>
<a id="__codelineno-77-27" name="__codelineno-77-27"></a><a href="#__codelineno-77-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">franklinReiter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span>
<a id="__codelineno-77-28" name="__codelineno-77-28"></a><a href="#__codelineno-77-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-77-29" name="__codelineno-77-29"></a><a href="#__codelineno-77-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;SICTF&#39;</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
<a id="__codelineno-77-30" name="__codelineno-77-30"></a><a href="#__codelineno-77-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-77-31" name="__codelineno-77-31"></a><a href="#__codelineno-77-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="k">break</span>
<a id="__codelineno-77-32" name="__codelineno-77-32"></a><a href="#__codelineno-77-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-77-33" name="__codelineno-77-33"></a><a href="#__codelineno-77-33"><span class="linenos" data-linenos="33 "></span></a>        <span class="k">continue</span>
</code></pre></div>
<h3 id="32023-rsa3">例题3——2023领航杯 RSA3<a class="headerlink" href="#32023-rsa3" title="Permanent link">&para;</a></h3>
<p>在前面的例子中，加密指数都不太大，脚本运行起来都算快。接下来这道例题，加密指数e为65537，如果不使用更优的方法，会很浪费时间</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><a href="#__codelineno-78-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><a href="#__codelineno-78-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><a href="#__codelineno-78-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><a href="#__codelineno-78-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p1</span><span class="p">,</span> <span class="n">q1</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a><a href="#__codelineno-78-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="n">p1</span><span class="o">*</span><span class="n">q1</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a><a href="#__codelineno-78-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a><a href="#__codelineno-78-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a><a href="#__codelineno-78-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p2</span><span class="p">,</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a><a href="#__codelineno-78-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n2</span> <span class="o">=</span> <span class="n">p2</span><span class="o">*</span><span class="n">q2</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a><a href="#__codelineno-78-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a><a href="#__codelineno-78-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n1 = </span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a><a href="#__codelineno-78-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n2 = </span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a><a href="#__codelineno-78-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c1 = </span><span class="si">{</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-78-14" name="__codelineno-78-14"></a><a href="#__codelineno-78-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c2 = </span><span class="si">{</span><span class="nb">pow</span><span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-78-15" name="__codelineno-78-15"></a><a href="#__codelineno-78-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-78-16" name="__codelineno-78-16"></a><a href="#__codelineno-78-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1">## n1 = 52579135273678950581073020233998071974221658902576724000130040488018033110534210901239397446395736563148970863970460542205225993317478251099451639165369081820130823165642873594136020122857712288395352930384057524510346112486008850200845915783772351449146183974239444691330777565342525218070680067550270554767</span>
<a id="__codelineno-78-17" name="__codelineno-78-17"></a><a href="#__codelineno-78-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">## n2 = 68210568831848267339414957973218186686176324296418282565773310695862151827108036984694027795077376921170907068110296451176263520249799154781062517066423984526868547296781709439425857993705489037768605485740968600877866332458671029054092942851472208033494968784822459369206497698469167909174346042658361616469</span>
<a id="__codelineno-78-18" name="__codelineno-78-18"></a><a href="#__codelineno-78-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">## c1 = 42941712708129054668823891960764339394032538100909746015733801598044118605733969558717842106784388091495719003761324737091667431446354282990525549196642753967283958283202592037329821712755519455155110675327321252333824912095517427885925854391047828862338332559137577789387455868761466777370476884779752953853</span>
<a id="__codelineno-78-19" name="__codelineno-78-19"></a><a href="#__codelineno-78-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">## c2 = 62704043252861638895370674827559804184650708692227789532879941590038911799857232898692335429773480889624046167792573885125945511356456073688435911975161053231589019934427151230924004944847291434167067905803180207183209888082275583120633408232749119300200555327883719466349164062163459300518993952046873724005</span>
</code></pre></div>
<p>参考：<a href="https://blog.csdn.net/EI_Captain/article/details/104777528">HALF-GCD算法的阐述_half gcd_Entropy Increaser的博客-CSDN博客</a></p>
<p><a href="https://www.cnblogs.com/whx1003/p/16217087.html">多项式 gcd 的正确姿势：Half-GCD 算法 - whx1003 - 博客园 (cnblogs.com)</a></p>
<p>脚本来源：<a href="https://github.com/rkm0959/rkm0959_implements/blob/main/Half_GCD/code.sage">rkm0959_implements/Half_GCD/code.sage at main · rkm0959/rkm0959_implements (github.com)</a></p>
<p>我们引入使用了HGCD算法的Franklin-Reiter相关消息攻击的脚本</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><a href="#__codelineno-79-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><a href="#__codelineno-79-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><a href="#__codelineno-79-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a><a href="#__codelineno-79-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">HGCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a><a href="#__codelineno-79-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="k">if</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="ow">or</span> <span class="n">a</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a><a href="#__codelineno-79-6"><span class="linenos" data-linenos=" 6 "></span></a>        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a><a href="#__codelineno-79-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a><a href="#__codelineno-79-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">a_top</span><span class="p">,</span> <span class="n">a_bot</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a><a href="#__codelineno-79-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">b_top</span><span class="p">,</span> <span class="n">b_bot</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a><a href="#__codelineno-79-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">R00</span><span class="p">,</span> <span class="n">R01</span><span class="p">,</span> <span class="n">R10</span><span class="p">,</span> <span class="n">R11</span> <span class="o">=</span> <span class="n">HGCD</span><span class="p">(</span><span class="n">a_top</span><span class="p">,</span> <span class="n">b_top</span><span class="p">)</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a><a href="#__codelineno-79-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">R00</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">R01</span> <span class="o">*</span> <span class="n">b</span>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a><a href="#__codelineno-79-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">R10</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">R11</span> <span class="o">*</span> <span class="n">b</span>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a><a href="#__codelineno-79-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">q</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a><a href="#__codelineno-79-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">d_top</span><span class="p">,</span> <span class="n">d_bot</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a><a href="#__codelineno-79-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">e_top</span><span class="p">,</span> <span class="n">e_bot</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="p">(</span><span class="n">m</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-79-16" name="__codelineno-79-16"></a><a href="#__codelineno-79-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">S00</span><span class="p">,</span> <span class="n">S01</span><span class="p">,</span> <span class="n">S10</span><span class="p">,</span> <span class="n">S11</span> <span class="o">=</span> <span class="n">HGCD</span><span class="p">(</span><span class="n">d_top</span><span class="p">,</span> <span class="n">e_top</span><span class="p">)</span>
<a id="__codelineno-79-17" name="__codelineno-79-17"></a><a href="#__codelineno-79-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">RET00</span> <span class="o">=</span> <span class="n">S01</span> <span class="o">*</span> <span class="n">R00</span> <span class="o">+</span> <span class="p">(</span><span class="n">S00</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S01</span><span class="p">)</span> <span class="o">*</span> <span class="n">R10</span>
<a id="__codelineno-79-18" name="__codelineno-79-18"></a><a href="#__codelineno-79-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">RET01</span> <span class="o">=</span> <span class="n">S01</span> <span class="o">*</span> <span class="n">R01</span> <span class="o">+</span> <span class="p">(</span><span class="n">S00</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S01</span><span class="p">)</span> <span class="o">*</span> <span class="n">R11</span>
<a id="__codelineno-79-19" name="__codelineno-79-19"></a><a href="#__codelineno-79-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">RET10</span> <span class="o">=</span> <span class="n">S11</span> <span class="o">*</span> <span class="n">R00</span> <span class="o">+</span> <span class="p">(</span><span class="n">S10</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S11</span><span class="p">)</span> <span class="o">*</span> <span class="n">R10</span>
<a id="__codelineno-79-20" name="__codelineno-79-20"></a><a href="#__codelineno-79-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">RET11</span> <span class="o">=</span> <span class="n">S11</span> <span class="o">*</span> <span class="n">R01</span> <span class="o">+</span> <span class="p">(</span><span class="n">S10</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">S11</span><span class="p">)</span> <span class="o">*</span> <span class="n">R11</span>
<a id="__codelineno-79-21" name="__codelineno-79-21"></a><a href="#__codelineno-79-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="k">return</span> <span class="n">RET00</span><span class="p">,</span> <span class="n">RET01</span><span class="p">,</span> <span class="n">RET10</span><span class="p">,</span> <span class="n">RET11</span>
<a id="__codelineno-79-22" name="__codelineno-79-22"></a><a href="#__codelineno-79-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-79-23" name="__codelineno-79-23"></a><a href="#__codelineno-79-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">GCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<a id="__codelineno-79-24" name="__codelineno-79-24"></a><a href="#__codelineno-79-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">degree</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">degree</span><span class="p">())</span>
<a id="__codelineno-79-25" name="__codelineno-79-25"></a><a href="#__codelineno-79-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-79-26" name="__codelineno-79-26"></a><a href="#__codelineno-79-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-79-27" name="__codelineno-79-27"></a><a href="#__codelineno-79-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="k">return</span> <span class="n">b</span>
<a id="__codelineno-79-28" name="__codelineno-79-28"></a><a href="#__codelineno-79-28"><span class="linenos" data-linenos="28 "></span></a>    <span class="n">R00</span><span class="p">,</span> <span class="n">R01</span><span class="p">,</span> <span class="n">R10</span><span class="p">,</span> <span class="n">R11</span> <span class="o">=</span> <span class="n">HGCD</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<a id="__codelineno-79-29" name="__codelineno-79-29"></a><a href="#__codelineno-79-29"><span class="linenos" data-linenos="29 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="n">R00</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">R01</span> <span class="o">*</span> <span class="n">b</span>
<a id="__codelineno-79-30" name="__codelineno-79-30"></a><a href="#__codelineno-79-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">R10</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">R11</span> <span class="o">*</span> <span class="n">b</span>
<a id="__codelineno-79-31" name="__codelineno-79-31"></a><a href="#__codelineno-79-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-79-32" name="__codelineno-79-32"></a><a href="#__codelineno-79-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-79-33" name="__codelineno-79-33"></a><a href="#__codelineno-79-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">quo_rem</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-79-34" name="__codelineno-79-34"></a><a href="#__codelineno-79-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-79-35" name="__codelineno-79-35"></a><a href="#__codelineno-79-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="k">return</span> <span class="n">d</span>
<a id="__codelineno-79-36" name="__codelineno-79-36"></a><a href="#__codelineno-79-36"><span class="linenos" data-linenos="36 "></span></a>    <span class="k">return</span> <span class="n">GCD</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a id="__codelineno-79-37" name="__codelineno-79-37"></a><a href="#__codelineno-79-37"><span class="linenos" data-linenos="37 "></span></a>
<a id="__codelineno-79-38" name="__codelineno-79-38"></a><a href="#__codelineno-79-38"><span class="linenos" data-linenos="38 "></span></a><span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">500000</span><span class="p">)</span>
<a id="__codelineno-79-39" name="__codelineno-79-39"></a><a href="#__codelineno-79-39"><span class="linenos" data-linenos="39 "></span></a>
<a id="__codelineno-79-40" name="__codelineno-79-40"></a><a href="#__codelineno-79-40"><span class="linenos" data-linenos="40 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-79-41" name="__codelineno-79-41"></a><a href="#__codelineno-79-41"><span class="linenos" data-linenos="41 "></span></a><span class="n">n1</span> <span class="o">=</span> 
<a id="__codelineno-79-42" name="__codelineno-79-42"></a><a href="#__codelineno-79-42"><span class="linenos" data-linenos="42 "></span></a><span class="n">n2</span> <span class="o">=</span> 
<a id="__codelineno-79-43" name="__codelineno-79-43"></a><a href="#__codelineno-79-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">c1</span> <span class="o">=</span> 
<a id="__codelineno-79-44" name="__codelineno-79-44"></a><a href="#__codelineno-79-44"><span class="linenos" data-linenos="44 "></span></a><span class="n">c2</span> <span class="o">=</span> 
<a id="__codelineno-79-45" name="__codelineno-79-45"></a><a href="#__codelineno-79-45"><span class="linenos" data-linenos="45 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
<a id="__codelineno-79-46" name="__codelineno-79-46"></a><a href="#__codelineno-79-46"><span class="linenos" data-linenos="46 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c1</span>
<a id="__codelineno-79-47" name="__codelineno-79-47"></a><a href="#__codelineno-79-47"><span class="linenos" data-linenos="47 "></span></a><span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">n1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="n">e</span> <span class="o">-</span> <span class="n">c2</span>
<a id="__codelineno-79-48" name="__codelineno-79-48"></a><a href="#__codelineno-79-48"><span class="linenos" data-linenos="48 "></span></a>
<a id="__codelineno-79-49" name="__codelineno-79-49"></a><a href="#__codelineno-79-49"><span class="linenos" data-linenos="49 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">GCD</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>
<a id="__codelineno-79-50" name="__codelineno-79-50"></a><a href="#__codelineno-79-50"><span class="linenos" data-linenos="50 "></span></a>
<a id="__codelineno-79-51" name="__codelineno-79-51"></a><a href="#__codelineno-79-51"><span class="linenos" data-linenos="51 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="o">-</span><span class="n">res</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span><span class="o">.</span><span class="n">coefficients</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-79-52" name="__codelineno-79-52"></a><a href="#__codelineno-79-52"><span class="linenos" data-linenos="52 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-79-53" name="__codelineno-79-53"></a><a href="#__codelineno-79-53"><span class="linenos" data-linenos="53 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-79-54" name="__codelineno-79-54"></a><a href="#__codelineno-79-54"><span class="linenos" data-linenos="54 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-79-55" name="__codelineno-79-55"></a><a href="#__codelineno-79-55"><span class="linenos" data-linenos="55 "></span></a><span class="c1">#CnHongKe{Fr4nkl1n_R31ter_4nd_gcD}</span>
</code></pre></div>
<h2 id="boneh-durfee">十八、Boneh-Durfee攻击<a class="headerlink" href="#boneh-durfee" title="Permanent link">&para;</a></h2>
<p>攻击条件:<span class="arithmatex">\(d &lt; N^{0.292}\)</span></p>
<p>存脚本即可</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><a href="#__codelineno-80-1"><span class="linenos" data-linenos="  1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><a href="#__codelineno-80-2"><span class="linenos" data-linenos="  2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a><a href="#__codelineno-80-3"><span class="linenos" data-linenos="  3 "></span></a>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a><a href="#__codelineno-80-4"><span class="linenos" data-linenos="  4 "></span></a><span class="c1">############################################</span>
<a id="__codelineno-80-5" name="__codelineno-80-5"></a><a href="#__codelineno-80-5"><span class="linenos" data-linenos="  5 "></span></a><span class="c1">## Config</span>
<a id="__codelineno-80-6" name="__codelineno-80-6"></a><a href="#__codelineno-80-6"><span class="linenos" data-linenos="  6 "></span></a><span class="c1">##########################################</span>
<a id="__codelineno-80-7" name="__codelineno-80-7"></a><a href="#__codelineno-80-7"><span class="linenos" data-linenos="  7 "></span></a>
<a id="__codelineno-80-8" name="__codelineno-80-8"></a><a href="#__codelineno-80-8"><span class="linenos" data-linenos="  8 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-9" name="__codelineno-80-9"></a><a href="#__codelineno-80-9"><span class="linenos" data-linenos="  9 "></span></a><span class="sd">Setting debug to true will display more informations</span>
<a id="__codelineno-80-10" name="__codelineno-80-10"></a><a href="#__codelineno-80-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="sd">about the lattice, the bounds, the vectors...</span>
<a id="__codelineno-80-11" name="__codelineno-80-11"></a><a href="#__codelineno-80-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-12" name="__codelineno-80-12"></a><a href="#__codelineno-80-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-80-13" name="__codelineno-80-13"></a><a href="#__codelineno-80-13"><span class="linenos" data-linenos=" 13 "></span></a>
<a id="__codelineno-80-14" name="__codelineno-80-14"></a><a href="#__codelineno-80-14"><span class="linenos" data-linenos=" 14 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-15" name="__codelineno-80-15"></a><a href="#__codelineno-80-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="sd">Setting strict to true will stop the algorithm (and</span>
<a id="__codelineno-80-16" name="__codelineno-80-16"></a><a href="#__codelineno-80-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="sd">return (-1, -1)) if we don&#39;t have a correct</span>
<a id="__codelineno-80-17" name="__codelineno-80-17"></a><a href="#__codelineno-80-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="sd">upperbound on the determinant. Note that this</span>
<a id="__codelineno-80-18" name="__codelineno-80-18"></a><a href="#__codelineno-80-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="sd">doesn&#39;t necesseraly mean that no solutions</span>
<a id="__codelineno-80-19" name="__codelineno-80-19"></a><a href="#__codelineno-80-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="sd">will be found since the theoretical upperbound is</span>
<a id="__codelineno-80-20" name="__codelineno-80-20"></a><a href="#__codelineno-80-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="sd">usualy far away from actual results. That is why</span>
<a id="__codelineno-80-21" name="__codelineno-80-21"></a><a href="#__codelineno-80-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="sd">you should probably use `strict = False`</span>
<a id="__codelineno-80-22" name="__codelineno-80-22"></a><a href="#__codelineno-80-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-23" name="__codelineno-80-23"></a><a href="#__codelineno-80-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-80-24" name="__codelineno-80-24"></a><a href="#__codelineno-80-24"><span class="linenos" data-linenos=" 24 "></span></a>
<a id="__codelineno-80-25" name="__codelineno-80-25"></a><a href="#__codelineno-80-25"><span class="linenos" data-linenos=" 25 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-26" name="__codelineno-80-26"></a><a href="#__codelineno-80-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="sd">This is experimental, but has provided remarkable results</span>
<a id="__codelineno-80-27" name="__codelineno-80-27"></a><a href="#__codelineno-80-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="sd">so far. It tries to reduce the lattice as much as it can</span>
<a id="__codelineno-80-28" name="__codelineno-80-28"></a><a href="#__codelineno-80-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="sd">while keeping its efficiency. I see no reason not to use</span>
<a id="__codelineno-80-29" name="__codelineno-80-29"></a><a href="#__codelineno-80-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="sd">this option, but if things don&#39;t work, you should try</span>
<a id="__codelineno-80-30" name="__codelineno-80-30"></a><a href="#__codelineno-80-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="sd">disabling it</span>
<a id="__codelineno-80-31" name="__codelineno-80-31"></a><a href="#__codelineno-80-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-32" name="__codelineno-80-32"></a><a href="#__codelineno-80-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="n">helpful_only</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-80-33" name="__codelineno-80-33"></a><a href="#__codelineno-80-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="n">dimension_min</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1">## stop removing if lattice reaches that dimension</span>
<a id="__codelineno-80-34" name="__codelineno-80-34"></a><a href="#__codelineno-80-34"><span class="linenos" data-linenos=" 34 "></span></a>
<a id="__codelineno-80-35" name="__codelineno-80-35"></a><a href="#__codelineno-80-35"><span class="linenos" data-linenos=" 35 "></span></a><span class="c1">############################################</span>
<a id="__codelineno-80-36" name="__codelineno-80-36"></a><a href="#__codelineno-80-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="c1">## Functions</span>
<a id="__codelineno-80-37" name="__codelineno-80-37"></a><a href="#__codelineno-80-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="c1">##########################################</span>
<a id="__codelineno-80-38" name="__codelineno-80-38"></a><a href="#__codelineno-80-38"><span class="linenos" data-linenos=" 38 "></span></a>
<a id="__codelineno-80-39" name="__codelineno-80-39"></a><a href="#__codelineno-80-39"><span class="linenos" data-linenos=" 39 "></span></a><span class="c1">## display stats on helpful vectors</span>
<a id="__codelineno-80-40" name="__codelineno-80-40"></a><a href="#__codelineno-80-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">helpful_vectors</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="p">):</span>
<a id="__codelineno-80-41" name="__codelineno-80-41"></a><a href="#__codelineno-80-41"><span class="linenos" data-linenos=" 41 "></span></a>    <span class="n">nothelpful</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-80-42" name="__codelineno-80-42"></a><a href="#__codelineno-80-42"><span class="linenos" data-linenos=" 42 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-80-43" name="__codelineno-80-43"></a><a href="#__codelineno-80-43"><span class="linenos" data-linenos=" 43 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">modulus</span><span class="p">:</span>
<a id="__codelineno-80-44" name="__codelineno-80-44"></a><a href="#__codelineno-80-44"><span class="linenos" data-linenos=" 44 "></span></a>            <span class="n">nothelpful</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-80-45" name="__codelineno-80-45"></a><a href="#__codelineno-80-45"><span class="linenos" data-linenos=" 45 "></span></a>
<a id="__codelineno-80-46" name="__codelineno-80-46"></a><a href="#__codelineno-80-46"><span class="linenos" data-linenos=" 46 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">nothelpful</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; vectors are not helpful&quot;</span><span class="p">)</span>
<a id="__codelineno-80-47" name="__codelineno-80-47"></a><a href="#__codelineno-80-47"><span class="linenos" data-linenos=" 47 "></span></a>
<a id="__codelineno-80-48" name="__codelineno-80-48"></a><a href="#__codelineno-80-48"><span class="linenos" data-linenos=" 48 "></span></a><span class="c1">## display matrix picture with 0 and X</span>
<a id="__codelineno-80-49" name="__codelineno-80-49"></a><a href="#__codelineno-80-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">matrix_overview</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">bound</span><span class="p">):</span>
<a id="__codelineno-80-50" name="__codelineno-80-50"></a><a href="#__codelineno-80-50"><span class="linenos" data-linenos=" 50 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-80-51" name="__codelineno-80-51"></a><a href="#__codelineno-80-51"><span class="linenos" data-linenos=" 51 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%02d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-80-52" name="__codelineno-80-52"></a><a href="#__codelineno-80-52"><span class="linenos" data-linenos=" 52 "></span></a>        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-80-53" name="__codelineno-80-53"></a><a href="#__codelineno-80-53"><span class="linenos" data-linenos=" 53 "></span></a>            <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span> <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;X&#39;</span>
<a id="__codelineno-80-54" name="__codelineno-80-54"></a><a href="#__codelineno-80-54"><span class="linenos" data-linenos=" 54 "></span></a>            <span class="k">if</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
<a id="__codelineno-80-55" name="__codelineno-80-55"></a><a href="#__codelineno-80-55"><span class="linenos" data-linenos=" 55 "></span></a>                <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
<a id="__codelineno-80-56" name="__codelineno-80-56"></a><a href="#__codelineno-80-56"><span class="linenos" data-linenos=" 56 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-80-57" name="__codelineno-80-57"></a><a href="#__codelineno-80-57"><span class="linenos" data-linenos=" 57 "></span></a>            <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39;~&#39;</span>
<a id="__codelineno-80-58" name="__codelineno-80-58"></a><a href="#__codelineno-80-58"><span class="linenos" data-linenos=" 58 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-80-59" name="__codelineno-80-59"></a><a href="#__codelineno-80-59"><span class="linenos" data-linenos=" 59 "></span></a>
<a id="__codelineno-80-60" name="__codelineno-80-60"></a><a href="#__codelineno-80-60"><span class="linenos" data-linenos=" 60 "></span></a><span class="c1">## tries to remove unhelpful vectors</span>
<a id="__codelineno-80-61" name="__codelineno-80-61"></a><a href="#__codelineno-80-61"><span class="linenos" data-linenos=" 61 "></span></a><span class="c1">## we start at current = n-1 (last vector)</span>
<a id="__codelineno-80-62" name="__codelineno-80-62"></a><a href="#__codelineno-80-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
<a id="__codelineno-80-63" name="__codelineno-80-63"></a><a href="#__codelineno-80-63"><span class="linenos" data-linenos=" 63 "></span></a>    <span class="c1">## end of our recursive function</span>
<a id="__codelineno-80-64" name="__codelineno-80-64"></a><a href="#__codelineno-80-64"><span class="linenos" data-linenos=" 64 "></span></a>    <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dimension_min</span><span class="p">:</span>
<a id="__codelineno-80-65" name="__codelineno-80-65"></a><a href="#__codelineno-80-65"><span class="linenos" data-linenos=" 65 "></span></a>        <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-80-66" name="__codelineno-80-66"></a><a href="#__codelineno-80-66"><span class="linenos" data-linenos=" 66 "></span></a>
<a id="__codelineno-80-67" name="__codelineno-80-67"></a><a href="#__codelineno-80-67"><span class="linenos" data-linenos=" 67 "></span></a>    <span class="c1">## we start by checking from the end</span>
<a id="__codelineno-80-68" name="__codelineno-80-68"></a><a href="#__codelineno-80-68"><span class="linenos" data-linenos=" 68 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-69" name="__codelineno-80-69"></a><a href="#__codelineno-80-69"><span class="linenos" data-linenos=" 69 "></span></a>        <span class="c1">## if it is unhelpful:</span>
<a id="__codelineno-80-70" name="__codelineno-80-70"></a><a href="#__codelineno-80-70"><span class="linenos" data-linenos=" 70 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-80-71" name="__codelineno-80-71"></a><a href="#__codelineno-80-71"><span class="linenos" data-linenos=" 71 "></span></a>            <span class="n">affected_vectors</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-80-72" name="__codelineno-80-72"></a><a href="#__codelineno-80-72"><span class="linenos" data-linenos=" 72 "></span></a>            <span class="n">affected_vector_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-80-73" name="__codelineno-80-73"></a><a href="#__codelineno-80-73"><span class="linenos" data-linenos=" 73 "></span></a>            <span class="c1">## let&#39;s check if it affects other vectors</span>
<a id="__codelineno-80-74" name="__codelineno-80-74"></a><a href="#__codelineno-80-74"><span class="linenos" data-linenos=" 74 "></span></a>            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-80-75" name="__codelineno-80-75"></a><a href="#__codelineno-80-75"><span class="linenos" data-linenos=" 75 "></span></a>                <span class="c1">## if another vector is affected:</span>
<a id="__codelineno-80-76" name="__codelineno-80-76"></a><a href="#__codelineno-80-76"><span class="linenos" data-linenos=" 76 "></span></a>                <span class="c1">## we increase the count</span>
<a id="__codelineno-80-77" name="__codelineno-80-77"></a><a href="#__codelineno-80-77"><span class="linenos" data-linenos=" 77 "></span></a>                <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-80-78" name="__codelineno-80-78"></a><a href="#__codelineno-80-78"><span class="linenos" data-linenos=" 78 "></span></a>                    <span class="n">affected_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-80-79" name="__codelineno-80-79"></a><a href="#__codelineno-80-79"><span class="linenos" data-linenos=" 79 "></span></a>                    <span class="n">affected_vector_index</span> <span class="o">=</span> <span class="n">jj</span>
<a id="__codelineno-80-80" name="__codelineno-80-80"></a><a href="#__codelineno-80-80"><span class="linenos" data-linenos=" 80 "></span></a>
<a id="__codelineno-80-81" name="__codelineno-80-81"></a><a href="#__codelineno-80-81"><span class="linenos" data-linenos=" 81 "></span></a>            <span class="c1">## level:0</span>
<a id="__codelineno-80-82" name="__codelineno-80-82"></a><a href="#__codelineno-80-82"><span class="linenos" data-linenos=" 82 "></span></a>            <span class="c1">## if no other vectors end up affected</span>
<a id="__codelineno-80-83" name="__codelineno-80-83"></a><a href="#__codelineno-80-83"><span class="linenos" data-linenos=" 83 "></span></a>            <span class="c1">## we remove it</span>
<a id="__codelineno-80-84" name="__codelineno-80-84"></a><a href="#__codelineno-80-84"><span class="linenos" data-linenos=" 84 "></span></a>            <span class="k">if</span> <span class="n">affected_vectors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-80-85" name="__codelineno-80-85"></a><a href="#__codelineno-80-85"><span class="linenos" data-linenos=" 85 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* removing unhelpful vector&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-80-86" name="__codelineno-80-86"></a><a href="#__codelineno-80-86"><span class="linenos" data-linenos=" 86 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_columns</span><span class="p">([</span><span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-80-87" name="__codelineno-80-87"></a><a href="#__codelineno-80-87"><span class="linenos" data-linenos=" 87 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">([</span><span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-80-88" name="__codelineno-80-88"></a><a href="#__codelineno-80-88"><span class="linenos" data-linenos=" 88 "></span></a>                <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-80-89" name="__codelineno-80-89"></a><a href="#__codelineno-80-89"><span class="linenos" data-linenos=" 89 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-80-90" name="__codelineno-80-90"></a><a href="#__codelineno-80-90"><span class="linenos" data-linenos=" 90 "></span></a>                <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-80-91" name="__codelineno-80-91"></a><a href="#__codelineno-80-91"><span class="linenos" data-linenos=" 91 "></span></a>
<a id="__codelineno-80-92" name="__codelineno-80-92"></a><a href="#__codelineno-80-92"><span class="linenos" data-linenos=" 92 "></span></a>            <span class="c1">## level:1</span>
<a id="__codelineno-80-93" name="__codelineno-80-93"></a><a href="#__codelineno-80-93"><span class="linenos" data-linenos=" 93 "></span></a>            <span class="c1">## if just one was affected we check</span>
<a id="__codelineno-80-94" name="__codelineno-80-94"></a><a href="#__codelineno-80-94"><span class="linenos" data-linenos=" 94 "></span></a>            <span class="c1">## if it is affecting someone else</span>
<a id="__codelineno-80-95" name="__codelineno-80-95"></a><a href="#__codelineno-80-95"><span class="linenos" data-linenos=" 95 "></span></a>            <span class="k">elif</span> <span class="n">affected_vectors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-80-96" name="__codelineno-80-96"></a><a href="#__codelineno-80-96"><span class="linenos" data-linenos=" 96 "></span></a>                <span class="n">affected_deeper</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-80-97" name="__codelineno-80-97"></a><a href="#__codelineno-80-97"><span class="linenos" data-linenos=" 97 "></span></a>                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">affected_vector_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-80-98" name="__codelineno-80-98"></a><a href="#__codelineno-80-98"><span class="linenos" data-linenos=" 98 "></span></a>                    <span class="c1">## if it is affecting even one vector</span>
<a id="__codelineno-80-99" name="__codelineno-80-99"></a><a href="#__codelineno-80-99"><span class="linenos" data-linenos=" 99 "></span></a>                    <span class="c1">## we give up on this one</span>
<a id="__codelineno-80-100" name="__codelineno-80-100"></a><a href="#__codelineno-80-100"><span class="linenos" data-linenos="100 "></span></a>                    <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-80-101" name="__codelineno-80-101"></a><a href="#__codelineno-80-101"><span class="linenos" data-linenos="101 "></span></a>                        <span class="n">affected_deeper</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-80-102" name="__codelineno-80-102"></a><a href="#__codelineno-80-102"><span class="linenos" data-linenos="102 "></span></a>                <span class="c1">## remove both it if no other vector was affected and</span>
<a id="__codelineno-80-103" name="__codelineno-80-103"></a><a href="#__codelineno-80-103"><span class="linenos" data-linenos="103 "></span></a>                <span class="c1">## this helpful vector is not helpful enough</span>
<a id="__codelineno-80-104" name="__codelineno-80-104"></a><a href="#__codelineno-80-104"><span class="linenos" data-linenos="104 "></span></a>                <span class="c1">## compared to our unhelpful one</span>
<a id="__codelineno-80-105" name="__codelineno-80-105"></a><a href="#__codelineno-80-105"><span class="linenos" data-linenos="105 "></span></a>                <span class="k">if</span> <span class="n">affected_deeper</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="n">BB</span><span class="p">[</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]):</span>
<a id="__codelineno-80-106" name="__codelineno-80-106"></a><a href="#__codelineno-80-106"><span class="linenos" data-linenos="106 "></span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* removing unhelpful vectors&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">)</span>
<a id="__codelineno-80-107" name="__codelineno-80-107"></a><a href="#__codelineno-80-107"><span class="linenos" data-linenos="107 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_columns</span><span class="p">([</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-80-108" name="__codelineno-80-108"></a><a href="#__codelineno-80-108"><span class="linenos" data-linenos="108 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">([</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-80-109" name="__codelineno-80-109"></a><a href="#__codelineno-80-109"><span class="linenos" data-linenos="109 "></span></a>                    <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">affected_vector_index</span><span class="p">)</span>
<a id="__codelineno-80-110" name="__codelineno-80-110"></a><a href="#__codelineno-80-110"><span class="linenos" data-linenos="110 "></span></a>                    <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-80-111" name="__codelineno-80-111"></a><a href="#__codelineno-80-111"><span class="linenos" data-linenos="111 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-80-112" name="__codelineno-80-112"></a><a href="#__codelineno-80-112"><span class="linenos" data-linenos="112 "></span></a>                    <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-80-113" name="__codelineno-80-113"></a><a href="#__codelineno-80-113"><span class="linenos" data-linenos="113 "></span></a>    <span class="c1">## nothing happened</span>
<a id="__codelineno-80-114" name="__codelineno-80-114"></a><a href="#__codelineno-80-114"><span class="linenos" data-linenos="114 "></span></a>    <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-80-115" name="__codelineno-80-115"></a><a href="#__codelineno-80-115"><span class="linenos" data-linenos="115 "></span></a>
<a id="__codelineno-80-116" name="__codelineno-80-116"></a><a href="#__codelineno-80-116"><span class="linenos" data-linenos="116 "></span></a><span class="sd">&quot;&quot;&quot; </span>
<a id="__codelineno-80-117" name="__codelineno-80-117"></a><a href="#__codelineno-80-117"><span class="linenos" data-linenos="117 "></span></a><span class="sd">Returns:</span>
<a id="__codelineno-80-118" name="__codelineno-80-118"></a><a href="#__codelineno-80-118"><span class="linenos" data-linenos="118 "></span></a><span class="sd">* 0,0   if it fails</span>
<a id="__codelineno-80-119" name="__codelineno-80-119"></a><a href="#__codelineno-80-119"><span class="linenos" data-linenos="119 "></span></a><span class="sd">* -1,-1 if `strict=true`, and determinant doesn&#39;t bound</span>
<a id="__codelineno-80-120" name="__codelineno-80-120"></a><a href="#__codelineno-80-120"><span class="linenos" data-linenos="120 "></span></a><span class="sd">* x0,y0 the solutions of `pol`</span>
<a id="__codelineno-80-121" name="__codelineno-80-121"></a><a href="#__codelineno-80-121"><span class="linenos" data-linenos="121 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-122" name="__codelineno-80-122"></a><a href="#__codelineno-80-122"><span class="linenos" data-linenos="122 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">boneh_durfee</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">modulus</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">):</span>
<a id="__codelineno-80-123" name="__codelineno-80-123"></a><a href="#__codelineno-80-123"><span class="linenos" data-linenos="123 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-80-124" name="__codelineno-80-124"></a><a href="#__codelineno-80-124"><span class="linenos" data-linenos="124 "></span></a><span class="sd">    Boneh and Durfee revisited by Herrmann and May</span>
<a id="__codelineno-80-125" name="__codelineno-80-125"></a><a href="#__codelineno-80-125"><span class="linenos" data-linenos="125 "></span></a>
<a id="__codelineno-80-126" name="__codelineno-80-126"></a><a href="#__codelineno-80-126"><span class="linenos" data-linenos="126 "></span></a><span class="sd">    finds a solution if:</span>
<a id="__codelineno-80-127" name="__codelineno-80-127"></a><a href="#__codelineno-80-127"><span class="linenos" data-linenos="127 "></span></a><span class="sd">    * d &lt; N^delta</span>
<a id="__codelineno-80-128" name="__codelineno-80-128"></a><a href="#__codelineno-80-128"><span class="linenos" data-linenos="128 "></span></a><span class="sd">    * |x| &lt; e^delta</span>
<a id="__codelineno-80-129" name="__codelineno-80-129"></a><a href="#__codelineno-80-129"><span class="linenos" data-linenos="129 "></span></a><span class="sd">    * |y| &lt; e^0.5</span>
<a id="__codelineno-80-130" name="__codelineno-80-130"></a><a href="#__codelineno-80-130"><span class="linenos" data-linenos="130 "></span></a><span class="sd">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span>
<a id="__codelineno-80-131" name="__codelineno-80-131"></a><a href="#__codelineno-80-131"><span class="linenos" data-linenos="131 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-80-132" name="__codelineno-80-132"></a><a href="#__codelineno-80-132"><span class="linenos" data-linenos="132 "></span></a>
<a id="__codelineno-80-133" name="__codelineno-80-133"></a><a href="#__codelineno-80-133"><span class="linenos" data-linenos="133 "></span></a>    <span class="c1">## substitution (Herrman and May)</span>
<a id="__codelineno-80-134" name="__codelineno-80-134"></a><a href="#__codelineno-80-134"><span class="linenos" data-linenos="134 "></span></a>    <span class="n">PR</span><span class="o">.&lt;</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-80-135" name="__codelineno-80-135"></a><a href="#__codelineno-80-135"><span class="linenos" data-linenos="135 "></span></a>    <span class="n">Q</span> <span class="o">=</span> <span class="n">PR</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="c1">## u = xy + 1</span>
<a id="__codelineno-80-136" name="__codelineno-80-136"></a><a href="#__codelineno-80-136"><span class="linenos" data-linenos="136 "></span></a>    <span class="n">polZ</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
<a id="__codelineno-80-137" name="__codelineno-80-137"></a><a href="#__codelineno-80-137"><span class="linenos" data-linenos="137 "></span></a>
<a id="__codelineno-80-138" name="__codelineno-80-138"></a><a href="#__codelineno-80-138"><span class="linenos" data-linenos="138 "></span></a>    <span class="n">UU</span> <span class="o">=</span> <span class="n">XX</span><span class="o">*</span><span class="n">YY</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-80-139" name="__codelineno-80-139"></a><a href="#__codelineno-80-139"><span class="linenos" data-linenos="139 "></span></a>
<a id="__codelineno-80-140" name="__codelineno-80-140"></a><a href="#__codelineno-80-140"><span class="linenos" data-linenos="140 "></span></a>    <span class="c1">## x-shifts</span>
<a id="__codelineno-80-141" name="__codelineno-80-141"></a><a href="#__codelineno-80-141"><span class="linenos" data-linenos="141 "></span></a>    <span class="n">gg</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-80-142" name="__codelineno-80-142"></a><a href="#__codelineno-80-142"><span class="linenos" data-linenos="142 "></span></a>    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-143" name="__codelineno-80-143"></a><a href="#__codelineno-80-143"><span class="linenos" data-linenos="143 "></span></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-144" name="__codelineno-80-144"></a><a href="#__codelineno-80-144"><span class="linenos" data-linenos="144 "></span></a>            <span class="n">xshift</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">ii</span> <span class="o">*</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span><span class="p">)</span> <span class="o">*</span> <span class="n">polZ</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="n">kk</span>
<a id="__codelineno-80-145" name="__codelineno-80-145"></a><a href="#__codelineno-80-145"><span class="linenos" data-linenos="145 "></span></a>            <span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xshift</span><span class="p">)</span>
<a id="__codelineno-80-146" name="__codelineno-80-146"></a><a href="#__codelineno-80-146"><span class="linenos" data-linenos="146 "></span></a>    <span class="n">gg</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-80-147" name="__codelineno-80-147"></a><a href="#__codelineno-80-147"><span class="linenos" data-linenos="147 "></span></a>
<a id="__codelineno-80-148" name="__codelineno-80-148"></a><a href="#__codelineno-80-148"><span class="linenos" data-linenos="148 "></span></a>    <span class="c1">## x-shifts list of monomials</span>
<a id="__codelineno-80-149" name="__codelineno-80-149"></a><a href="#__codelineno-80-149"><span class="linenos" data-linenos="149 "></span></a>    <span class="n">monomials</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-80-150" name="__codelineno-80-150"></a><a href="#__codelineno-80-150"><span class="linenos" data-linenos="150 "></span></a>    <span class="k">for</span> <span class="n">polynomial</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">:</span>
<a id="__codelineno-80-151" name="__codelineno-80-151"></a><a href="#__codelineno-80-151"><span class="linenos" data-linenos="151 "></span></a>        <span class="k">for</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">polynomial</span><span class="o">.</span><span class="n">monomials</span><span class="p">():</span>
<a id="__codelineno-80-152" name="__codelineno-80-152"></a><a href="#__codelineno-80-152"><span class="linenos" data-linenos="152 "></span></a>            <span class="k">if</span> <span class="n">monomial</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">monomials</span><span class="p">:</span>
<a id="__codelineno-80-153" name="__codelineno-80-153"></a><a href="#__codelineno-80-153"><span class="linenos" data-linenos="153 "></span></a>                <span class="n">monomials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monomial</span><span class="p">)</span>
<a id="__codelineno-80-154" name="__codelineno-80-154"></a><a href="#__codelineno-80-154"><span class="linenos" data-linenos="154 "></span></a>    <span class="n">monomials</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-80-155" name="__codelineno-80-155"></a><a href="#__codelineno-80-155"><span class="linenos" data-linenos="155 "></span></a>
<a id="__codelineno-80-156" name="__codelineno-80-156"></a><a href="#__codelineno-80-156"><span class="linenos" data-linenos="156 "></span></a>    <span class="c1">## y-shifts (selected by Herrman and May)</span>
<a id="__codelineno-80-157" name="__codelineno-80-157"></a><a href="#__codelineno-80-157"><span class="linenos" data-linenos="157 "></span></a>    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-158" name="__codelineno-80-158"></a><a href="#__codelineno-80-158"><span class="linenos" data-linenos="158 "></span></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">mm</span><span class="o">/</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-159" name="__codelineno-80-159"></a><a href="#__codelineno-80-159"><span class="linenos" data-linenos="159 "></span></a>            <span class="n">yshift</span> <span class="o">=</span> <span class="n">y</span><span class="o">^</span><span class="n">jj</span> <span class="o">*</span> <span class="n">polZ</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="n">kk</span> <span class="o">*</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span><span class="p">)</span>
<a id="__codelineno-80-160" name="__codelineno-80-160"></a><a href="#__codelineno-80-160"><span class="linenos" data-linenos="160 "></span></a>            <span class="n">yshift</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">yshift</span><span class="p">)</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
<a id="__codelineno-80-161" name="__codelineno-80-161"></a><a href="#__codelineno-80-161"><span class="linenos" data-linenos="161 "></span></a>            <span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yshift</span><span class="p">)</span> <span class="c1">## substitution</span>
<a id="__codelineno-80-162" name="__codelineno-80-162"></a><a href="#__codelineno-80-162"><span class="linenos" data-linenos="162 "></span></a>
<a id="__codelineno-80-163" name="__codelineno-80-163"></a><a href="#__codelineno-80-163"><span class="linenos" data-linenos="163 "></span></a>    <span class="c1">## y-shifts list of monomials</span>
<a id="__codelineno-80-164" name="__codelineno-80-164"></a><a href="#__codelineno-80-164"><span class="linenos" data-linenos="164 "></span></a>    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-165" name="__codelineno-80-165"></a><a href="#__codelineno-80-165"><span class="linenos" data-linenos="165 "></span></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">mm</span><span class="o">/</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-166" name="__codelineno-80-166"></a><a href="#__codelineno-80-166"><span class="linenos" data-linenos="166 "></span></a>            <span class="n">monomials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="o">^</span><span class="n">kk</span> <span class="o">*</span> <span class="n">y</span><span class="o">^</span><span class="n">jj</span><span class="p">)</span>
<a id="__codelineno-80-167" name="__codelineno-80-167"></a><a href="#__codelineno-80-167"><span class="linenos" data-linenos="167 "></span></a>
<a id="__codelineno-80-168" name="__codelineno-80-168"></a><a href="#__codelineno-80-168"><span class="linenos" data-linenos="168 "></span></a>    <span class="c1">## construct lattice B</span>
<a id="__codelineno-80-169" name="__codelineno-80-169"></a><a href="#__codelineno-80-169"><span class="linenos" data-linenos="169 "></span></a>    <span class="n">nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">monomials</span><span class="p">)</span>
<a id="__codelineno-80-170" name="__codelineno-80-170"></a><a href="#__codelineno-80-170"><span class="linenos" data-linenos="170 "></span></a>    <span class="n">BB</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>
<a id="__codelineno-80-171" name="__codelineno-80-171"></a><a href="#__codelineno-80-171"><span class="linenos" data-linenos="171 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-80-172" name="__codelineno-80-172"></a><a href="#__codelineno-80-172"><span class="linenos" data-linenos="172 "></span></a>        <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">](</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-80-173" name="__codelineno-80-173"></a><a href="#__codelineno-80-173"><span class="linenos" data-linenos="173 "></span></a>        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-174" name="__codelineno-80-174"></a><a href="#__codelineno-80-174"><span class="linenos" data-linenos="174 "></span></a>            <span class="k">if</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">monomials</span><span class="p">():</span>
<a id="__codelineno-80-175" name="__codelineno-80-175"></a><a href="#__codelineno-80-175"><span class="linenos" data-linenos="175 "></span></a>                <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">monomial_coefficient</span><span class="p">(</span><span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span> <span class="o">*</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-80-176" name="__codelineno-80-176"></a><a href="#__codelineno-80-176"><span class="linenos" data-linenos="176 "></span></a>
<a id="__codelineno-80-177" name="__codelineno-80-177"></a><a href="#__codelineno-80-177"><span class="linenos" data-linenos="177 "></span></a>    <span class="c1">## Prototype to reduce the lattice</span>
<a id="__codelineno-80-178" name="__codelineno-80-178"></a><a href="#__codelineno-80-178"><span class="linenos" data-linenos="178 "></span></a>    <span class="k">if</span> <span class="n">helpful_only</span><span class="p">:</span>
<a id="__codelineno-80-179" name="__codelineno-80-179"></a><a href="#__codelineno-80-179"><span class="linenos" data-linenos="179 "></span></a>        <span class="c1">## automatically remove</span>
<a id="__codelineno-80-180" name="__codelineno-80-180"></a><a href="#__codelineno-80-180"><span class="linenos" data-linenos="180 "></span></a>        <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">,</span> <span class="n">nn</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-80-181" name="__codelineno-80-181"></a><a href="#__codelineno-80-181"><span class="linenos" data-linenos="181 "></span></a>        <span class="c1">## reset dimension</span>
<a id="__codelineno-80-182" name="__codelineno-80-182"></a><a href="#__codelineno-80-182"><span class="linenos" data-linenos="182 "></span></a>        <span class="n">nn</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-80-183" name="__codelineno-80-183"></a><a href="#__codelineno-80-183"><span class="linenos" data-linenos="183 "></span></a>        <span class="k">if</span> <span class="n">nn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-80-184" name="__codelineno-80-184"></a><a href="#__codelineno-80-184"><span class="linenos" data-linenos="184 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failure&quot;</span><span class="p">)</span>
<a id="__codelineno-80-185" name="__codelineno-80-185"></a><a href="#__codelineno-80-185"><span class="linenos" data-linenos="185 "></span></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<a id="__codelineno-80-186" name="__codelineno-80-186"></a><a href="#__codelineno-80-186"><span class="linenos" data-linenos="186 "></span></a>
<a id="__codelineno-80-187" name="__codelineno-80-187"></a><a href="#__codelineno-80-187"><span class="linenos" data-linenos="187 "></span></a>    <span class="c1">## check if vectors are helpful</span>
<a id="__codelineno-80-188" name="__codelineno-80-188"></a><a href="#__codelineno-80-188"><span class="linenos" data-linenos="188 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-189" name="__codelineno-80-189"></a><a href="#__codelineno-80-189"><span class="linenos" data-linenos="189 "></span></a>        <span class="n">helpful_vectors</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">)</span>
<a id="__codelineno-80-190" name="__codelineno-80-190"></a><a href="#__codelineno-80-190"><span class="linenos" data-linenos="190 "></span></a>
<a id="__codelineno-80-191" name="__codelineno-80-191"></a><a href="#__codelineno-80-191"><span class="linenos" data-linenos="191 "></span></a>    <span class="c1">## check if determinant is correctly bounded</span>
<a id="__codelineno-80-192" name="__codelineno-80-192"></a><a href="#__codelineno-80-192"><span class="linenos" data-linenos="192 "></span></a>    <span class="n">det</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">det</span><span class="p">()</span>
<a id="__codelineno-80-193" name="__codelineno-80-193"></a><a href="#__codelineno-80-193"><span class="linenos" data-linenos="193 "></span></a>    <span class="n">bound</span> <span class="o">=</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span>
<a id="__codelineno-80-194" name="__codelineno-80-194"></a><a href="#__codelineno-80-194"><span class="linenos" data-linenos="194 "></span></a>    <span class="k">if</span> <span class="n">det</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-80-195" name="__codelineno-80-195"></a><a href="#__codelineno-80-195"><span class="linenos" data-linenos="195 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span><span class="p">)</span>
<a id="__codelineno-80-196" name="__codelineno-80-196"></a><a href="#__codelineno-80-196"><span class="linenos" data-linenos="196 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Try with highers m and t.&quot;</span><span class="p">)</span>
<a id="__codelineno-80-197" name="__codelineno-80-197"></a><a href="#__codelineno-80-197"><span class="linenos" data-linenos="197 "></span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-198" name="__codelineno-80-198"></a><a href="#__codelineno-80-198"><span class="linenos" data-linenos="198 "></span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">det</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">bound</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-80-199" name="__codelineno-80-199"></a><a href="#__codelineno-80-199"><span class="linenos" data-linenos="199 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;size det(L) - size e^(m*n) = &quot;</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
<a id="__codelineno-80-200" name="__codelineno-80-200"></a><a href="#__codelineno-80-200"><span class="linenos" data-linenos="200 "></span></a>        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
<a id="__codelineno-80-201" name="__codelineno-80-201"></a><a href="#__codelineno-80-201"><span class="linenos" data-linenos="201 "></span></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-80-202" name="__codelineno-80-202"></a><a href="#__codelineno-80-202"><span class="linenos" data-linenos="202 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-80-203" name="__codelineno-80-203"></a><a href="#__codelineno-80-203"><span class="linenos" data-linenos="203 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span><span class="p">)</span>
<a id="__codelineno-80-204" name="__codelineno-80-204"></a><a href="#__codelineno-80-204"><span class="linenos" data-linenos="204 "></span></a>
<a id="__codelineno-80-205" name="__codelineno-80-205"></a><a href="#__codelineno-80-205"><span class="linenos" data-linenos="205 "></span></a>    <span class="c1">## display the lattice basis</span>
<a id="__codelineno-80-206" name="__codelineno-80-206"></a><a href="#__codelineno-80-206"><span class="linenos" data-linenos="206 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-207" name="__codelineno-80-207"></a><a href="#__codelineno-80-207"><span class="linenos" data-linenos="207 "></span></a>        <span class="n">matrix_overview</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">)</span>
<a id="__codelineno-80-208" name="__codelineno-80-208"></a><a href="#__codelineno-80-208"><span class="linenos" data-linenos="208 "></span></a>
<a id="__codelineno-80-209" name="__codelineno-80-209"></a><a href="#__codelineno-80-209"><span class="linenos" data-linenos="209 "></span></a>    <span class="c1">## LLL</span>
<a id="__codelineno-80-210" name="__codelineno-80-210"></a><a href="#__codelineno-80-210"><span class="linenos" data-linenos="210 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-211" name="__codelineno-80-211"></a><a href="#__codelineno-80-211"><span class="linenos" data-linenos="211 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span><span class="p">)</span>
<a id="__codelineno-80-212" name="__codelineno-80-212"></a><a href="#__codelineno-80-212"><span class="linenos" data-linenos="212 "></span></a>
<a id="__codelineno-80-213" name="__codelineno-80-213"></a><a href="#__codelineno-80-213"><span class="linenos" data-linenos="213 "></span></a>    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">LLL</span><span class="p">()</span>
<a id="__codelineno-80-214" name="__codelineno-80-214"></a><a href="#__codelineno-80-214"><span class="linenos" data-linenos="214 "></span></a>
<a id="__codelineno-80-215" name="__codelineno-80-215"></a><a href="#__codelineno-80-215"><span class="linenos" data-linenos="215 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-216" name="__codelineno-80-216"></a><a href="#__codelineno-80-216"><span class="linenos" data-linenos="216 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LLL is done!&quot;</span><span class="p">)</span>
<a id="__codelineno-80-217" name="__codelineno-80-217"></a><a href="#__codelineno-80-217"><span class="linenos" data-linenos="217 "></span></a>
<a id="__codelineno-80-218" name="__codelineno-80-218"></a><a href="#__codelineno-80-218"><span class="linenos" data-linenos="218 "></span></a>    <span class="c1">## transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span>
<a id="__codelineno-80-219" name="__codelineno-80-219"></a><a href="#__codelineno-80-219"><span class="linenos" data-linenos="219 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-220" name="__codelineno-80-220"></a><a href="#__codelineno-80-220"><span class="linenos" data-linenos="220 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;looking for independent vectors in the lattice&quot;</span><span class="p">)</span>
<a id="__codelineno-80-221" name="__codelineno-80-221"></a><a href="#__codelineno-80-221"><span class="linenos" data-linenos="221 "></span></a>    <span class="n">found_polynomials</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-80-222" name="__codelineno-80-222"></a><a href="#__codelineno-80-222"><span class="linenos" data-linenos="222 "></span></a>
<a id="__codelineno-80-223" name="__codelineno-80-223"></a><a href="#__codelineno-80-223"><span class="linenos" data-linenos="223 "></span></a>    <span class="k">for</span> <span class="n">pol1_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-80-224" name="__codelineno-80-224"></a><a href="#__codelineno-80-224"><span class="linenos" data-linenos="224 "></span></a>        <span class="k">for</span> <span class="n">pol2_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pol1_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-80-225" name="__codelineno-80-225"></a><a href="#__codelineno-80-225"><span class="linenos" data-linenos="225 "></span></a>            <span class="c1">## for i and j, create the two polynomials</span>
<a id="__codelineno-80-226" name="__codelineno-80-226"></a><a href="#__codelineno-80-226"><span class="linenos" data-linenos="226 "></span></a>            <span class="n">PR</span><span class="o">.&lt;</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-80-227" name="__codelineno-80-227"></a><a href="#__codelineno-80-227"><span class="linenos" data-linenos="227 "></span></a>            <span class="n">pol1</span> <span class="o">=</span> <span class="n">pol2</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-80-228" name="__codelineno-80-228"></a><a href="#__codelineno-80-228"><span class="linenos" data-linenos="228 "></span></a>            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-80-229" name="__codelineno-80-229"></a><a href="#__codelineno-80-229"><span class="linenos" data-linenos="229 "></span></a>                <span class="n">pol1</span> <span class="o">+=</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">BB</span><span class="p">[</span><span class="n">pol1_idx</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-80-230" name="__codelineno-80-230"></a><a href="#__codelineno-80-230"><span class="linenos" data-linenos="230 "></span></a>                <span class="n">pol2</span> <span class="o">+=</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">BB</span><span class="p">[</span><span class="n">pol2_idx</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-80-231" name="__codelineno-80-231"></a><a href="#__codelineno-80-231"><span class="linenos" data-linenos="231 "></span></a>
<a id="__codelineno-80-232" name="__codelineno-80-232"></a><a href="#__codelineno-80-232"><span class="linenos" data-linenos="232 "></span></a>            <span class="c1">## resultant</span>
<a id="__codelineno-80-233" name="__codelineno-80-233"></a><a href="#__codelineno-80-233"><span class="linenos" data-linenos="233 "></span></a>            <span class="n">PR</span><span class="o">.&lt;</span><span class="n">q</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-80-234" name="__codelineno-80-234"></a><a href="#__codelineno-80-234"><span class="linenos" data-linenos="234 "></span></a>            <span class="n">rr</span> <span class="o">=</span> <span class="n">pol1</span><span class="o">.</span><span class="n">resultant</span><span class="p">(</span><span class="n">pol2</span><span class="p">)</span>
<a id="__codelineno-80-235" name="__codelineno-80-235"></a><a href="#__codelineno-80-235"><span class="linenos" data-linenos="235 "></span></a>
<a id="__codelineno-80-236" name="__codelineno-80-236"></a><a href="#__codelineno-80-236"><span class="linenos" data-linenos="236 "></span></a>            <span class="c1">## are these good polynomials?</span>
<a id="__codelineno-80-237" name="__codelineno-80-237"></a><a href="#__codelineno-80-237"><span class="linenos" data-linenos="237 "></span></a>            <span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">is_zero</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rr</span><span class="o">.</span><span class="n">monomials</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-80-238" name="__codelineno-80-238"></a><a href="#__codelineno-80-238"><span class="linenos" data-linenos="238 "></span></a>                <span class="k">continue</span>
<a id="__codelineno-80-239" name="__codelineno-80-239"></a><a href="#__codelineno-80-239"><span class="linenos" data-linenos="239 "></span></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-80-240" name="__codelineno-80-240"></a><a href="#__codelineno-80-240"><span class="linenos" data-linenos="240 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found them, using vectors&quot;</span><span class="p">,</span> <span class="n">pol1_idx</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="n">pol2_idx</span><span class="p">)</span>
<a id="__codelineno-80-241" name="__codelineno-80-241"></a><a href="#__codelineno-80-241"><span class="linenos" data-linenos="241 "></span></a>                <span class="n">found_polynomials</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-80-242" name="__codelineno-80-242"></a><a href="#__codelineno-80-242"><span class="linenos" data-linenos="242 "></span></a>                <span class="k">break</span>
<a id="__codelineno-80-243" name="__codelineno-80-243"></a><a href="#__codelineno-80-243"><span class="linenos" data-linenos="243 "></span></a>        <span class="k">if</span> <span class="n">found_polynomials</span><span class="p">:</span>
<a id="__codelineno-80-244" name="__codelineno-80-244"></a><a href="#__codelineno-80-244"><span class="linenos" data-linenos="244 "></span></a>            <span class="k">break</span>
<a id="__codelineno-80-245" name="__codelineno-80-245"></a><a href="#__codelineno-80-245"><span class="linenos" data-linenos="245 "></span></a>
<a id="__codelineno-80-246" name="__codelineno-80-246"></a><a href="#__codelineno-80-246"><span class="linenos" data-linenos="246 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_polynomials</span><span class="p">:</span>
<a id="__codelineno-80-247" name="__codelineno-80-247"></a><a href="#__codelineno-80-247"><span class="linenos" data-linenos="247 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span><span class="p">)</span>
<a id="__codelineno-80-248" name="__codelineno-80-248"></a><a href="#__codelineno-80-248"><span class="linenos" data-linenos="248 "></span></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-80-249" name="__codelineno-80-249"></a><a href="#__codelineno-80-249"><span class="linenos" data-linenos="249 "></span></a>
<a id="__codelineno-80-250" name="__codelineno-80-250"></a><a href="#__codelineno-80-250"><span class="linenos" data-linenos="250 "></span></a>    <span class="n">rr</span> <span class="o">=</span> <span class="n">rr</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-80-251" name="__codelineno-80-251"></a><a href="#__codelineno-80-251"><span class="linenos" data-linenos="251 "></span></a>
<a id="__codelineno-80-252" name="__codelineno-80-252"></a><a href="#__codelineno-80-252"><span class="linenos" data-linenos="252 "></span></a>    <span class="c1">## solutions</span>
<a id="__codelineno-80-253" name="__codelineno-80-253"></a><a href="#__codelineno-80-253"><span class="linenos" data-linenos="253 "></span></a>    <span class="n">soly</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-80-254" name="__codelineno-80-254"></a><a href="#__codelineno-80-254"><span class="linenos" data-linenos="254 "></span></a>
<a id="__codelineno-80-255" name="__codelineno-80-255"></a><a href="#__codelineno-80-255"><span class="linenos" data-linenos="255 "></span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">soly</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-80-256" name="__codelineno-80-256"></a><a href="#__codelineno-80-256"><span class="linenos" data-linenos="256 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your prediction (delta) is too small&quot;</span><span class="p">)</span>
<a id="__codelineno-80-257" name="__codelineno-80-257"></a><a href="#__codelineno-80-257"><span class="linenos" data-linenos="257 "></span></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-80-258" name="__codelineno-80-258"></a><a href="#__codelineno-80-258"><span class="linenos" data-linenos="258 "></span></a>
<a id="__codelineno-80-259" name="__codelineno-80-259"></a><a href="#__codelineno-80-259"><span class="linenos" data-linenos="259 "></span></a>    <span class="n">soly</span> <span class="o">=</span> <span class="n">soly</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-80-260" name="__codelineno-80-260"></a><a href="#__codelineno-80-260"><span class="linenos" data-linenos="260 "></span></a>    <span class="n">ss</span> <span class="o">=</span> <span class="n">pol1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span>
<a id="__codelineno-80-261" name="__codelineno-80-261"></a><a href="#__codelineno-80-261"><span class="linenos" data-linenos="261 "></span></a>    <span class="n">solx</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">roots</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-80-262" name="__codelineno-80-262"></a><a href="#__codelineno-80-262"><span class="linenos" data-linenos="262 "></span></a>
<a id="__codelineno-80-263" name="__codelineno-80-263"></a><a href="#__codelineno-80-263"><span class="linenos" data-linenos="263 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-264" name="__codelineno-80-264"></a><a href="#__codelineno-80-264"><span class="linenos" data-linenos="264 "></span></a>    <span class="k">return</span> <span class="n">solx</span><span class="p">,</span> <span class="n">soly</span>
<a id="__codelineno-80-265" name="__codelineno-80-265"></a><a href="#__codelineno-80-265"><span class="linenos" data-linenos="265 "></span></a>
<a id="__codelineno-80-266" name="__codelineno-80-266"></a><a href="#__codelineno-80-266"><span class="linenos" data-linenos="266 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">example</span><span class="p">():</span>
<a id="__codelineno-80-267" name="__codelineno-80-267"></a><a href="#__codelineno-80-267"><span class="linenos" data-linenos="267 "></span></a>    <span class="c1">############################################</span>
<a id="__codelineno-80-268" name="__codelineno-80-268"></a><a href="#__codelineno-80-268"><span class="linenos" data-linenos="268 "></span></a>    <span class="c1">## How To Use This Script</span>
<a id="__codelineno-80-269" name="__codelineno-80-269"></a><a href="#__codelineno-80-269"><span class="linenos" data-linenos="269 "></span></a>    <span class="c1">##########################################</span>
<a id="__codelineno-80-270" name="__codelineno-80-270"></a><a href="#__codelineno-80-270"><span class="linenos" data-linenos="270 "></span></a>
<a id="__codelineno-80-271" name="__codelineno-80-271"></a><a href="#__codelineno-80-271"><span class="linenos" data-linenos="271 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-272" name="__codelineno-80-272"></a><a href="#__codelineno-80-272"><span class="linenos" data-linenos="272 "></span></a>    <span class="c1">## The problem to solve (edit the following values)</span>
<a id="__codelineno-80-273" name="__codelineno-80-273"></a><a href="#__codelineno-80-273"><span class="linenos" data-linenos="273 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-274" name="__codelineno-80-274"></a><a href="#__codelineno-80-274"><span class="linenos" data-linenos="274 "></span></a>
<a id="__codelineno-80-275" name="__codelineno-80-275"></a><a href="#__codelineno-80-275"><span class="linenos" data-linenos="275 "></span></a>    <span class="c1">## the modulus</span>
<a id="__codelineno-80-276" name="__codelineno-80-276"></a><a href="#__codelineno-80-276"><span class="linenos" data-linenos="276 "></span></a>    <span class="n">N</span> <span class="o">=</span> <span class="mh">0xc2fd2913bae61f845ac94e4ee1bb10d8531dda830d31bb221dac5f179a8f883f15046d7aa179aff848db2734b8f88cc73d09f35c445c74ee35b01a96eb7b0a6ad9cb9ccd6c02c3f8c55ecabb55501bb2c318a38cac2db69d510e152756054aaed064ac2a454e46d9b3b755b67b46906fbff8dd9aeca6755909333f5f81bf74db</span>
<a id="__codelineno-80-277" name="__codelineno-80-277"></a><a href="#__codelineno-80-277"><span class="linenos" data-linenos="277 "></span></a>    <span class="c1">## the public exponent</span>
<a id="__codelineno-80-278" name="__codelineno-80-278"></a><a href="#__codelineno-80-278"><span class="linenos" data-linenos="278 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mh">0x19441f679c9609f2484eb9b2658d7138252b847b2ed8ad182be7976ed57a3e441af14897ce041f3e07916445b88181c22f510150584eee4b0f776a5a487a4472a99f2ddc95efdd2b380ab4480533808b8c92e63ace57fb42bac8315fa487d03bec86d854314bc2ec4f99b192bb98710be151599d60f224114f6b33f47e357517</span>
<a id="__codelineno-80-279" name="__codelineno-80-279"></a><a href="#__codelineno-80-279"><span class="linenos" data-linenos="279 "></span></a>
<a id="__codelineno-80-280" name="__codelineno-80-280"></a><a href="#__codelineno-80-280"><span class="linenos" data-linenos="280 "></span></a>    <span class="c1">## the hypothesis on the private exponent (the theoretical maximum is 0.292)</span>
<a id="__codelineno-80-281" name="__codelineno-80-281"></a><a href="#__codelineno-80-281"><span class="linenos" data-linenos="281 "></span></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mf">.18</span> <span class="c1">## this means that d &lt; N^delta</span>
<a id="__codelineno-80-282" name="__codelineno-80-282"></a><a href="#__codelineno-80-282"><span class="linenos" data-linenos="282 "></span></a>
<a id="__codelineno-80-283" name="__codelineno-80-283"></a><a href="#__codelineno-80-283"><span class="linenos" data-linenos="283 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-284" name="__codelineno-80-284"></a><a href="#__codelineno-80-284"><span class="linenos" data-linenos="284 "></span></a>    <span class="c1">## Lattice (tweak those values)</span>
<a id="__codelineno-80-285" name="__codelineno-80-285"></a><a href="#__codelineno-80-285"><span class="linenos" data-linenos="285 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-286" name="__codelineno-80-286"></a><a href="#__codelineno-80-286"><span class="linenos" data-linenos="286 "></span></a>
<a id="__codelineno-80-287" name="__codelineno-80-287"></a><a href="#__codelineno-80-287"><span class="linenos" data-linenos="287 "></span></a>    <span class="c1">## you should tweak this (after a first run), (e.g. increment it until a solution is found)</span>
<a id="__codelineno-80-288" name="__codelineno-80-288"></a><a href="#__codelineno-80-288"><span class="linenos" data-linenos="288 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1">## size of the lattice (bigger the better/slower)</span>
<a id="__codelineno-80-289" name="__codelineno-80-289"></a><a href="#__codelineno-80-289"><span class="linenos" data-linenos="289 "></span></a>
<a id="__codelineno-80-290" name="__codelineno-80-290"></a><a href="#__codelineno-80-290"><span class="linenos" data-linenos="290 "></span></a>    <span class="c1">## you need to be a lattice master to tweak these</span>
<a id="__codelineno-80-291" name="__codelineno-80-291"></a><a href="#__codelineno-80-291"><span class="linenos" data-linenos="291 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>  <span class="c1">## optimization from Herrmann and May</span>
<a id="__codelineno-80-292" name="__codelineno-80-292"></a><a href="#__codelineno-80-292"><span class="linenos" data-linenos="292 "></span></a>    <span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">^</span><span class="n">delta</span><span class="p">)</span>  <span class="c1">## this _might_ be too much</span>
<a id="__codelineno-80-293" name="__codelineno-80-293"></a><a href="#__codelineno-80-293"><span class="linenos" data-linenos="293 "></span></a>    <span class="n">Y</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>    <span class="c1">## correct if p, q are ~ same size</span>
<a id="__codelineno-80-294" name="__codelineno-80-294"></a><a href="#__codelineno-80-294"><span class="linenos" data-linenos="294 "></span></a>
<a id="__codelineno-80-295" name="__codelineno-80-295"></a><a href="#__codelineno-80-295"><span class="linenos" data-linenos="295 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-296" name="__codelineno-80-296"></a><a href="#__codelineno-80-296"><span class="linenos" data-linenos="296 "></span></a>    <span class="c1">## Don&#39;t touch anything below</span>
<a id="__codelineno-80-297" name="__codelineno-80-297"></a><a href="#__codelineno-80-297"><span class="linenos" data-linenos="297 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-298" name="__codelineno-80-298"></a><a href="#__codelineno-80-298"><span class="linenos" data-linenos="298 "></span></a>
<a id="__codelineno-80-299" name="__codelineno-80-299"></a><a href="#__codelineno-80-299"><span class="linenos" data-linenos="299 "></span></a>    <span class="c1">## Problem put in equation</span>
<a id="__codelineno-80-300" name="__codelineno-80-300"></a><a href="#__codelineno-80-300"><span class="linenos" data-linenos="300 "></span></a>    <span class="n">P</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-80-301" name="__codelineno-80-301"></a><a href="#__codelineno-80-301"><span class="linenos" data-linenos="301 "></span></a>    <span class="n">A</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-80-302" name="__codelineno-80-302"></a><a href="#__codelineno-80-302"><span class="linenos" data-linenos="302 "></span></a>    <span class="n">pol</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-80-303" name="__codelineno-80-303"></a><a href="#__codelineno-80-303"><span class="linenos" data-linenos="303 "></span></a>
<a id="__codelineno-80-304" name="__codelineno-80-304"></a><a href="#__codelineno-80-304"><span class="linenos" data-linenos="304 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-305" name="__codelineno-80-305"></a><a href="#__codelineno-80-305"><span class="linenos" data-linenos="305 "></span></a>    <span class="c1">## Find the solutions!</span>
<a id="__codelineno-80-306" name="__codelineno-80-306"></a><a href="#__codelineno-80-306"><span class="linenos" data-linenos="306 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-80-307" name="__codelineno-80-307"></a><a href="#__codelineno-80-307"><span class="linenos" data-linenos="307 "></span></a>
<a id="__codelineno-80-308" name="__codelineno-80-308"></a><a href="#__codelineno-80-308"><span class="linenos" data-linenos="308 "></span></a>    <span class="c1">## Checking bounds</span>
<a id="__codelineno-80-309" name="__codelineno-80-309"></a><a href="#__codelineno-80-309"><span class="linenos" data-linenos="309 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-310" name="__codelineno-80-310"></a><a href="#__codelineno-80-310"><span class="linenos" data-linenos="310 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== checking values ===&quot;</span><span class="p">)</span>
<a id="__codelineno-80-311" name="__codelineno-80-311"></a><a href="#__codelineno-80-311"><span class="linenos" data-linenos="311 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* delta:&quot;</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<a id="__codelineno-80-312" name="__codelineno-80-312"></a><a href="#__codelineno-80-312"><span class="linenos" data-linenos="312 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* delta &lt; 0.292&quot;</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.292</span><span class="p">)</span>
<a id="__codelineno-80-313" name="__codelineno-80-313"></a><a href="#__codelineno-80-313"><span class="linenos" data-linenos="313 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* size of e:&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-80-314" name="__codelineno-80-314"></a><a href="#__codelineno-80-314"><span class="linenos" data-linenos="314 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* size of N:&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-80-315" name="__codelineno-80-315"></a><a href="#__codelineno-80-315"><span class="linenos" data-linenos="315 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* m:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;, t:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<a id="__codelineno-80-316" name="__codelineno-80-316"></a><a href="#__codelineno-80-316"><span class="linenos" data-linenos="316 "></span></a>
<a id="__codelineno-80-317" name="__codelineno-80-317"></a><a href="#__codelineno-80-317"><span class="linenos" data-linenos="317 "></span></a>    <span class="c1">## boneh_durfee</span>
<a id="__codelineno-80-318" name="__codelineno-80-318"></a><a href="#__codelineno-80-318"><span class="linenos" data-linenos="318 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-319" name="__codelineno-80-319"></a><a href="#__codelineno-80-319"><span class="linenos" data-linenos="319 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== running algorithm ===&quot;</span><span class="p">)</span>
<a id="__codelineno-80-320" name="__codelineno-80-320"></a><a href="#__codelineno-80-320"><span class="linenos" data-linenos="320 "></span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-80-321" name="__codelineno-80-321"></a><a href="#__codelineno-80-321"><span class="linenos" data-linenos="321 "></span></a>
<a id="__codelineno-80-322" name="__codelineno-80-322"></a><a href="#__codelineno-80-322"><span class="linenos" data-linenos="322 "></span></a>    <span class="n">solx</span><span class="p">,</span> <span class="n">soly</span> <span class="o">=</span> <span class="n">boneh_durfee</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-80-323" name="__codelineno-80-323"></a><a href="#__codelineno-80-323"><span class="linenos" data-linenos="323 "></span></a>
<a id="__codelineno-80-324" name="__codelineno-80-324"></a><a href="#__codelineno-80-324"><span class="linenos" data-linenos="324 "></span></a>    <span class="c1">## found a solution?</span>
<a id="__codelineno-80-325" name="__codelineno-80-325"></a><a href="#__codelineno-80-325"><span class="linenos" data-linenos="325 "></span></a>    <span class="k">if</span> <span class="n">solx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-80-326" name="__codelineno-80-326"></a><a href="#__codelineno-80-326"><span class="linenos" data-linenos="326 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== solution found ===&quot;</span><span class="p">)</span>
<a id="__codelineno-80-327" name="__codelineno-80-327"></a><a href="#__codelineno-80-327"><span class="linenos" data-linenos="327 "></span></a>        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-80-328" name="__codelineno-80-328"></a><a href="#__codelineno-80-328"><span class="linenos" data-linenos="328 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x:&quot;</span><span class="p">,</span> <span class="n">solx</span><span class="p">)</span>
<a id="__codelineno-80-329" name="__codelineno-80-329"></a><a href="#__codelineno-80-329"><span class="linenos" data-linenos="329 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y:&quot;</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span>
<a id="__codelineno-80-330" name="__codelineno-80-330"></a><a href="#__codelineno-80-330"><span class="linenos" data-linenos="330 "></span></a>
<a id="__codelineno-80-331" name="__codelineno-80-331"></a><a href="#__codelineno-80-331"><span class="linenos" data-linenos="331 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pol</span><span class="p">(</span><span class="n">solx</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span> <span class="o">/</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-80-332" name="__codelineno-80-332"></a><a href="#__codelineno-80-332"><span class="linenos" data-linenos="332 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;private key found:&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a id="__codelineno-80-333" name="__codelineno-80-333"></a><a href="#__codelineno-80-333"><span class="linenos" data-linenos="333 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-80-334" name="__codelineno-80-334"></a><a href="#__codelineno-80-334"><span class="linenos" data-linenos="334 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== no solution was found ===&quot;</span><span class="p">)</span>
<a id="__codelineno-80-335" name="__codelineno-80-335"></a><a href="#__codelineno-80-335"><span class="linenos" data-linenos="335 "></span></a>
<a id="__codelineno-80-336" name="__codelineno-80-336"></a><a href="#__codelineno-80-336"><span class="linenos" data-linenos="336 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-80-337" name="__codelineno-80-337"></a><a href="#__codelineno-80-337"><span class="linenos" data-linenos="337 "></span></a>        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;=== </span><span class="si">%s</span><span class="s2"> seconds ===&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)))</span>
<a id="__codelineno-80-338" name="__codelineno-80-338"></a><a href="#__codelineno-80-338"><span class="linenos" data-linenos="338 "></span></a>
<a id="__codelineno-80-339" name="__codelineno-80-339"></a><a href="#__codelineno-80-339"><span class="linenos" data-linenos="339 "></span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-80-340" name="__codelineno-80-340"></a><a href="#__codelineno-80-340"><span class="linenos" data-linenos="340 "></span></a>    <span class="n">example</span><span class="p">()</span>
</code></pre></div>
<h3 id="2023so-large-e">例题 2023楚慧杯——so large e<a class="headerlink" href="#2023so-large-e" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><a href="#__codelineno-81-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><a href="#__codelineno-81-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><a href="#__codelineno-81-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">flag</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><a href="#__codelineno-81-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a><a href="#__codelineno-81-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a><a href="#__codelineno-81-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><a href="#__codelineno-81-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a><a href="#__codelineno-81-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a><a href="#__codelineno-81-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a><a href="#__codelineno-81-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-81-11" name="__codelineno-81-11"></a><a href="#__codelineno-81-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-81-12" name="__codelineno-81-12"></a><a href="#__codelineno-81-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">assert</span> <span class="n">size</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">==</span><span class="mi">1024</span>
<a id="__codelineno-81-13" name="__codelineno-81-13"></a><a href="#__codelineno-81-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-81-14" name="__codelineno-81-14"></a><a href="#__codelineno-81-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">assert</span> <span class="n">GCD</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span>
<a id="__codelineno-81-15" name="__codelineno-81-15"></a><a href="#__codelineno-81-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
<a id="__codelineno-81-16" name="__codelineno-81-16"></a><a href="#__codelineno-81-16"><span class="linenos" data-linenos="16 "></span></a><span class="k">assert</span> <span class="n">size</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">269</span>
<a id="__codelineno-81-17" name="__codelineno-81-17"></a><a href="#__codelineno-81-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-81-18" name="__codelineno-81-18"></a><a href="#__codelineno-81-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">pub</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-81-19" name="__codelineno-81-19"></a><a href="#__codelineno-81-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">PublicKey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">pub</span><span class="p">)</span>
<a id="__codelineno-81-20" name="__codelineno-81-20"></a><a href="#__codelineno-81-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;pub.pem&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span> <span class="p">:</span>
<a id="__codelineno-81-21" name="__codelineno-81-21"></a><a href="#__codelineno-81-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">PublicKey</span><span class="o">.</span><span class="n">exportKey</span><span class="p">())</span>
<a id="__codelineno-81-22" name="__codelineno-81-22"></a><a href="#__codelineno-81-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-81-23" name="__codelineno-81-23"></a><a href="#__codelineno-81-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-81-24" name="__codelineno-81-24"></a><a href="#__codelineno-81-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c =&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-81-25" name="__codelineno-81-25"></a><a href="#__codelineno-81-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-81-26" name="__codelineno-81-26"></a><a href="#__codelineno-81-26"><span class="linenos" data-linenos="26 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)))</span>
<a id="__codelineno-81-27" name="__codelineno-81-27"></a><a href="#__codelineno-81-27"><span class="linenos" data-linenos="27 "></span></a>
<a id="__codelineno-81-28" name="__codelineno-81-28"></a><a href="#__codelineno-81-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-81-29" name="__codelineno-81-29"></a><a href="#__codelineno-81-29"><span class="linenos" data-linenos="29 "></span></a><span class="c1">#c = 6838759631922176040297411386959306230064807618456930982742841698524622016849807235726065272136043603027166249075560058232683230155346614429566511309977857815138004298815137913729662337535371277019856193898546849896085411001528569293727010020290576888205244471943227253000727727343731590226737192613447347860</span>
</code></pre></div>
<p>提取公钥得到n,e</p>
<p>发现<span class="arithmatex">\(\frac{d}{n} = 0.26269\)</span></p>
<p>多半就是<strong>boneh_durfee</strong>攻击手段</p>
<p>改改example()函数的<code>delta</code>和<code>m</code>即可</p>
<p><code>delta</code>就是<span class="arithmatex">\(\frac{d}{n}\)</span>的大小</p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><a href="#__codelineno-82-1"><span class="linenos" data-linenos="  1 "></span></a><span class="c1">#sage</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><a href="#__codelineno-82-2"><span class="linenos" data-linenos="  2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_function</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><a href="#__codelineno-82-3"><span class="linenos" data-linenos="  3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a><a href="#__codelineno-82-4"><span class="linenos" data-linenos="  4 "></span></a>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a><a href="#__codelineno-82-5"><span class="linenos" data-linenos="  5 "></span></a><span class="c1">############################################</span>
<a id="__codelineno-82-6" name="__codelineno-82-6"></a><a href="#__codelineno-82-6"><span class="linenos" data-linenos="  6 "></span></a><span class="c1">## Config</span>
<a id="__codelineno-82-7" name="__codelineno-82-7"></a><a href="#__codelineno-82-7"><span class="linenos" data-linenos="  7 "></span></a><span class="c1">##########################################</span>
<a id="__codelineno-82-8" name="__codelineno-82-8"></a><a href="#__codelineno-82-8"><span class="linenos" data-linenos="  8 "></span></a>
<a id="__codelineno-82-9" name="__codelineno-82-9"></a><a href="#__codelineno-82-9"><span class="linenos" data-linenos="  9 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-10" name="__codelineno-82-10"></a><a href="#__codelineno-82-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="sd">Setting debug to true will display more informations</span>
<a id="__codelineno-82-11" name="__codelineno-82-11"></a><a href="#__codelineno-82-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="sd">about the lattice, the bounds, the vectors...</span>
<a id="__codelineno-82-12" name="__codelineno-82-12"></a><a href="#__codelineno-82-12"><span class="linenos" data-linenos=" 12 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-13" name="__codelineno-82-13"></a><a href="#__codelineno-82-13"><span class="linenos" data-linenos=" 13 "></span></a><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-82-14" name="__codelineno-82-14"></a><a href="#__codelineno-82-14"><span class="linenos" data-linenos=" 14 "></span></a>
<a id="__codelineno-82-15" name="__codelineno-82-15"></a><a href="#__codelineno-82-15"><span class="linenos" data-linenos=" 15 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-16" name="__codelineno-82-16"></a><a href="#__codelineno-82-16"><span class="linenos" data-linenos=" 16 "></span></a><span class="sd">Setting strict to true will stop the algorithm (and</span>
<a id="__codelineno-82-17" name="__codelineno-82-17"></a><a href="#__codelineno-82-17"><span class="linenos" data-linenos=" 17 "></span></a><span class="sd">return (-1, -1)) if we don&#39;t have a correct</span>
<a id="__codelineno-82-18" name="__codelineno-82-18"></a><a href="#__codelineno-82-18"><span class="linenos" data-linenos=" 18 "></span></a><span class="sd">upperbound on the determinant. Note that this</span>
<a id="__codelineno-82-19" name="__codelineno-82-19"></a><a href="#__codelineno-82-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="sd">doesn&#39;t necesseraly mean that no solutions</span>
<a id="__codelineno-82-20" name="__codelineno-82-20"></a><a href="#__codelineno-82-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="sd">will be found since the theoretical upperbound is</span>
<a id="__codelineno-82-21" name="__codelineno-82-21"></a><a href="#__codelineno-82-21"><span class="linenos" data-linenos=" 21 "></span></a><span class="sd">usualy far away from actual results. That is why</span>
<a id="__codelineno-82-22" name="__codelineno-82-22"></a><a href="#__codelineno-82-22"><span class="linenos" data-linenos=" 22 "></span></a><span class="sd">you should probably use `strict = False`</span>
<a id="__codelineno-82-23" name="__codelineno-82-23"></a><a href="#__codelineno-82-23"><span class="linenos" data-linenos=" 23 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-24" name="__codelineno-82-24"></a><a href="#__codelineno-82-24"><span class="linenos" data-linenos=" 24 "></span></a><span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-82-25" name="__codelineno-82-25"></a><a href="#__codelineno-82-25"><span class="linenos" data-linenos=" 25 "></span></a>
<a id="__codelineno-82-26" name="__codelineno-82-26"></a><a href="#__codelineno-82-26"><span class="linenos" data-linenos=" 26 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-27" name="__codelineno-82-27"></a><a href="#__codelineno-82-27"><span class="linenos" data-linenos=" 27 "></span></a><span class="sd">This is experimental, but has provided remarkable results</span>
<a id="__codelineno-82-28" name="__codelineno-82-28"></a><a href="#__codelineno-82-28"><span class="linenos" data-linenos=" 28 "></span></a><span class="sd">so far. It tries to reduce the lattice as much as it can</span>
<a id="__codelineno-82-29" name="__codelineno-82-29"></a><a href="#__codelineno-82-29"><span class="linenos" data-linenos=" 29 "></span></a><span class="sd">while keeping its efficiency. I see no reason not to use</span>
<a id="__codelineno-82-30" name="__codelineno-82-30"></a><a href="#__codelineno-82-30"><span class="linenos" data-linenos=" 30 "></span></a><span class="sd">this option, but if things don&#39;t work, you should try</span>
<a id="__codelineno-82-31" name="__codelineno-82-31"></a><a href="#__codelineno-82-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="sd">disabling it</span>
<a id="__codelineno-82-32" name="__codelineno-82-32"></a><a href="#__codelineno-82-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-33" name="__codelineno-82-33"></a><a href="#__codelineno-82-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="n">helpful_only</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-82-34" name="__codelineno-82-34"></a><a href="#__codelineno-82-34"><span class="linenos" data-linenos=" 34 "></span></a><span class="n">dimension_min</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1">## stop removing if lattice reaches that dimension</span>
<a id="__codelineno-82-35" name="__codelineno-82-35"></a><a href="#__codelineno-82-35"><span class="linenos" data-linenos=" 35 "></span></a>
<a id="__codelineno-82-36" name="__codelineno-82-36"></a><a href="#__codelineno-82-36"><span class="linenos" data-linenos=" 36 "></span></a><span class="c1">############################################</span>
<a id="__codelineno-82-37" name="__codelineno-82-37"></a><a href="#__codelineno-82-37"><span class="linenos" data-linenos=" 37 "></span></a><span class="c1">## Functions</span>
<a id="__codelineno-82-38" name="__codelineno-82-38"></a><a href="#__codelineno-82-38"><span class="linenos" data-linenos=" 38 "></span></a><span class="c1">##########################################</span>
<a id="__codelineno-82-39" name="__codelineno-82-39"></a><a href="#__codelineno-82-39"><span class="linenos" data-linenos=" 39 "></span></a>
<a id="__codelineno-82-40" name="__codelineno-82-40"></a><a href="#__codelineno-82-40"><span class="linenos" data-linenos=" 40 "></span></a><span class="c1">## display stats on helpful vectors</span>
<a id="__codelineno-82-41" name="__codelineno-82-41"></a><a href="#__codelineno-82-41"><span class="linenos" data-linenos=" 41 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">helpful_vectors</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="p">):</span>
<a id="__codelineno-82-42" name="__codelineno-82-42"></a><a href="#__codelineno-82-42"><span class="linenos" data-linenos=" 42 "></span></a>    <span class="n">nothelpful</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-82-43" name="__codelineno-82-43"></a><a href="#__codelineno-82-43"><span class="linenos" data-linenos=" 43 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-82-44" name="__codelineno-82-44"></a><a href="#__codelineno-82-44"><span class="linenos" data-linenos=" 44 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">modulus</span><span class="p">:</span>
<a id="__codelineno-82-45" name="__codelineno-82-45"></a><a href="#__codelineno-82-45"><span class="linenos" data-linenos=" 45 "></span></a>            <span class="n">nothelpful</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-82-46" name="__codelineno-82-46"></a><a href="#__codelineno-82-46"><span class="linenos" data-linenos=" 46 "></span></a>
<a id="__codelineno-82-47" name="__codelineno-82-47"></a><a href="#__codelineno-82-47"><span class="linenos" data-linenos=" 47 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">nothelpful</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; vectors are not helpful&quot;</span><span class="p">)</span>
<a id="__codelineno-82-48" name="__codelineno-82-48"></a><a href="#__codelineno-82-48"><span class="linenos" data-linenos=" 48 "></span></a>
<a id="__codelineno-82-49" name="__codelineno-82-49"></a><a href="#__codelineno-82-49"><span class="linenos" data-linenos=" 49 "></span></a><span class="c1">## display matrix picture with 0 and X</span>
<a id="__codelineno-82-50" name="__codelineno-82-50"></a><a href="#__codelineno-82-50"><span class="linenos" data-linenos=" 50 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">matrix_overview</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">bound</span><span class="p">):</span>
<a id="__codelineno-82-51" name="__codelineno-82-51"></a><a href="#__codelineno-82-51"><span class="linenos" data-linenos=" 51 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-82-52" name="__codelineno-82-52"></a><a href="#__codelineno-82-52"><span class="linenos" data-linenos=" 52 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%02d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-82-53" name="__codelineno-82-53"></a><a href="#__codelineno-82-53"><span class="linenos" data-linenos=" 53 "></span></a>        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-82-54" name="__codelineno-82-54"></a><a href="#__codelineno-82-54"><span class="linenos" data-linenos=" 54 "></span></a>            <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span> <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;X&#39;</span>
<a id="__codelineno-82-55" name="__codelineno-82-55"></a><a href="#__codelineno-82-55"><span class="linenos" data-linenos=" 55 "></span></a>            <span class="k">if</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
<a id="__codelineno-82-56" name="__codelineno-82-56"></a><a href="#__codelineno-82-56"><span class="linenos" data-linenos=" 56 "></span></a>                <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
<a id="__codelineno-82-57" name="__codelineno-82-57"></a><a href="#__codelineno-82-57"><span class="linenos" data-linenos=" 57 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-82-58" name="__codelineno-82-58"></a><a href="#__codelineno-82-58"><span class="linenos" data-linenos=" 58 "></span></a>            <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39;~&#39;</span>
<a id="__codelineno-82-59" name="__codelineno-82-59"></a><a href="#__codelineno-82-59"><span class="linenos" data-linenos=" 59 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<a id="__codelineno-82-60" name="__codelineno-82-60"></a><a href="#__codelineno-82-60"><span class="linenos" data-linenos=" 60 "></span></a>
<a id="__codelineno-82-61" name="__codelineno-82-61"></a><a href="#__codelineno-82-61"><span class="linenos" data-linenos=" 61 "></span></a><span class="c1">## tries to remove unhelpful vectors</span>
<a id="__codelineno-82-62" name="__codelineno-82-62"></a><a href="#__codelineno-82-62"><span class="linenos" data-linenos=" 62 "></span></a><span class="c1">## we start at current = n-1 (last vector)</span>
<a id="__codelineno-82-63" name="__codelineno-82-63"></a><a href="#__codelineno-82-63"><span class="linenos" data-linenos=" 63 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
<a id="__codelineno-82-64" name="__codelineno-82-64"></a><a href="#__codelineno-82-64"><span class="linenos" data-linenos=" 64 "></span></a>    <span class="c1">## end of our recursive function</span>
<a id="__codelineno-82-65" name="__codelineno-82-65"></a><a href="#__codelineno-82-65"><span class="linenos" data-linenos=" 65 "></span></a>    <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dimension_min</span><span class="p">:</span>
<a id="__codelineno-82-66" name="__codelineno-82-66"></a><a href="#__codelineno-82-66"><span class="linenos" data-linenos=" 66 "></span></a>        <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-82-67" name="__codelineno-82-67"></a><a href="#__codelineno-82-67"><span class="linenos" data-linenos=" 67 "></span></a>
<a id="__codelineno-82-68" name="__codelineno-82-68"></a><a href="#__codelineno-82-68"><span class="linenos" data-linenos=" 68 "></span></a>    <span class="c1">## we start by checking from the end</span>
<a id="__codelineno-82-69" name="__codelineno-82-69"></a><a href="#__codelineno-82-69"><span class="linenos" data-linenos=" 69 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-70" name="__codelineno-82-70"></a><a href="#__codelineno-82-70"><span class="linenos" data-linenos=" 70 "></span></a>        <span class="c1">## if it is unhelpful:</span>
<a id="__codelineno-82-71" name="__codelineno-82-71"></a><a href="#__codelineno-82-71"><span class="linenos" data-linenos=" 71 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-82-72" name="__codelineno-82-72"></a><a href="#__codelineno-82-72"><span class="linenos" data-linenos=" 72 "></span></a>            <span class="n">affected_vectors</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-82-73" name="__codelineno-82-73"></a><a href="#__codelineno-82-73"><span class="linenos" data-linenos=" 73 "></span></a>            <span class="n">affected_vector_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-82-74" name="__codelineno-82-74"></a><a href="#__codelineno-82-74"><span class="linenos" data-linenos=" 74 "></span></a>            <span class="c1">## let&#39;s check if it affects other vectors</span>
<a id="__codelineno-82-75" name="__codelineno-82-75"></a><a href="#__codelineno-82-75"><span class="linenos" data-linenos=" 75 "></span></a>            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-82-76" name="__codelineno-82-76"></a><a href="#__codelineno-82-76"><span class="linenos" data-linenos=" 76 "></span></a>                <span class="c1">## if another vector is affected:</span>
<a id="__codelineno-82-77" name="__codelineno-82-77"></a><a href="#__codelineno-82-77"><span class="linenos" data-linenos=" 77 "></span></a>                <span class="c1">## we increase the count</span>
<a id="__codelineno-82-78" name="__codelineno-82-78"></a><a href="#__codelineno-82-78"><span class="linenos" data-linenos=" 78 "></span></a>                <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-82-79" name="__codelineno-82-79"></a><a href="#__codelineno-82-79"><span class="linenos" data-linenos=" 79 "></span></a>                    <span class="n">affected_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-82-80" name="__codelineno-82-80"></a><a href="#__codelineno-82-80"><span class="linenos" data-linenos=" 80 "></span></a>                    <span class="n">affected_vector_index</span> <span class="o">=</span> <span class="n">jj</span>
<a id="__codelineno-82-81" name="__codelineno-82-81"></a><a href="#__codelineno-82-81"><span class="linenos" data-linenos=" 81 "></span></a>
<a id="__codelineno-82-82" name="__codelineno-82-82"></a><a href="#__codelineno-82-82"><span class="linenos" data-linenos=" 82 "></span></a>            <span class="c1">## level:0</span>
<a id="__codelineno-82-83" name="__codelineno-82-83"></a><a href="#__codelineno-82-83"><span class="linenos" data-linenos=" 83 "></span></a>            <span class="c1">## if no other vectors end up affected</span>
<a id="__codelineno-82-84" name="__codelineno-82-84"></a><a href="#__codelineno-82-84"><span class="linenos" data-linenos=" 84 "></span></a>            <span class="c1">## we remove it</span>
<a id="__codelineno-82-85" name="__codelineno-82-85"></a><a href="#__codelineno-82-85"><span class="linenos" data-linenos=" 85 "></span></a>            <span class="k">if</span> <span class="n">affected_vectors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-82-86" name="__codelineno-82-86"></a><a href="#__codelineno-82-86"><span class="linenos" data-linenos=" 86 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* removing unhelpful vector&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-82-87" name="__codelineno-82-87"></a><a href="#__codelineno-82-87"><span class="linenos" data-linenos=" 87 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_columns</span><span class="p">([</span><span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-82-88" name="__codelineno-82-88"></a><a href="#__codelineno-82-88"><span class="linenos" data-linenos=" 88 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">([</span><span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-82-89" name="__codelineno-82-89"></a><a href="#__codelineno-82-89"><span class="linenos" data-linenos=" 89 "></span></a>                <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-82-90" name="__codelineno-82-90"></a><a href="#__codelineno-82-90"><span class="linenos" data-linenos=" 90 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-82-91" name="__codelineno-82-91"></a><a href="#__codelineno-82-91"><span class="linenos" data-linenos=" 91 "></span></a>                <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-82-92" name="__codelineno-82-92"></a><a href="#__codelineno-82-92"><span class="linenos" data-linenos=" 92 "></span></a>
<a id="__codelineno-82-93" name="__codelineno-82-93"></a><a href="#__codelineno-82-93"><span class="linenos" data-linenos=" 93 "></span></a>            <span class="c1">## level:1</span>
<a id="__codelineno-82-94" name="__codelineno-82-94"></a><a href="#__codelineno-82-94"><span class="linenos" data-linenos=" 94 "></span></a>            <span class="c1">## if just one was affected we check</span>
<a id="__codelineno-82-95" name="__codelineno-82-95"></a><a href="#__codelineno-82-95"><span class="linenos" data-linenos=" 95 "></span></a>            <span class="c1">## if it is affecting someone else</span>
<a id="__codelineno-82-96" name="__codelineno-82-96"></a><a href="#__codelineno-82-96"><span class="linenos" data-linenos=" 96 "></span></a>            <span class="k">elif</span> <span class="n">affected_vectors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-82-97" name="__codelineno-82-97"></a><a href="#__codelineno-82-97"><span class="linenos" data-linenos=" 97 "></span></a>                <span class="n">affected_deeper</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-82-98" name="__codelineno-82-98"></a><a href="#__codelineno-82-98"><span class="linenos" data-linenos=" 98 "></span></a>                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">affected_vector_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-82-99" name="__codelineno-82-99"></a><a href="#__codelineno-82-99"><span class="linenos" data-linenos=" 99 "></span></a>                    <span class="c1">## if it is affecting even one vector</span>
<a id="__codelineno-82-100" name="__codelineno-82-100"></a><a href="#__codelineno-82-100"><span class="linenos" data-linenos="100 "></span></a>                    <span class="c1">## we give up on this one</span>
<a id="__codelineno-82-101" name="__codelineno-82-101"></a><a href="#__codelineno-82-101"><span class="linenos" data-linenos="101 "></span></a>                    <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-82-102" name="__codelineno-82-102"></a><a href="#__codelineno-82-102"><span class="linenos" data-linenos="102 "></span></a>                        <span class="n">affected_deeper</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-82-103" name="__codelineno-82-103"></a><a href="#__codelineno-82-103"><span class="linenos" data-linenos="103 "></span></a>                <span class="c1">## remove both it if no other vector was affected and</span>
<a id="__codelineno-82-104" name="__codelineno-82-104"></a><a href="#__codelineno-82-104"><span class="linenos" data-linenos="104 "></span></a>                <span class="c1">## this helpful vector is not helpful enough</span>
<a id="__codelineno-82-105" name="__codelineno-82-105"></a><a href="#__codelineno-82-105"><span class="linenos" data-linenos="105 "></span></a>                <span class="c1">## compared to our unhelpful one</span>
<a id="__codelineno-82-106" name="__codelineno-82-106"></a><a href="#__codelineno-82-106"><span class="linenos" data-linenos="106 "></span></a>                <span class="k">if</span> <span class="n">affected_deeper</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="n">BB</span><span class="p">[</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]):</span>
<a id="__codelineno-82-107" name="__codelineno-82-107"></a><a href="#__codelineno-82-107"><span class="linenos" data-linenos="107 "></span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* removing unhelpful vectors&quot;</span><span class="p">,</span> <span class="n">ii</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">)</span>
<a id="__codelineno-82-108" name="__codelineno-82-108"></a><a href="#__codelineno-82-108"><span class="linenos" data-linenos="108 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_columns</span><span class="p">([</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-82-109" name="__codelineno-82-109"></a><a href="#__codelineno-82-109"><span class="linenos" data-linenos="109 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">([</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-82-110" name="__codelineno-82-110"></a><a href="#__codelineno-82-110"><span class="linenos" data-linenos="110 "></span></a>                    <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">affected_vector_index</span><span class="p">)</span>
<a id="__codelineno-82-111" name="__codelineno-82-111"></a><a href="#__codelineno-82-111"><span class="linenos" data-linenos="111 "></span></a>                    <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-82-112" name="__codelineno-82-112"></a><a href="#__codelineno-82-112"><span class="linenos" data-linenos="112 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-82-113" name="__codelineno-82-113"></a><a href="#__codelineno-82-113"><span class="linenos" data-linenos="113 "></span></a>                    <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-82-114" name="__codelineno-82-114"></a><a href="#__codelineno-82-114"><span class="linenos" data-linenos="114 "></span></a>    <span class="c1">## nothing happened</span>
<a id="__codelineno-82-115" name="__codelineno-82-115"></a><a href="#__codelineno-82-115"><span class="linenos" data-linenos="115 "></span></a>    <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-82-116" name="__codelineno-82-116"></a><a href="#__codelineno-82-116"><span class="linenos" data-linenos="116 "></span></a>
<a id="__codelineno-82-117" name="__codelineno-82-117"></a><a href="#__codelineno-82-117"><span class="linenos" data-linenos="117 "></span></a><span class="sd">&quot;&quot;&quot; </span>
<a id="__codelineno-82-118" name="__codelineno-82-118"></a><a href="#__codelineno-82-118"><span class="linenos" data-linenos="118 "></span></a><span class="sd">Returns:</span>
<a id="__codelineno-82-119" name="__codelineno-82-119"></a><a href="#__codelineno-82-119"><span class="linenos" data-linenos="119 "></span></a><span class="sd">* 0,0   if it fails</span>
<a id="__codelineno-82-120" name="__codelineno-82-120"></a><a href="#__codelineno-82-120"><span class="linenos" data-linenos="120 "></span></a><span class="sd">* -1,-1 if `strict=true`, and determinant doesn&#39;t bound</span>
<a id="__codelineno-82-121" name="__codelineno-82-121"></a><a href="#__codelineno-82-121"><span class="linenos" data-linenos="121 "></span></a><span class="sd">* x0,y0 the solutions of `pol`</span>
<a id="__codelineno-82-122" name="__codelineno-82-122"></a><a href="#__codelineno-82-122"><span class="linenos" data-linenos="122 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-123" name="__codelineno-82-123"></a><a href="#__codelineno-82-123"><span class="linenos" data-linenos="123 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">boneh_durfee</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">modulus</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">):</span>
<a id="__codelineno-82-124" name="__codelineno-82-124"></a><a href="#__codelineno-82-124"><span class="linenos" data-linenos="124 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-82-125" name="__codelineno-82-125"></a><a href="#__codelineno-82-125"><span class="linenos" data-linenos="125 "></span></a><span class="sd">    Boneh and Durfee revisited by Herrmann and May</span>
<a id="__codelineno-82-126" name="__codelineno-82-126"></a><a href="#__codelineno-82-126"><span class="linenos" data-linenos="126 "></span></a>
<a id="__codelineno-82-127" name="__codelineno-82-127"></a><a href="#__codelineno-82-127"><span class="linenos" data-linenos="127 "></span></a><span class="sd">    finds a solution if:</span>
<a id="__codelineno-82-128" name="__codelineno-82-128"></a><a href="#__codelineno-82-128"><span class="linenos" data-linenos="128 "></span></a><span class="sd">    * d &lt; N^delta</span>
<a id="__codelineno-82-129" name="__codelineno-82-129"></a><a href="#__codelineno-82-129"><span class="linenos" data-linenos="129 "></span></a><span class="sd">    * |x| &lt; e^delta</span>
<a id="__codelineno-82-130" name="__codelineno-82-130"></a><a href="#__codelineno-82-130"><span class="linenos" data-linenos="130 "></span></a><span class="sd">    * |y| &lt; e^0.5</span>
<a id="__codelineno-82-131" name="__codelineno-82-131"></a><a href="#__codelineno-82-131"><span class="linenos" data-linenos="131 "></span></a><span class="sd">    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292</span>
<a id="__codelineno-82-132" name="__codelineno-82-132"></a><a href="#__codelineno-82-132"><span class="linenos" data-linenos="132 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-82-133" name="__codelineno-82-133"></a><a href="#__codelineno-82-133"><span class="linenos" data-linenos="133 "></span></a>
<a id="__codelineno-82-134" name="__codelineno-82-134"></a><a href="#__codelineno-82-134"><span class="linenos" data-linenos="134 "></span></a>    <span class="c1">## substitution (Herrman and May)</span>
<a id="__codelineno-82-135" name="__codelineno-82-135"></a><a href="#__codelineno-82-135"><span class="linenos" data-linenos="135 "></span></a>    <span class="n">PR</span><span class="o">.&lt;</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-82-136" name="__codelineno-82-136"></a><a href="#__codelineno-82-136"><span class="linenos" data-linenos="136 "></span></a>    <span class="n">Q</span> <span class="o">=</span> <span class="n">PR</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="c1">## u = xy + 1</span>
<a id="__codelineno-82-137" name="__codelineno-82-137"></a><a href="#__codelineno-82-137"><span class="linenos" data-linenos="137 "></span></a>    <span class="n">polZ</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
<a id="__codelineno-82-138" name="__codelineno-82-138"></a><a href="#__codelineno-82-138"><span class="linenos" data-linenos="138 "></span></a>
<a id="__codelineno-82-139" name="__codelineno-82-139"></a><a href="#__codelineno-82-139"><span class="linenos" data-linenos="139 "></span></a>    <span class="n">UU</span> <span class="o">=</span> <span class="n">XX</span><span class="o">*</span><span class="n">YY</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-82-140" name="__codelineno-82-140"></a><a href="#__codelineno-82-140"><span class="linenos" data-linenos="140 "></span></a>
<a id="__codelineno-82-141" name="__codelineno-82-141"></a><a href="#__codelineno-82-141"><span class="linenos" data-linenos="141 "></span></a>    <span class="c1">## x-shifts</span>
<a id="__codelineno-82-142" name="__codelineno-82-142"></a><a href="#__codelineno-82-142"><span class="linenos" data-linenos="142 "></span></a>    <span class="n">gg</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-82-143" name="__codelineno-82-143"></a><a href="#__codelineno-82-143"><span class="linenos" data-linenos="143 "></span></a>    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-144" name="__codelineno-82-144"></a><a href="#__codelineno-82-144"><span class="linenos" data-linenos="144 "></span></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-145" name="__codelineno-82-145"></a><a href="#__codelineno-82-145"><span class="linenos" data-linenos="145 "></span></a>            <span class="n">xshift</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">ii</span> <span class="o">*</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span><span class="p">)</span> <span class="o">*</span> <span class="n">polZ</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="n">kk</span>
<a id="__codelineno-82-146" name="__codelineno-82-146"></a><a href="#__codelineno-82-146"><span class="linenos" data-linenos="146 "></span></a>            <span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xshift</span><span class="p">)</span>
<a id="__codelineno-82-147" name="__codelineno-82-147"></a><a href="#__codelineno-82-147"><span class="linenos" data-linenos="147 "></span></a>    <span class="n">gg</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-82-148" name="__codelineno-82-148"></a><a href="#__codelineno-82-148"><span class="linenos" data-linenos="148 "></span></a>
<a id="__codelineno-82-149" name="__codelineno-82-149"></a><a href="#__codelineno-82-149"><span class="linenos" data-linenos="149 "></span></a>    <span class="c1">## x-shifts list of monomials</span>
<a id="__codelineno-82-150" name="__codelineno-82-150"></a><a href="#__codelineno-82-150"><span class="linenos" data-linenos="150 "></span></a>    <span class="n">monomials</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-82-151" name="__codelineno-82-151"></a><a href="#__codelineno-82-151"><span class="linenos" data-linenos="151 "></span></a>    <span class="k">for</span> <span class="n">polynomial</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">:</span>
<a id="__codelineno-82-152" name="__codelineno-82-152"></a><a href="#__codelineno-82-152"><span class="linenos" data-linenos="152 "></span></a>        <span class="k">for</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">polynomial</span><span class="o">.</span><span class="n">monomials</span><span class="p">():</span>
<a id="__codelineno-82-153" name="__codelineno-82-153"></a><a href="#__codelineno-82-153"><span class="linenos" data-linenos="153 "></span></a>            <span class="k">if</span> <span class="n">monomial</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">monomials</span><span class="p">:</span>
<a id="__codelineno-82-154" name="__codelineno-82-154"></a><a href="#__codelineno-82-154"><span class="linenos" data-linenos="154 "></span></a>                <span class="n">monomials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monomial</span><span class="p">)</span>
<a id="__codelineno-82-155" name="__codelineno-82-155"></a><a href="#__codelineno-82-155"><span class="linenos" data-linenos="155 "></span></a>    <span class="n">monomials</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-82-156" name="__codelineno-82-156"></a><a href="#__codelineno-82-156"><span class="linenos" data-linenos="156 "></span></a>
<a id="__codelineno-82-157" name="__codelineno-82-157"></a><a href="#__codelineno-82-157"><span class="linenos" data-linenos="157 "></span></a>    <span class="c1">## y-shifts (selected by Herrman and May)</span>
<a id="__codelineno-82-158" name="__codelineno-82-158"></a><a href="#__codelineno-82-158"><span class="linenos" data-linenos="158 "></span></a>    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-159" name="__codelineno-82-159"></a><a href="#__codelineno-82-159"><span class="linenos" data-linenos="159 "></span></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">mm</span><span class="o">/</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-160" name="__codelineno-82-160"></a><a href="#__codelineno-82-160"><span class="linenos" data-linenos="160 "></span></a>            <span class="n">yshift</span> <span class="o">=</span> <span class="n">y</span><span class="o">^</span><span class="n">jj</span> <span class="o">*</span> <span class="n">polZ</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="n">kk</span> <span class="o">*</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span><span class="p">)</span>
<a id="__codelineno-82-161" name="__codelineno-82-161"></a><a href="#__codelineno-82-161"><span class="linenos" data-linenos="161 "></span></a>            <span class="n">yshift</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">yshift</span><span class="p">)</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
<a id="__codelineno-82-162" name="__codelineno-82-162"></a><a href="#__codelineno-82-162"><span class="linenos" data-linenos="162 "></span></a>            <span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yshift</span><span class="p">)</span> <span class="c1">## substitution</span>
<a id="__codelineno-82-163" name="__codelineno-82-163"></a><a href="#__codelineno-82-163"><span class="linenos" data-linenos="163 "></span></a>
<a id="__codelineno-82-164" name="__codelineno-82-164"></a><a href="#__codelineno-82-164"><span class="linenos" data-linenos="164 "></span></a>    <span class="c1">## y-shifts list of monomials</span>
<a id="__codelineno-82-165" name="__codelineno-82-165"></a><a href="#__codelineno-82-165"><span class="linenos" data-linenos="165 "></span></a>    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-166" name="__codelineno-82-166"></a><a href="#__codelineno-82-166"><span class="linenos" data-linenos="166 "></span></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">mm</span><span class="o">/</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-167" name="__codelineno-82-167"></a><a href="#__codelineno-82-167"><span class="linenos" data-linenos="167 "></span></a>            <span class="n">monomials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="o">^</span><span class="n">kk</span> <span class="o">*</span> <span class="n">y</span><span class="o">^</span><span class="n">jj</span><span class="p">)</span>
<a id="__codelineno-82-168" name="__codelineno-82-168"></a><a href="#__codelineno-82-168"><span class="linenos" data-linenos="168 "></span></a>
<a id="__codelineno-82-169" name="__codelineno-82-169"></a><a href="#__codelineno-82-169"><span class="linenos" data-linenos="169 "></span></a>    <span class="c1">## construct lattice B</span>
<a id="__codelineno-82-170" name="__codelineno-82-170"></a><a href="#__codelineno-82-170"><span class="linenos" data-linenos="170 "></span></a>    <span class="n">nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">monomials</span><span class="p">)</span>
<a id="__codelineno-82-171" name="__codelineno-82-171"></a><a href="#__codelineno-82-171"><span class="linenos" data-linenos="171 "></span></a>    <span class="n">BB</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>
<a id="__codelineno-82-172" name="__codelineno-82-172"></a><a href="#__codelineno-82-172"><span class="linenos" data-linenos="172 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-82-173" name="__codelineno-82-173"></a><a href="#__codelineno-82-173"><span class="linenos" data-linenos="173 "></span></a>        <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">](</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-82-174" name="__codelineno-82-174"></a><a href="#__codelineno-82-174"><span class="linenos" data-linenos="174 "></span></a>        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-175" name="__codelineno-82-175"></a><a href="#__codelineno-82-175"><span class="linenos" data-linenos="175 "></span></a>            <span class="k">if</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">monomials</span><span class="p">():</span>
<a id="__codelineno-82-176" name="__codelineno-82-176"></a><a href="#__codelineno-82-176"><span class="linenos" data-linenos="176 "></span></a>                <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">monomial_coefficient</span><span class="p">(</span><span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span> <span class="o">*</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-82-177" name="__codelineno-82-177"></a><a href="#__codelineno-82-177"><span class="linenos" data-linenos="177 "></span></a>
<a id="__codelineno-82-178" name="__codelineno-82-178"></a><a href="#__codelineno-82-178"><span class="linenos" data-linenos="178 "></span></a>    <span class="c1">## Prototype to reduce the lattice</span>
<a id="__codelineno-82-179" name="__codelineno-82-179"></a><a href="#__codelineno-82-179"><span class="linenos" data-linenos="179 "></span></a>    <span class="k">if</span> <span class="n">helpful_only</span><span class="p">:</span>
<a id="__codelineno-82-180" name="__codelineno-82-180"></a><a href="#__codelineno-82-180"><span class="linenos" data-linenos="180 "></span></a>        <span class="c1">## automatically remove</span>
<a id="__codelineno-82-181" name="__codelineno-82-181"></a><a href="#__codelineno-82-181"><span class="linenos" data-linenos="181 "></span></a>        <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">,</span> <span class="n">nn</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-82-182" name="__codelineno-82-182"></a><a href="#__codelineno-82-182"><span class="linenos" data-linenos="182 "></span></a>        <span class="c1">## reset dimension</span>
<a id="__codelineno-82-183" name="__codelineno-82-183"></a><a href="#__codelineno-82-183"><span class="linenos" data-linenos="183 "></span></a>        <span class="n">nn</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-82-184" name="__codelineno-82-184"></a><a href="#__codelineno-82-184"><span class="linenos" data-linenos="184 "></span></a>        <span class="k">if</span> <span class="n">nn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-82-185" name="__codelineno-82-185"></a><a href="#__codelineno-82-185"><span class="linenos" data-linenos="185 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failure&quot;</span><span class="p">)</span>
<a id="__codelineno-82-186" name="__codelineno-82-186"></a><a href="#__codelineno-82-186"><span class="linenos" data-linenos="186 "></span></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<a id="__codelineno-82-187" name="__codelineno-82-187"></a><a href="#__codelineno-82-187"><span class="linenos" data-linenos="187 "></span></a>
<a id="__codelineno-82-188" name="__codelineno-82-188"></a><a href="#__codelineno-82-188"><span class="linenos" data-linenos="188 "></span></a>    <span class="c1">## check if vectors are helpful</span>
<a id="__codelineno-82-189" name="__codelineno-82-189"></a><a href="#__codelineno-82-189"><span class="linenos" data-linenos="189 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-190" name="__codelineno-82-190"></a><a href="#__codelineno-82-190"><span class="linenos" data-linenos="190 "></span></a>        <span class="n">helpful_vectors</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">)</span>
<a id="__codelineno-82-191" name="__codelineno-82-191"></a><a href="#__codelineno-82-191"><span class="linenos" data-linenos="191 "></span></a>
<a id="__codelineno-82-192" name="__codelineno-82-192"></a><a href="#__codelineno-82-192"><span class="linenos" data-linenos="192 "></span></a>    <span class="c1">## check if determinant is correctly bounded</span>
<a id="__codelineno-82-193" name="__codelineno-82-193"></a><a href="#__codelineno-82-193"><span class="linenos" data-linenos="193 "></span></a>    <span class="n">det</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">det</span><span class="p">()</span>
<a id="__codelineno-82-194" name="__codelineno-82-194"></a><a href="#__codelineno-82-194"><span class="linenos" data-linenos="194 "></span></a>    <span class="n">bound</span> <span class="o">=</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span>
<a id="__codelineno-82-195" name="__codelineno-82-195"></a><a href="#__codelineno-82-195"><span class="linenos" data-linenos="195 "></span></a>    <span class="k">if</span> <span class="n">det</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-82-196" name="__codelineno-82-196"></a><a href="#__codelineno-82-196"><span class="linenos" data-linenos="196 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span><span class="p">)</span>
<a id="__codelineno-82-197" name="__codelineno-82-197"></a><a href="#__codelineno-82-197"><span class="linenos" data-linenos="197 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Try with highers m and t.&quot;</span><span class="p">)</span>
<a id="__codelineno-82-198" name="__codelineno-82-198"></a><a href="#__codelineno-82-198"><span class="linenos" data-linenos="198 "></span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-199" name="__codelineno-82-199"></a><a href="#__codelineno-82-199"><span class="linenos" data-linenos="199 "></span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">det</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">bound</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-82-200" name="__codelineno-82-200"></a><a href="#__codelineno-82-200"><span class="linenos" data-linenos="200 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;size det(L) - size e^(m*n) = &quot;</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
<a id="__codelineno-82-201" name="__codelineno-82-201"></a><a href="#__codelineno-82-201"><span class="linenos" data-linenos="201 "></span></a>        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
<a id="__codelineno-82-202" name="__codelineno-82-202"></a><a href="#__codelineno-82-202"><span class="linenos" data-linenos="202 "></span></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-82-203" name="__codelineno-82-203"></a><a href="#__codelineno-82-203"><span class="linenos" data-linenos="203 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-82-204" name="__codelineno-82-204"></a><a href="#__codelineno-82-204"><span class="linenos" data-linenos="204 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span><span class="p">)</span>
<a id="__codelineno-82-205" name="__codelineno-82-205"></a><a href="#__codelineno-82-205"><span class="linenos" data-linenos="205 "></span></a>
<a id="__codelineno-82-206" name="__codelineno-82-206"></a><a href="#__codelineno-82-206"><span class="linenos" data-linenos="206 "></span></a>    <span class="c1">## display the lattice basis</span>
<a id="__codelineno-82-207" name="__codelineno-82-207"></a><a href="#__codelineno-82-207"><span class="linenos" data-linenos="207 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-208" name="__codelineno-82-208"></a><a href="#__codelineno-82-208"><span class="linenos" data-linenos="208 "></span></a>        <span class="n">matrix_overview</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">)</span>
<a id="__codelineno-82-209" name="__codelineno-82-209"></a><a href="#__codelineno-82-209"><span class="linenos" data-linenos="209 "></span></a>
<a id="__codelineno-82-210" name="__codelineno-82-210"></a><a href="#__codelineno-82-210"><span class="linenos" data-linenos="210 "></span></a>    <span class="c1">## LLL</span>
<a id="__codelineno-82-211" name="__codelineno-82-211"></a><a href="#__codelineno-82-211"><span class="linenos" data-linenos="211 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-212" name="__codelineno-82-212"></a><a href="#__codelineno-82-212"><span class="linenos" data-linenos="212 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span><span class="p">)</span>
<a id="__codelineno-82-213" name="__codelineno-82-213"></a><a href="#__codelineno-82-213"><span class="linenos" data-linenos="213 "></span></a>
<a id="__codelineno-82-214" name="__codelineno-82-214"></a><a href="#__codelineno-82-214"><span class="linenos" data-linenos="214 "></span></a>    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">LLL</span><span class="p">()</span>
<a id="__codelineno-82-215" name="__codelineno-82-215"></a><a href="#__codelineno-82-215"><span class="linenos" data-linenos="215 "></span></a>
<a id="__codelineno-82-216" name="__codelineno-82-216"></a><a href="#__codelineno-82-216"><span class="linenos" data-linenos="216 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-217" name="__codelineno-82-217"></a><a href="#__codelineno-82-217"><span class="linenos" data-linenos="217 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;LLL is done!&quot;</span><span class="p">)</span>
<a id="__codelineno-82-218" name="__codelineno-82-218"></a><a href="#__codelineno-82-218"><span class="linenos" data-linenos="218 "></span></a>
<a id="__codelineno-82-219" name="__codelineno-82-219"></a><a href="#__codelineno-82-219"><span class="linenos" data-linenos="219 "></span></a>    <span class="c1">## transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span>
<a id="__codelineno-82-220" name="__codelineno-82-220"></a><a href="#__codelineno-82-220"><span class="linenos" data-linenos="220 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-221" name="__codelineno-82-221"></a><a href="#__codelineno-82-221"><span class="linenos" data-linenos="221 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;looking for independent vectors in the lattice&quot;</span><span class="p">)</span>
<a id="__codelineno-82-222" name="__codelineno-82-222"></a><a href="#__codelineno-82-222"><span class="linenos" data-linenos="222 "></span></a>    <span class="n">found_polynomials</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-82-223" name="__codelineno-82-223"></a><a href="#__codelineno-82-223"><span class="linenos" data-linenos="223 "></span></a>
<a id="__codelineno-82-224" name="__codelineno-82-224"></a><a href="#__codelineno-82-224"><span class="linenos" data-linenos="224 "></span></a>    <span class="k">for</span> <span class="n">pol1_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-82-225" name="__codelineno-82-225"></a><a href="#__codelineno-82-225"><span class="linenos" data-linenos="225 "></span></a>        <span class="k">for</span> <span class="n">pol2_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pol1_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-82-226" name="__codelineno-82-226"></a><a href="#__codelineno-82-226"><span class="linenos" data-linenos="226 "></span></a>            <span class="c1">## for i and j, create the two polynomials</span>
<a id="__codelineno-82-227" name="__codelineno-82-227"></a><a href="#__codelineno-82-227"><span class="linenos" data-linenos="227 "></span></a>            <span class="n">PR</span><span class="o">.&lt;</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-82-228" name="__codelineno-82-228"></a><a href="#__codelineno-82-228"><span class="linenos" data-linenos="228 "></span></a>            <span class="n">pol1</span> <span class="o">=</span> <span class="n">pol2</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-82-229" name="__codelineno-82-229"></a><a href="#__codelineno-82-229"><span class="linenos" data-linenos="229 "></span></a>            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-82-230" name="__codelineno-82-230"></a><a href="#__codelineno-82-230"><span class="linenos" data-linenos="230 "></span></a>                <span class="n">pol1</span> <span class="o">+=</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">BB</span><span class="p">[</span><span class="n">pol1_idx</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-82-231" name="__codelineno-82-231"></a><a href="#__codelineno-82-231"><span class="linenos" data-linenos="231 "></span></a>                <span class="n">pol2</span> <span class="o">+=</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">BB</span><span class="p">[</span><span class="n">pol2_idx</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-82-232" name="__codelineno-82-232"></a><a href="#__codelineno-82-232"><span class="linenos" data-linenos="232 "></span></a>
<a id="__codelineno-82-233" name="__codelineno-82-233"></a><a href="#__codelineno-82-233"><span class="linenos" data-linenos="233 "></span></a>            <span class="c1">## resultant</span>
<a id="__codelineno-82-234" name="__codelineno-82-234"></a><a href="#__codelineno-82-234"><span class="linenos" data-linenos="234 "></span></a>            <span class="n">PR</span><span class="o">.&lt;</span><span class="n">q</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-82-235" name="__codelineno-82-235"></a><a href="#__codelineno-82-235"><span class="linenos" data-linenos="235 "></span></a>            <span class="n">rr</span> <span class="o">=</span> <span class="n">pol1</span><span class="o">.</span><span class="n">resultant</span><span class="p">(</span><span class="n">pol2</span><span class="p">)</span>
<a id="__codelineno-82-236" name="__codelineno-82-236"></a><a href="#__codelineno-82-236"><span class="linenos" data-linenos="236 "></span></a>
<a id="__codelineno-82-237" name="__codelineno-82-237"></a><a href="#__codelineno-82-237"><span class="linenos" data-linenos="237 "></span></a>            <span class="c1">## are these good polynomials?</span>
<a id="__codelineno-82-238" name="__codelineno-82-238"></a><a href="#__codelineno-82-238"><span class="linenos" data-linenos="238 "></span></a>            <span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">is_zero</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rr</span><span class="o">.</span><span class="n">monomials</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-82-239" name="__codelineno-82-239"></a><a href="#__codelineno-82-239"><span class="linenos" data-linenos="239 "></span></a>                <span class="k">continue</span>
<a id="__codelineno-82-240" name="__codelineno-82-240"></a><a href="#__codelineno-82-240"><span class="linenos" data-linenos="240 "></span></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-82-241" name="__codelineno-82-241"></a><a href="#__codelineno-82-241"><span class="linenos" data-linenos="241 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found them, using vectors&quot;</span><span class="p">,</span> <span class="n">pol1_idx</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="n">pol2_idx</span><span class="p">)</span>
<a id="__codelineno-82-242" name="__codelineno-82-242"></a><a href="#__codelineno-82-242"><span class="linenos" data-linenos="242 "></span></a>                <span class="n">found_polynomials</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-82-243" name="__codelineno-82-243"></a><a href="#__codelineno-82-243"><span class="linenos" data-linenos="243 "></span></a>                <span class="k">break</span>
<a id="__codelineno-82-244" name="__codelineno-82-244"></a><a href="#__codelineno-82-244"><span class="linenos" data-linenos="244 "></span></a>        <span class="k">if</span> <span class="n">found_polynomials</span><span class="p">:</span>
<a id="__codelineno-82-245" name="__codelineno-82-245"></a><a href="#__codelineno-82-245"><span class="linenos" data-linenos="245 "></span></a>            <span class="k">break</span>
<a id="__codelineno-82-246" name="__codelineno-82-246"></a><a href="#__codelineno-82-246"><span class="linenos" data-linenos="246 "></span></a>
<a id="__codelineno-82-247" name="__codelineno-82-247"></a><a href="#__codelineno-82-247"><span class="linenos" data-linenos="247 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_polynomials</span><span class="p">:</span>
<a id="__codelineno-82-248" name="__codelineno-82-248"></a><a href="#__codelineno-82-248"><span class="linenos" data-linenos="248 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span><span class="p">)</span>
<a id="__codelineno-82-249" name="__codelineno-82-249"></a><a href="#__codelineno-82-249"><span class="linenos" data-linenos="249 "></span></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-82-250" name="__codelineno-82-250"></a><a href="#__codelineno-82-250"><span class="linenos" data-linenos="250 "></span></a>
<a id="__codelineno-82-251" name="__codelineno-82-251"></a><a href="#__codelineno-82-251"><span class="linenos" data-linenos="251 "></span></a>    <span class="n">rr</span> <span class="o">=</span> <span class="n">rr</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-82-252" name="__codelineno-82-252"></a><a href="#__codelineno-82-252"><span class="linenos" data-linenos="252 "></span></a>
<a id="__codelineno-82-253" name="__codelineno-82-253"></a><a href="#__codelineno-82-253"><span class="linenos" data-linenos="253 "></span></a>    <span class="c1">## solutions</span>
<a id="__codelineno-82-254" name="__codelineno-82-254"></a><a href="#__codelineno-82-254"><span class="linenos" data-linenos="254 "></span></a>    <span class="n">soly</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-82-255" name="__codelineno-82-255"></a><a href="#__codelineno-82-255"><span class="linenos" data-linenos="255 "></span></a>
<a id="__codelineno-82-256" name="__codelineno-82-256"></a><a href="#__codelineno-82-256"><span class="linenos" data-linenos="256 "></span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">soly</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-82-257" name="__codelineno-82-257"></a><a href="#__codelineno-82-257"><span class="linenos" data-linenos="257 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your prediction (delta) is too small&quot;</span><span class="p">)</span>
<a id="__codelineno-82-258" name="__codelineno-82-258"></a><a href="#__codelineno-82-258"><span class="linenos" data-linenos="258 "></span></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-82-259" name="__codelineno-82-259"></a><a href="#__codelineno-82-259"><span class="linenos" data-linenos="259 "></span></a>
<a id="__codelineno-82-260" name="__codelineno-82-260"></a><a href="#__codelineno-82-260"><span class="linenos" data-linenos="260 "></span></a>    <span class="n">soly</span> <span class="o">=</span> <span class="n">soly</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-82-261" name="__codelineno-82-261"></a><a href="#__codelineno-82-261"><span class="linenos" data-linenos="261 "></span></a>    <span class="n">ss</span> <span class="o">=</span> <span class="n">pol1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span>
<a id="__codelineno-82-262" name="__codelineno-82-262"></a><a href="#__codelineno-82-262"><span class="linenos" data-linenos="262 "></span></a>    <span class="n">solx</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">roots</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-82-263" name="__codelineno-82-263"></a><a href="#__codelineno-82-263"><span class="linenos" data-linenos="263 "></span></a>
<a id="__codelineno-82-264" name="__codelineno-82-264"></a><a href="#__codelineno-82-264"><span class="linenos" data-linenos="264 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-265" name="__codelineno-82-265"></a><a href="#__codelineno-82-265"><span class="linenos" data-linenos="265 "></span></a>    <span class="k">return</span> <span class="n">solx</span><span class="p">,</span> <span class="n">soly</span>
<a id="__codelineno-82-266" name="__codelineno-82-266"></a><a href="#__codelineno-82-266"><span class="linenos" data-linenos="266 "></span></a>
<a id="__codelineno-82-267" name="__codelineno-82-267"></a><a href="#__codelineno-82-267"><span class="linenos" data-linenos="267 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">example</span><span class="p">():</span>
<a id="__codelineno-82-268" name="__codelineno-82-268"></a><a href="#__codelineno-82-268"><span class="linenos" data-linenos="268 "></span></a>    <span class="c1">############################################</span>
<a id="__codelineno-82-269" name="__codelineno-82-269"></a><a href="#__codelineno-82-269"><span class="linenos" data-linenos="269 "></span></a>    <span class="c1">## How To Use This Script</span>
<a id="__codelineno-82-270" name="__codelineno-82-270"></a><a href="#__codelineno-82-270"><span class="linenos" data-linenos="270 "></span></a>    <span class="c1">##########################################</span>
<a id="__codelineno-82-271" name="__codelineno-82-271"></a><a href="#__codelineno-82-271"><span class="linenos" data-linenos="271 "></span></a>
<a id="__codelineno-82-272" name="__codelineno-82-272"></a><a href="#__codelineno-82-272"><span class="linenos" data-linenos="272 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-273" name="__codelineno-82-273"></a><a href="#__codelineno-82-273"><span class="linenos" data-linenos="273 "></span></a>    <span class="c1">## The problem to solve (edit the following values)</span>
<a id="__codelineno-82-274" name="__codelineno-82-274"></a><a href="#__codelineno-82-274"><span class="linenos" data-linenos="274 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-275" name="__codelineno-82-275"></a><a href="#__codelineno-82-275"><span class="linenos" data-linenos="275 "></span></a>
<a id="__codelineno-82-276" name="__codelineno-82-276"></a><a href="#__codelineno-82-276"><span class="linenos" data-linenos="276 "></span></a>    <span class="c1">## the modulus</span>
<a id="__codelineno-82-277" name="__codelineno-82-277"></a><a href="#__codelineno-82-277"><span class="linenos" data-linenos="277 "></span></a>    <span class="n">N</span> <span class="o">=</span> <span class="mi">116518679305515263290840706715579691213922169271634579327519562902613543582623449606741546472920401997930041388553141909069487589461948798111698856100819163407893673249162209631978914843896272256274862501461321020961958367098759183487116417487922645782638510876609728886007680825340200888068103951956139343723</span>
<a id="__codelineno-82-278" name="__codelineno-82-278"></a><a href="#__codelineno-82-278"><span class="linenos" data-linenos="278 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mi">113449247876071397911206070019495939088171696712182747502133063172021565345788627261740950665891922659340020397229619329204520999096535909867327960323598168596664323692312516466648588320607291284630435682282630745947689431909998401389566081966753438869725583665294310689820290368901166811028660086977458571233</span>
<a id="__codelineno-82-279" name="__codelineno-82-279"></a><a href="#__codelineno-82-279"><span class="linenos" data-linenos="279 "></span></a>    <span class="c1">## the public exponent</span>
<a id="__codelineno-82-280" name="__codelineno-82-280"></a><a href="#__codelineno-82-280"><span class="linenos" data-linenos="280 "></span></a>    <span class="c1">## the hypothesis on the private exponent (the theoretical maximum is 0.292)</span>
<a id="__codelineno-82-281" name="__codelineno-82-281"></a><a href="#__codelineno-82-281"><span class="linenos" data-linenos="281 "></span></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mf">.27</span> <span class="c1">## this means that d &lt; N^delta</span>
<a id="__codelineno-82-282" name="__codelineno-82-282"></a><a href="#__codelineno-82-282"><span class="linenos" data-linenos="282 "></span></a>
<a id="__codelineno-82-283" name="__codelineno-82-283"></a><a href="#__codelineno-82-283"><span class="linenos" data-linenos="283 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-284" name="__codelineno-82-284"></a><a href="#__codelineno-82-284"><span class="linenos" data-linenos="284 "></span></a>    <span class="c1">## Lattice (tweak those values)</span>
<a id="__codelineno-82-285" name="__codelineno-82-285"></a><a href="#__codelineno-82-285"><span class="linenos" data-linenos="285 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-286" name="__codelineno-82-286"></a><a href="#__codelineno-82-286"><span class="linenos" data-linenos="286 "></span></a>
<a id="__codelineno-82-287" name="__codelineno-82-287"></a><a href="#__codelineno-82-287"><span class="linenos" data-linenos="287 "></span></a>    <span class="c1">## you should tweak this (after a first run), (e.g. increment it until a solution is found)</span>
<a id="__codelineno-82-288" name="__codelineno-82-288"></a><a href="#__codelineno-82-288"><span class="linenos" data-linenos="288 "></span></a>    <span class="n">m</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1">## size of the lattice (bigger the better/slower)</span>
<a id="__codelineno-82-289" name="__codelineno-82-289"></a><a href="#__codelineno-82-289"><span class="linenos" data-linenos="289 "></span></a>
<a id="__codelineno-82-290" name="__codelineno-82-290"></a><a href="#__codelineno-82-290"><span class="linenos" data-linenos="290 "></span></a>    <span class="c1">## you need to be a lattice master to tweak these</span>
<a id="__codelineno-82-291" name="__codelineno-82-291"></a><a href="#__codelineno-82-291"><span class="linenos" data-linenos="291 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span>  <span class="c1">## optimization from Herrmann and May</span>
<a id="__codelineno-82-292" name="__codelineno-82-292"></a><a href="#__codelineno-82-292"><span class="linenos" data-linenos="292 "></span></a>    <span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">^</span><span class="n">delta</span><span class="p">)</span>  <span class="c1">## this _might_ be too much</span>
<a id="__codelineno-82-293" name="__codelineno-82-293"></a><a href="#__codelineno-82-293"><span class="linenos" data-linenos="293 "></span></a>    <span class="n">Y</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>    <span class="c1">## correct if p, q are ~ same size</span>
<a id="__codelineno-82-294" name="__codelineno-82-294"></a><a href="#__codelineno-82-294"><span class="linenos" data-linenos="294 "></span></a>
<a id="__codelineno-82-295" name="__codelineno-82-295"></a><a href="#__codelineno-82-295"><span class="linenos" data-linenos="295 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-296" name="__codelineno-82-296"></a><a href="#__codelineno-82-296"><span class="linenos" data-linenos="296 "></span></a>    <span class="c1">## Don&#39;t touch anything below</span>
<a id="__codelineno-82-297" name="__codelineno-82-297"></a><a href="#__codelineno-82-297"><span class="linenos" data-linenos="297 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-298" name="__codelineno-82-298"></a><a href="#__codelineno-82-298"><span class="linenos" data-linenos="298 "></span></a>
<a id="__codelineno-82-299" name="__codelineno-82-299"></a><a href="#__codelineno-82-299"><span class="linenos" data-linenos="299 "></span></a>    <span class="c1">## Problem put in equation</span>
<a id="__codelineno-82-300" name="__codelineno-82-300"></a><a href="#__codelineno-82-300"><span class="linenos" data-linenos="300 "></span></a>    <span class="n">P</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-82-301" name="__codelineno-82-301"></a><a href="#__codelineno-82-301"><span class="linenos" data-linenos="301 "></span></a>    <span class="n">A</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-82-302" name="__codelineno-82-302"></a><a href="#__codelineno-82-302"><span class="linenos" data-linenos="302 "></span></a>    <span class="n">pol</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-82-303" name="__codelineno-82-303"></a><a href="#__codelineno-82-303"><span class="linenos" data-linenos="303 "></span></a>
<a id="__codelineno-82-304" name="__codelineno-82-304"></a><a href="#__codelineno-82-304"><span class="linenos" data-linenos="304 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-305" name="__codelineno-82-305"></a><a href="#__codelineno-82-305"><span class="linenos" data-linenos="305 "></span></a>    <span class="c1">## Find the solutions!</span>
<a id="__codelineno-82-306" name="__codelineno-82-306"></a><a href="#__codelineno-82-306"><span class="linenos" data-linenos="306 "></span></a>    <span class="c1">#</span>
<a id="__codelineno-82-307" name="__codelineno-82-307"></a><a href="#__codelineno-82-307"><span class="linenos" data-linenos="307 "></span></a>
<a id="__codelineno-82-308" name="__codelineno-82-308"></a><a href="#__codelineno-82-308"><span class="linenos" data-linenos="308 "></span></a>    <span class="c1">## Checking bounds</span>
<a id="__codelineno-82-309" name="__codelineno-82-309"></a><a href="#__codelineno-82-309"><span class="linenos" data-linenos="309 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-310" name="__codelineno-82-310"></a><a href="#__codelineno-82-310"><span class="linenos" data-linenos="310 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== checking values ===&quot;</span><span class="p">)</span>
<a id="__codelineno-82-311" name="__codelineno-82-311"></a><a href="#__codelineno-82-311"><span class="linenos" data-linenos="311 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* delta:&quot;</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<a id="__codelineno-82-312" name="__codelineno-82-312"></a><a href="#__codelineno-82-312"><span class="linenos" data-linenos="312 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* delta &lt; 0.292&quot;</span><span class="p">,</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.292</span><span class="p">)</span>
<a id="__codelineno-82-313" name="__codelineno-82-313"></a><a href="#__codelineno-82-313"><span class="linenos" data-linenos="313 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* size of e:&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-82-314" name="__codelineno-82-314"></a><a href="#__codelineno-82-314"><span class="linenos" data-linenos="314 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* size of N:&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-82-315" name="__codelineno-82-315"></a><a href="#__codelineno-82-315"><span class="linenos" data-linenos="315 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;* m:&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s2">&quot;, t:&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<a id="__codelineno-82-316" name="__codelineno-82-316"></a><a href="#__codelineno-82-316"><span class="linenos" data-linenos="316 "></span></a>
<a id="__codelineno-82-317" name="__codelineno-82-317"></a><a href="#__codelineno-82-317"><span class="linenos" data-linenos="317 "></span></a>    <span class="c1">## boneh_durfee</span>
<a id="__codelineno-82-318" name="__codelineno-82-318"></a><a href="#__codelineno-82-318"><span class="linenos" data-linenos="318 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-319" name="__codelineno-82-319"></a><a href="#__codelineno-82-319"><span class="linenos" data-linenos="319 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== running algorithm ===&quot;</span><span class="p">)</span>
<a id="__codelineno-82-320" name="__codelineno-82-320"></a><a href="#__codelineno-82-320"><span class="linenos" data-linenos="320 "></span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-82-321" name="__codelineno-82-321"></a><a href="#__codelineno-82-321"><span class="linenos" data-linenos="321 "></span></a>
<a id="__codelineno-82-322" name="__codelineno-82-322"></a><a href="#__codelineno-82-322"><span class="linenos" data-linenos="322 "></span></a>    <span class="n">solx</span><span class="p">,</span> <span class="n">soly</span> <span class="o">=</span> <span class="n">boneh_durfee</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-82-323" name="__codelineno-82-323"></a><a href="#__codelineno-82-323"><span class="linenos" data-linenos="323 "></span></a>
<a id="__codelineno-82-324" name="__codelineno-82-324"></a><a href="#__codelineno-82-324"><span class="linenos" data-linenos="324 "></span></a>    <span class="c1">## found a solution?</span>
<a id="__codelineno-82-325" name="__codelineno-82-325"></a><a href="#__codelineno-82-325"><span class="linenos" data-linenos="325 "></span></a>    <span class="k">if</span> <span class="n">solx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-82-326" name="__codelineno-82-326"></a><a href="#__codelineno-82-326"><span class="linenos" data-linenos="326 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== solution found ===&quot;</span><span class="p">)</span>
<a id="__codelineno-82-327" name="__codelineno-82-327"></a><a href="#__codelineno-82-327"><span class="linenos" data-linenos="327 "></span></a>        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-82-328" name="__codelineno-82-328"></a><a href="#__codelineno-82-328"><span class="linenos" data-linenos="328 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x:&quot;</span><span class="p">,</span> <span class="n">solx</span><span class="p">)</span>
<a id="__codelineno-82-329" name="__codelineno-82-329"></a><a href="#__codelineno-82-329"><span class="linenos" data-linenos="329 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y:&quot;</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span>
<a id="__codelineno-82-330" name="__codelineno-82-330"></a><a href="#__codelineno-82-330"><span class="linenos" data-linenos="330 "></span></a>
<a id="__codelineno-82-331" name="__codelineno-82-331"></a><a href="#__codelineno-82-331"><span class="linenos" data-linenos="331 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pol</span><span class="p">(</span><span class="n">solx</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span> <span class="o">/</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-82-332" name="__codelineno-82-332"></a><a href="#__codelineno-82-332"><span class="linenos" data-linenos="332 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;private key found:&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<a id="__codelineno-82-333" name="__codelineno-82-333"></a><a href="#__codelineno-82-333"><span class="linenos" data-linenos="333 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-82-334" name="__codelineno-82-334"></a><a href="#__codelineno-82-334"><span class="linenos" data-linenos="334 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== no solution was found ===&quot;</span><span class="p">)</span>
<a id="__codelineno-82-335" name="__codelineno-82-335"></a><a href="#__codelineno-82-335"><span class="linenos" data-linenos="335 "></span></a>
<a id="__codelineno-82-336" name="__codelineno-82-336"></a><a href="#__codelineno-82-336"><span class="linenos" data-linenos="336 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-82-337" name="__codelineno-82-337"></a><a href="#__codelineno-82-337"><span class="linenos" data-linenos="337 "></span></a>        <span class="nb">print</span><span class="p">((</span><span class="s2">&quot;=== </span><span class="si">%s</span><span class="s2"> seconds ===&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)))</span>
<a id="__codelineno-82-338" name="__codelineno-82-338"></a><a href="#__codelineno-82-338"><span class="linenos" data-linenos="338 "></span></a>
<a id="__codelineno-82-339" name="__codelineno-82-339"></a><a href="#__codelineno-82-339"><span class="linenos" data-linenos="339 "></span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-82-340" name="__codelineno-82-340"></a><a href="#__codelineno-82-340"><span class="linenos" data-linenos="340 "></span></a>    <span class="n">example</span><span class="p">()</span>
</code></pre></div>
<h3 id="2023-bd">例题 2023领航杯 bd<a class="headerlink" href="#2023-bd" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><a href="#__codelineno-83-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a><a href="#__codelineno-83-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><a href="#__codelineno-83-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><a href="#__codelineno-83-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a><a href="#__codelineno-83-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a><a href="#__codelineno-83-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a><a href="#__codelineno-83-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">299</span><span class="p">)</span>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a><a href="#__codelineno-83-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">d</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-83-9" name="__codelineno-83-9"></a><a href="#__codelineno-83-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-83-10" name="__codelineno-83-10"></a><a href="#__codelineno-83-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-83-11" name="__codelineno-83-11"></a><a href="#__codelineno-83-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">hint1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-83-12" name="__codelineno-83-12"></a><a href="#__codelineno-83-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">hint2</span> <span class="o">=</span> <span class="n">q</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-83-13" name="__codelineno-83-13"></a><a href="#__codelineno-83-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-83-14" name="__codelineno-83-14"></a><a href="#__codelineno-83-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-83-15" name="__codelineno-83-15"></a><a href="#__codelineno-83-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-83-16" name="__codelineno-83-16"></a><a href="#__codelineno-83-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-83-17" name="__codelineno-83-17"></a><a href="#__codelineno-83-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-83-18" name="__codelineno-83-18"></a><a href="#__codelineno-83-18"><span class="linenos" data-linenos="18 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hint1 = </span><span class="si">{</span><span class="n">hint1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-83-19" name="__codelineno-83-19"></a><a href="#__codelineno-83-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hint2 = </span><span class="si">{</span><span class="n">hint2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-83-20" name="__codelineno-83-20"></a><a href="#__codelineno-83-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-83-21" name="__codelineno-83-21"></a><a href="#__codelineno-83-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-83-22" name="__codelineno-83-22"></a><a href="#__codelineno-83-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">n = 73337798113265277242402875272164983073482378701520700321577706460042584510776095519204866950129951930143711572581533177043149866218358557626070702546982947219557280493881836314492046745063916644418320245218549690820002504737756133747743286301499039227014032044403571945455215839074583290324966069724343874361</span>
<a id="__codelineno-83-23" name="__codelineno-83-23"></a><a href="#__codelineno-83-23"><span class="linenos" data-linenos="23 "></span></a><span class="sd">e = 42681919079074901709680276679968298324860328305878264036188155781983964226653746568102282190906458519960811259171162918944726137301701132135900454469634110653076655027353831375989861927565774719655974876907429954299669710134188543166679161864800926130527741511760447090995444554722545165685959110788876766283</span>
<a id="__codelineno-83-24" name="__codelineno-83-24"></a><a href="#__codelineno-83-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">c = 35616516401097721876690503261383371143934066789806504179229622323608172352486702183654617788750099596415052166506074598646146147151595929618406796332682042252530491640781065608144381326123387506000855818316664510273026302748073274714692374375426255513608075674924804166600192903250052744024508330641045908599</span>
<a id="__codelineno-83-25" name="__codelineno-83-25"></a><a href="#__codelineno-83-25"><span class="linenos" data-linenos="25 "></span></a><span class="sd">hint1 = 740477612377832718425</span>
<a id="__codelineno-83-26" name="__codelineno-83-26"></a><a href="#__codelineno-83-26"><span class="linenos" data-linenos="26 "></span></a><span class="sd">hint2 = 767891335159501447918</span>
<a id="__codelineno-83-27" name="__codelineno-83-27"></a><a href="#__codelineno-83-27"><span class="linenos" data-linenos="27 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>这是一种利用上p,q高位的boneh-durfee，论文:<a href="https://eprint.iacr.org/2023/367.pdf">367.pdf (iacr.org)</a></p>
<p>对大佬实验的脚本进行修改：<a href="https://pastebin.com/zpUkrfDh">Codes of the manuscript---Practical Attacks on Small Private Exponent RSA---New Records and New Insi - Pastebin.com</a></p>
<p>这类题没太搞懂原理，只能当个脚本小子先</p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><a href="#__codelineno-84-1"><span class="linenos" data-linenos="  1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><a href="#__codelineno-84-2"><span class="linenos" data-linenos="  2 "></span></a><span class="n">time</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><a href="#__codelineno-84-3"><span class="linenos" data-linenos="  3 "></span></a>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a><a href="#__codelineno-84-4"><span class="linenos" data-linenos="  4 "></span></a><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><a href="#__codelineno-84-5"><span class="linenos" data-linenos="  5 "></span></a>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><a href="#__codelineno-84-6"><span class="linenos" data-linenos="  6 "></span></a><span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a><a href="#__codelineno-84-7"><span class="linenos" data-linenos="  7 "></span></a>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a><a href="#__codelineno-84-8"><span class="linenos" data-linenos="  8 "></span></a><span class="n">helpful_only</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a><a href="#__codelineno-84-9"><span class="linenos" data-linenos="  9 "></span></a><span class="n">dimension_min</span> <span class="o">=</span> <span class="mi">7</span> <span class="c1">## 如果晶格达到该尺寸，则停止移除</span>
<a id="__codelineno-84-10" name="__codelineno-84-10"></a><a href="#__codelineno-84-10"><span class="linenos" data-linenos=" 10 "></span></a><span class="c1">## 显示有用矢量的统计数据</span>
<a id="__codelineno-84-11" name="__codelineno-84-11"></a><a href="#__codelineno-84-11"><span class="linenos" data-linenos=" 11 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">helpful_vectors</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="p">):</span>
<a id="__codelineno-84-12" name="__codelineno-84-12"></a><a href="#__codelineno-84-12"><span class="linenos" data-linenos=" 12 "></span></a>    <span class="n">nothelpful</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-84-13" name="__codelineno-84-13"></a><a href="#__codelineno-84-13"><span class="linenos" data-linenos=" 13 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-84-14" name="__codelineno-84-14"></a><a href="#__codelineno-84-14"><span class="linenos" data-linenos=" 14 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">modulus</span><span class="p">:</span>
<a id="__codelineno-84-15" name="__codelineno-84-15"></a><a href="#__codelineno-84-15"><span class="linenos" data-linenos=" 15 "></span></a>            <span class="n">nothelpful</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-84-16" name="__codelineno-84-16"></a><a href="#__codelineno-84-16"><span class="linenos" data-linenos=" 16 "></span></a>
<a id="__codelineno-84-17" name="__codelineno-84-17"></a><a href="#__codelineno-84-17"><span class="linenos" data-linenos=" 17 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">nothelpful</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot; vectors are not helpful&quot;</span><span class="p">)</span>
<a id="__codelineno-84-18" name="__codelineno-84-18"></a><a href="#__codelineno-84-18"><span class="linenos" data-linenos=" 18 "></span></a>
<a id="__codelineno-84-19" name="__codelineno-84-19"></a><a href="#__codelineno-84-19"><span class="linenos" data-linenos=" 19 "></span></a><span class="c1">## 显示带有 0 和 X 的矩阵</span>
<a id="__codelineno-84-20" name="__codelineno-84-20"></a><a href="#__codelineno-84-20"><span class="linenos" data-linenos=" 20 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">matrix_overview</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">bound</span><span class="p">):</span>
<a id="__codelineno-84-21" name="__codelineno-84-21"></a><a href="#__codelineno-84-21"><span class="linenos" data-linenos=" 21 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-84-22" name="__codelineno-84-22"></a><a href="#__codelineno-84-22"><span class="linenos" data-linenos=" 22 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%02d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-84-23" name="__codelineno-84-23"></a><a href="#__codelineno-84-23"><span class="linenos" data-linenos=" 23 "></span></a>        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
<a id="__codelineno-84-24" name="__codelineno-84-24"></a><a href="#__codelineno-84-24"><span class="linenos" data-linenos=" 24 "></span></a>            <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span> <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;X&#39;</span>
<a id="__codelineno-84-25" name="__codelineno-84-25"></a><a href="#__codelineno-84-25"><span class="linenos" data-linenos=" 25 "></span></a>            <span class="k">if</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span> 
<a id="__codelineno-84-26" name="__codelineno-84-26"></a><a href="#__codelineno-84-26"><span class="linenos" data-linenos=" 26 "></span></a>                <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
<a id="__codelineno-84-27" name="__codelineno-84-27"></a><a href="#__codelineno-84-27"><span class="linenos" data-linenos=" 27 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-84-28" name="__codelineno-84-28"></a><a href="#__codelineno-84-28"><span class="linenos" data-linenos=" 28 "></span></a>            <span class="n">a</span> <span class="o">+=</span> <span class="s1">&#39;~&#39;</span>
<a id="__codelineno-84-29" name="__codelineno-84-29"></a><a href="#__codelineno-84-29"><span class="linenos" data-linenos=" 29 "></span></a>        <span class="c1">#print (a)</span>
<a id="__codelineno-84-30" name="__codelineno-84-30"></a><a href="#__codelineno-84-30"><span class="linenos" data-linenos=" 30 "></span></a>
<a id="__codelineno-84-31" name="__codelineno-84-31"></a><a href="#__codelineno-84-31"><span class="linenos" data-linenos=" 31 "></span></a><span class="c1">## 尝试删除无用的向量</span>
<a id="__codelineno-84-32" name="__codelineno-84-32"></a><a href="#__codelineno-84-32"><span class="linenos" data-linenos=" 32 "></span></a><span class="c1">## 从当前 = n-1（最后一个向量）开始</span>
<a id="__codelineno-84-33" name="__codelineno-84-33"></a><a href="#__codelineno-84-33"><span class="linenos" data-linenos=" 33 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
<a id="__codelineno-84-34" name="__codelineno-84-34"></a><a href="#__codelineno-84-34"><span class="linenos" data-linenos=" 34 "></span></a>    <span class="c1">## 我们从当前 = n-1（最后一个向量）开始</span>
<a id="__codelineno-84-35" name="__codelineno-84-35"></a><a href="#__codelineno-84-35"><span class="linenos" data-linenos=" 35 "></span></a>    <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dimension_min</span><span class="p">:</span>
<a id="__codelineno-84-36" name="__codelineno-84-36"></a><a href="#__codelineno-84-36"><span class="linenos" data-linenos=" 36 "></span></a>        <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-84-37" name="__codelineno-84-37"></a><a href="#__codelineno-84-37"><span class="linenos" data-linenos=" 37 "></span></a>
<a id="__codelineno-84-38" name="__codelineno-84-38"></a><a href="#__codelineno-84-38"><span class="linenos" data-linenos=" 38 "></span></a>    <span class="c1">## 开始从后面检查</span>
<a id="__codelineno-84-39" name="__codelineno-84-39"></a><a href="#__codelineno-84-39"><span class="linenos" data-linenos=" 39 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-40" name="__codelineno-84-40"></a><a href="#__codelineno-84-40"><span class="linenos" data-linenos=" 40 "></span></a>        <span class="c1">##  如果它没有用</span>
<a id="__codelineno-84-41" name="__codelineno-84-41"></a><a href="#__codelineno-84-41"><span class="linenos" data-linenos=" 41 "></span></a>        <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-84-42" name="__codelineno-84-42"></a><a href="#__codelineno-84-42"><span class="linenos" data-linenos=" 42 "></span></a>            <span class="n">affected_vectors</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-84-43" name="__codelineno-84-43"></a><a href="#__codelineno-84-43"><span class="linenos" data-linenos=" 43 "></span></a>            <span class="n">affected_vector_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-84-44" name="__codelineno-84-44"></a><a href="#__codelineno-84-44"><span class="linenos" data-linenos=" 44 "></span></a>             <span class="c1">## 让我们检查它是否影响其他向量</span>
<a id="__codelineno-84-45" name="__codelineno-84-45"></a><a href="#__codelineno-84-45"><span class="linenos" data-linenos=" 45 "></span></a>            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-84-46" name="__codelineno-84-46"></a><a href="#__codelineno-84-46"><span class="linenos" data-linenos=" 46 "></span></a>                <span class="c1">## 如果另一个向量受到影响：</span>
<a id="__codelineno-84-47" name="__codelineno-84-47"></a><a href="#__codelineno-84-47"><span class="linenos" data-linenos=" 47 "></span></a>                <span class="c1">## 我们增加计数</span>
<a id="__codelineno-84-48" name="__codelineno-84-48"></a><a href="#__codelineno-84-48"><span class="linenos" data-linenos=" 48 "></span></a>                <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-84-49" name="__codelineno-84-49"></a><a href="#__codelineno-84-49"><span class="linenos" data-linenos=" 49 "></span></a>                    <span class="n">affected_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-84-50" name="__codelineno-84-50"></a><a href="#__codelineno-84-50"><span class="linenos" data-linenos=" 50 "></span></a>                    <span class="n">affected_vector_index</span> <span class="o">=</span> <span class="n">jj</span>
<a id="__codelineno-84-51" name="__codelineno-84-51"></a><a href="#__codelineno-84-51"><span class="linenos" data-linenos=" 51 "></span></a>
<a id="__codelineno-84-52" name="__codelineno-84-52"></a><a href="#__codelineno-84-52"><span class="linenos" data-linenos=" 52 "></span></a>            <span class="c1">## 等级：0</span>
<a id="__codelineno-84-53" name="__codelineno-84-53"></a><a href="#__codelineno-84-53"><span class="linenos" data-linenos=" 53 "></span></a>            <span class="c1">## 如果没有其他载体最终受到影响</span>
<a id="__codelineno-84-54" name="__codelineno-84-54"></a><a href="#__codelineno-84-54"><span class="linenos" data-linenos=" 54 "></span></a>            <span class="c1">## 我们删除它</span>
<a id="__codelineno-84-55" name="__codelineno-84-55"></a><a href="#__codelineno-84-55"><span class="linenos" data-linenos=" 55 "></span></a>            <span class="k">if</span> <span class="n">affected_vectors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-84-56" name="__codelineno-84-56"></a><a href="#__codelineno-84-56"><span class="linenos" data-linenos=" 56 "></span></a>                <span class="c1">#print (&quot;* removing unhelpful vector&quot;, ii)</span>
<a id="__codelineno-84-57" name="__codelineno-84-57"></a><a href="#__codelineno-84-57"><span class="linenos" data-linenos=" 57 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_columns</span><span class="p">([</span><span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-84-58" name="__codelineno-84-58"></a><a href="#__codelineno-84-58"><span class="linenos" data-linenos=" 58 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">([</span><span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-84-59" name="__codelineno-84-59"></a><a href="#__codelineno-84-59"><span class="linenos" data-linenos=" 59 "></span></a>                <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-84-60" name="__codelineno-84-60"></a><a href="#__codelineno-84-60"><span class="linenos" data-linenos=" 60 "></span></a>                <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-84-61" name="__codelineno-84-61"></a><a href="#__codelineno-84-61"><span class="linenos" data-linenos=" 61 "></span></a>                <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-84-62" name="__codelineno-84-62"></a><a href="#__codelineno-84-62"><span class="linenos" data-linenos=" 62 "></span></a>
<a id="__codelineno-84-63" name="__codelineno-84-63"></a><a href="#__codelineno-84-63"><span class="linenos" data-linenos=" 63 "></span></a>           <span class="c1">## 等级：1</span>
<a id="__codelineno-84-64" name="__codelineno-84-64"></a><a href="#__codelineno-84-64"><span class="linenos" data-linenos=" 64 "></span></a>            <span class="c1">#如果只有一个受到影响，我们会检查</span>
<a id="__codelineno-84-65" name="__codelineno-84-65"></a><a href="#__codelineno-84-65"><span class="linenos" data-linenos=" 65 "></span></a>            <span class="c1">## 如果它正在影响别的向量</span>
<a id="__codelineno-84-66" name="__codelineno-84-66"></a><a href="#__codelineno-84-66"><span class="linenos" data-linenos=" 66 "></span></a>            <span class="k">elif</span> <span class="n">affected_vectors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-84-67" name="__codelineno-84-67"></a><a href="#__codelineno-84-67"><span class="linenos" data-linenos=" 67 "></span></a>                <span class="n">affected_deeper</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-84-68" name="__codelineno-84-68"></a><a href="#__codelineno-84-68"><span class="linenos" data-linenos=" 68 "></span></a>                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">affected_vector_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
<a id="__codelineno-84-69" name="__codelineno-84-69"></a><a href="#__codelineno-84-69"><span class="linenos" data-linenos=" 69 "></span></a>                    <span class="c1">## 如果它影响哪怕一个向量</span>
<a id="__codelineno-84-70" name="__codelineno-84-70"></a><a href="#__codelineno-84-70"><span class="linenos" data-linenos=" 70 "></span></a>                    <span class="c1">## 我们放弃这个</span>
<a id="__codelineno-84-71" name="__codelineno-84-71"></a><a href="#__codelineno-84-71"><span class="linenos" data-linenos=" 71 "></span></a>                    <span class="k">if</span> <span class="n">BB</span><span class="p">[</span><span class="n">kk</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-84-72" name="__codelineno-84-72"></a><a href="#__codelineno-84-72"><span class="linenos" data-linenos=" 72 "></span></a>                        <span class="n">affected_deeper</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-84-73" name="__codelineno-84-73"></a><a href="#__codelineno-84-73"><span class="linenos" data-linenos=" 73 "></span></a>                <span class="c1">## 如果没有其他向量受到影响，则将其删除，并且</span>
<a id="__codelineno-84-74" name="__codelineno-84-74"></a><a href="#__codelineno-84-74"><span class="linenos" data-linenos=" 74 "></span></a>                <span class="c1">## 这个有用的向量不够有用</span>
<a id="__codelineno-84-75" name="__codelineno-84-75"></a><a href="#__codelineno-84-75"><span class="linenos" data-linenos=" 75 "></span></a>                <span class="c1">#与我们无用的相比</span>
<a id="__codelineno-84-76" name="__codelineno-84-76"></a><a href="#__codelineno-84-76"><span class="linenos" data-linenos=" 76 "></span></a>                <span class="k">if</span> <span class="n">affected_deeper</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="n">BB</span><span class="p">[</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">affected_vector_index</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bound</span> <span class="o">-</span> <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span><span class="p">]):</span>
<a id="__codelineno-84-77" name="__codelineno-84-77"></a><a href="#__codelineno-84-77"><span class="linenos" data-linenos=" 77 "></span></a>                    <span class="c1">#print (&quot;* removing unhelpful vectors&quot;, ii, &quot;and&quot;, affected_vector_index)</span>
<a id="__codelineno-84-78" name="__codelineno-84-78"></a><a href="#__codelineno-84-78"><span class="linenos" data-linenos=" 78 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_columns</span><span class="p">([</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-84-79" name="__codelineno-84-79"></a><a href="#__codelineno-84-79"><span class="linenos" data-linenos=" 79 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">delete_rows</span><span class="p">([</span><span class="n">affected_vector_index</span><span class="p">,</span> <span class="n">ii</span><span class="p">])</span>
<a id="__codelineno-84-80" name="__codelineno-84-80"></a><a href="#__codelineno-84-80"><span class="linenos" data-linenos=" 80 "></span></a>                    <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">affected_vector_index</span><span class="p">)</span>
<a id="__codelineno-84-81" name="__codelineno-84-81"></a><a href="#__codelineno-84-81"><span class="linenos" data-linenos=" 81 "></span></a>                    <span class="n">monomials</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<a id="__codelineno-84-82" name="__codelineno-84-82"></a><a href="#__codelineno-84-82"><span class="linenos" data-linenos=" 82 "></span></a>                    <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-84-83" name="__codelineno-84-83"></a><a href="#__codelineno-84-83"><span class="linenos" data-linenos=" 83 "></span></a>                    <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-84-84" name="__codelineno-84-84"></a><a href="#__codelineno-84-84"><span class="linenos" data-linenos=" 84 "></span></a>    <span class="c1">## nothing happened</span>
<a id="__codelineno-84-85" name="__codelineno-84-85"></a><a href="#__codelineno-84-85"><span class="linenos" data-linenos=" 85 "></span></a>    <span class="k">return</span> <span class="n">BB</span>
<a id="__codelineno-84-86" name="__codelineno-84-86"></a><a href="#__codelineno-84-86"><span class="linenos" data-linenos=" 86 "></span></a>
<a id="__codelineno-84-87" name="__codelineno-84-87"></a><a href="#__codelineno-84-87"><span class="linenos" data-linenos=" 87 "></span></a><span class="sd">&quot;&quot;&quot; </span>
<a id="__codelineno-84-88" name="__codelineno-84-88"></a><a href="#__codelineno-84-88"><span class="linenos" data-linenos=" 88 "></span></a><span class="sd">Returns:</span>
<a id="__codelineno-84-89" name="__codelineno-84-89"></a><a href="#__codelineno-84-89"><span class="linenos" data-linenos=" 89 "></span></a><span class="sd">* 0,0   if it fails</span>
<a id="__codelineno-84-90" name="__codelineno-84-90"></a><a href="#__codelineno-84-90"><span class="linenos" data-linenos=" 90 "></span></a><span class="sd">* -1,-1 如果 &quot;strict=true&quot;，并且行列式不受约束</span>
<a id="__codelineno-84-91" name="__codelineno-84-91"></a><a href="#__codelineno-84-91"><span class="linenos" data-linenos=" 91 "></span></a><span class="sd">* x0,y0 the solutions of `pol`</span>
<a id="__codelineno-84-92" name="__codelineno-84-92"></a><a href="#__codelineno-84-92"><span class="linenos" data-linenos=" 92 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-84-93" name="__codelineno-84-93"></a><a href="#__codelineno-84-93"><span class="linenos" data-linenos=" 93 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">boneh_durfee</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">modulus</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">XX</span><span class="p">,</span> <span class="n">YY</span><span class="p">):</span>
<a id="__codelineno-84-94" name="__codelineno-84-94"></a><a href="#__codelineno-84-94"><span class="linenos" data-linenos=" 94 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-84-95" name="__codelineno-84-95"></a><a href="#__codelineno-84-95"><span class="linenos" data-linenos=" 95 "></span></a><span class="sd">    Boneh and Durfee revisited by Herrmann and May</span>
<a id="__codelineno-84-96" name="__codelineno-84-96"></a><a href="#__codelineno-84-96"><span class="linenos" data-linenos=" 96 "></span></a>
<a id="__codelineno-84-97" name="__codelineno-84-97"></a><a href="#__codelineno-84-97"><span class="linenos" data-linenos=" 97 "></span></a><span class="sd"> 在以下情况下找到解决方案：</span>
<a id="__codelineno-84-98" name="__codelineno-84-98"></a><a href="#__codelineno-84-98"><span class="linenos" data-linenos=" 98 "></span></a><span class="sd">* d &lt; N^delta</span>
<a id="__codelineno-84-99" name="__codelineno-84-99"></a><a href="#__codelineno-84-99"><span class="linenos" data-linenos=" 99 "></span></a><span class="sd">* |x|&lt; e^delta</span>
<a id="__codelineno-84-100" name="__codelineno-84-100"></a><a href="#__codelineno-84-100"><span class="linenos" data-linenos="100 "></span></a><span class="sd">* |y|&lt; e^0.5</span>
<a id="__codelineno-84-101" name="__codelineno-84-101"></a><a href="#__codelineno-84-101"><span class="linenos" data-linenos="101 "></span></a><span class="sd">每当 delta &lt; 1 - sqrt(2)/2 ~ 0.292</span>
<a id="__codelineno-84-102" name="__codelineno-84-102"></a><a href="#__codelineno-84-102"><span class="linenos" data-linenos="102 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-84-103" name="__codelineno-84-103"></a><a href="#__codelineno-84-103"><span class="linenos" data-linenos="103 "></span></a>
<a id="__codelineno-84-104" name="__codelineno-84-104"></a><a href="#__codelineno-84-104"><span class="linenos" data-linenos="104 "></span></a>    <span class="c1">## substitution (Herrman and May)</span>
<a id="__codelineno-84-105" name="__codelineno-84-105"></a><a href="#__codelineno-84-105"><span class="linenos" data-linenos="105 "></span></a>    <span class="n">PR</span><span class="o">.&lt;</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>   <span class="c1">#多项式环</span>
<a id="__codelineno-84-106" name="__codelineno-84-106"></a><a href="#__codelineno-84-106"><span class="linenos" data-linenos="106 "></span></a>    <span class="n">Q</span> <span class="o">=</span> <span class="n">PR</span><span class="o">.</span><span class="n">quotient</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span>        <span class="c1">##  u = xy + 1</span>
<a id="__codelineno-84-107" name="__codelineno-84-107"></a><a href="#__codelineno-84-107"><span class="linenos" data-linenos="107 "></span></a>    <span class="n">polZ</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">pol</span><span class="p">)</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
<a id="__codelineno-84-108" name="__codelineno-84-108"></a><a href="#__codelineno-84-108"><span class="linenos" data-linenos="108 "></span></a>
<a id="__codelineno-84-109" name="__codelineno-84-109"></a><a href="#__codelineno-84-109"><span class="linenos" data-linenos="109 "></span></a>    <span class="n">UU</span> <span class="o">=</span> <span class="n">XX</span><span class="o">*</span><span class="n">YY</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-84-110" name="__codelineno-84-110"></a><a href="#__codelineno-84-110"><span class="linenos" data-linenos="110 "></span></a>
<a id="__codelineno-84-111" name="__codelineno-84-111"></a><a href="#__codelineno-84-111"><span class="linenos" data-linenos="111 "></span></a>    <span class="c1">## x-移位</span>
<a id="__codelineno-84-112" name="__codelineno-84-112"></a><a href="#__codelineno-84-112"><span class="linenos" data-linenos="112 "></span></a>    <span class="n">gg</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-84-113" name="__codelineno-84-113"></a><a href="#__codelineno-84-113"><span class="linenos" data-linenos="113 "></span></a>    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-114" name="__codelineno-84-114"></a><a href="#__codelineno-84-114"><span class="linenos" data-linenos="114 "></span></a>        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-115" name="__codelineno-84-115"></a><a href="#__codelineno-84-115"><span class="linenos" data-linenos="115 "></span></a>            <span class="n">xshift</span> <span class="o">=</span> <span class="n">x</span><span class="o">^</span><span class="n">ii</span> <span class="o">*</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span><span class="p">)</span> <span class="o">*</span> <span class="n">polZ</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="n">kk</span>
<a id="__codelineno-84-116" name="__codelineno-84-116"></a><a href="#__codelineno-84-116"><span class="linenos" data-linenos="116 "></span></a>            <span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xshift</span><span class="p">)</span>
<a id="__codelineno-84-117" name="__codelineno-84-117"></a><a href="#__codelineno-84-117"><span class="linenos" data-linenos="117 "></span></a>    <span class="n">gg</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-84-118" name="__codelineno-84-118"></a><a href="#__codelineno-84-118"><span class="linenos" data-linenos="118 "></span></a>
<a id="__codelineno-84-119" name="__codelineno-84-119"></a><a href="#__codelineno-84-119"><span class="linenos" data-linenos="119 "></span></a>    <span class="c1">## 单项式 x 移位列表</span>
<a id="__codelineno-84-120" name="__codelineno-84-120"></a><a href="#__codelineno-84-120"><span class="linenos" data-linenos="120 "></span></a>    <span class="n">monomials</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-84-121" name="__codelineno-84-121"></a><a href="#__codelineno-84-121"><span class="linenos" data-linenos="121 "></span></a>    <span class="k">for</span> <span class="n">polynomial</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">:</span>
<a id="__codelineno-84-122" name="__codelineno-84-122"></a><a href="#__codelineno-84-122"><span class="linenos" data-linenos="122 "></span></a>        <span class="k">for</span> <span class="n">monomial</span> <span class="ow">in</span> <span class="n">polynomial</span><span class="o">.</span><span class="n">monomials</span><span class="p">():</span> <span class="c1">#对于多项式中的单项式。单项式（）：</span>
<a id="__codelineno-84-123" name="__codelineno-84-123"></a><a href="#__codelineno-84-123"><span class="linenos" data-linenos="123 "></span></a>            <span class="k">if</span> <span class="n">monomial</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">monomials</span><span class="p">:</span>  <span class="c1">## 如果单项不在单项中</span>
<a id="__codelineno-84-124" name="__codelineno-84-124"></a><a href="#__codelineno-84-124"><span class="linenos" data-linenos="124 "></span></a>                <span class="n">monomials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">monomial</span><span class="p">)</span>
<a id="__codelineno-84-125" name="__codelineno-84-125"></a><a href="#__codelineno-84-125"><span class="linenos" data-linenos="125 "></span></a>    <span class="n">monomials</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<a id="__codelineno-84-126" name="__codelineno-84-126"></a><a href="#__codelineno-84-126"><span class="linenos" data-linenos="126 "></span></a>
<a id="__codelineno-84-127" name="__codelineno-84-127"></a><a href="#__codelineno-84-127"><span class="linenos" data-linenos="127 "></span></a>    <span class="c1">## y-移位</span>
<a id="__codelineno-84-128" name="__codelineno-84-128"></a><a href="#__codelineno-84-128"><span class="linenos" data-linenos="128 "></span></a>    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-129" name="__codelineno-84-129"></a><a href="#__codelineno-84-129"><span class="linenos" data-linenos="129 "></span></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">mm</span><span class="o">/</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-130" name="__codelineno-84-130"></a><a href="#__codelineno-84-130"><span class="linenos" data-linenos="130 "></span></a>            <span class="n">yshift</span> <span class="o">=</span> <span class="n">y</span><span class="o">^</span><span class="n">jj</span> <span class="o">*</span> <span class="n">polZ</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">^</span><span class="n">kk</span> <span class="o">*</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span> <span class="o">-</span> <span class="n">kk</span><span class="p">)</span>
<a id="__codelineno-84-131" name="__codelineno-84-131"></a><a href="#__codelineno-84-131"><span class="linenos" data-linenos="131 "></span></a>            <span class="n">yshift</span> <span class="o">=</span> <span class="n">Q</span><span class="p">(</span><span class="n">yshift</span><span class="p">)</span><span class="o">.</span><span class="n">lift</span><span class="p">()</span>
<a id="__codelineno-84-132" name="__codelineno-84-132"></a><a href="#__codelineno-84-132"><span class="linenos" data-linenos="132 "></span></a>            <span class="n">gg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yshift</span><span class="p">)</span> <span class="c1">## substitution</span>
<a id="__codelineno-84-133" name="__codelineno-84-133"></a><a href="#__codelineno-84-133"><span class="linenos" data-linenos="133 "></span></a>
<a id="__codelineno-84-134" name="__codelineno-84-134"></a><a href="#__codelineno-84-134"><span class="linenos" data-linenos="134 "></span></a>    <span class="c1">## 单项式 y 移位列表</span>
<a id="__codelineno-84-135" name="__codelineno-84-135"></a><a href="#__codelineno-84-135"><span class="linenos" data-linenos="135 "></span></a>    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-136" name="__codelineno-84-136"></a><a href="#__codelineno-84-136"><span class="linenos" data-linenos="136 "></span></a>        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">mm</span><span class="o">/</span><span class="n">tt</span><span class="p">)</span> <span class="o">*</span> <span class="n">jj</span><span class="p">,</span> <span class="n">mm</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-137" name="__codelineno-84-137"></a><a href="#__codelineno-84-137"><span class="linenos" data-linenos="137 "></span></a>            <span class="n">monomials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="o">^</span><span class="n">kk</span> <span class="o">*</span> <span class="n">y</span><span class="o">^</span><span class="n">jj</span><span class="p">)</span>
<a id="__codelineno-84-138" name="__codelineno-84-138"></a><a href="#__codelineno-84-138"><span class="linenos" data-linenos="138 "></span></a>
<a id="__codelineno-84-139" name="__codelineno-84-139"></a><a href="#__codelineno-84-139"><span class="linenos" data-linenos="139 "></span></a>    <span class="c1">## 构造格 B</span>
<a id="__codelineno-84-140" name="__codelineno-84-140"></a><a href="#__codelineno-84-140"><span class="linenos" data-linenos="140 "></span></a>    <span class="n">nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">monomials</span><span class="p">)</span>
<a id="__codelineno-84-141" name="__codelineno-84-141"></a><a href="#__codelineno-84-141"><span class="linenos" data-linenos="141 "></span></a>    <span class="n">BB</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">ZZ</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>
<a id="__codelineno-84-142" name="__codelineno-84-142"></a><a href="#__codelineno-84-142"><span class="linenos" data-linenos="142 "></span></a>    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-84-143" name="__codelineno-84-143"></a><a href="#__codelineno-84-143"><span class="linenos" data-linenos="143 "></span></a>        <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">](</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-84-144" name="__codelineno-84-144"></a><a href="#__codelineno-84-144"><span class="linenos" data-linenos="144 "></span></a>        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-145" name="__codelineno-84-145"></a><a href="#__codelineno-84-145"><span class="linenos" data-linenos="145 "></span></a>            <span class="k">if</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">monomials</span><span class="p">():</span>
<a id="__codelineno-84-146" name="__codelineno-84-146"></a><a href="#__codelineno-84-146"><span class="linenos" data-linenos="146 "></span></a>                <span class="n">BB</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">gg</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">monomial_coefficient</span><span class="p">(</span><span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span> <span class="o">*</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-84-147" name="__codelineno-84-147"></a><a href="#__codelineno-84-147"><span class="linenos" data-linenos="147 "></span></a>
<a id="__codelineno-84-148" name="__codelineno-84-148"></a><a href="#__codelineno-84-148"><span class="linenos" data-linenos="148 "></span></a>    <span class="c1">#约化格的原型</span>
<a id="__codelineno-84-149" name="__codelineno-84-149"></a><a href="#__codelineno-84-149"><span class="linenos" data-linenos="149 "></span></a>    <span class="k">if</span> <span class="n">helpful_only</span><span class="p">:</span>
<a id="__codelineno-84-150" name="__codelineno-84-150"></a><a href="#__codelineno-84-150"><span class="linenos" data-linenos="150 "></span></a>        <span class="c1">##  #自动删除</span>
<a id="__codelineno-84-151" name="__codelineno-84-151"></a><a href="#__codelineno-84-151"><span class="linenos" data-linenos="151 "></span></a>        <span class="n">BB</span> <span class="o">=</span> <span class="n">remove_unhelpful</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">monomials</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">,</span> <span class="n">nn</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-84-152" name="__codelineno-84-152"></a><a href="#__codelineno-84-152"><span class="linenos" data-linenos="152 "></span></a>        <span class="c1">## 重置维度</span>
<a id="__codelineno-84-153" name="__codelineno-84-153"></a><a href="#__codelineno-84-153"><span class="linenos" data-linenos="153 "></span></a>        <span class="n">nn</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">dimensions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-84-154" name="__codelineno-84-154"></a><a href="#__codelineno-84-154"><span class="linenos" data-linenos="154 "></span></a>        <span class="k">if</span> <span class="n">nn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-84-155" name="__codelineno-84-155"></a><a href="#__codelineno-84-155"><span class="linenos" data-linenos="155 "></span></a>            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;failure&quot;</span><span class="p">)</span>
<a id="__codelineno-84-156" name="__codelineno-84-156"></a><a href="#__codelineno-84-156"><span class="linenos" data-linenos="156 "></span></a>            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<a id="__codelineno-84-157" name="__codelineno-84-157"></a><a href="#__codelineno-84-157"><span class="linenos" data-linenos="157 "></span></a>
<a id="__codelineno-84-158" name="__codelineno-84-158"></a><a href="#__codelineno-84-158"><span class="linenos" data-linenos="158 "></span></a>    <span class="c1">## 检查向量是否有帮助</span>
<a id="__codelineno-84-159" name="__codelineno-84-159"></a><a href="#__codelineno-84-159"><span class="linenos" data-linenos="159 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-160" name="__codelineno-84-160"></a><a href="#__codelineno-84-160"><span class="linenos" data-linenos="160 "></span></a>        <span class="n">helpful_vectors</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">)</span>
<a id="__codelineno-84-161" name="__codelineno-84-161"></a><a href="#__codelineno-84-161"><span class="linenos" data-linenos="161 "></span></a>
<a id="__codelineno-84-162" name="__codelineno-84-162"></a><a href="#__codelineno-84-162"><span class="linenos" data-linenos="162 "></span></a>    <span class="c1">## 检查行列式是否正确界定</span>
<a id="__codelineno-84-163" name="__codelineno-84-163"></a><a href="#__codelineno-84-163"><span class="linenos" data-linenos="163 "></span></a>    <span class="n">det</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">det</span><span class="p">()</span>
<a id="__codelineno-84-164" name="__codelineno-84-164"></a><a href="#__codelineno-84-164"><span class="linenos" data-linenos="164 "></span></a>    <span class="n">bound</span> <span class="o">=</span> <span class="n">modulus</span><span class="o">^</span><span class="p">(</span><span class="n">mm</span><span class="o">*</span><span class="n">nn</span><span class="p">)</span>
<a id="__codelineno-84-165" name="__codelineno-84-165"></a><a href="#__codelineno-84-165"><span class="linenos" data-linenos="165 "></span></a>    <span class="k">if</span> <span class="n">det</span> <span class="o">&gt;=</span> <span class="n">bound</span><span class="p">:</span>
<a id="__codelineno-84-166" name="__codelineno-84-166"></a><a href="#__codelineno-84-166"><span class="linenos" data-linenos="166 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;We do not have det &lt; bound. Solutions might not be found.&quot;</span><span class="p">)</span>
<a id="__codelineno-84-167" name="__codelineno-84-167"></a><a href="#__codelineno-84-167"><span class="linenos" data-linenos="167 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Try with highers m and t.&quot;</span><span class="p">)</span>
<a id="__codelineno-84-168" name="__codelineno-84-168"></a><a href="#__codelineno-84-168"><span class="linenos" data-linenos="168 "></span></a>        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-169" name="__codelineno-84-169"></a><a href="#__codelineno-84-169"><span class="linenos" data-linenos="169 "></span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">det</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">bound</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-84-170" name="__codelineno-84-170"></a><a href="#__codelineno-84-170"><span class="linenos" data-linenos="170 "></span></a>            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;size det(L) - size e^(m*n) = &quot;</span><span class="p">,</span> <span class="n">floor</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
<a id="__codelineno-84-171" name="__codelineno-84-171"></a><a href="#__codelineno-84-171"><span class="linenos" data-linenos="171 "></span></a>        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
<a id="__codelineno-84-172" name="__codelineno-84-172"></a><a href="#__codelineno-84-172"><span class="linenos" data-linenos="172 "></span></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-84-173" name="__codelineno-84-173"></a><a href="#__codelineno-84-173"><span class="linenos" data-linenos="173 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-84-174" name="__codelineno-84-174"></a><a href="#__codelineno-84-174"><span class="linenos" data-linenos="174 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)&quot;</span><span class="p">)</span>
<a id="__codelineno-84-175" name="__codelineno-84-175"></a><a href="#__codelineno-84-175"><span class="linenos" data-linenos="175 "></span></a>
<a id="__codelineno-84-176" name="__codelineno-84-176"></a><a href="#__codelineno-84-176"><span class="linenos" data-linenos="176 "></span></a>    <span class="c1">## display the lattice basis</span>
<a id="__codelineno-84-177" name="__codelineno-84-177"></a><a href="#__codelineno-84-177"><span class="linenos" data-linenos="177 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-178" name="__codelineno-84-178"></a><a href="#__codelineno-84-178"><span class="linenos" data-linenos="178 "></span></a>        <span class="n">matrix_overview</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span> <span class="n">modulus</span><span class="o">^</span><span class="n">mm</span><span class="p">)</span>
<a id="__codelineno-84-179" name="__codelineno-84-179"></a><a href="#__codelineno-84-179"><span class="linenos" data-linenos="179 "></span></a>
<a id="__codelineno-84-180" name="__codelineno-84-180"></a><a href="#__codelineno-84-180"><span class="linenos" data-linenos="180 "></span></a>    <span class="c1">## LLL</span>
<a id="__codelineno-84-181" name="__codelineno-84-181"></a><a href="#__codelineno-84-181"><span class="linenos" data-linenos="181 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-182" name="__codelineno-84-182"></a><a href="#__codelineno-84-182"><span class="linenos" data-linenos="182 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;optimizing basis of the lattice via LLL, this can take a long time&quot;</span><span class="p">)</span>
<a id="__codelineno-84-183" name="__codelineno-84-183"></a><a href="#__codelineno-84-183"><span class="linenos" data-linenos="183 "></span></a>
<a id="__codelineno-84-184" name="__codelineno-84-184"></a><a href="#__codelineno-84-184"><span class="linenos" data-linenos="184 "></span></a>    <span class="c1">#BB = BB.BKZ(block_size=25)</span>
<a id="__codelineno-84-185" name="__codelineno-84-185"></a><a href="#__codelineno-84-185"><span class="linenos" data-linenos="185 "></span></a>    <span class="n">BB</span> <span class="o">=</span> <span class="n">BB</span><span class="o">.</span><span class="n">LLL</span><span class="p">()</span>
<a id="__codelineno-84-186" name="__codelineno-84-186"></a><a href="#__codelineno-84-186"><span class="linenos" data-linenos="186 "></span></a>
<a id="__codelineno-84-187" name="__codelineno-84-187"></a><a href="#__codelineno-84-187"><span class="linenos" data-linenos="187 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-188" name="__codelineno-84-188"></a><a href="#__codelineno-84-188"><span class="linenos" data-linenos="188 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;LLL is done!&quot;</span><span class="p">)</span>
<a id="__codelineno-84-189" name="__codelineno-84-189"></a><a href="#__codelineno-84-189"><span class="linenos" data-linenos="189 "></span></a>
<a id="__codelineno-84-190" name="__codelineno-84-190"></a><a href="#__codelineno-84-190"><span class="linenos" data-linenos="190 "></span></a>    <span class="c1">## 替换向量 i 和 j -&gt;多项式 1 和 2</span>
<a id="__codelineno-84-191" name="__codelineno-84-191"></a><a href="#__codelineno-84-191"><span class="linenos" data-linenos="191 "></span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-192" name="__codelineno-84-192"></a><a href="#__codelineno-84-192"><span class="linenos" data-linenos="192 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;在格中寻找线性无关向量&quot;</span><span class="p">)</span>
<a id="__codelineno-84-193" name="__codelineno-84-193"></a><a href="#__codelineno-84-193"><span class="linenos" data-linenos="193 "></span></a>    <span class="n">found_polynomials</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-84-194" name="__codelineno-84-194"></a><a href="#__codelineno-84-194"><span class="linenos" data-linenos="194 "></span></a>
<a id="__codelineno-84-195" name="__codelineno-84-195"></a><a href="#__codelineno-84-195"><span class="linenos" data-linenos="195 "></span></a>    <span class="k">for</span> <span class="n">pol1_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-196" name="__codelineno-84-196"></a><a href="#__codelineno-84-196"><span class="linenos" data-linenos="196 "></span></a>        <span class="k">for</span> <span class="n">pol2_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pol1_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-84-197" name="__codelineno-84-197"></a><a href="#__codelineno-84-197"><span class="linenos" data-linenos="197 "></span></a>
<a id="__codelineno-84-198" name="__codelineno-84-198"></a><a href="#__codelineno-84-198"><span class="linenos" data-linenos="198 "></span></a>            <span class="c1">## 对于i and j, 构造两个多项式</span>
<a id="__codelineno-84-199" name="__codelineno-84-199"></a><a href="#__codelineno-84-199"><span class="linenos" data-linenos="199 "></span></a>
<a id="__codelineno-84-200" name="__codelineno-84-200"></a><a href="#__codelineno-84-200"><span class="linenos" data-linenos="200 "></span></a>            <span class="n">PR</span><span class="o">.&lt;</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-84-201" name="__codelineno-84-201"></a><a href="#__codelineno-84-201"><span class="linenos" data-linenos="201 "></span></a>            <span class="n">pol1</span> <span class="o">=</span> <span class="n">pol2</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-84-202" name="__codelineno-84-202"></a><a href="#__codelineno-84-202"><span class="linenos" data-linenos="202 "></span></a>            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
<a id="__codelineno-84-203" name="__codelineno-84-203"></a><a href="#__codelineno-84-203"><span class="linenos" data-linenos="203 "></span></a>                <span class="n">pol1</span> <span class="o">+=</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">BB</span><span class="p">[</span><span class="n">pol1_idx</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-84-204" name="__codelineno-84-204"></a><a href="#__codelineno-84-204"><span class="linenos" data-linenos="204 "></span></a>                <span class="n">pol2</span> <span class="o">+=</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">w</span><span class="o">*</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">*</span> <span class="n">BB</span><span class="p">[</span><span class="n">pol2_idx</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">/</span> <span class="n">monomials</span><span class="p">[</span><span class="n">jj</span><span class="p">](</span><span class="n">UU</span><span class="p">,</span><span class="n">XX</span><span class="p">,</span><span class="n">YY</span><span class="p">)</span>
<a id="__codelineno-84-205" name="__codelineno-84-205"></a><a href="#__codelineno-84-205"><span class="linenos" data-linenos="205 "></span></a>
<a id="__codelineno-84-206" name="__codelineno-84-206"></a><a href="#__codelineno-84-206"><span class="linenos" data-linenos="206 "></span></a>            <span class="c1">## 结果</span>
<a id="__codelineno-84-207" name="__codelineno-84-207"></a><a href="#__codelineno-84-207"><span class="linenos" data-linenos="207 "></span></a>            <span class="n">PR</span><span class="o">.&lt;</span><span class="n">q</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-84-208" name="__codelineno-84-208"></a><a href="#__codelineno-84-208"><span class="linenos" data-linenos="208 "></span></a>            <span class="n">rr</span> <span class="o">=</span> <span class="n">pol1</span><span class="o">.</span><span class="n">resultant</span><span class="p">(</span><span class="n">pol2</span><span class="p">)</span>
<a id="__codelineno-84-209" name="__codelineno-84-209"></a><a href="#__codelineno-84-209"><span class="linenos" data-linenos="209 "></span></a>
<a id="__codelineno-84-210" name="__codelineno-84-210"></a><a href="#__codelineno-84-210"><span class="linenos" data-linenos="210 "></span></a>
<a id="__codelineno-84-211" name="__codelineno-84-211"></a><a href="#__codelineno-84-211"><span class="linenos" data-linenos="211 "></span></a>            <span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">is_zero</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rr</span><span class="o">.</span><span class="n">monomials</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-84-212" name="__codelineno-84-212"></a><a href="#__codelineno-84-212"><span class="linenos" data-linenos="212 "></span></a>                <span class="k">continue</span>
<a id="__codelineno-84-213" name="__codelineno-84-213"></a><a href="#__codelineno-84-213"><span class="linenos" data-linenos="213 "></span></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-84-214" name="__codelineno-84-214"></a><a href="#__codelineno-84-214"><span class="linenos" data-linenos="214 "></span></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;found them, using vectors&quot;</span><span class="p">,</span> <span class="n">pol1_idx</span><span class="p">,</span> <span class="s2">&quot;and&quot;</span><span class="p">,</span> <span class="n">pol2_idx</span><span class="p">)</span>
<a id="__codelineno-84-215" name="__codelineno-84-215"></a><a href="#__codelineno-84-215"><span class="linenos" data-linenos="215 "></span></a>                <span class="n">found_polynomials</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-84-216" name="__codelineno-84-216"></a><a href="#__codelineno-84-216"><span class="linenos" data-linenos="216 "></span></a>                <span class="k">break</span>
<a id="__codelineno-84-217" name="__codelineno-84-217"></a><a href="#__codelineno-84-217"><span class="linenos" data-linenos="217 "></span></a>        <span class="k">if</span> <span class="n">found_polynomials</span><span class="p">:</span>
<a id="__codelineno-84-218" name="__codelineno-84-218"></a><a href="#__codelineno-84-218"><span class="linenos" data-linenos="218 "></span></a>            <span class="k">break</span>
<a id="__codelineno-84-219" name="__codelineno-84-219"></a><a href="#__codelineno-84-219"><span class="linenos" data-linenos="219 "></span></a>
<a id="__codelineno-84-220" name="__codelineno-84-220"></a><a href="#__codelineno-84-220"><span class="linenos" data-linenos="220 "></span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_polynomials</span><span class="p">:</span>
<a id="__codelineno-84-221" name="__codelineno-84-221"></a><a href="#__codelineno-84-221"><span class="linenos" data-linenos="221 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;no independant vectors could be found. This should very rarely happen...&quot;</span><span class="p">)</span>
<a id="__codelineno-84-222" name="__codelineno-84-222"></a><a href="#__codelineno-84-222"><span class="linenos" data-linenos="222 "></span></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-84-223" name="__codelineno-84-223"></a><a href="#__codelineno-84-223"><span class="linenos" data-linenos="223 "></span></a>
<a id="__codelineno-84-224" name="__codelineno-84-224"></a><a href="#__codelineno-84-224"><span class="linenos" data-linenos="224 "></span></a>    <span class="n">rr</span> <span class="o">=</span> <span class="n">rr</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-84-225" name="__codelineno-84-225"></a><a href="#__codelineno-84-225"><span class="linenos" data-linenos="225 "></span></a>
<a id="__codelineno-84-226" name="__codelineno-84-226"></a><a href="#__codelineno-84-226"><span class="linenos" data-linenos="226 "></span></a>    <span class="c1">## solutions</span>
<a id="__codelineno-84-227" name="__codelineno-84-227"></a><a href="#__codelineno-84-227"><span class="linenos" data-linenos="227 "></span></a>    <span class="n">soly</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-84-228" name="__codelineno-84-228"></a><a href="#__codelineno-84-228"><span class="linenos" data-linenos="228 "></span></a>
<a id="__codelineno-84-229" name="__codelineno-84-229"></a><a href="#__codelineno-84-229"><span class="linenos" data-linenos="229 "></span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">soly</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-84-230" name="__codelineno-84-230"></a><a href="#__codelineno-84-230"><span class="linenos" data-linenos="230 "></span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Your prediction (delta) is too small&quot;</span><span class="p">)</span>
<a id="__codelineno-84-231" name="__codelineno-84-231"></a><a href="#__codelineno-84-231"><span class="linenos" data-linenos="231 "></span></a>        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<a id="__codelineno-84-232" name="__codelineno-84-232"></a><a href="#__codelineno-84-232"><span class="linenos" data-linenos="232 "></span></a>
<a id="__codelineno-84-233" name="__codelineno-84-233"></a><a href="#__codelineno-84-233"><span class="linenos" data-linenos="233 "></span></a>    <span class="n">soly</span> <span class="o">=</span> <span class="n">soly</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-84-234" name="__codelineno-84-234"></a><a href="#__codelineno-84-234"><span class="linenos" data-linenos="234 "></span></a>    <span class="n">ss</span> <span class="o">=</span> <span class="n">pol1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span>
<a id="__codelineno-84-235" name="__codelineno-84-235"></a><a href="#__codelineno-84-235"><span class="linenos" data-linenos="235 "></span></a>    <span class="n">solx</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">roots</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-84-236" name="__codelineno-84-236"></a><a href="#__codelineno-84-236"><span class="linenos" data-linenos="236 "></span></a>    <span class="k">return</span> <span class="n">solx</span><span class="p">,</span> <span class="n">soly</span>
<a id="__codelineno-84-237" name="__codelineno-84-237"></a><a href="#__codelineno-84-237"><span class="linenos" data-linenos="237 "></span></a>
<a id="__codelineno-84-238" name="__codelineno-84-238"></a><a href="#__codelineno-84-238"><span class="linenos" data-linenos="238 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">example</span><span class="p">():</span>
<a id="__codelineno-84-239" name="__codelineno-84-239"></a><a href="#__codelineno-84-239"><span class="linenos" data-linenos="239 "></span></a>    <span class="c1">############################################</span>
<a id="__codelineno-84-240" name="__codelineno-84-240"></a><a href="#__codelineno-84-240"><span class="linenos" data-linenos="240 "></span></a>    <span class="c1">## 随机生成数据</span>
<a id="__codelineno-84-241" name="__codelineno-84-241"></a><a href="#__codelineno-84-241"><span class="linenos" data-linenos="241 "></span></a>    <span class="c1">##########################################</span>
<a id="__codelineno-84-242" name="__codelineno-84-242"></a><a href="#__codelineno-84-242"><span class="linenos" data-linenos="242 "></span></a>    <span class="c1">#start_time =time.perf_counter</span>
<a id="__codelineno-84-243" name="__codelineno-84-243"></a><a href="#__codelineno-84-243"><span class="linenos" data-linenos="243 "></span></a>    <span class="n">start</span> <span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<a id="__codelineno-84-244" name="__codelineno-84-244"></a><a href="#__codelineno-84-244"><span class="linenos" data-linenos="244 "></span></a>    <span class="n">size</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-84-245" name="__codelineno-84-245"></a><a href="#__codelineno-84-245"><span class="linenos" data-linenos="245 "></span></a>    <span class="n">length_N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">size</span>
<a id="__codelineno-84-246" name="__codelineno-84-246"></a><a href="#__codelineno-84-246"><span class="linenos" data-linenos="246 "></span></a>    <span class="n">ss</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-84-247" name="__codelineno-84-247"></a><a href="#__codelineno-84-247"><span class="linenos" data-linenos="247 "></span></a>    <span class="n">s</span> <span class="o">=</span> <span class="mi">70</span>
<a id="__codelineno-84-248" name="__codelineno-84-248"></a><a href="#__codelineno-84-248"><span class="linenos" data-linenos="248 "></span></a>    <span class="n">M</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1">## the number of experiments</span>
<a id="__codelineno-84-249" name="__codelineno-84-249"></a><a href="#__codelineno-84-249"><span class="linenos" data-linenos="249 "></span></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mi">299</span><span class="o">/</span><span class="mi">1024</span>
<a id="__codelineno-84-250" name="__codelineno-84-250"></a><a href="#__codelineno-84-250"><span class="linenos" data-linenos="250 "></span></a>
<a id="__codelineno-84-251" name="__codelineno-84-251"></a><a href="#__codelineno-84-251"><span class="linenos" data-linenos="251 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
<a id="__codelineno-84-252" name="__codelineno-84-252"></a><a href="#__codelineno-84-252"><span class="linenos" data-linenos="252 "></span></a><span class="c1">##         p =  random_prime(2^size,None,2^(size-1))</span>
<a id="__codelineno-84-253" name="__codelineno-84-253"></a><a href="#__codelineno-84-253"><span class="linenos" data-linenos="253 "></span></a><span class="c1">##         q =  random_prime(2^size,None,2^(size-1))</span>
<a id="__codelineno-84-254" name="__codelineno-84-254"></a><a href="#__codelineno-84-254"><span class="linenos" data-linenos="254 "></span></a><span class="c1">##         if(p&lt;q):</span>
<a id="__codelineno-84-255" name="__codelineno-84-255"></a><a href="#__codelineno-84-255"><span class="linenos" data-linenos="255 "></span></a><span class="c1">##             temp=p</span>
<a id="__codelineno-84-256" name="__codelineno-84-256"></a><a href="#__codelineno-84-256"><span class="linenos" data-linenos="256 "></span></a><span class="c1">##             p=q</span>
<a id="__codelineno-84-257" name="__codelineno-84-257"></a><a href="#__codelineno-84-257"><span class="linenos" data-linenos="257 "></span></a><span class="c1">##             q=temp</span>
<a id="__codelineno-84-258" name="__codelineno-84-258"></a><a href="#__codelineno-84-258"><span class="linenos" data-linenos="258 "></span></a>        <span class="n">N</span> <span class="o">=</span> <span class="mi">73337798113265277242402875272164983073482378701520700321577706460042584510776095519204866950129951930143711572581533177043149866218358557626070702546982947219557280493881836314492046745063916644418320245218549690820002504737756133747743286301499039227014032044403571945455215839074583290324966069724343874361</span>
<a id="__codelineno-84-259" name="__codelineno-84-259"></a><a href="#__codelineno-84-259"><span class="linenos" data-linenos="259 "></span></a>        <span class="n">e</span> <span class="o">=</span> <span class="mi">42681919079074901709680276679968298324860328305878264036188155781983964226653746568102282190906458519960811259171162918944726137301701132135900454469634110653076655027353831375989861927565774719655974876907429954299669710134188543166679161864800926130527741511760447090995444554722545165685959110788876766283</span>
<a id="__codelineno-84-260" name="__codelineno-84-260"></a><a href="#__codelineno-84-260"><span class="linenos" data-linenos="260 "></span></a>        <span class="n">hint1</span> <span class="o">=</span> <span class="mi">740477612377832718425</span>   <span class="c1">## p高位</span>
<a id="__codelineno-84-261" name="__codelineno-84-261"></a><a href="#__codelineno-84-261"><span class="linenos" data-linenos="261 "></span></a>        <span class="n">hint2</span> <span class="o">=</span> <span class="mi">767891335159501447918</span>  <span class="c1">## q高位</span>
<a id="__codelineno-84-262" name="__codelineno-84-262"></a><a href="#__codelineno-84-262"><span class="linenos" data-linenos="262 "></span></a><span class="c1">##         print (&quot;p真实高&quot;,s,&quot;比特：&quot;, int(p/2^(512-s)))</span>
<a id="__codelineno-84-263" name="__codelineno-84-263"></a><a href="#__codelineno-84-263"><span class="linenos" data-linenos="263 "></span></a><span class="c1">##         print (&quot;q真实高&quot;,s,&quot;比特：&quot;, int(q/2^(512-s)))</span>
<a id="__codelineno-84-264" name="__codelineno-84-264"></a><a href="#__codelineno-84-264"><span class="linenos" data-linenos="264 "></span></a><span class="c1">##         N = p*q;</span>
<a id="__codelineno-84-265" name="__codelineno-84-265"></a><a href="#__codelineno-84-265"><span class="linenos" data-linenos="265 "></span></a>
<a id="__codelineno-84-266" name="__codelineno-84-266"></a><a href="#__codelineno-84-266"><span class="linenos" data-linenos="266 "></span></a>
<a id="__codelineno-84-267" name="__codelineno-84-267"></a><a href="#__codelineno-84-267"><span class="linenos" data-linenos="267 "></span></a>    <span class="c1">## 解密指数d的指数( 最大0.292)  </span>
<a id="__codelineno-84-268" name="__codelineno-84-268"></a><a href="#__codelineno-84-268"><span class="linenos" data-linenos="268 "></span></a>
<a id="__codelineno-84-269" name="__codelineno-84-269"></a><a href="#__codelineno-84-269"><span class="linenos" data-linenos="269 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="mi">7</span>   <span class="c1">## 格大小（越大越好/越慢）</span>
<a id="__codelineno-84-270" name="__codelineno-84-270"></a><a href="#__codelineno-84-270"><span class="linenos" data-linenos="270 "></span></a>        <span class="n">t</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(((</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span> <span class="o">*</span> <span class="n">m</span><span class="p">))</span>  <span class="c1">## 来自 Herrmann 和 May 的优化</span>
<a id="__codelineno-84-271" name="__codelineno-84-271"></a><a href="#__codelineno-84-271"><span class="linenos" data-linenos="271 "></span></a>        <span class="n">X</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">^</span><span class="n">delta</span><span class="p">)</span>  <span class="c1">## </span>
<a id="__codelineno-84-272" name="__codelineno-84-272"></a><a href="#__codelineno-84-272"><span class="linenos" data-linenos="272 "></span></a>        <span class="n">Y</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">N</span><span class="o">^</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">^</span><span class="n">s</span><span class="p">)</span>    <span class="c1">## 如果 p、 q 大小相同，则正确</span>
<a id="__codelineno-84-273" name="__codelineno-84-273"></a><a href="#__codelineno-84-273"><span class="linenos" data-linenos="273 "></span></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hint1</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">hint1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-84-274" name="__codelineno-84-274"></a><a href="#__codelineno-84-274"><span class="linenos" data-linenos="274 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1"> l=&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<a id="__codelineno-84-275" name="__codelineno-84-275"></a><a href="#__codelineno-84-275"><span class="linenos" data-linenos="275 "></span></a>            <span class="n">pM</span><span class="o">=</span><span class="n">l</span><span class="p">;</span>
<a id="__codelineno-84-276" name="__codelineno-84-276"></a><a href="#__codelineno-84-276"><span class="linenos" data-linenos="276 "></span></a>            <span class="n">p0</span><span class="o">=</span><span class="n">pM</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-84-277" name="__codelineno-84-277"></a><a href="#__codelineno-84-277"><span class="linenos" data-linenos="277 "></span></a>            <span class="n">q0</span><span class="o">=</span><span class="n">N</span><span class="o">/</span><span class="n">p0</span><span class="p">;</span>
<a id="__codelineno-84-278" name="__codelineno-84-278"></a><a href="#__codelineno-84-278"><span class="linenos" data-linenos="278 "></span></a>            <span class="n">qM</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">q0</span><span class="o">/</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="n">s</span><span class="p">))</span>
<a id="__codelineno-84-279" name="__codelineno-84-279"></a><a href="#__codelineno-84-279"><span class="linenos" data-linenos="279 "></span></a>            <span class="n">A</span> <span class="o">=</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="o">-</span><span class="n">pM</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">-</span><span class="n">qM</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="n">s</span><span class="p">);</span>
<a id="__codelineno-84-280" name="__codelineno-84-280"></a><a href="#__codelineno-84-280"><span class="linenos" data-linenos="280 "></span></a>        <span class="c1">#A = N+1</span>
<a id="__codelineno-84-281" name="__codelineno-84-281"></a><a href="#__codelineno-84-281"><span class="linenos" data-linenos="281 "></span></a>            <span class="n">P</span><span class="o">.&lt;</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">ZZ</span><span class="p">)</span>
<a id="__codelineno-84-282" name="__codelineno-84-282"></a><a href="#__codelineno-84-282"><span class="linenos" data-linenos="282 "></span></a>            <span class="n">pol</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>  <span class="c1">#构建的方程</span>
<a id="__codelineno-84-283" name="__codelineno-84-283"></a><a href="#__codelineno-84-283"><span class="linenos" data-linenos="283 "></span></a>
<a id="__codelineno-84-284" name="__codelineno-84-284"></a><a href="#__codelineno-84-284"><span class="linenos" data-linenos="284 "></span></a>            <span class="c1">## Checking bounds</span>
<a id="__codelineno-84-285" name="__codelineno-84-285"></a><a href="#__codelineno-84-285"><span class="linenos" data-linenos="285 "></span></a>            <span class="c1">#if debug:</span>
<a id="__codelineno-84-286" name="__codelineno-84-286"></a><a href="#__codelineno-84-286"><span class="linenos" data-linenos="286 "></span></a>                <span class="c1">#print (&quot;=== 核对数据 ===&quot;)</span>
<a id="__codelineno-84-287" name="__codelineno-84-287"></a><a href="#__codelineno-84-287"><span class="linenos" data-linenos="287 "></span></a>                <span class="c1">#print (&quot;* delta:&quot;, delta)</span>
<a id="__codelineno-84-288" name="__codelineno-84-288"></a><a href="#__codelineno-84-288"><span class="linenos" data-linenos="288 "></span></a>                <span class="c1">#print (&quot;* delta &lt; 0.292&quot;, delta &lt; 0.292)</span>
<a id="__codelineno-84-289" name="__codelineno-84-289"></a><a href="#__codelineno-84-289"><span class="linenos" data-linenos="289 "></span></a>                <span class="c1">#print (&quot;* size of e:&quot;, ceil(log(e)/log(2)))  ## e的bit数</span>
<a id="__codelineno-84-290" name="__codelineno-84-290"></a><a href="#__codelineno-84-290"><span class="linenos" data-linenos="290 "></span></a>                <span class="c1">## print (&quot;* size of N:&quot;, len(bin(N)))          ## N的bit数</span>
<a id="__codelineno-84-291" name="__codelineno-84-291"></a><a href="#__codelineno-84-291"><span class="linenos" data-linenos="291 "></span></a>                <span class="c1">#print (&quot;* size of N:&quot;, ceil(log(N)/log(2)))  ## N的bit数</span>
<a id="__codelineno-84-292" name="__codelineno-84-292"></a><a href="#__codelineno-84-292"><span class="linenos" data-linenos="292 "></span></a>                <span class="c1">#print (&quot;* m:&quot;, m, &quot;, t:&quot;, t)</span>
<a id="__codelineno-84-293" name="__codelineno-84-293"></a><a href="#__codelineno-84-293"><span class="linenos" data-linenos="293 "></span></a>
<a id="__codelineno-84-294" name="__codelineno-84-294"></a><a href="#__codelineno-84-294"><span class="linenos" data-linenos="294 "></span></a>            <span class="c1">## boneh_durfee</span>
<a id="__codelineno-84-295" name="__codelineno-84-295"></a><a href="#__codelineno-84-295"><span class="linenos" data-linenos="295 "></span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-296" name="__codelineno-84-296"></a><a href="#__codelineno-84-296"><span class="linenos" data-linenos="296 "></span></a>                <span class="c1">##print (&quot;=== running algorithm ===&quot;)</span>
<a id="__codelineno-84-297" name="__codelineno-84-297"></a><a href="#__codelineno-84-297"><span class="linenos" data-linenos="297 "></span></a>                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-84-298" name="__codelineno-84-298"></a><a href="#__codelineno-84-298"><span class="linenos" data-linenos="298 "></span></a>
<a id="__codelineno-84-299" name="__codelineno-84-299"></a><a href="#__codelineno-84-299"><span class="linenos" data-linenos="299 "></span></a>
<a id="__codelineno-84-300" name="__codelineno-84-300"></a><a href="#__codelineno-84-300"><span class="linenos" data-linenos="300 "></span></a>            <span class="n">solx</span><span class="p">,</span> <span class="n">soly</span> <span class="o">=</span> <span class="n">boneh_durfee</span><span class="p">(</span><span class="n">pol</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<a id="__codelineno-84-301" name="__codelineno-84-301"></a><a href="#__codelineno-84-301"><span class="linenos" data-linenos="301 "></span></a>
<a id="__codelineno-84-302" name="__codelineno-84-302"></a><a href="#__codelineno-84-302"><span class="linenos" data-linenos="302 "></span></a>
<a id="__codelineno-84-303" name="__codelineno-84-303"></a><a href="#__codelineno-84-303"><span class="linenos" data-linenos="303 "></span></a>            <span class="k">if</span> <span class="n">solx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-84-304" name="__codelineno-84-304"></a><a href="#__codelineno-84-304"><span class="linenos" data-linenos="304 "></span></a>                <span class="c1">#print (&quot;=== solution found ===&quot;)</span>
<a id="__codelineno-84-305" name="__codelineno-84-305"></a><a href="#__codelineno-84-305"><span class="linenos" data-linenos="305 "></span></a>                <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-84-306" name="__codelineno-84-306"></a><a href="#__codelineno-84-306"><span class="linenos" data-linenos="306 "></span></a>                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;x:&quot;</span><span class="p">,</span> <span class="n">solx</span><span class="p">)</span>
<a id="__codelineno-84-307" name="__codelineno-84-307"></a><a href="#__codelineno-84-307"><span class="linenos" data-linenos="307 "></span></a>                    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;y:&quot;</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span>
<a id="__codelineno-84-308" name="__codelineno-84-308"></a><a href="#__codelineno-84-308"><span class="linenos" data-linenos="308 "></span></a>
<a id="__codelineno-84-309" name="__codelineno-84-309"></a><a href="#__codelineno-84-309"><span class="linenos" data-linenos="309 "></span></a>                <span class="n">d_sol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pol</span><span class="p">(</span><span class="n">solx</span><span class="p">,</span> <span class="n">soly</span><span class="p">)</span> <span class="o">/</span> <span class="n">e</span><span class="p">)</span>
<a id="__codelineno-84-310" name="__codelineno-84-310"></a><a href="#__codelineno-84-310"><span class="linenos" data-linenos="310 "></span></a>                <span class="n">ss</span><span class="o">=</span><span class="n">ss</span><span class="o">+</span><span class="mi">1</span>
<a id="__codelineno-84-311" name="__codelineno-84-311"></a><a href="#__codelineno-84-311"><span class="linenos" data-linenos="311 "></span></a>
<a id="__codelineno-84-312" name="__codelineno-84-312"></a><a href="#__codelineno-84-312"><span class="linenos" data-linenos="312 "></span></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;=== solution found ===&quot;</span><span class="p">)</span>
<a id="__codelineno-84-313" name="__codelineno-84-313"></a><a href="#__codelineno-84-313"><span class="linenos" data-linenos="313 "></span></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;p的高比特为：&quot;</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
<a id="__codelineno-84-314" name="__codelineno-84-314"></a><a href="#__codelineno-84-314"><span class="linenos" data-linenos="314 "></span></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;q的高比特为：&quot;</span><span class="p">,</span><span class="n">qM</span><span class="p">)</span>
<a id="__codelineno-84-315" name="__codelineno-84-315"></a><a href="#__codelineno-84-315"><span class="linenos" data-linenos="315 "></span></a>                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;d=&quot;</span><span class="p">,</span><span class="n">d_sol</span><span class="p">)</span> 
<a id="__codelineno-84-316" name="__codelineno-84-316"></a><a href="#__codelineno-84-316"><span class="linenos" data-linenos="316 "></span></a>
<a id="__codelineno-84-317" name="__codelineno-84-317"></a><a href="#__codelineno-84-317"><span class="linenos" data-linenos="317 "></span></a>            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
<a id="__codelineno-84-318" name="__codelineno-84-318"></a><a href="#__codelineno-84-318"><span class="linenos" data-linenos="318 "></span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== </span><span class="si">%s</span><span class="s2"> seconds ===&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
<a id="__codelineno-84-319" name="__codelineno-84-319"></a><a href="#__codelineno-84-319"><span class="linenos" data-linenos="319 "></span></a>            <span class="c1">#break</span>
<a id="__codelineno-84-320" name="__codelineno-84-320"></a><a href="#__codelineno-84-320"><span class="linenos" data-linenos="320 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ss=&quot;</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span>
<a id="__codelineno-84-321" name="__codelineno-84-321"></a><a href="#__codelineno-84-321"><span class="linenos" data-linenos="321 "></span></a>                            <span class="c1">#end=time.process_time</span>
<a id="__codelineno-84-322" name="__codelineno-84-322"></a><a href="#__codelineno-84-322"><span class="linenos" data-linenos="322 "></span></a>        <span class="n">end</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<a id="__codelineno-84-323" name="__codelineno-84-323"></a><a href="#__codelineno-84-323"><span class="linenos" data-linenos="323 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running time: </span><span class="si">%s</span><span class="s1"> Seconds&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
<a id="__codelineno-84-324" name="__codelineno-84-324"></a><a href="#__codelineno-84-324"><span class="linenos" data-linenos="324 "></span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-84-325" name="__codelineno-84-325"></a><a href="#__codelineno-84-325"><span class="linenos" data-linenos="325 "></span></a>    <span class="n">example</span><span class="p">()</span>  
</code></pre></div>
<h2 id="_27">十九、一些和数论推导相关的题目<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h2>
<h3 id="1hint-powapbqn">1.hint = pow(ap+b,q,n)<a class="headerlink" href="#1hint-powapbqn" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><a href="#__codelineno-85-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><a href="#__codelineno-85-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><a href="#__codelineno-85-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-85-4" name="__codelineno-85-4"></a><a href="#__codelineno-85-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-85-5" name="__codelineno-85-5"></a><a href="#__codelineno-85-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-85-6" name="__codelineno-85-6"></a><a href="#__codelineno-85-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-85-7" name="__codelineno-85-7"></a><a href="#__codelineno-85-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-85-8" name="__codelineno-85-8"></a><a href="#__codelineno-85-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-85-9" name="__codelineno-85-9"></a><a href="#__codelineno-85-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-85-10" name="__codelineno-85-10"></a><a href="#__codelineno-85-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-85-11" name="__codelineno-85-11"></a><a href="#__codelineno-85-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span>
<a id="__codelineno-85-12" name="__codelineno-85-12"></a><a href="#__codelineno-85-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-85-13" name="__codelineno-85-13"></a><a href="#__codelineno-85-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-85-14" name="__codelineno-85-14"></a><a href="#__codelineno-85-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2020</span> <span class="o">*</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">2021</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-85-15" name="__codelineno-85-15"></a><a href="#__codelineno-85-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-85-16" name="__codelineno-85-16"></a><a href="#__codelineno-85-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c=</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-85-17" name="__codelineno-85-17"></a><a href="#__codelineno-85-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;hint=</span><span class="si">{</span><span class="n">hint</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p>把hint展开</p>
<div class="arithmatex">\[
hint \equiv (2020p + 2021)^q \mod n
\]</div>
<p>模<span class="arithmatex">\(p\)</span>能得到</p>
<div class="arithmatex">\[
hint \equiv 2021^q \mod p
\]</div>
<p>两边同时取p次方</p>
<div class="arithmatex">\[
hint^p \equiv 2021^n \mod p
\]</div>
<p>即</p>
<div class="arithmatex">\[
hint \equiv 2021^n \mod p
\]</div>
<p><code>p = gcd(pow(2021,n,n) - hint,n)</code></p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><a href="#__codelineno-86-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><a href="#__codelineno-86-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><a href="#__codelineno-86-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><a href="#__codelineno-86-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">27020725261160598541077357737650775795182555998856810737571508044949928734067444441660366270392732456051807439301564552672200975582350577967001486740668193835704559129378410828266554536148151615878808327988333060924165410762016082268322936465413880236634083213834739549234631742766416876749808978934944262651307600621868854944164060642189749365967978497831698002669974744487926082412272998646851047638183126945784060957075393737537570645086672473571281053798891685646561828588448040073373363454584468753860529849749093081434144360661566815886630699933232263079413562069476421802192735693386029862725050469209845710383</span>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a><a href="#__codelineno-86-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">10188807385387617708190575473905502994151677148079820873886980571555051900701810208218351138721306416600688313703084580808183634201231599134123549448962443376514560489130860694363901933597676373555599555647232128717993571185822894818704143675318690577221330618533739592165564396729937983659337232822442555504262694675199751730664450120569727835850996566436129543730932040989365233424791093843941154003052950306359994891955336607690065213304872738280674213630736611351982705373394299097653653497017756036211550125607093109216729483090391729134062236908282557149575812220142872855836932590459512028618076264332235518829</span>
<a id="__codelineno-86-6" name="__codelineno-86-6"></a><a href="#__codelineno-86-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="mi">15179972145975733285419381814235528011288991423484121653543845156913121513320504879647666067298415751234264897435338898933073713420024176276221164394369781676781604128149168834126855517212300158864797800121336042194751965268493010327202598446572764475343894613152062609436699715193914479572113800212525965140106015838636914979735618606768207651697548364440806425770871133439416876157686985836939255598747973339866125864303982956813846287509191028829738926404992619459242904729015823730553526572575372668559669124599614613391797015393641171177282129497503752370800088634017972208535899870704612274473042064675033593148</span>
<a id="__codelineno-86-7" name="__codelineno-86-7"></a><a href="#__codelineno-86-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-86-8" name="__codelineno-86-8"></a><a href="#__codelineno-86-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-86-9" name="__codelineno-86-9"></a><a href="#__codelineno-86-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">hint</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-86-10" name="__codelineno-86-10"></a><a href="#__codelineno-86-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-86-11" name="__codelineno-86-11"></a><a href="#__codelineno-86-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-86-12" name="__codelineno-86-12"></a><a href="#__codelineno-86-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-86-13" name="__codelineno-86-13"></a><a href="#__codelineno-86-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="2hint-powapben">2.hint = pow(ap+b,e,n)<a class="headerlink" href="#2hint-powapben" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><a href="#__codelineno-87-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><a href="#__codelineno-87-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><a href="#__codelineno-87-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a><a href="#__codelineno-87-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a><a href="#__codelineno-87-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-87-6" name="__codelineno-87-6"></a><a href="#__codelineno-87-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-87-7" name="__codelineno-87-7"></a><a href="#__codelineno-87-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-87-8" name="__codelineno-87-8"></a><a href="#__codelineno-87-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-87-9" name="__codelineno-87-9"></a><a href="#__codelineno-87-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-87-10" name="__codelineno-87-10"></a><a href="#__codelineno-87-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-87-11" name="__codelineno-87-11"></a><a href="#__codelineno-87-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-87-12" name="__codelineno-87-12"></a><a href="#__codelineno-87-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">h</span> <span class="o">=</span> <span class="mi">20211102</span>
<a id="__codelineno-87-13" name="__codelineno-87-13"></a><a href="#__codelineno-87-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">hc</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">p</span> <span class="o">*</span> <span class="mi">1111</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-87-14" name="__codelineno-87-14"></a><a href="#__codelineno-87-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-87-15" name="__codelineno-87-15"></a><a href="#__codelineno-87-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hc=&quot;</span><span class="p">,</span> <span class="n">hc</span><span class="p">)</span>
<a id="__codelineno-87-16" name="__codelineno-87-16"></a><a href="#__codelineno-87-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-87-17" name="__codelineno-87-17"></a><a href="#__codelineno-87-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-87-18" name="__codelineno-87-18"></a><a href="#__codelineno-87-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">hc</span> <span class="o">=</span> <span class="mi">71505320953946158049530109094654497075489963071106175336722892393493112481336409391299522595724154571954223093317880494307263262649833222750675105885636892419350501821324979706283867758665536771783209816719106279467902518895579024290387800216711663670572861182058425925280993190282267615052256942516011995207</span>
<a id="__codelineno-87-19" name="__codelineno-87-19"></a><a href="#__codelineno-87-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">76856511192427852645963041043072791148703422665129663050712492700760489247788743818199589072069758934570218804936479267319288093436111548055922916898782764333246946326823653877357695179165138863843657328764265204547147092074499832221138997131011222722917338444675582832114206750168113207646100633238664244737</span>
<a id="__codelineno-87-20" name="__codelineno-87-20"></a><a href="#__codelineno-87-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">39246179387125192271554620313966311736032348078183121707012959204367908070472764506984235827179206718838172586811066682034907967943722841257765922283692526422653916506577810629430853963448057701574209912936660396486847365579797147723437378122880075493171892191049105237005801787649587080840600670585409293046</span>
</code></pre></div>
<div class="arithmatex">\[
hint \equiv (ap + b)^e \mod n
\]</div>
<p>两边模p得到</p>
<div class="arithmatex">\[
hint \equiv b^e \mod p
\]</div>
<p><code>p = gcd(pow(b,e,n)-hint,n)</code></p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><a href="#__codelineno-88-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><a href="#__codelineno-88-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><a href="#__codelineno-88-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a><a href="#__codelineno-88-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="mi">71505320953946158049530109094654497075489963071106175336722892393493112481336409391299522595724154571954223093317880494307263262649833222750675105885636892419350501821324979706283867758665536771783209816719106279467902518895579024290387800216711663670572861182058425925280993190282267615052256942516011995207</span>
<a id="__codelineno-88-5" name="__codelineno-88-5"></a><a href="#__codelineno-88-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">76856511192427852645963041043072791148703422665129663050712492700760489247788743818199589072069758934570218804936479267319288093436111548055922916898782764333246946326823653877357695179165138863843657328764265204547147092074499832221138997131011222722917338444675582832114206750168113207646100633238664244737</span>
<a id="__codelineno-88-6" name="__codelineno-88-6"></a><a href="#__codelineno-88-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">39246179387125192271554620313966311736032348078183121707012959204367908070472764506984235827179206718838172586811066682034907967943722841257765922283692526422653916506577810629430853963448057701574209912936660396486847365579797147723437378122880075493171892191049105237005801787649587080840600670585409293046</span>
<a id="__codelineno-88-7" name="__codelineno-88-7"></a><a href="#__codelineno-88-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-88-8" name="__codelineno-88-8"></a><a href="#__codelineno-88-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="mi">20211102</span>
<a id="__codelineno-88-9" name="__codelineno-88-9"></a><a href="#__codelineno-88-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-88-10" name="__codelineno-88-10"></a><a href="#__codelineno-88-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="n">hint</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-88-11" name="__codelineno-88-11"></a><a href="#__codelineno-88-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-88-12" name="__codelineno-88-12"></a><a href="#__codelineno-88-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-88-13" name="__codelineno-88-13"></a><a href="#__codelineno-88-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-88-14" name="__codelineno-88-14"></a><a href="#__codelineno-88-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="3q-inverseep">3.q = inverse(e,p)<a class="headerlink" href="#3q-inverseep" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><a href="#__codelineno-89-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><a href="#__codelineno-89-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><a href="#__codelineno-89-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><a href="#__codelineno-89-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a><a href="#__codelineno-89-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a><a href="#__codelineno-89-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a><a href="#__codelineno-89-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a><a href="#__codelineno-89-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a><a href="#__codelineno-89-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-89-10" name="__codelineno-89-10"></a><a href="#__codelineno-89-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-89-11" name="__codelineno-89-11"></a><a href="#__codelineno-89-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">libnum</span><span class="o">.</span><span class="n">invmod</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-89-12" name="__codelineno-89-12"></a><a href="#__codelineno-89-12"><span class="linenos" data-linenos="12 "></span></a>    <span class="k">if</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-89-13" name="__codelineno-89-13"></a><a href="#__codelineno-89-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">break</span>
<a id="__codelineno-89-14" name="__codelineno-89-14"></a><a href="#__codelineno-89-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">n</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-89-15" name="__codelineno-89-15"></a><a href="#__codelineno-89-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">c</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-89-16" name="__codelineno-89-16"></a><a href="#__codelineno-89-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-89-17" name="__codelineno-89-17"></a><a href="#__codelineno-89-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c=&quot;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[
eq \equiv 1 \mod p
\]</div>
<p>所以有</p>
<div class="arithmatex">\[
eq = kp + 1
\]</div>
<p>两边同时乘<span class="arithmatex">\(p\)</span></p>
<div class="arithmatex">\[
en = kp^2 + 1
\]</div>
<p>这个k和e差不多大，在e不太大的情况下可以枚举k解这个方程</p>
<p>还有个方法就是</p>
<p>从<span class="arithmatex">\(en = kp^2 + 1\)</span>，凑出<span class="arithmatex">\(4ken + 1 = (2kp+1)^2\)</span></p>
<p>所以<span class="arithmatex">\(p = \frac{(4ken+1)^{\frac{1}{2}}-1}{2k}\)</span></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><a href="#__codelineno-90-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><a href="#__codelineno-90-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><a href="#__codelineno-90-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a><a href="#__codelineno-90-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">58204114420266684815970658378327773998564393394613074044159240444415512492622689982761518905542522328879289101538953676661805875053162972893258897360344016406294652339343767887745752686437325346837603712186500309908703326587069304255508650910107794737000566778637055164127273830551001009133332601839918695739</span>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a><a href="#__codelineno-90-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">43430611858598126654595145883807180034546121754009334579568652220639483233618841529702503298293207886941913478597477904682701187000781983315547295293641024286170190626012102497319037012751300959255076727985925313853559910457404758461819072120343343943528618993507783981659418177044469142912677141806591464788</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a><a href="#__codelineno-90-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a><a href="#__codelineno-90-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a><a href="#__codelineno-90-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a><a href="#__codelineno-90-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-90-10" name="__codelineno-90-10"></a><a href="#__codelineno-90-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-90-11" name="__codelineno-90-11"></a><a href="#__codelineno-90-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-90-12" name="__codelineno-90-12"></a><a href="#__codelineno-90-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-90-13" name="__codelineno-90-13"></a><a href="#__codelineno-90-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-90-14" name="__codelineno-90-14"></a><a href="#__codelineno-90-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-90-15" name="__codelineno-90-15"></a><a href="#__codelineno-90-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-90-16" name="__codelineno-90-16"></a><a href="#__codelineno-90-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">break</span>
</code></pre></div>
<h3 id="4powmpnpowmqn">4.pow(m,p,n)和pow(m,q,n)<a class="headerlink" href="#4powmpnpowmqn" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><a href="#__codelineno-91-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><a href="#__codelineno-91-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><a href="#__codelineno-91-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a><a href="#__codelineno-91-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-91-5" name="__codelineno-91-5"></a><a href="#__codelineno-91-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a><a href="#__codelineno-91-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a><a href="#__codelineno-91-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a><a href="#__codelineno-91-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">x</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a><a href="#__codelineno-91-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">y</span><span class="o">=</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-91-10" name="__codelineno-91-10"></a><a href="#__codelineno-91-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n=&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-91-11" name="__codelineno-91-11"></a><a href="#__codelineno-91-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x=&quot;</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-91-12" name="__codelineno-91-12"></a><a href="#__codelineno-91-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y=&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[
x \equiv m ^ p \mod n
\]</div>
<p>由费马小定理得</p>
<div class="arithmatex">\[
x \equiv m \mod p
\]</div>
<p>同理</p>
<div class="arithmatex">\[
y \equiv m \mod q
\]</div>
<p>即</p>
<div class="arithmatex">\[
x = k_1p + m
\]</div>
<div class="arithmatex">\[
y = k_2q + m
\]</div>
<p>相乘之后得到</p>
<div class="arithmatex">\[
xy = m^2 + (k_1p+k_2q)m + k_1k_2n
\]</div>
<p>再次化简</p>
<div class="arithmatex">\[
xy \equiv m^2 + (x-m + y - m)m \mod n
\]</div>
<p>然后用copper解</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><a href="#__codelineno-92-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><a href="#__codelineno-92-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><a href="#__codelineno-92-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">119168018353396473071220326930634033296857570351877525203349067654228903288865563346158289110924833018314600851680403536994000145188490252887831026813814036968773088160020677568623347649228357482873911613625537196000702331852604517461327776409524836030721808860499640682583008287503643735346752806150919473547</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a><a href="#__codelineno-92-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">x</span> <span class="o">=</span> <span class="mi">20889450245206188360163017466832661797042512279294313816641964974342193835127401896327018708629718120262511077145232274218469726065543657294173612852238031375768722870519066517281989421725687761586428233882899166319861093186744865410310768961853709659722549327714475931676224727563796969392665870925936060875</span>
<a id="__codelineno-92-5" name="__codelineno-92-5"></a><a href="#__codelineno-92-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">y</span> <span class="o">=</span> <span class="mi">32080707538492572190029237251694217148237404571842762312567934187316746458298295007401945958852986479911593108750816992042333214302313415615710205763277908672519589955718578006218124903939275787171888825356704546781455848117466648569999021535956085557973651213126679157398458139672913801297571585910183741493</span>
<a id="__codelineno-92-6" name="__codelineno-92-6"></a><a href="#__codelineno-92-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-92-7" name="__codelineno-92-7"></a><a href="#__codelineno-92-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">m</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-92-8" name="__codelineno-92-8"></a><a href="#__codelineno-92-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-92-9" name="__codelineno-92-9"></a><a href="#__codelineno-92-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">m</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span>
<a id="__codelineno-92-10" name="__codelineno-92-10"></a><a href="#__codelineno-92-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-92-11" name="__codelineno-92-11"></a><a href="#__codelineno-92-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">root</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="o">^</span><span class="mi">336</span><span class="p">)</span>
<a id="__codelineno-92-12" name="__codelineno-92-12"></a><a href="#__codelineno-92-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">if</span> <span class="n">root</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-92-13" name="__codelineno-92-13"></a><a href="#__codelineno-92-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</code></pre></div>
<h3 id="5leak-d-p">5.leak = d + p<a class="headerlink" href="#5leak-d-p" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><a href="#__codelineno-93-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><a href="#__codelineno-93-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a><a href="#__codelineno-93-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a><a href="#__codelineno-93-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-93-5" name="__codelineno-93-5"></a><a href="#__codelineno-93-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-93-6" name="__codelineno-93-6"></a><a href="#__codelineno-93-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-93-7" name="__codelineno-93-7"></a><a href="#__codelineno-93-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-93-8" name="__codelineno-93-8"></a><a href="#__codelineno-93-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-93-9" name="__codelineno-93-9"></a><a href="#__codelineno-93-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-93-10" name="__codelineno-93-10"></a><a href="#__codelineno-93-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-93-11" name="__codelineno-93-11"></a><a href="#__codelineno-93-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-93-12" name="__codelineno-93-12"></a><a href="#__codelineno-93-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">p</span>
<a id="__codelineno-93-13" name="__codelineno-93-13"></a><a href="#__codelineno-93-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-93-14" name="__codelineno-93-14"></a><a href="#__codelineno-93-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;leak = </span><span class="si">{</span><span class="n">leak</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-93-15" name="__codelineno-93-15"></a><a href="#__codelineno-93-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-93-16" name="__codelineno-93-16"></a><a href="#__codelineno-93-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[
leak = d + p
\]</div>
<p>同时乘上e</p>
<div class="arithmatex">\[
leak \times e = ed + ep
\]</div>
<div class="arithmatex">\[
\because ed = k(p-1)(q-1) + 1
\]</div>
<div class="arithmatex">\[
\therefore leak \times e = k(p-1)(q-1) + ep + 1 = (k_1 + e)(p-1) + e + 1
\]</div>
<p>则</p>
<div class="arithmatex">\[
2^{leak\times e} \equiv 2^{(p-1)(k_1+e)+e+1} \equiv 2^{e+1} \mod p
\]</div>
<p><code>p = gcd(pow(2,e*leak,n) - pow(2,e+1,n),n)</code></p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><a href="#__codelineno-94-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><a href="#__codelineno-94-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a><a href="#__codelineno-94-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a><a href="#__codelineno-94-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="mi">43773730595208010615167769243389712919043986781372553925103531305753192121900940758872887224717935746491356121136709395293427821519713664465479239343568683512805566797519940659245386786069452631897152582632812964236464253538638932777814445952543179981728372597574240011522586022744496408528369815424689627714</span>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a><a href="#__codelineno-94-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">32609109759602838902299290553935199233727818772965249106067660946940666082748851189532358246129713630287421754985189526470019256048805899987261287835158990237267846168718587057488187109882012577904592602367187436017302897260666096753156638501800052563311351183911829268477864436682312113353547663292164618797</span>
<a id="__codelineno-94-6" name="__codelineno-94-6"></a><a href="#__codelineno-94-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">73687428902140845363357908478989818544523419338611246958530518113252515978963884581173646615800353308789787478447973996695401703969420384980841285031836556985268236880854319562700104921035182736733530699304849659644263120110205601793351720111745179867010541532557489688430577820860370652773129870929371931513</span>
<a id="__codelineno-94-7" name="__codelineno-94-7"></a><a href="#__codelineno-94-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-94-8" name="__codelineno-94-8"></a><a href="#__codelineno-94-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-94-9" name="__codelineno-94-9"></a><a href="#__codelineno-94-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">leak</span> <span class="o">*</span> <span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-94-10" name="__codelineno-94-10"></a><a href="#__codelineno-94-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-94-11" name="__codelineno-94-11"></a><a href="#__codelineno-94-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-94-12" name="__codelineno-94-12"></a><a href="#__codelineno-94-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-94-13" name="__codelineno-94-13"></a><a href="#__codelineno-94-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<p>接下来三个题型来源于2023 数据安全产业人才能力挑战赛---math_exam</p>
<h3 id="6leak-n-p-q-1">6.leak = (n + p) % (q-1)<a class="headerlink" href="#6leak-n-p-q-1" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><a href="#__codelineno-95-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><a href="#__codelineno-95-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a><a href="#__codelineno-95-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a><a href="#__codelineno-95-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a><a href="#__codelineno-95-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a><a href="#__codelineno-95-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a><a href="#__codelineno-95-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">:</span>
<a id="__codelineno-95-8" name="__codelineno-95-8"></a><a href="#__codelineno-95-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span>
<a id="__codelineno-95-9" name="__codelineno-95-9"></a><a href="#__codelineno-95-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-95-10" name="__codelineno-95-10"></a><a href="#__codelineno-95-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-95-11" name="__codelineno-95-11"></a><a href="#__codelineno-95-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-95-12" name="__codelineno-95-12"></a><a href="#__codelineno-95-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-95-13" name="__codelineno-95-13"></a><a href="#__codelineno-95-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-95-14" name="__codelineno-95-14"></a><a href="#__codelineno-95-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-95-15" name="__codelineno-95-15"></a><a href="#__codelineno-95-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-95-16" name="__codelineno-95-16"></a><a href="#__codelineno-95-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">leak</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-95-17" name="__codelineno-95-17"></a><a href="#__codelineno-95-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-95-18" name="__codelineno-95-18"></a><a href="#__codelineno-95-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">#e = 65537</span>
<a id="__codelineno-95-19" name="__codelineno-95-19"></a><a href="#__codelineno-95-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">#c = 846622880180923496523897101093587388412673197929101816777894080453907929979417582433675846206418833989406082027835614960931951892393700870678469052366477889491688459558189367255658278968722099012534045477993924284003153851171132420751750724394405070269223797513951991873714156884423926582172189394011114952</span>
<a id="__codelineno-95-20" name="__codelineno-95-20"></a><a href="#__codelineno-95-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">#n = 159452716285492879108396025652299064897348745847754101475050126796260046052685162344131542880739092630022413124977374334652652450809186959288635651980201026825896903174847709657312399801033678426271413442323084354665643010763178857967804623680894444913369256168333223214048037661178587978535722147091129404833</span>
<a id="__codelineno-95-21" name="__codelineno-95-21"></a><a href="#__codelineno-95-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1">#leak = 2669103705669857828725305123419482758456336465207378766363532584323475128597302561377245054918781031448710846825859151788151496659511563529987056456136018</span>
</code></pre></div>
<div class="arithmatex">\[
leak \equiv (n + p) \mod q-1
\]</div>
<p>即</p>
<div class="arithmatex">\[
leak \equiv p(q + 1) \mod q-1
\]</div>
<div class="arithmatex">\[
\therefore leak \equiv 2p \mod q-1
\]</div>
<p>题目确定了<span class="arithmatex">\(p &gt; q\)</span></p>
<div class="arithmatex">\[
\therefore p \mod q-1 = p - q + 1
\]</div>
<div class="arithmatex">\[
\therefore leak \equiv 2(p-q + 1)
\]</div>
<p>再联立<span class="arithmatex">\(n = p \times q\)</span>解方程即可分解n</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><a href="#__codelineno-96-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><a href="#__codelineno-96-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="kn">import</span> <span class="n">solve</span><span class="p">,</span><span class="n">symbols</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><a href="#__codelineno-96-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a><a href="#__codelineno-96-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-96-5" name="__codelineno-96-5"></a><a href="#__codelineno-96-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-96-6" name="__codelineno-96-6"></a><a href="#__codelineno-96-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">846622880180923496523897101093587388412673197929101816777894080453907929979417582433675846206418833989406082027835614960931951892393700870678469052366477889491688459558189367255658278968722099012534045477993924284003153851171132420751750724394405070269223797513951991873714156884423926582172189394011114952</span>
<a id="__codelineno-96-7" name="__codelineno-96-7"></a><a href="#__codelineno-96-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">159452716285492879108396025652299064897348745847754101475050126796260046052685162344131542880739092630022413124977374334652652450809186959288635651980201026825896903174847709657312399801033678426271413442323084354665643010763178857967804623680894444913369256168333223214048037661178587978535722147091129404833</span>
<a id="__codelineno-96-8" name="__codelineno-96-8"></a><a href="#__codelineno-96-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="mi">2669103705669857828725305123419482758456336465207378766363532584323475128597302561377245054918781031448710846825859151788151496659511563529987056456136018</span>
<a id="__codelineno-96-9" name="__codelineno-96-9"></a><a href="#__codelineno-96-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-96-10" name="__codelineno-96-10"></a><a href="#__codelineno-96-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<a id="__codelineno-96-11" name="__codelineno-96-11"></a><a href="#__codelineno-96-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)</span>
<a id="__codelineno-96-12" name="__codelineno-96-12"></a><a href="#__codelineno-96-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-96-13" name="__codelineno-96-13"></a><a href="#__codelineno-96-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">eq1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">leak</span>
<a id="__codelineno-96-14" name="__codelineno-96-14"></a><a href="#__codelineno-96-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">eq2</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-96-15" name="__codelineno-96-15"></a><a href="#__codelineno-96-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-96-16" name="__codelineno-96-16"></a><a href="#__codelineno-96-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">solution</span> <span class="o">=</span> <span class="n">solve</span><span class="p">((</span><span class="n">eq1</span><span class="p">,</span><span class="n">eq2</span><span class="p">),(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
<a id="__codelineno-96-17" name="__codelineno-96-17"></a><a href="#__codelineno-96-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
<a id="__codelineno-96-18" name="__codelineno-96-18"></a><a href="#__codelineno-96-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-96-19" name="__codelineno-96-19"></a><a href="#__codelineno-96-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-96-20" name="__codelineno-96-20"></a><a href="#__codelineno-96-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-96-21" name="__codelineno-96-21"></a><a href="#__codelineno-96-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-96-22" name="__codelineno-96-22"></a><a href="#__codelineno-96-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-96-23" name="__codelineno-96-23"></a><a href="#__codelineno-96-23"><span class="linenos" data-linenos="23 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="7leak-d-p-q">7.leak = d + p + q<a class="headerlink" href="#7leak-d-p-q" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><a href="#__codelineno-97-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a><a href="#__codelineno-97-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a><a href="#__codelineno-97-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a><a href="#__codelineno-97-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-97-5" name="__codelineno-97-5"></a><a href="#__codelineno-97-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-97-6" name="__codelineno-97-6"></a><a href="#__codelineno-97-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-97-7" name="__codelineno-97-7"></a><a href="#__codelineno-97-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-97-8" name="__codelineno-97-8"></a><a href="#__codelineno-97-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-97-9" name="__codelineno-97-9"></a><a href="#__codelineno-97-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-97-10" name="__codelineno-97-10"></a><a href="#__codelineno-97-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-97-11" name="__codelineno-97-11"></a><a href="#__codelineno-97-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">d</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">invmod</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-97-12" name="__codelineno-97-12"></a><a href="#__codelineno-97-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="n">d</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="n">q</span>
<a id="__codelineno-97-13" name="__codelineno-97-13"></a><a href="#__codelineno-97-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-97-14" name="__codelineno-97-14"></a><a href="#__codelineno-97-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-97-15" name="__codelineno-97-15"></a><a href="#__codelineno-97-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-97-16" name="__codelineno-97-16"></a><a href="#__codelineno-97-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">leak</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-97-17" name="__codelineno-97-17"></a><a href="#__codelineno-97-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-97-18" name="__codelineno-97-18"></a><a href="#__codelineno-97-18"><span class="linenos" data-linenos="18 "></span></a><span class="c1">#e = 65537</span>
<a id="__codelineno-97-19" name="__codelineno-97-19"></a><a href="#__codelineno-97-19"><span class="linenos" data-linenos="19 "></span></a><span class="c1">#c = 65194823373091792824101730983124740337276083358867621564067880339279446092377567969207237986613196892737474455781661885696122256698478429450971196633786693648866129636737262041654769618993094832127875251068775632567036646408374963058703320605733921797230106462440860984746880466416824674570639694481298708147</span>
<a id="__codelineno-97-20" name="__codelineno-97-20"></a><a href="#__codelineno-97-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">#n = 101929257180069933443442160085713121307068880188090652033345240568607589666231813199686824369361640378636124324844158355533056421197926269617986872835671463371353540696806173813019752742218460997272803573114119876536384486655117245296360474103378827486280279523273344156760793016731778663058274770626116861407</span>
<a id="__codelineno-97-21" name="__codelineno-97-21"></a><a href="#__codelineno-97-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1">#leak = 87007773233816810147344015772388866522443114032719766646343787373996588014373656496789294836431302130125588646180886383013958151442324020038131736683796464202667423644714259545194662934238144990354387370533656134036753530002005551694211595695927699196016268145816389892292091218491443784193805171731592693841</span>
</code></pre></div>
<div class="arithmatex">\[
leak = d + p + q
\]</div>
<div class="arithmatex">\[
\therefore d = leak - (p + q)
\]</div>
<p>则</p>
<div class="arithmatex">\[
m \equiv c^d \equiv c^{leak -(p+q)} \mod n
\]</div>
<p>因为<span class="arithmatex">\(\phi(n) = n - (p+q) + 1\)</span></p>
<div class="arithmatex">\[
\therefore m \equiv c^{leak - (n + 1)} \mod n
\]</div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><a href="#__codelineno-98-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><a href="#__codelineno-98-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><a href="#__codelineno-98-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">65194823373091792824101730983124740337276083358867621564067880339279446092377567969207237986613196892737474455781661885696122256698478429450971196633786693648866129636737262041654769618993094832127875251068775632567036646408374963058703320605733921797230106462440860984746880466416824674570639694481298708147</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><a href="#__codelineno-98-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">101929257180069933443442160085713121307068880188090652033345240568607589666231813199686824369361640378636124324844158355533056421197926269617986872835671463371353540696806173813019752742218460997272803573114119876536384486655117245296360474103378827486280279523273344156760793016731778663058274770626116861407</span>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a><a href="#__codelineno-98-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="mi">87007773233816810147344015772388866522443114032719766646343787373996588014373656496789294836431302130125588646180886383013958151442324020038131736683796464202667423644714259545194662934238144990354387370533656134036753530002005551694211595695927699196016268145816389892292091218491443784193805171731592693841</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a><a href="#__codelineno-98-6"><span class="linenos" data-linenos="6 "></span></a>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a><a href="#__codelineno-98-7"><span class="linenos" data-linenos="7 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">leak</span> <span class="o">-</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a><a href="#__codelineno-98-8"><span class="linenos" data-linenos="8 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="8leak-powpqn-powqpn-n">8.leak = pow(p,q,n) + pow(q,p,n) % n<a class="headerlink" href="#8leak-powpqn-powqpn-n" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><a href="#__codelineno-99-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">libnum</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><a href="#__codelineno-99-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><a href="#__codelineno-99-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-99-4" name="__codelineno-99-4"></a><a href="#__codelineno-99-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">s2n</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-99-5" name="__codelineno-99-5"></a><a href="#__codelineno-99-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">p</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-99-6" name="__codelineno-99-6"></a><a href="#__codelineno-99-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">q</span><span class="o">=</span><span class="n">libnum</span><span class="o">.</span><span class="n">generate_prime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-99-7" name="__codelineno-99-7"></a><a href="#__codelineno-99-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-99-8" name="__codelineno-99-8"></a><a href="#__codelineno-99-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-99-9" name="__codelineno-99-9"></a><a href="#__codelineno-99-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-99-10" name="__codelineno-99-10"></a><a href="#__codelineno-99-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-99-11" name="__codelineno-99-11"></a><a href="#__codelineno-99-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-99-12" name="__codelineno-99-12"></a><a href="#__codelineno-99-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-99-13" name="__codelineno-99-13"></a><a href="#__codelineno-99-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-99-14" name="__codelineno-99-14"></a><a href="#__codelineno-99-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-99-15" name="__codelineno-99-15"></a><a href="#__codelineno-99-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">leak</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="arithmatex">\[
leak \equiv (p^q \mod n + q^p \mod n) \mod n
\]</div>
<p>由费马小定理得</p>
<div class="arithmatex">\[
leak \equiv (p^q \mod q + q^p \mod p) \mod n
\]</div>
<p>即</p>
<div class="arithmatex">\[
leak \equiv p + q \mod n
\]</div>
<div class="arithmatex">\[
\because p + q &lt; n
\]</div>
<div class="arithmatex">\[
\therefore leak = p + q
\]</div>
<p>然后</p>
<div class="arithmatex">\[
(p-q)^2 = (p+q)^2 - 4n = leak^2 - 4n
\]</div>
<div class="arithmatex">\[
\therefore p = \frac{((p+q) + (p-q))}{2}
\]</div>
<p>或者解方程</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><a href="#__codelineno-100-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a><a href="#__codelineno-100-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a><a href="#__codelineno-100-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a><a href="#__codelineno-100-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-100-5" name="__codelineno-100-5"></a><a href="#__codelineno-100-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">59662555342583061013008608133060203475725526601468647442902301335538953096485921516133656618941085620436784211565880744663573927593670579237831797055934897166262528476227281479029026508166848256301828084036716500159067642101104810756620735383857351274773983199968924981397675373272878756685629789497697821620</span>
<a id="__codelineno-100-6" name="__codelineno-100-6"></a><a href="#__codelineno-100-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">83332115751539889489689110273690067288993797655970253065863170986174973047785854940017477990345318506407680986257706329521142524295434171889087917406552261883625775754882538291980506944585738241124811588555071095223782766762626040473256423491630224616140407276984106458673447870374272906086783555489477673207</span>
<a id="__codelineno-100-7" name="__codelineno-100-7"></a><a href="#__codelineno-100-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="mi">18881487897809480964326513919135880296801378921812225600834164247018332292886076618571738627353925482046410714540439662613766662197119044934743578662330528</span>
<a id="__codelineno-100-8" name="__codelineno-100-8"></a><a href="#__codelineno-100-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-100-9" name="__codelineno-100-9"></a><a href="#__codelineno-100-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p_q</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">iroot</span><span class="p">(</span><span class="n">leak</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-100-10" name="__codelineno-100-10"></a><a href="#__codelineno-100-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">leak</span> <span class="o">+</span> <span class="n">p_q</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-100-11" name="__codelineno-100-11"></a><a href="#__codelineno-100-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-100-12" name="__codelineno-100-12"></a><a href="#__codelineno-100-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-100-13" name="__codelineno-100-13"></a><a href="#__codelineno-100-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-100-14" name="__codelineno-100-14"></a><a href="#__codelineno-100-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h4 id="2023math_exam">2023数据安全产业人才能力挑战赛——math_exam<a class="headerlink" href="#2023math_exam" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><a href="#__codelineno-101-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><a href="#__codelineno-101-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><a href="#__codelineno-101-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><a href="#__codelineno-101-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a><a href="#__codelineno-101-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">bits</span> <span class="o">=</span> <span class="mi">512</span>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a><a href="#__codelineno-101-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a><a href="#__codelineno-101-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">pad</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a><a href="#__codelineno-101-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">pad_length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a><a href="#__codelineno-101-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="n">pad_data</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">pad_length</span><span class="p">)</span>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a><a href="#__codelineno-101-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">return</span> <span class="n">msg</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">pad_data</span>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a><a href="#__codelineno-101-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-101-12" name="__codelineno-101-12"></a><a href="#__codelineno-101-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">unpad</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-101-13" name="__codelineno-101-13"></a><a href="#__codelineno-101-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">return</span> <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-101-14" name="__codelineno-101-14"></a><a href="#__codelineno-101-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-101-15" name="__codelineno-101-15"></a><a href="#__codelineno-101-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">challenge1</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<a id="__codelineno-101-16" name="__codelineno-101-16"></a><a href="#__codelineno-101-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-101-17" name="__codelineno-101-17"></a><a href="#__codelineno-101-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;=</span> <span class="n">q</span><span class="p">:</span>
<a id="__codelineno-101-18" name="__codelineno-101-18"></a><a href="#__codelineno-101-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span>
<a id="__codelineno-101-19" name="__codelineno-101-19"></a><a href="#__codelineno-101-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-101-20" name="__codelineno-101-20"></a><a href="#__codelineno-101-20"><span class="linenos" data-linenos="20 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-101-21" name="__codelineno-101-21"></a><a href="#__codelineno-101-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-101-22" name="__codelineno-101-22"></a><a href="#__codelineno-101-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="n">leak</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-101-23" name="__codelineno-101-23"></a><a href="#__codelineno-101-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------- challenge 1 --------&#39;</span><span class="p">)</span>
<a id="__codelineno-101-24" name="__codelineno-101-24"></a><a href="#__codelineno-101-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-25" name="__codelineno-101-25"></a><a href="#__codelineno-101-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-26" name="__codelineno-101-26"></a><a href="#__codelineno-101-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-27" name="__codelineno-101-27"></a><a href="#__codelineno-101-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">leak</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-28" name="__codelineno-101-28"></a><a href="#__codelineno-101-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-101-29" name="__codelineno-101-29"></a><a href="#__codelineno-101-29"><span class="linenos" data-linenos="29 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">challenge2</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<a id="__codelineno-101-30" name="__codelineno-101-30"></a><a href="#__codelineno-101-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-101-31" name="__codelineno-101-31"></a><a href="#__codelineno-101-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-101-32" name="__codelineno-101-32"></a><a href="#__codelineno-101-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-101-33" name="__codelineno-101-33"></a><a href="#__codelineno-101-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-101-34" name="__codelineno-101-34"></a><a href="#__codelineno-101-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-101-35" name="__codelineno-101-35"></a><a href="#__codelineno-101-35"><span class="linenos" data-linenos="35 "></span></a>    <span class="n">leak</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">q</span>
<a id="__codelineno-101-36" name="__codelineno-101-36"></a><a href="#__codelineno-101-36"><span class="linenos" data-linenos="36 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------- challenge 2 --------&#39;</span><span class="p">)</span>
<a id="__codelineno-101-37" name="__codelineno-101-37"></a><a href="#__codelineno-101-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-38" name="__codelineno-101-38"></a><a href="#__codelineno-101-38"><span class="linenos" data-linenos="38 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-39" name="__codelineno-101-39"></a><a href="#__codelineno-101-39"><span class="linenos" data-linenos="39 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-40" name="__codelineno-101-40"></a><a href="#__codelineno-101-40"><span class="linenos" data-linenos="40 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">leak</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-41" name="__codelineno-101-41"></a><a href="#__codelineno-101-41"><span class="linenos" data-linenos="41 "></span></a>
<a id="__codelineno-101-42" name="__codelineno-101-42"></a><a href="#__codelineno-101-42"><span class="linenos" data-linenos="42 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">challenge3</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<a id="__codelineno-101-43" name="__codelineno-101-43"></a><a href="#__codelineno-101-43"><span class="linenos" data-linenos="43 "></span></a>    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-101-44" name="__codelineno-101-44"></a><a href="#__codelineno-101-44"><span class="linenos" data-linenos="44 "></span></a>    <span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-101-45" name="__codelineno-101-45"></a><a href="#__codelineno-101-45"><span class="linenos" data-linenos="45 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-101-46" name="__codelineno-101-46"></a><a href="#__codelineno-101-46"><span class="linenos" data-linenos="46 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-101-47" name="__codelineno-101-47"></a><a href="#__codelineno-101-47"><span class="linenos" data-linenos="47 "></span></a>    <span class="n">leak</span> <span class="o">=</span> <span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">%</span> <span class="n">n</span>
<a id="__codelineno-101-48" name="__codelineno-101-48"></a><a href="#__codelineno-101-48"><span class="linenos" data-linenos="48 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------- challenge 3 --------&#39;</span><span class="p">)</span>
<a id="__codelineno-101-49" name="__codelineno-101-49"></a><a href="#__codelineno-101-49"><span class="linenos" data-linenos="49 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">e</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-50" name="__codelineno-101-50"></a><a href="#__codelineno-101-50"><span class="linenos" data-linenos="50 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-51" name="__codelineno-101-51"></a><a href="#__codelineno-101-51"><span class="linenos" data-linenos="51 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-52" name="__codelineno-101-52"></a><a href="#__codelineno-101-52"><span class="linenos" data-linenos="52 "></span></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">leak</span><span class="w"> </span><span class="si">= }</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-101-53" name="__codelineno-101-53"></a><a href="#__codelineno-101-53"><span class="linenos" data-linenos="53 "></span></a>
<a id="__codelineno-101-54" name="__codelineno-101-54"></a><a href="#__codelineno-101-54"><span class="linenos" data-linenos="54 "></span></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">==</span> <span class="mi">42</span>
<a id="__codelineno-101-55" name="__codelineno-101-55"></a><a href="#__codelineno-101-55"><span class="linenos" data-linenos="55 "></span></a><span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-101-56" name="__codelineno-101-56"></a><a href="#__codelineno-101-56"><span class="linenos" data-linenos="56 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span>
<a id="__codelineno-101-57" name="__codelineno-101-57"></a><a href="#__codelineno-101-57"><span class="linenos" data-linenos="57 "></span></a>    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">14</span><span class="p">],</span> <span class="n">bits</span><span class="o">//</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
<a id="__codelineno-101-58" name="__codelineno-101-58"></a><a href="#__codelineno-101-58"><span class="linenos" data-linenos="58 "></span></a>
<a id="__codelineno-101-59" name="__codelineno-101-59"></a><a href="#__codelineno-101-59"><span class="linenos" data-linenos="59 "></span></a><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">ms</span>
<a id="__codelineno-101-60" name="__codelineno-101-60"></a><a href="#__codelineno-101-60"><span class="linenos" data-linenos="60 "></span></a><span class="n">challenge1</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
<a id="__codelineno-101-61" name="__codelineno-101-61"></a><a href="#__codelineno-101-61"><span class="linenos" data-linenos="61 "></span></a><span class="n">challenge2</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
<a id="__codelineno-101-62" name="__codelineno-101-62"></a><a href="#__codelineno-101-62"><span class="linenos" data-linenos="62 "></span></a><span class="n">challenge3</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
<a id="__codelineno-101-63" name="__codelineno-101-63"></a><a href="#__codelineno-101-63"><span class="linenos" data-linenos="63 "></span></a>
<a id="__codelineno-101-64" name="__codelineno-101-64"></a><a href="#__codelineno-101-64"><span class="linenos" data-linenos="64 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-101-65" name="__codelineno-101-65"></a><a href="#__codelineno-101-65"><span class="linenos" data-linenos="65 "></span></a><span class="sd">-------- challenge 1 --------</span>
<a id="__codelineno-101-66" name="__codelineno-101-66"></a><a href="#__codelineno-101-66"><span class="linenos" data-linenos="66 "></span></a><span class="sd">e = 65537</span>
<a id="__codelineno-101-67" name="__codelineno-101-67"></a><a href="#__codelineno-101-67"><span class="linenos" data-linenos="67 "></span></a><span class="sd">c = 112742443814287255411540092433156061065388404049949520959549377871297566383025041892192679147481155020865118811016470498351633875090973546567374001852295013083192495299811476604405637385307524194793969533646755764136014187430115618114840780368311166911900457224593131166970676797547489278410997707815915932756</span>
<a id="__codelineno-101-68" name="__codelineno-101-68"></a><a href="#__codelineno-101-68"><span class="linenos" data-linenos="68 "></span></a><span class="sd">n = 121127425328043404860413278637978444801342472819958112597540188142689720655042880213001676368390521140660355813910726809125567752172921410143437643574528335234973793653775043030021036875866776532570781661875022102733555943967261003246543180935987772711036868216508554536086688819118597075508026787867088355603</span>
<a id="__codelineno-101-69" name="__codelineno-101-69"></a><a href="#__codelineno-101-69"><span class="linenos" data-linenos="69 "></span></a><span class="sd">leak = 216638862637129382765636503118049146067015523924032194492700294200289728064297722088882791754351329407138196573832392846467607399504585045028165699421278</span>
<a id="__codelineno-101-70" name="__codelineno-101-70"></a><a href="#__codelineno-101-70"><span class="linenos" data-linenos="70 "></span></a><span class="sd">-------- challenge 2 --------</span>
<a id="__codelineno-101-71" name="__codelineno-101-71"></a><a href="#__codelineno-101-71"><span class="linenos" data-linenos="71 "></span></a><span class="sd">e = 65537</span>
<a id="__codelineno-101-72" name="__codelineno-101-72"></a><a href="#__codelineno-101-72"><span class="linenos" data-linenos="72 "></span></a><span class="sd">c = 7964477910021153997178145480752641882728907630831216554750778499596527781702830885213467912351097301767341858663701574005489585561370961723264247818377063081744522471774208105250855114831033452448184392499682147532404562876275189577321587660597603848038824026981539659156304028998137796242331160312370913038</span>
<a id="__codelineno-101-73" name="__codelineno-101-73"></a><a href="#__codelineno-101-73"><span class="linenos" data-linenos="73 "></span></a><span class="sd">n = 140571013522095816880929287025269553867630639381779595547026503691829940612178900269986625350464874598461222087427155791855120339533208468121389480964471710028253589422629569889402475311387750348466199387760629889238062977271925350490110043385800605640905324122017637306715108727700910035925728362455954862209</span>
<a id="__codelineno-101-74" name="__codelineno-101-74"></a><a href="#__codelineno-101-74"><span class="linenos" data-linenos="74 "></span></a><span class="sd">leak = 58442382248753295429370894053397615609981110383986887405127350139482893508400422595729520437678203735054593866306478994471465948872565590901376309380029015549809468112086393107585011072503638322671608471684607214064187044372418770555236721845694224676090744181562673509234801011420696349507624867568099759003</span>
<a id="__codelineno-101-75" name="__codelineno-101-75"></a><a href="#__codelineno-101-75"><span class="linenos" data-linenos="75 "></span></a><span class="sd">-------- challenge 3 --------</span>
<a id="__codelineno-101-76" name="__codelineno-101-76"></a><a href="#__codelineno-101-76"><span class="linenos" data-linenos="76 "></span></a><span class="sd">e = 65537</span>
<a id="__codelineno-101-77" name="__codelineno-101-77"></a><a href="#__codelineno-101-77"><span class="linenos" data-linenos="77 "></span></a><span class="sd">c = 54161995127842474543974770981473422085334044100057089719350274921419091368361244533281599379235907845996678762379778310924192757650322930707785543132446159092950451255660204858292974657119337026589911330412367633761103944916751660957776230135927005700707688661350641600954072696774954805514477330339449799540</span>
<a id="__codelineno-101-78" name="__codelineno-101-78"></a><a href="#__codelineno-101-78"><span class="linenos" data-linenos="78 "></span></a><span class="sd">n = 88207747624007183083381863279444163105330473097729276113333026679597864128605555600000789783468271680476780366740448641311570797876037993255307716167149079618302706650018518487351604778857406170722209469765782625409279109832638886179654096975665134276856272488090272822541461702907181545730309689190333058151</span>
<a id="__codelineno-101-79" name="__codelineno-101-79"></a><a href="#__codelineno-101-79"><span class="linenos" data-linenos="79 "></span></a><span class="sd">leak = 19596671928335648228117128090384865424885102632642665068992144783391306491716530155291726644158221224616817878768426330717188403310818678195631582453246848</span>
<a id="__codelineno-101-80" name="__codelineno-101-80"></a><a href="#__codelineno-101-80"><span class="linenos" data-linenos="80 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><a href="#__codelineno-102-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sympy</span><span class="w"> </span><span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span><span class="n">solve</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><a href="#__codelineno-102-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a><a href="#__codelineno-102-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a><a href="#__codelineno-102-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a><a href="#__codelineno-102-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-102-6" name="__codelineno-102-6"></a><a href="#__codelineno-102-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">c1</span> <span class="o">=</span> 
<a id="__codelineno-102-7" name="__codelineno-102-7"></a><a href="#__codelineno-102-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n1</span> <span class="o">=</span> 
<a id="__codelineno-102-8" name="__codelineno-102-8"></a><a href="#__codelineno-102-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">leak1</span> <span class="o">=</span> 
<a id="__codelineno-102-9" name="__codelineno-102-9"></a><a href="#__codelineno-102-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-102-10" name="__codelineno-102-10"></a><a href="#__codelineno-102-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">p1</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p1&#39;</span><span class="p">)</span>
<a id="__codelineno-102-11" name="__codelineno-102-11"></a><a href="#__codelineno-102-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q1</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;q1&#39;</span><span class="p">)</span>
<a id="__codelineno-102-12" name="__codelineno-102-12"></a><a href="#__codelineno-102-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-102-13" name="__codelineno-102-13"></a><a href="#__codelineno-102-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">eq1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">q1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">leak1</span>
<a id="__codelineno-102-14" name="__codelineno-102-14"></a><a href="#__codelineno-102-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">eq2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">*</span> <span class="n">q1</span><span class="o">-</span> <span class="n">n1</span>
<a id="__codelineno-102-15" name="__codelineno-102-15"></a><a href="#__codelineno-102-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-102-16" name="__codelineno-102-16"></a><a href="#__codelineno-102-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">solution1</span> <span class="o">=</span> <span class="n">solve</span><span class="p">((</span><span class="n">eq1</span><span class="p">,</span><span class="n">eq2</span><span class="p">),(</span><span class="n">p1</span><span class="p">,</span><span class="n">q1</span><span class="p">))</span>
<a id="__codelineno-102-17" name="__codelineno-102-17"></a><a href="#__codelineno-102-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-102-18" name="__codelineno-102-18"></a><a href="#__codelineno-102-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">p1</span><span class="p">,</span><span class="n">q1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">solution1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">solution1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-102-19" name="__codelineno-102-19"></a><a href="#__codelineno-102-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">d1</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-102-20" name="__codelineno-102-20"></a><a href="#__codelineno-102-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">m1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-102-21" name="__codelineno-102-21"></a><a href="#__codelineno-102-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">flag1</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m1</span><span class="p">)[:</span><span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-102-22" name="__codelineno-102-22"></a><a href="#__codelineno-102-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-102-23" name="__codelineno-102-23"></a><a href="#__codelineno-102-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">c2</span> <span class="o">=</span> 
<a id="__codelineno-102-24" name="__codelineno-102-24"></a><a href="#__codelineno-102-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">n2</span> <span class="o">=</span> 
<a id="__codelineno-102-25" name="__codelineno-102-25"></a><a href="#__codelineno-102-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">leak2</span> <span class="o">=</span> 
<a id="__codelineno-102-26" name="__codelineno-102-26"></a><a href="#__codelineno-102-26"><span class="linenos" data-linenos="26 "></span></a>
<a id="__codelineno-102-27" name="__codelineno-102-27"></a><a href="#__codelineno-102-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">tmp</span> <span class="o">=</span> <span class="n">leak2</span> <span class="o">-</span> <span class="n">n2</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-102-28" name="__codelineno-102-28"></a><a href="#__codelineno-102-28"><span class="linenos" data-linenos="28 "></span></a><span class="n">m2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
<a id="__codelineno-102-29" name="__codelineno-102-29"></a><a href="#__codelineno-102-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">flag2</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m2</span><span class="p">)[:</span><span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-102-30" name="__codelineno-102-30"></a><a href="#__codelineno-102-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-102-31" name="__codelineno-102-31"></a><a href="#__codelineno-102-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">c3</span> <span class="o">=</span> 
<a id="__codelineno-102-32" name="__codelineno-102-32"></a><a href="#__codelineno-102-32"><span class="linenos" data-linenos="32 "></span></a><span class="n">n3</span> <span class="o">=</span> 
<a id="__codelineno-102-33" name="__codelineno-102-33"></a><a href="#__codelineno-102-33"><span class="linenos" data-linenos="33 "></span></a><span class="n">leak3</span> <span class="o">=</span> 
<a id="__codelineno-102-34" name="__codelineno-102-34"></a><a href="#__codelineno-102-34"><span class="linenos" data-linenos="34 "></span></a>
<a id="__codelineno-102-35" name="__codelineno-102-35"></a><a href="#__codelineno-102-35"><span class="linenos" data-linenos="35 "></span></a><span class="n">p3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;p3&#39;</span><span class="p">)</span>
<a id="__codelineno-102-36" name="__codelineno-102-36"></a><a href="#__codelineno-102-36"><span class="linenos" data-linenos="36 "></span></a><span class="n">q3</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;q3&#39;</span><span class="p">)</span>
<a id="__codelineno-102-37" name="__codelineno-102-37"></a><a href="#__codelineno-102-37"><span class="linenos" data-linenos="37 "></span></a>
<a id="__codelineno-102-38" name="__codelineno-102-38"></a><a href="#__codelineno-102-38"><span class="linenos" data-linenos="38 "></span></a><span class="n">eq3</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">+</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">leak3</span>
<a id="__codelineno-102-39" name="__codelineno-102-39"></a><a href="#__codelineno-102-39"><span class="linenos" data-linenos="39 "></span></a><span class="n">eq4</span> <span class="o">=</span> <span class="n">p3</span> <span class="o">*</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">n3</span>
<a id="__codelineno-102-40" name="__codelineno-102-40"></a><a href="#__codelineno-102-40"><span class="linenos" data-linenos="40 "></span></a>
<a id="__codelineno-102-41" name="__codelineno-102-41"></a><a href="#__codelineno-102-41"><span class="linenos" data-linenos="41 "></span></a><span class="n">solution3</span> <span class="o">=</span> <span class="n">solve</span><span class="p">((</span><span class="n">eq3</span><span class="p">,</span><span class="n">eq4</span><span class="p">),(</span><span class="n">p3</span><span class="p">,</span><span class="n">q3</span><span class="p">))</span>
<a id="__codelineno-102-42" name="__codelineno-102-42"></a><a href="#__codelineno-102-42"><span class="linenos" data-linenos="42 "></span></a>
<a id="__codelineno-102-43" name="__codelineno-102-43"></a><a href="#__codelineno-102-43"><span class="linenos" data-linenos="43 "></span></a><span class="n">p3</span><span class="p">,</span><span class="n">q3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">solution3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">solution3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-102-44" name="__codelineno-102-44"></a><a href="#__codelineno-102-44"><span class="linenos" data-linenos="44 "></span></a><span class="n">d3</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p3</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-102-45" name="__codelineno-102-45"></a><a href="#__codelineno-102-45"><span class="linenos" data-linenos="45 "></span></a><span class="n">m3</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c3</span><span class="p">,</span><span class="n">d3</span><span class="p">,</span><span class="n">n3</span><span class="p">)</span>
<a id="__codelineno-102-46" name="__codelineno-102-46"></a><a href="#__codelineno-102-46"><span class="linenos" data-linenos="46 "></span></a><span class="n">flag3</span> <span class="o">=</span> <span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m3</span><span class="p">)[:</span><span class="mi">14</span><span class="p">]</span>
<a id="__codelineno-102-47" name="__codelineno-102-47"></a><a href="#__codelineno-102-47"><span class="linenos" data-linenos="47 "></span></a>
<a id="__codelineno-102-48" name="__codelineno-102-48"></a><a href="#__codelineno-102-48"><span class="linenos" data-linenos="48 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="n">flag1</span> <span class="o">+</span> <span class="n">flag2</span> <span class="o">+</span> <span class="n">flag3</span>
<a id="__codelineno-102-49" name="__codelineno-102-49"></a><a href="#__codelineno-102-49"><span class="linenos" data-linenos="49 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</code></pre></div>
<h2 id="_28">二十、剪枝相关<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h2>
<h3 id="1gift-p-q">1.gift = p ^ q<a class="headerlink" href="#1gift-p-q" title="Permanent link">&para;</a></h3>
<p>题目来源：2023陕西省技能大赛——奇怪得asr</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><a href="#__codelineno-103-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><a href="#__codelineno-103-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a><a href="#__codelineno-103-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;flag{**********}&#39;</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a><a href="#__codelineno-103-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a><a href="#__codelineno-103-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">bits</span> <span class="o">=</span> <span class="mi">1024</span>
<a id="__codelineno-103-6" name="__codelineno-103-6"></a><a href="#__codelineno-103-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">msg</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-103-7" name="__codelineno-103-7"></a><a href="#__codelineno-103-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-103-8" name="__codelineno-103-8"></a><a href="#__codelineno-103-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-103-9" name="__codelineno-103-9"></a><a href="#__codelineno-103-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
<a id="__codelineno-103-10" name="__codelineno-103-10"></a><a href="#__codelineno-103-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
<a id="__codelineno-103-11" name="__codelineno-103-11"></a><a href="#__codelineno-103-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-103-12" name="__codelineno-103-12"></a><a href="#__codelineno-103-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-103-13" name="__codelineno-103-13"></a><a href="#__codelineno-103-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">encrypt1</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-103-14" name="__codelineno-103-14"></a><a href="#__codelineno-103-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-103-15" name="__codelineno-103-15"></a><a href="#__codelineno-103-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">return</span> <span class="n">c</span>
<a id="__codelineno-103-16" name="__codelineno-103-16"></a><a href="#__codelineno-103-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-103-17" name="__codelineno-103-17"></a><a href="#__codelineno-103-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">seed</span> <span class="o">=</span> <span class="n">p</span> <span class="o">^</span> <span class="n">q</span>
<a id="__codelineno-103-18" name="__codelineno-103-18"></a><a href="#__codelineno-103-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">a</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
<a id="__codelineno-103-19" name="__codelineno-103-19"></a><a href="#__codelineno-103-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">b</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
<a id="__codelineno-103-20" name="__codelineno-103-20"></a><a href="#__codelineno-103-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span>
<a id="__codelineno-103-21" name="__codelineno-103-21"></a><a href="#__codelineno-103-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-103-22" name="__codelineno-103-22"></a><a href="#__codelineno-103-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">encrypt2</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
<a id="__codelineno-103-23" name="__codelineno-103-23"></a><a href="#__codelineno-103-23"><span class="linenos" data-linenos="23 "></span></a>    <span class="n">enc</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-103-24" name="__codelineno-103-24"></a><a href="#__codelineno-103-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-103-25" name="__codelineno-103-25"></a><a href="#__codelineno-103-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">seed</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">%</span> <span class="n">n1</span>
<a id="__codelineno-103-26" name="__codelineno-103-26"></a><a href="#__codelineno-103-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="n">enc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-103-27" name="__codelineno-103-27"></a><a href="#__codelineno-103-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">return</span> <span class="n">enc</span>
<a id="__codelineno-103-28" name="__codelineno-103-28"></a><a href="#__codelineno-103-28"><span class="linenos" data-linenos="28 "></span></a>
<a id="__codelineno-103-29" name="__codelineno-103-29"></a><a href="#__codelineno-103-29"><span class="linenos" data-linenos="29 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="n">encrypt1</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-103-30" name="__codelineno-103-30"></a><a href="#__codelineno-103-30"><span class="linenos" data-linenos="30 "></span></a><span class="n">enc</span> <span class="o">=</span> <span class="n">encrypt2</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-103-31" name="__codelineno-103-31"></a><a href="#__codelineno-103-31"><span class="linenos" data-linenos="31 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n = &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-103-32" name="__codelineno-103-32"></a><a href="#__codelineno-103-32"><span class="linenos" data-linenos="32 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c = &quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-103-33" name="__codelineno-103-33"></a><a href="#__codelineno-103-33"><span class="linenos" data-linenos="33 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n1 = &quot;</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
<a id="__codelineno-103-34" name="__codelineno-103-34"></a><a href="#__codelineno-103-34"><span class="linenos" data-linenos="34 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;enc = &quot;</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
<a id="__codelineno-103-35" name="__codelineno-103-35"></a><a href="#__codelineno-103-35"><span class="linenos" data-linenos="35 "></span></a>
<a id="__codelineno-103-36" name="__codelineno-103-36"></a><a href="#__codelineno-103-36"><span class="linenos" data-linenos="36 "></span></a><span class="n">n</span> <span class="o">=</span>  <span class="mi">24044063028844014127418595700558729326190738802687551098858513077613750188240082663594575453404975706225242363463089392757425008423696150244560748490108425645064339883915929498539109384801415313004805586193044292137299902797522618277016789979196782551492020031695781792205215671106103568559626617762521687128199445018651010056934305055040748892733145467040663073395258760159451903432330506383025685265502086582538667772105057401245864822281535425692919273252955571196166824113519446568745718898654447958192533288063735350717599092500158028352667339959012630051251024677881674246253876293205648190626145653304572328397</span>
<a id="__codelineno-103-37" name="__codelineno-103-37"></a><a href="#__codelineno-103-37"><span class="linenos" data-linenos="37 "></span></a><span class="n">c</span> <span class="o">=</span>  <span class="mi">14883053247652228283811442762780942186987432684268901119544211089991663825267989728286381980568977804079766160707988623895155236079459150322336701772385709429870215701045797411519212730389048862111088898917402253368572002593328131895422933030329446097639972123501482601377059155708292321789694103528266681104521268192526745361895856566384239849048923482217529011549596939269967690907738755747213669693953769070736092857407573675987242774763239531688324956444305397953424851627349331117467417542814921554060612622936755420459029769026126293588814831034143264949347763031994934813475762839410192390466491651507733968227</span>
<a id="__codelineno-103-38" name="__codelineno-103-38"></a><a href="#__codelineno-103-38"><span class="linenos" data-linenos="38 "></span></a><span class="n">n1</span> <span class="o">=</span>  <span class="mi">137670797028117726329534659376416493367957852768263083700434198723955223922183386928456013703791817601151754417828367188186912209697081337658512940425529211281290630976671911327606706953154608427885071841566358882014021242768190762103365969320014710368160869517966437591299370072284930202718943785099916898209</span>
<a id="__codelineno-103-39" name="__codelineno-103-39"></a><a href="#__codelineno-103-39"><span class="linenos" data-linenos="39 "></span></a><span class="n">enc</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">101737402423360536260958229788866250367716256968287178187558336481872788309727545478736771692477306412259739856568227009850831432381180909815512654609798228982433082928392936844193974517574281026029228179913579225687286945054175762659252515268270399329404664775893089132101252158524000295899895962104782878103</span><span class="p">,</span> <span class="mi">37355684997487259669354747104430314505839306993101096210478266975184357608742619438151118843905165289324251734149329596611854110739738607745107961453008343886403511257039401245484528985856920723694142989180291902939107642020398816995584650913417698279936585230648639613028793148102494100898288564799111024672</span><span class="p">,</span> <span class="mi">58677759595639211550435023449462812079890625834313820227189340593596480924226619376872336960357021314847975570175387751632125898437020801920862764666175594874885587518469384576361008639967382152477408865298759987606155830674598034578657554841283906976808719095766296677147076808250022898199866472085742989883</span><span class="p">,</span> <span class="mi">61841632061818470036288407041172200048676249787061823756736224887116113640875444187463656719652972233582538657844183320242896612625995507633237074900538692102956750184024574603018257213912795847625926653585010890014291951218199774765624860625726555381815237888483974246173727262881650634287497285246796321130</span><span class="p">,</span> <span class="mi">7618244158597756867387754433401378508070531356170836765779245254233413235386172690733378371343899289510629513166609513857423499004879497768588665836034791151090648182168421570449377835494883902907064269417199065924565304966242954268460876762295575715334403142360198583318323418975108290758222653083011275844</span><span class="p">,</span> <span class="mi">106276841058222138994123556391380518368163552919305398852484130331884811278068151915582752795463570013359693610495645946230044828403849434903415989487924763756589202218361370725532394478569304449884620166937809374355282324069422109879874964479199929174533104879048175102339134830614476339153367475243140156049</span><span class="p">,</span> <span class="mi">54574757236475194407137831004617398270525645136836468973535243574661043352422598443323384197261529289829451787586618886007968913414366545291507686451774653217577858375086817168124727394445167274831801876424578654786480330913650363551771258617533162477541882336257099777912519011890593910515860435759936717781</span><span class="p">,</span> <span class="mi">15567087904962670212229825713697043597876172881256160613623383896576159414077875401117959132252949501643234465895697270909085179587988268864498823765197994781747034644583869111599516151129007414228897958635533561248099927507725880289417298814703767549313482346652043188826434944367260731729064673486516315207</span><span class="p">,</span> <span class="mi">10757138067445225320504771816863593606847219020279502671965413470243269270456133564739090471033889069283122519782525412134604896073598293410977787230108853737796640474070194546344190858079847734817109910030714675258996740807873872365037296486121580542250452443305370358407408558223735250474249180772656905880</span><span class="p">,</span> <span class="mi">68097848963949068260912124852455363245291187860801223898468533992003737157497436432969031551088942445561676359631354280979357356539429863946694570097104716411407829017684705171462511875250672979623888463245258237680782731827727876526411531354910982579164963119481534453651300645314177478026462894232377307020</span><span class="p">]</span>
</code></pre></div>
<p>先通过LCG求出seed，然后剪枝得到p,q。LCG就不过多赘述了</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><a href="#__codelineno-104-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><a href="#__codelineno-104-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a><a href="#__codelineno-104-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a><a href="#__codelineno-104-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a><a href="#__codelineno-104-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">gift</span> <span class="o">=</span> <span class="mi">39428646082513135314545544161912595458975375891528176714825766497155482031976852156313956476772023258684487799640179241987139554034654104867011313090105438798561154654679825702410748780286094326639330840289843154525176685892323447168072417654823748596238888125898914210332775882916911771786984574407163323116</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a><a href="#__codelineno-104-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="mi">24044063028844014127418595700558729326190738802687551098858513077613750188240082663594575453404975706225242363463089392757425008423696150244560748490108425645064339883915929498539109384801415313004805586193044292137299902797522618277016789979196782551492020031695781792205215671106103568559626617762521687128199445018651010056934305055040748892733145467040663073395258760159451903432330506383025685265502086582538667772105057401245864822281535425692919273252955571196166824113519446568745718898654447958192533288063735350717599092500158028352667339959012630051251024677881674246253876293205648190626145653304572328397</span>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a><a href="#__codelineno-104-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">14883053247652228283811442762780942186987432684268901119544211089991663825267989728286381980568977804079766160707988623895155236079459150322336701772385709429870215701045797411519212730389048862111088898917402253368572002593328131895422933030329446097639972123501482601377059155708292321789694103528266681104521268192526745361895856566384239849048923482217529011549596939269967690907738755747213669693953769070736092857407573675987242774763239531688324956444305397953424851627349331117467417542814921554060612622936755420459029769026126293588814831034143264949347763031994934813475762839410192390466491651507733968227</span>
<a id="__codelineno-104-8" name="__codelineno-104-8"></a><a href="#__codelineno-104-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-104-9" name="__codelineno-104-9"></a><a href="#__codelineno-104-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="c1">## 低位往高位爆</span>
<a id="__codelineno-104-10" name="__codelineno-104-10"></a><a href="#__codelineno-104-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">findp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-104-11" name="__codelineno-104-11"></a><a href="#__codelineno-104-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1024</span><span class="p">:</span>
<a id="__codelineno-104-12" name="__codelineno-104-12"></a><a href="#__codelineno-104-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-104-13" name="__codelineno-104-13"></a><a href="#__codelineno-104-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="k">if</span> <span class="n">N</span> <span class="o">%</span> <span class="n">pp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-104-14" name="__codelineno-104-14"></a><a href="#__codelineno-104-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p = &quot;</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
<a id="__codelineno-104-15" name="__codelineno-104-15"></a><a href="#__codelineno-104-15"><span class="linenos" data-linenos="15 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q = &quot;</span><span class="p">,</span><span class="n">N</span> <span class="o">//</span> <span class="n">pp</span><span class="p">)</span>
<a id="__codelineno-104-16" name="__codelineno-104-16"></a><a href="#__codelineno-104-16"><span class="linenos" data-linenos="16 "></span></a>            <span class="n">qq</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="n">pp</span>
<a id="__codelineno-104-17" name="__codelineno-104-17"></a><a href="#__codelineno-104-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="mi">65537</span><span class="p">,(</span><span class="n">pp</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">qq</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-104-18" name="__codelineno-104-18"></a><a href="#__codelineno-104-18"><span class="linenos" data-linenos="18 "></span></a>            <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-104-19" name="__codelineno-104-19"></a><a href="#__codelineno-104-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-104-20" name="__codelineno-104-20"></a><a href="#__codelineno-104-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="k">return</span>
<a id="__codelineno-104-21" name="__codelineno-104-21"></a><a href="#__codelineno-104-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-104-22" name="__codelineno-104-22"></a><a href="#__codelineno-104-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-104-23" name="__codelineno-104-23"></a><a href="#__codelineno-104-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-104-24" name="__codelineno-104-24"></a><a href="#__codelineno-104-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">qq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-104-25" name="__codelineno-104-25"></a><a href="#__codelineno-104-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">pp</span> <span class="o">^</span> <span class="n">qq</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">gift</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pp</span> <span class="o">*</span> <span class="n">qq</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">l</span><span class="p">):</span>
<a id="__codelineno-104-26" name="__codelineno-104-26"></a><a href="#__codelineno-104-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-104-27" name="__codelineno-104-27"></a><a href="#__codelineno-104-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-104-28" name="__codelineno-104-28"></a><a href="#__codelineno-104-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-104-29" name="__codelineno-104-29"></a><a href="#__codelineno-104-29"><span class="linenos" data-linenos="29 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-104-30" name="__codelineno-104-30"></a><a href="#__codelineno-104-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-104-31" name="__codelineno-104-31"></a><a href="#__codelineno-104-31"><span class="linenos" data-linenos="31 "></span></a><span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<a id="__codelineno-104-32" name="__codelineno-104-32"></a><a href="#__codelineno-104-32"><span class="linenos" data-linenos="32 "></span></a><span class="c1">## flag{y0u_kn0w_Pruning_and_lcg}</span>
</code></pre></div>
<h3 id="2gift-p-q-16">2.gift = p ^ （q &gt;&gt; 16）<a class="headerlink" href="#2gift-p-q-16" title="Permanent link">&para;</a></h3>
<p>题目来源：2023DASCTF暑期挑战赛——EzRSA</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><a href="#__codelineno-105-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><a href="#__codelineno-105-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">secret</span><span class="p">,</span> <span class="n">flag</span>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a><a href="#__codelineno-105-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">encrypt</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><a href="#__codelineno-105-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-105-5" name="__codelineno-105-5"></a><a href="#__codelineno-105-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">assert</span> <span class="n">flag</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;dasctf{&quot;</span> <span class="o">+</span> <span class="n">secret</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;}&quot;</span>
<a id="__codelineno-105-6" name="__codelineno-105-6"></a><a href="#__codelineno-105-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">11</span>
<a id="__codelineno-105-7" name="__codelineno-105-7"></a><a href="#__codelineno-105-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-105-8" name="__codelineno-105-8"></a><a href="#__codelineno-105-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-105-9" name="__codelineno-105-9"></a><a href="#__codelineno-105-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-105-10" name="__codelineno-105-10"></a><a href="#__codelineno-105-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">P</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-105-11" name="__codelineno-105-11"></a><a href="#__codelineno-105-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">Q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-105-12" name="__codelineno-105-12"></a><a href="#__codelineno-105-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">Q</span>
<a id="__codelineno-105-13" name="__codelineno-105-13"></a><a href="#__codelineno-105-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">gift</span> <span class="o">=</span> <span class="n">P</span> <span class="o">^</span> <span class="p">(</span><span class="n">Q</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-105-14" name="__codelineno-105-14"></a><a href="#__codelineno-105-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-105-15" name="__codelineno-105-15"></a><a href="#__codelineno-105-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">gift</span><span class="p">,</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
<a id="__codelineno-105-16" name="__codelineno-105-16"></a><a href="#__codelineno-105-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">encrypt</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">secret</span><span class="p">)),</span>
<a id="__codelineno-105-17" name="__codelineno-105-17"></a><a href="#__codelineno-105-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">encrypt</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)))</span>
<a id="__codelineno-105-18" name="__codelineno-105-18"></a><a href="#__codelineno-105-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-105-19" name="__codelineno-105-19"></a><a href="#__codelineno-105-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="mi">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span>
<a id="__codelineno-105-20" name="__codelineno-105-20"></a><a href="#__codelineno-105-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">gift</span> <span class="o">=</span> <span class="mi">8006730615575401350470175601463518481685396114003290299131469001242636369747855817476589805833427855228149768949773065563676033514362512835553274555294034</span>
<a id="__codelineno-105-21" name="__codelineno-105-21"></a><a href="#__codelineno-105-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="mi">14183763184495367653522884147951054630177015952745593358354098952173965560488104213517563098676028516541915855754066719475487503348914181674929072472238449853082118064823835322313680705889432313419976738694317594843046001448855575986413338142129464525633835911168202553914150009081557835620953018542067857943</span>
<a id="__codelineno-105-22" name="__codelineno-105-22"></a><a href="#__codelineno-105-22"><span class="linenos" data-linenos="22 "></span></a><span class="nb">pow</span><span class="p">(</span><span class="n">secret</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="mi">69307306970629523181683439240748426263979206546157895088924929426911355406769672385984829784804673821643976780928024209092360092670457978154309402591145689825571209515868435608753923870043647892816574684663993415796465074027369407799009929334083395577490711236614662941070610575313972839165233651342137645009</span>
<a id="__codelineno-105-23" name="__codelineno-105-23"></a><a href="#__codelineno-105-23"><span class="linenos" data-linenos="23 "></span></a><span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="mi">46997465834324781573963709865566777091686340553483507705539161842460528999282057880362259416654012854237739527277448599755805614622531827257136959664035098209206110290879482726083191005164961200125296999449598766201435057091624225218351537278712880859703730566080874333989361396420522357001928540408351500991</span>
</code></pre></div>
<p>思路很清晰，先分解N，解RSA得到n，再富兰克林相关消息攻击求解flag。</p>
<p>这里只展示剪枝分解N</p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><a href="#__codelineno-106-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a><a href="#__codelineno-106-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><a href="#__codelineno-106-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a><a href="#__codelineno-106-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a><a href="#__codelineno-106-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">gift</span> <span class="o">=</span> <span class="mi">8006730615575401350470175601463518481685396114003290299131469001242636369747855817476589805833427855228149768949773065563676033514362512835553274555294034</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a><a href="#__codelineno-106-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="mi">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a><a href="#__codelineno-106-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a><a href="#__codelineno-106-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="c1">## 低位往高位爆</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a><a href="#__codelineno-106-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">findp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a><a href="#__codelineno-106-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">512</span><span class="p">:</span>
<a id="__codelineno-106-11" name="__codelineno-106-11"></a><a href="#__codelineno-106-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-106-12" name="__codelineno-106-12"></a><a href="#__codelineno-106-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="k">if</span> <span class="n">N</span> <span class="o">%</span> <span class="n">pp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-106-13" name="__codelineno-106-13"></a><a href="#__codelineno-106-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p = &quot;</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
<a id="__codelineno-106-14" name="__codelineno-106-14"></a><a href="#__codelineno-106-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q = &quot;</span><span class="p">,</span><span class="n">N</span> <span class="o">//</span> <span class="n">pp</span><span class="p">)</span>
<a id="__codelineno-106-15" name="__codelineno-106-15"></a><a href="#__codelineno-106-15"><span class="linenos" data-linenos="15 "></span></a>
<a id="__codelineno-106-16" name="__codelineno-106-16"></a><a href="#__codelineno-106-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-106-17" name="__codelineno-106-17"></a><a href="#__codelineno-106-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-106-18" name="__codelineno-106-18"></a><a href="#__codelineno-106-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-106-19" name="__codelineno-106-19"></a><a href="#__codelineno-106-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">qq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-106-20" name="__codelineno-106-20"></a><a href="#__codelineno-106-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">pp</span> <span class="o">^</span> <span class="p">(</span><span class="n">qq</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">gift</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pp</span> <span class="o">*</span> <span class="n">qq</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="n">N</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">l</span><span class="p">):</span>
<a id="__codelineno-106-21" name="__codelineno-106-21"></a><a href="#__codelineno-106-21"><span class="linenos" data-linenos="21 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-106-22" name="__codelineno-106-22"></a><a href="#__codelineno-106-22"><span class="linenos" data-linenos="22 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-106-23" name="__codelineno-106-23"></a><a href="#__codelineno-106-23"><span class="linenos" data-linenos="23 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;1&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-106-24" name="__codelineno-106-24"></a><a href="#__codelineno-106-24"><span class="linenos" data-linenos="24 "></span></a>            <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-106-25" name="__codelineno-106-25"></a><a href="#__codelineno-106-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-106-26" name="__codelineno-106-26"></a><a href="#__codelineno-106-26"><span class="linenos" data-linenos="26 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="mi">17</span><span class="p">):</span>
<a id="__codelineno-106-27" name="__codelineno-106-27"></a><a href="#__codelineno-106-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="nb">bin</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])</span>
<a id="__codelineno-106-28" name="__codelineno-106-28"></a><a href="#__codelineno-106-28"><span class="linenos" data-linenos="28 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-106-29" name="__codelineno-106-29"></a><a href="#__codelineno-106-29"><span class="linenos" data-linenos="29 "></span></a><span class="sd">p =  8006847171912577069085166877758626954304824756138758266557706391662987806065132448544117840031499707938227955094109779732609035310252723066470330862622641</span>
<a id="__codelineno-106-30" name="__codelineno-106-30"></a><a href="#__codelineno-106-30"><span class="linenos" data-linenos="30 "></span></a><span class="sd">q =  9366986529377069783394625848920106951220134111548343265311677163992169555436421569730703291128771472885865288798344038000984911921843088200997725324682297</span>
<a id="__codelineno-106-31" name="__codelineno-106-31"></a><a href="#__codelineno-106-31"><span class="linenos" data-linenos="31 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h3 id="3_4">3.不会取名字<a class="headerlink" href="#3_4" title="Permanent link">&para;</a></h3>
<p>题目来源:2024HDCTF——ezrsa</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><a href="#__codelineno-107-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><a href="#__codelineno-107-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a><a href="#__codelineno-107-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a><a href="#__codelineno-107-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a><a href="#__codelineno-107-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a><a href="#__codelineno-107-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-107-7" name="__codelineno-107-7"></a><a href="#__codelineno-107-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">gen1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">bits</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">rand</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span> <span class="p">(</span><span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">randfunc</span><span class="o">=</span><span class="n">rand</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">randfunc</span><span class="o">=</span><span class="n">rand</span><span class="p">))</span>
<a id="__codelineno-107-8" name="__codelineno-107-8"></a><a href="#__codelineno-107-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-107-9" name="__codelineno-107-9"></a><a href="#__codelineno-107-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">gen2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">506</span><span class="p">):</span> <span class="nb">next</span><span class="p">(((</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">getPrime</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">getPrime</span><span class="p">(</span><span class="n">alpha</span><span class="p">))]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">K</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">isPrime</span><span class="p">(</span><span class="n">p</span> <span class="o">:=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span> <span class="o">%</span> <span class="n">T</span><span class="p">))),</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-107-10" name="__codelineno-107-10"></a><a href="#__codelineno-107-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-107-11" name="__codelineno-107-11"></a><a href="#__codelineno-107-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">p1</span><span class="p">,</span><span class="n">q1</span><span class="o">=</span><span class="n">gen1</span><span class="p">()</span>
<a id="__codelineno-107-12" name="__codelineno-107-12"></a><a href="#__codelineno-107-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">p2</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">gen2</span><span class="p">()</span>
<a id="__codelineno-107-13" name="__codelineno-107-13"></a><a href="#__codelineno-107-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">assert</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;DASCTF{&quot;</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-107-14" name="__codelineno-107-14"></a><a href="#__codelineno-107-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">p1</span><span class="o">*</span><span class="n">q1</span><span class="p">)</span>
<a id="__codelineno-107-15" name="__codelineno-107-15"></a><a href="#__codelineno-107-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">((</span><span class="n">p2</span><span class="o">*</span><span class="n">q2</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>
<a id="__codelineno-107-16" name="__codelineno-107-16"></a><a href="#__codelineno-107-16"><span class="linenos" data-linenos="16 "></span></a><span class="c1">## 44945076854246685060397710825960160082061127479194994041436997195972585701097443198954359213635892234058786065342178389181538153413878118039445271277476379366294977408981257175008890470376094381644530106799352839565803317977637572325347776636285703517680754624094985374606187797141657688145287340444623176193</span>
<a id="__codelineno-107-17" name="__codelineno-107-17"></a><a href="#__codelineno-107-17"><span class="linenos" data-linenos="17 "></span></a><span class="c1">## (57784854392324291351358704449756491526369373648574288191576366413179694041729248864428194536249209588548791706980878177790271653262097539281383559433402738548851606776347237650302071287124974607439996041713554182180186588308614458904981542909792071322939678815174962366963098166320441995961513884899917498099, 150514823288951667574011681197229106951781617714873679347685702558528178681176081082658953342482323349796111911103531429615442550000291753989779754337491)</span>
</code></pre></div>
<p>这里仅对gen1()这部分讲解</p>
<p><code>gen1()</code>，关键就是把<code>getPrime(bits,randfunc=None)</code>改成了<code>getPrime(bits,randfunc=rand)</code></p>
<p>我不太清楚<code>randfunc</code>起到什么作用，自己打印几组数据发现，<code>gen1</code>生成的素数每8bit只有2个情况，分别是</p>
<p><code>00000000 00000001</code></p>
<p>而高8位必定是<code>10000000</code></p>
<p>通过这个性质，再利用<code>p * q % 2**l == n % 2**l</code>，写一个剪枝就可以爆出来</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><a href="#__codelineno-108-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><a href="#__codelineno-108-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><a href="#__codelineno-108-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">n1</span> <span class="o">=</span> <span class="mi">44945076854246685060397710825960160082061127479194994041436997195972585701097443198954359213635892234058786065342178389181538153413878118039445271277476379366294977408981257175008890470376094381644530106799352839565803317977637572325347776636285703517680754624094985374606187797141657688145287340444623176193</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a><a href="#__codelineno-108-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-108-5" name="__codelineno-108-5"></a><a href="#__codelineno-108-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">find</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
<a id="__codelineno-108-6" name="__codelineno-108-6"></a><a href="#__codelineno-108-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">504</span><span class="p">:</span>
<a id="__codelineno-108-7" name="__codelineno-108-7"></a><a href="#__codelineno-108-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;10000000&quot;</span><span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-108-8" name="__codelineno-108-8"></a><a href="#__codelineno-108-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">qq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;10000000&quot;</span><span class="o">+</span> <span class="n">q</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-108-9" name="__codelineno-108-9"></a><a href="#__codelineno-108-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="k">if</span> <span class="n">n1</span> <span class="o">%</span> <span class="n">pp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-108-10" name="__codelineno-108-10"></a><a href="#__codelineno-108-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p1 = </span><span class="si">{</span><span class="n">pp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-108-11" name="__codelineno-108-11"></a><a href="#__codelineno-108-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q1 = </span><span class="si">{</span><span class="n">qq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-108-12" name="__codelineno-108-12"></a><a href="#__codelineno-108-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="k">return</span> 
<a id="__codelineno-108-13" name="__codelineno-108-13"></a><a href="#__codelineno-108-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-108-14" name="__codelineno-108-14"></a><a href="#__codelineno-108-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-108-15" name="__codelineno-108-15"></a><a href="#__codelineno-108-15"><span class="linenos" data-linenos="15 "></span></a>        <span class="n">qq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-108-16" name="__codelineno-108-16"></a><a href="#__codelineno-108-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="k">if</span> <span class="n">pp</span> <span class="o">*</span> <span class="n">qq</span> <span class="o">%</span> <span class="mi">2</span><span class="o">**</span><span class="n">l</span> <span class="o">==</span> <span class="n">n1</span> <span class="o">%</span> <span class="mi">2</span><span class="o">**</span><span class="n">l</span><span class="p">:</span>
<a id="__codelineno-108-17" name="__codelineno-108-17"></a><a href="#__codelineno-108-17"><span class="linenos" data-linenos="17 "></span></a>            <span class="n">find</span><span class="p">(</span><span class="s2">&quot;00000001&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s2">&quot;00000001&quot;</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-108-18" name="__codelineno-108-18"></a><a href="#__codelineno-108-18"><span class="linenos" data-linenos="18 "></span></a>            <span class="n">find</span><span class="p">(</span><span class="s2">&quot;00000001&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s2">&quot;00000000&quot;</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-108-19" name="__codelineno-108-19"></a><a href="#__codelineno-108-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="n">find</span><span class="p">(</span><span class="s2">&quot;00000000&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s2">&quot;00000001&quot;</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-108-20" name="__codelineno-108-20"></a><a href="#__codelineno-108-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="n">find</span><span class="p">(</span><span class="s2">&quot;00000000&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span><span class="s2">&quot;00000000&quot;</span> <span class="o">+</span> <span class="n">q</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-108-21" name="__codelineno-108-21"></a><a href="#__codelineno-108-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-108-22" name="__codelineno-108-22"></a><a href="#__codelineno-108-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">find</span><span class="p">(</span><span class="s2">&quot;00000001&quot;</span><span class="p">,</span><span class="s2">&quot;00000001&quot;</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>
<h3 id="4_1">4.不会取名字<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h3>
<p>题目来源:2024osuCTF</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><a href="#__codelineno-109-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">isPrime</span><span class="p">,</span><span class="n">bytes_to_long</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a><a href="#__codelineno-109-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a><a href="#__codelineno-109-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a><a href="#__codelineno-109-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a><a href="#__codelineno-109-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">getWYSIprime</span><span class="p">():</span>
<a id="__codelineno-109-6" name="__codelineno-109-6"></a><a href="#__codelineno-109-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-109-7" name="__codelineno-109-7"></a><a href="#__codelineno-109-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s2">&quot;727&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">272</span><span class="p">)]</span>
<a id="__codelineno-109-8" name="__codelineno-109-8"></a><a href="#__codelineno-109-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">prime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">digits</span><span class="p">))</span>
<a id="__codelineno-109-9" name="__codelineno-109-9"></a><a href="#__codelineno-109-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">prime</span><span class="p">):</span>
<a id="__codelineno-109-10" name="__codelineno-109-10"></a><a href="#__codelineno-109-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="k">return</span> <span class="n">prime</span>
<a id="__codelineno-109-11" name="__codelineno-109-11"></a><a href="#__codelineno-109-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-109-12" name="__codelineno-109-12"></a><a href="#__codelineno-109-12"><span class="linenos" data-linenos="12 "></span></a><span class="c1">## RSA encryption using the WYSI primes</span>
<a id="__codelineno-109-13" name="__codelineno-109-13"></a><a href="#__codelineno-109-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getWYSIprime</span><span class="p">()</span>
<a id="__codelineno-109-14" name="__codelineno-109-14"></a><a href="#__codelineno-109-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getWYSIprime</span><span class="p">()</span>
<a id="__codelineno-109-15" name="__codelineno-109-15"></a><a href="#__codelineno-109-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-109-16" name="__codelineno-109-16"></a><a href="#__codelineno-109-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-109-17" name="__codelineno-109-17"></a><a href="#__codelineno-109-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;FLAG&quot;</span><span class="p">,</span><span class="sa">b</span><span class="s2">&quot;osu</span><span class="si">{fake_flag_for_testing}</span><span class="s2">&quot;</span><span class="p">))</span>
<a id="__codelineno-109-18" name="__codelineno-109-18"></a><a href="#__codelineno-109-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">ciphertext</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-109-19" name="__codelineno-109-19"></a><a href="#__codelineno-109-19"><span class="linenos" data-linenos="19 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-109-20" name="__codelineno-109-20"></a><a href="#__codelineno-109-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-109-21" name="__codelineno-109-21"></a><a href="#__codelineno-109-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ciphertext = </span><span class="si">{</span><span class="n">ciphertext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-109-22" name="__codelineno-109-22"></a><a href="#__codelineno-109-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-109-23" name="__codelineno-109-23"></a><a href="#__codelineno-109-23"><span class="linenos" data-linenos="23 "></span></a><span class="sd">n = 2160489795493918825870689458820648828073650907916827108594219132976202835249425984494778310568338106260399032800745421512005980632641226298431130513637640125399673697368934008374907832728004469350033174207285393191694692228748281256956917290437627249889472471749973975591415828107248775449619403563269856991145789325659736854030396401772371148983463743700921913930643887223704115714270634525795771407138067936125866995910432010323584269926871467482064993332990516534083898654487467161183876470821163254662352951613205371404232685831299594035879</span>
<a id="__codelineno-109-24" name="__codelineno-109-24"></a><a href="#__codelineno-109-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">e = 65537</span>
<a id="__codelineno-109-25" name="__codelineno-109-25"></a><a href="#__codelineno-109-25"><span class="linenos" data-linenos="25 "></span></a><span class="sd">ciphertext = 2087465275374927411696643073934443161977332564784688452208874207586196343901447373283939960111955963073429256266959192725814591103495590654238320816453299972810032321690243148092328690893438620034168359613530005646388116690482999620292746246472545500537029353066218068261278475470490922381998208396008297649151265515949490058859271855915806534872788601506545082508028917211992107642670108678400276555889198472686479168292281830557272701569298806067439923555717602352224216701010790924698838402522493324695403237985441044135894549709670322380450</span>
<a id="__codelineno-109-26" name="__codelineno-109-26"></a><a href="#__codelineno-109-26"><span class="linenos" data-linenos="26 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>素数由<code>7</code> or <code>2</code>组成，所以剪枝就好了，和二进制的01没什么区别</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><a href="#__codelineno-110-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a><a href="#__codelineno-110-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a><a href="#__codelineno-110-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-110-4" name="__codelineno-110-4"></a><a href="#__codelineno-110-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-110-5" name="__codelineno-110-5"></a><a href="#__codelineno-110-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">2160489795493918825870689458820648828073650907916827108594219132976202835249425984494778310568338106260399032800745421512005980632641226298431130513637640125399673697368934008374907832728004469350033174207285393191694692228748281256956917290437627249889472471749973975591415828107248775449619403563269856991145789325659736854030396401772371148983463743700921913930643887223704115714270634525795771407138067936125866995910432010323584269926871467482064993332990516534083898654487467161183876470821163254662352951613205371404232685831299594035879</span>
<a id="__codelineno-110-6" name="__codelineno-110-6"></a><a href="#__codelineno-110-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-110-7" name="__codelineno-110-7"></a><a href="#__codelineno-110-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">ciphertext</span> <span class="o">=</span> <span class="mi">2087465275374927411696643073934443161977332564784688452208874207586196343901447373283939960111955963073429256266959192725814591103495590654238320816453299972810032321690243148092328690893438620034168359613530005646388116690482999620292746246472545500537029353066218068261278475470490922381998208396008297649151265515949490058859271855915806534872788601506545082508028917211992107642670108678400276555889198472686479168292281830557272701569298806067439923555717602352224216701010790924698838402522493324695403237985441044135894549709670322380450</span>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a><a href="#__codelineno-110-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a><a href="#__codelineno-110-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">findp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-110-10" name="__codelineno-110-10"></a><a href="#__codelineno-110-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-110-11" name="__codelineno-110-11"></a><a href="#__codelineno-110-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">272</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-110-12" name="__codelineno-110-12"></a><a href="#__codelineno-110-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-110-13" name="__codelineno-110-13"></a><a href="#__codelineno-110-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p = </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-110-14" name="__codelineno-110-14"></a><a href="#__codelineno-110-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-110-15" name="__codelineno-110-15"></a><a href="#__codelineno-110-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-110-16" name="__codelineno-110-16"></a><a href="#__codelineno-110-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">]</span>
<a id="__codelineno-110-17" name="__codelineno-110-17"></a><a href="#__codelineno-110-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-110-18" name="__codelineno-110-18"></a><a href="#__codelineno-110-18"><span class="linenos" data-linenos="18 "></span></a>            <span class="n">pp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>
<a id="__codelineno-110-19" name="__codelineno-110-19"></a><a href="#__codelineno-110-19"><span class="linenos" data-linenos="19 "></span></a>            <span class="n">qq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span>
<a id="__codelineno-110-20" name="__codelineno-110-20"></a><a href="#__codelineno-110-20"><span class="linenos" data-linenos="20 "></span></a>            <span class="k">if</span> <span class="n">pp</span> <span class="o">*</span> <span class="n">qq</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="n">l</span> <span class="o">==</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="o">**</span><span class="n">l</span><span class="p">:</span>
<a id="__codelineno-110-21" name="__codelineno-110-21"></a><a href="#__codelineno-110-21"><span class="linenos" data-linenos="21 "></span></a>                <span class="n">findp</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="n">p</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-110-22" name="__codelineno-110-22"></a><a href="#__codelineno-110-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-110-23" name="__codelineno-110-23"></a><a href="#__codelineno-110-23"><span class="linenos" data-linenos="23 "></span></a><span class="c1">## findp(&quot;7&quot;,&quot;7&quot;)</span>
<a id="__codelineno-110-24" name="__codelineno-110-24"></a><a href="#__codelineno-110-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="mi">27777727727777722777277277777272772727772722777777277777277772227772772772227272727777772772772727227772777277727777777222777777277727772272272777772722727722777727277727727777777772772777772777277772222727227777777222727777772772272727777222777777277777727272772272272277</span>
<a id="__codelineno-110-25" name="__codelineno-110-25"></a><a href="#__codelineno-110-25"><span class="linenos" data-linenos="25 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mi">77777772777772222722727222227777272777772777772277727772722777777777227277727272772727277277272772727227272772772222277777772727727772722772777272727777272722772777277777277777277777727777277277777277777272772772777777727772727277727777772772777772272772272222227777777227</span>
<a id="__codelineno-110-26" name="__codelineno-110-26"></a><a href="#__codelineno-110-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-110-27" name="__codelineno-110-27"></a><a href="#__codelineno-110-27"><span class="linenos" data-linenos="27 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-110-28" name="__codelineno-110-28"></a><a href="#__codelineno-110-28"><span class="linenos" data-linenos="28 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-110-29" name="__codelineno-110-29"></a><a href="#__codelineno-110-29"><span class="linenos" data-linenos="29 "></span></a><span class="c1">## osu{h4v3_y0u_3v3r_n0t1c3d_th4t_727_1s_pr1m3?}</span>
</code></pre></div>
<p>这四种其实感觉都算是一个类型的。还有很多类型的剪枝可以参考:<a href="https://tangcuxiaojikuai.xyz/post/342113ee.html">Crypto趣题-剪枝 | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<h3 id="5">5.剪枝高位泄露<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<p>改编自2024XYCTF——铜匠——part3</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><a href="#__codelineno-111-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a><a href="#__codelineno-111-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a><a href="#__codelineno-111-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a><a href="#__codelineno-111-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a><a href="#__codelineno-111-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-111-6" name="__codelineno-111-6"></a><a href="#__codelineno-111-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-111-7" name="__codelineno-111-7"></a><a href="#__codelineno-111-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-111-8" name="__codelineno-111-8"></a><a href="#__codelineno-111-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-111-9" name="__codelineno-111-9"></a><a href="#__codelineno-111-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-111-10" name="__codelineno-111-10"></a><a href="#__codelineno-111-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-111-11" name="__codelineno-111-11"></a><a href="#__codelineno-111-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-111-12" name="__codelineno-111-12"></a><a href="#__codelineno-111-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-111-13" name="__codelineno-111-13"></a><a href="#__codelineno-111-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">^</span> <span class="n">q</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">200</span>
<a id="__codelineno-111-14" name="__codelineno-111-14"></a><a href="#__codelineno-111-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-111-15" name="__codelineno-111-15"></a><a href="#__codelineno-111-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-111-16" name="__codelineno-111-16"></a><a href="#__codelineno-111-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hint = </span><span class="si">{</span><span class="n">hint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-111-17" name="__codelineno-111-17"></a><a href="#__codelineno-111-17"><span class="linenos" data-linenos="17 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-111-18" name="__codelineno-111-18"></a><a href="#__codelineno-111-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-111-19" name="__codelineno-111-19"></a><a href="#__codelineno-111-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">c = 131369115652458166734046676308463999858958566061027321031978783010359641091133329180071403453658128376834077573719048417128188606423319316139110362434662107918020440100011984923813248515798307240829242781364796147914413916010985480344221078382648887106771447184119879293816004142774768308105423590006218154095</span>
<a id="__codelineno-111-20" name="__codelineno-111-20"></a><a href="#__codelineno-111-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">hint = 1418156189500701046118843280016917462701888775284481310064968961841401532967678842766145628051</span>
<a id="__codelineno-111-21" name="__codelineno-111-21"></a><a href="#__codelineno-111-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">n = 149674440332297459310104619359509309480607215578927485825557593606756533602713173946403283163260154493438427348209708307170391308942988466700336664636266655214819841710712761463985437035510015805275916279554381867547108324810390610671268389247357987728963839572199589558858271355105026004101888297456720686127</span>
<a id="__codelineno-111-22" name="__codelineno-111-22"></a><a href="#__codelineno-111-22"><span class="linenos" data-linenos="22 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>原理参考:<a href="https://tangcuxiaojikuai.xyz/post/e872e217.html">2023-鹏城杯-wp-crypto | 糖醋小鸡块的blog (tangcuxiaojikuai.xyz)</a></p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><a href="#__codelineno-112-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a><a href="#__codelineno-112-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a><a href="#__codelineno-112-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">77362292774939745985127248740136531356798680244461718641182309736632869439528624490319564705732587035892746550259989967311639940839352531540590481816143399815777578738222244349541298856970218973629828183402846736572747940317185733010901816452760815595925525717774150109667814870300394441913855689875810419726</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a><a href="#__codelineno-112-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="mi">3952699881526141586582096584337236735424573202916336803978009509888494841237961467284222140708</span>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a><a href="#__codelineno-112-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mi">101811981048263163700430054305833461232304464649339483324456752139265661172425623344370861924802283149319747333342558424458871624320190755682987168048547266046556603061770039238687342160962557147928318419071351955573359146111983095312306624896541836196196950684743489047140141567937687816622755267268993977151</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a><a href="#__codelineno-112-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-112-7" name="__codelineno-112-7"></a><a href="#__codelineno-112-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-112-8" name="__codelineno-112-8"></a><a href="#__codelineno-112-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="n">hint</span> <span class="o">&lt;&lt;</span> <span class="mi">200</span>
<a id="__codelineno-112-9" name="__codelineno-112-9"></a><a href="#__codelineno-112-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">leak</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">leak</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-112-10" name="__codelineno-112-10"></a><a href="#__codelineno-112-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">leakbits</span> <span class="o">=</span> <span class="mi">200</span>                          <span class="c1">## 缺失的位数</span>
<a id="__codelineno-112-11" name="__codelineno-112-11"></a><a href="#__codelineno-112-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-112-12" name="__codelineno-112-12"></a><a href="#__codelineno-112-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">findp</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">qq</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
<a id="__codelineno-112-13" name="__codelineno-112-13"></a><a href="#__codelineno-112-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">p_Min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pp</span> <span class="o">+</span> <span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-112-14" name="__codelineno-112-14"></a><a href="#__codelineno-112-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">p_Max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pp</span> <span class="o">+</span> <span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-112-15" name="__codelineno-112-15"></a><a href="#__codelineno-112-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">q_Min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">qq</span> <span class="o">+</span> <span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-112-16" name="__codelineno-112-16"></a><a href="#__codelineno-112-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">q_Max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">qq</span> <span class="o">+</span> <span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-112-17" name="__codelineno-112-17"></a><a href="#__codelineno-112-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-112-18" name="__codelineno-112-18"></a><a href="#__codelineno-112-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">if</span><span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="mi">512</span> <span class="o">-</span> <span class="n">leakbits</span><span class="p">):</span>
<a id="__codelineno-112-19" name="__codelineno-112-19"></a><a href="#__codelineno-112-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-112-20" name="__codelineno-112-20"></a><a href="#__codelineno-112-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">phigh</span> <span class="o">=</span> <span class="n">p_Min</span>
<a id="__codelineno-112-21" name="__codelineno-112-21"></a><a href="#__codelineno-112-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">f</span> <span class="o">=</span> <span class="n">phigh</span> <span class="o">+</span> <span class="n">x</span>
<a id="__codelineno-112-22" name="__codelineno-112-22"></a><a href="#__codelineno-112-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">root</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="o">^</span><span class="n">leakbits</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.499</span><span class="p">)</span>
<a id="__codelineno-112-23" name="__codelineno-112-23"></a><a href="#__codelineno-112-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="k">if</span> <span class="n">root</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-112-24" name="__codelineno-112-24"></a><a href="#__codelineno-112-24"><span class="linenos" data-linenos="24 "></span></a>            <span class="n">p</span> <span class="o">=</span> <span class="n">phigh</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-112-25" name="__codelineno-112-25"></a><a href="#__codelineno-112-25"><span class="linenos" data-linenos="25 "></span></a>            <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-112-26" name="__codelineno-112-26"></a><a href="#__codelineno-112-26"><span class="linenos" data-linenos="26 "></span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-112-27" name="__codelineno-112-27"></a><a href="#__codelineno-112-27"><span class="linenos" data-linenos="27 "></span></a>            <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-112-28" name="__codelineno-112-28"></a><a href="#__codelineno-112-28"><span class="linenos" data-linenos="28 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-112-29" name="__codelineno-112-29"></a><a href="#__codelineno-112-29"><span class="linenos" data-linenos="29 "></span></a>
<a id="__codelineno-112-30" name="__codelineno-112-30"></a><a href="#__codelineno-112-30"><span class="linenos" data-linenos="30 "></span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">p_Max</span> <span class="o">*</span> <span class="n">q_Max</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">p_Min</span> <span class="o">*</span> <span class="n">q_Min</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-112-31" name="__codelineno-112-31"></a><a href="#__codelineno-112-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="k">return</span>
<a id="__codelineno-112-32" name="__codelineno-112-32"></a><a href="#__codelineno-112-32"><span class="linenos" data-linenos="32 "></span></a>
<a id="__codelineno-112-33" name="__codelineno-112-33"></a><a href="#__codelineno-112-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="c1">## 以下是根据异或来操作的</span>
<a id="__codelineno-112-34" name="__codelineno-112-34"></a><a href="#__codelineno-112-34"><span class="linenos" data-linenos="34 "></span></a>    <span class="k">if</span> <span class="n">leak</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
<a id="__codelineno-112-35" name="__codelineno-112-35"></a><a href="#__codelineno-112-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="n">findp</span><span class="p">(</span><span class="n">pp</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">qq</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-112-36" name="__codelineno-112-36"></a><a href="#__codelineno-112-36"><span class="linenos" data-linenos="36 "></span></a>        <span class="n">findp</span><span class="p">(</span><span class="n">pp</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">qq</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-112-37" name="__codelineno-112-37"></a><a href="#__codelineno-112-37"><span class="linenos" data-linenos="37 "></span></a>    <span class="k">if</span> <span class="n">leak</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
<a id="__codelineno-112-38" name="__codelineno-112-38"></a><a href="#__codelineno-112-38"><span class="linenos" data-linenos="38 "></span></a>        <span class="n">findp</span><span class="p">(</span><span class="n">pp</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">qq</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-112-39" name="__codelineno-112-39"></a><a href="#__codelineno-112-39"><span class="linenos" data-linenos="39 "></span></a>        <span class="n">findp</span><span class="p">(</span><span class="n">pp</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">qq</span> <span class="o">+</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-112-40" name="__codelineno-112-40"></a><a href="#__codelineno-112-40"><span class="linenos" data-linenos="40 "></span></a>
<a id="__codelineno-112-41" name="__codelineno-112-41"></a><a href="#__codelineno-112-41"><span class="linenos" data-linenos="41 "></span></a><span class="n">findp</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<h2 id="n_1">二十一、一些分解n常用的方法<a class="headerlink" href="#n_1" title="Permanent link">&para;</a></h2>
<h3 id="1_11">1.费马分解<a class="headerlink" href="#1_11" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
n = p\times q = (\frac{p+q}{2})^2 - (\frac{p-q}{2})^2
\]</div>
<p>简单来说，费马分解干了这样一件事:</p>
<p>从<span class="arithmatex">\(a = \sqrt{n}\)</span>开始，逐步增加，直到发现<span class="arithmatex">\(a^2 - n\)</span>是一个平方数，就找到了正确的<span class="arithmatex">\(a,b\)</span>，然后就可以计算<span class="arithmatex">\(p = a +b ,q = a -b\)</span></p>
<p>从这个思想可以发现，这个算法的效率取决于<span class="arithmatex">\(\frac{p+q}{2}\)</span>和<span class="arithmatex">\(\sqrt{n}\)</span>的差距，所以当<span class="arithmatex">\(p,q\)</span>接近的时候，用费马分解可以很快计算出<span class="arithmatex">\(p,q\)</span></p>
<p>这里给出一个脚本</p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><a href="#__codelineno-113-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">isqrt</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a><a href="#__codelineno-113-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-113-3" name="__codelineno-113-3"></a><a href="#__codelineno-113-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">fermat</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-113-4" name="__codelineno-113-4"></a><a href="#__codelineno-113-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-113-5" name="__codelineno-113-5"></a><a href="#__codelineno-113-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">b2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-113-6" name="__codelineno-113-6"></a><a href="#__codelineno-113-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-113-7" name="__codelineno-113-7"></a><a href="#__codelineno-113-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-113-8" name="__codelineno-113-8"></a><a href="#__codelineno-113-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">while</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b2</span><span class="p">:</span>
<a id="__codelineno-113-9" name="__codelineno-113-9"></a><a href="#__codelineno-113-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-113-10" name="__codelineno-113-10"></a><a href="#__codelineno-113-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">b2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-113-11" name="__codelineno-113-11"></a><a href="#__codelineno-113-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
<a id="__codelineno-113-12" name="__codelineno-113-12"></a><a href="#__codelineno-113-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-113-13" name="__codelineno-113-13"></a><a href="#__codelineno-113-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<a id="__codelineno-113-14" name="__codelineno-113-14"></a><a href="#__codelineno-113-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<a id="__codelineno-113-15" name="__codelineno-113-15"></a><a href="#__codelineno-113-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">assert</span> <span class="n">n</span> <span class="o">==</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-113-16" name="__codelineno-113-16"></a><a href="#__codelineno-113-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span>
</code></pre></div>
<h4 id="moectf2023-p-q">例题——MoeCTF2023 |p-q|<a class="headerlink" href="#moectf2023-p-q" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><a href="#__codelineno-114-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.txt&quot;</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fs</span><span class="p">:</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a><a href="#__codelineno-114-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="n">flag</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a><a href="#__codelineno-114-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="o">==</span> <span class="mi">72</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a><a href="#__codelineno-114-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-114-5" name="__codelineno-114-5"></a><a href="#__codelineno-114-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span><span class="s2">&quot;big&quot;</span><span class="p">)</span>
<a id="__codelineno-114-6" name="__codelineno-114-6"></a><a href="#__codelineno-114-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-114-7" name="__codelineno-114-7"></a><a href="#__codelineno-114-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">getPrime</span><span class="p">,</span> <span class="n">isPrime</span>
<a id="__codelineno-114-8" name="__codelineno-114-8"></a><a href="#__codelineno-114-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-114-9" name="__codelineno-114-9"></a><a href="#__codelineno-114-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">next_prime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<a id="__codelineno-114-10" name="__codelineno-114-10"></a><a href="#__codelineno-114-10"><span class="linenos" data-linenos="10 "></span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-114-11" name="__codelineno-114-11"></a><a href="#__codelineno-114-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span>
<a id="__codelineno-114-12" name="__codelineno-114-12"></a><a href="#__codelineno-114-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<a id="__codelineno-114-13" name="__codelineno-114-13"></a><a href="#__codelineno-114-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="k">return</span> <span class="n">p</span>
<a id="__codelineno-114-14" name="__codelineno-114-14"></a><a href="#__codelineno-114-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-114-15" name="__codelineno-114-15"></a><a href="#__codelineno-114-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
<a id="__codelineno-114-16" name="__codelineno-114-16"></a><a href="#__codelineno-114-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">next_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-114-17" name="__codelineno-114-17"></a><a href="#__codelineno-114-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-114-18" name="__codelineno-114-18"></a><a href="#__codelineno-114-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-114-19" name="__codelineno-114-19"></a><a href="#__codelineno-114-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-114-20" name="__codelineno-114-20"></a><a href="#__codelineno-114-20"><span class="linenos" data-linenos="20 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;n =&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-114-21" name="__codelineno-114-21"></a><a href="#__codelineno-114-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;c =&quot;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-114-22" name="__codelineno-114-22"></a><a href="#__codelineno-114-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-114-23" name="__codelineno-114-23"></a><a href="#__codelineno-114-23"><span class="linenos" data-linenos="23 "></span></a><span class="c1">## n = 329960318345010350458589325571454799968957932130539403944044204698872359769449414256378111233592533561892402020955736786563103586897940757198920737583107357264433730515123570697570757034221232010688796344257587359198400915567115397034901247038275403825404094129637119512164953012131445747740645183682571690806238508035172474685818036517880994658466362305677430221344381425792427288500814551334928982040579744048907401043058567486871621293983772331951723963911377839286050368715384227640638031857101612517441295926821712605955984000617738833973829140899288164786111118033301974794123637285172303688427806450817155786233788027512244397952849209700013205803489334055814513866650854230478124920442832221946442593769555237909177172933634236392800414176981780444770542047378630756636857018730168151824307814244094763132088236333995807013617801783919113541391133267230410179444855465611792191833319172887852945902960736744468250550722314565805440432977225703650102517531531476188269635151281661081058374242768608270563131619806585194608795817118466680430500830137335634289617464844004904410907221482919453859885955054140320857757297655475489972268282336250384384926216818756762307686391740965586168590784252524275489515352125321398406426217</span>
<a id="__codelineno-114-24" name="__codelineno-114-24"></a><a href="#__codelineno-114-24"><span class="linenos" data-linenos="24 "></span></a><span class="c1">## c = 307746143297103281117512771170735061509547958991947416701685589829711285274762039205145422734327595082350457374530975854337055433998982493020603245187129916580627539476324521854057990929173492940833073106540441902619425074887573232779899379436737429823569006431370954961865581168635086246592539153824456681688944066925973182272443586463636373955966146029489121226571408532284480270826510961605206483011204059402338926815599691009406841471142048842308786000059979977645988396524814553253493672729395573658564825709547262230219183672493306100392069182994445509803952976016630731417479238769736432223194249245020320183199001774879893442186017555682902409661647546547835345461056900610391514595370600575845979413984555709077635397717741521573798309855584473259503981955303774208127361309229536010653615696850725905168242705387575720694946072789441481191449772933265705810128547553027708513478130258801233619669699177901566688737559102165508239876805822898509541232565766265491283807922473440397456701500524925191214292669986798631732639221198138026031561329502985577205314190565609214349344303324429408234237832110076900414483795318189628198913032900272406887003325858236057373096880675754802725017537119549989304878960436575670784578550</span>
</code></pre></div>
<p>这里p,q是相邻的素数，可以直接开根号分解，也可以用费马分解</p>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><a href="#__codelineno-115-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">isqrt</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a><a href="#__codelineno-115-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><a href="#__codelineno-115-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a><a href="#__codelineno-115-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">fermat</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><a href="#__codelineno-115-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a><a href="#__codelineno-115-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">b2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-115-7" name="__codelineno-115-7"></a><a href="#__codelineno-115-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="n">b</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-115-8" name="__codelineno-115-8"></a><a href="#__codelineno-115-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-115-9" name="__codelineno-115-9"></a><a href="#__codelineno-115-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">while</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">b2</span><span class="p">:</span>
<a id="__codelineno-115-10" name="__codelineno-115-10"></a><a href="#__codelineno-115-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-115-11" name="__codelineno-115-11"></a><a href="#__codelineno-115-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="n">b2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-115-12" name="__codelineno-115-12"></a><a href="#__codelineno-115-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
<a id="__codelineno-115-13" name="__codelineno-115-13"></a><a href="#__codelineno-115-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-115-14" name="__codelineno-115-14"></a><a href="#__codelineno-115-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<a id="__codelineno-115-15" name="__codelineno-115-15"></a><a href="#__codelineno-115-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<a id="__codelineno-115-16" name="__codelineno-115-16"></a><a href="#__codelineno-115-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="k">assert</span> <span class="n">n</span> <span class="o">==</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-115-17" name="__codelineno-115-17"></a><a href="#__codelineno-115-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span>
<a id="__codelineno-115-18" name="__codelineno-115-18"></a><a href="#__codelineno-115-18"><span class="linenos" data-linenos="18 "></span></a>
<a id="__codelineno-115-19" name="__codelineno-115-19"></a><a href="#__codelineno-115-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">n</span> <span class="o">=</span> 
<a id="__codelineno-115-20" name="__codelineno-115-20"></a><a href="#__codelineno-115-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">c</span> <span class="o">=</span> 
<a id="__codelineno-115-21" name="__codelineno-115-21"></a><a href="#__codelineno-115-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">p</span><span class="p">,</span><span class="n">q</span> <span class="o">=</span> <span class="n">fermat</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-115-22" name="__codelineno-115-22"></a><a href="#__codelineno-115-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="mi">65537</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-115-23" name="__codelineno-115-23"></a><a href="#__codelineno-115-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-115-24" name="__codelineno-115-24"></a><a href="#__codelineno-115-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="2p-1">2.p-1光滑<a class="headerlink" href="#2p-1" title="Permanent link">&para;</a></h3>
<p>原理没了解，就存个脚本吧</p>
<p>脚本来源:<a href="https://blog.csdn.net/qq_73643549/article/details/133692704">RSA攻击：Smooth攻击_p-1光滑攻击-CSDN博客</a></p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><a href="#__codelineno-116-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-116-2" name="__codelineno-116-2"></a><a href="#__codelineno-116-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-116-3" name="__codelineno-116-3"></a><a href="#__codelineno-116-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Pollards_p_1</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a id="__codelineno-116-4" name="__codelineno-116-4"></a><a href="#__codelineno-116-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1">## 为了快速计算以及满足费马小定理条件</span>
<a id="__codelineno-116-5" name="__codelineno-116-5"></a><a href="#__codelineno-116-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1">## 从1开始没必要</span>
<a id="__codelineno-116-6" name="__codelineno-116-6"></a><a href="#__codelineno-116-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-116-7" name="__codelineno-116-7"></a><a href="#__codelineno-116-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-116-8" name="__codelineno-116-8"></a><a href="#__codelineno-116-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>    <span class="c1">## 递推计算a^B!</span>
<a id="__codelineno-116-9" name="__codelineno-116-9"></a><a href="#__codelineno-116-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>   <span class="c1">## 尝试计算p</span>
<a id="__codelineno-116-10" name="__codelineno-116-10"></a><a href="#__codelineno-116-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span> <span class="o">!=</span> <span class="n">N</span><span class="p">:</span>   <span class="c1">## 满足条件后返回</span>
<a id="__codelineno-116-11" name="__codelineno-116-11"></a><a href="#__codelineno-116-11"><span class="linenos" data-linenos="11 "></span></a>            <span class="k">return</span> <span class="n">res</span>
<a id="__codelineno-116-12" name="__codelineno-116-12"></a><a href="#__codelineno-116-12"><span class="linenos" data-linenos="12 "></span></a>        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
<h4 id="nctf2019-childrsa">例题——NCTF2019 childRSA<a class="headerlink" href="#nctf2019-childrsa" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><a href="#__codelineno-117-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">choice</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><a href="#__codelineno-117-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">isPrime</span><span class="p">,</span> <span class="n">sieve_base</span> <span class="k">as</span> <span class="n">primes</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a><a href="#__codelineno-117-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">flag</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a><a href="#__codelineno-117-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-117-5" name="__codelineno-117-5"></a><a href="#__codelineno-117-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-117-6" name="__codelineno-117-6"></a><a href="#__codelineno-117-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">getPrime</span><span class="p">(</span><span class="n">bits</span><span class="p">):</span>
<a id="__codelineno-117-7" name="__codelineno-117-7"></a><a href="#__codelineno-117-7"><span class="linenos" data-linenos=" 7 "></span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-117-8" name="__codelineno-117-8"></a><a href="#__codelineno-117-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-117-9" name="__codelineno-117-9"></a><a href="#__codelineno-117-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="k">while</span> <span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">bits</span><span class="p">:</span>
<a id="__codelineno-117-10" name="__codelineno-117-10"></a><a href="#__codelineno-117-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="n">n</span> <span class="o">*=</span> <span class="n">choice</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span>
<a id="__codelineno-117-11" name="__codelineno-117-11"></a><a href="#__codelineno-117-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-117-12" name="__codelineno-117-12"></a><a href="#__codelineno-117-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="k">return</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-117-13" name="__codelineno-117-13"></a><a href="#__codelineno-117-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-117-14" name="__codelineno-117-14"></a><a href="#__codelineno-117-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-117-15" name="__codelineno-117-15"></a><a href="#__codelineno-117-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
<a id="__codelineno-117-16" name="__codelineno-117-16"></a><a href="#__codelineno-117-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
<a id="__codelineno-117-17" name="__codelineno-117-17"></a><a href="#__codelineno-117-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-117-18" name="__codelineno-117-18"></a><a href="#__codelineno-117-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-117-19" name="__codelineno-117-19"></a><a href="#__codelineno-117-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-117-20" name="__codelineno-117-20"></a><a href="#__codelineno-117-20"><span class="linenos" data-linenos="20 "></span></a><span class="c1">## n = 32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span>
<a id="__codelineno-117-21" name="__codelineno-117-21"></a><a href="#__codelineno-117-21"><span class="linenos" data-linenos="21 "></span></a><span class="c1">## c = 26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><a href="#__codelineno-118-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><a href="#__codelineno-118-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-118-3" name="__codelineno-118-3"></a><a href="#__codelineno-118-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-118-4" name="__codelineno-118-4"></a><a href="#__codelineno-118-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">Pollards_p_1</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<a id="__codelineno-118-5" name="__codelineno-118-5"></a><a href="#__codelineno-118-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1">## 为了快速计算以及满足费马小定理条件</span>
<a id="__codelineno-118-6" name="__codelineno-118-6"></a><a href="#__codelineno-118-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c1">## 从1开始没必要</span>
<a id="__codelineno-118-7" name="__codelineno-118-7"></a><a href="#__codelineno-118-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-118-8" name="__codelineno-118-8"></a><a href="#__codelineno-118-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-118-9" name="__codelineno-118-9"></a><a href="#__codelineno-118-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="n">a</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>    <span class="c1">## 递推计算a^B!</span>
<a id="__codelineno-118-10" name="__codelineno-118-10"></a><a href="#__codelineno-118-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>   <span class="c1">## 尝试计算p</span>
<a id="__codelineno-118-11" name="__codelineno-118-11"></a><a href="#__codelineno-118-11"><span class="linenos" data-linenos="11 "></span></a>        <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">res</span> <span class="o">!=</span> <span class="n">N</span><span class="p">:</span>   <span class="c1">## 满足条件后返回</span>
<a id="__codelineno-118-12" name="__codelineno-118-12"></a><a href="#__codelineno-118-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="k">return</span> <span class="n">res</span>
<a id="__codelineno-118-13" name="__codelineno-118-13"></a><a href="#__codelineno-118-13"><span class="linenos" data-linenos="13 "></span></a>        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-118-14" name="__codelineno-118-14"></a><a href="#__codelineno-118-14"><span class="linenos" data-linenos="14 "></span></a>
<a id="__codelineno-118-15" name="__codelineno-118-15"></a><a href="#__codelineno-118-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">n</span> <span class="o">=</span> 
<a id="__codelineno-118-16" name="__codelineno-118-16"></a><a href="#__codelineno-118-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">c</span> <span class="o">=</span> 
<a id="__codelineno-118-17" name="__codelineno-118-17"></a><a href="#__codelineno-118-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">Pollards_p_1</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-118-18" name="__codelineno-118-18"></a><a href="#__codelineno-118-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-118-19" name="__codelineno-118-19"></a><a href="#__codelineno-118-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="mi">65537</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-118-20" name="__codelineno-118-20"></a><a href="#__codelineno-118-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-118-21" name="__codelineno-118-21"></a><a href="#__codelineno-118-21"><span class="linenos" data-linenos="21 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-118-22" name="__codelineno-118-22"></a><a href="#__codelineno-118-22"><span class="linenos" data-linenos="22 "></span></a><span class="c1">## NCTF{Th3r3_ar3_1ns3cure_RSA_m0duli_7hat_at_f1rst_gl4nce_appe4r_t0_be_s3cur3}</span>
</code></pre></div>
<h3 id="3p1">3.p+1光滑<a class="headerlink" href="#3p1" title="Permanent link">&para;</a></h3>
<p>脚本来源:</p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><a href="#__codelineno-119-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">lucas</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a><a href="#__codelineno-119-2"><span class="linenos" data-linenos=" 2 "></span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">c</span> <span class="c1">## a1</span>
<a id="__codelineno-119-3" name="__codelineno-119-3"></a><a href="#__codelineno-119-3"><span class="linenos" data-linenos=" 3 "></span></a>    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span> <span class="c1">## a2</span>
<a id="__codelineno-119-4" name="__codelineno-119-4"></a><a href="#__codelineno-119-4"><span class="linenos" data-linenos=" 4 "></span></a>    <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">bin</span><span class="p">(</span><span class="n">d</span><span class="p">)[</span><span class="mi">3</span><span class="p">:]:</span> <span class="c1">## 快速乘(从高到低位)--我个人理解</span>
<a id="__codelineno-119-5" name="__codelineno-119-5"></a><a href="#__codelineno-119-5"><span class="linenos" data-linenos=" 5 "></span></a>        <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
<a id="__codelineno-119-6" name="__codelineno-119-6"></a><a href="#__codelineno-119-6"><span class="linenos" data-linenos=" 6 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span> <span class="c1">## 下标对应a_{x+y}，其次保证a_{2k-1}=a_{k}a_{k-1}-a_{0}成立</span>
<a id="__codelineno-119-7" name="__codelineno-119-7"></a><a href="#__codelineno-119-7"><span class="linenos" data-linenos=" 7 "></span></a>            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span> <span class="c1">## 使得y翻倍--正常的快速幂流程</span>
<a id="__codelineno-119-8" name="__codelineno-119-8"></a><a href="#__codelineno-119-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-119-9" name="__codelineno-119-9"></a><a href="#__codelineno-119-9"><span class="linenos" data-linenos=" 9 "></span></a>            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span> <span class="c1">## 保证a_{2k-1}=a_{k}a_{k-1}-a_{0}成立</span>
<a id="__codelineno-119-10" name="__codelineno-119-10"></a><a href="#__codelineno-119-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span> <span class="c1">## a_{k} 翻倍</span>
<a id="__codelineno-119-11" name="__codelineno-119-11"></a><a href="#__codelineno-119-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">return</span> <span class="n">x</span> <span class="c1">#返回a_{ed}</span>
</code></pre></div>
<p>才疏学浅，没找到例题</p>
<h3 id="4phinn">4.已知phi和n分解n<a class="headerlink" href="#4phinn" title="Permanent link">&para;</a></h3>
<p>如果是两个因子的,<span class="arithmatex">\(n = p\times q\)</span>，那么直接联立方程就可以解</p>
<p>如果是多因子的话，就没这么容易了，以NKCTF2023的ezRSA为例</p>
<h4 id="nkctf2023-ezrsa">例题——NKCTF2023 ezRSA<a class="headerlink" href="#nkctf2023-ezrsa" title="Permanent link">&para;</a></h4>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><a href="#__codelineno-120-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><a href="#__codelineno-120-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-120-3" name="__codelineno-120-3"></a><a href="#__codelineno-120-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-120-4" name="__codelineno-120-4"></a><a href="#__codelineno-120-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">m1</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-120-5" name="__codelineno-120-5"></a><a href="#__codelineno-120-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m2</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">:])</span>
<a id="__codelineno-120-6" name="__codelineno-120-6"></a><a href="#__codelineno-120-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-120-7" name="__codelineno-120-7"></a><a href="#__codelineno-120-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen</span><span class="p">():</span>
<a id="__codelineno-120-8" name="__codelineno-120-8"></a><a href="#__codelineno-120-8"><span class="linenos" data-linenos=" 8 "></span></a>    <span class="n">prime_list</span>  <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-120-9" name="__codelineno-120-9"></a><a href="#__codelineno-120-9"><span class="linenos" data-linenos=" 9 "></span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-120-10" name="__codelineno-120-10"></a><a href="#__codelineno-120-10"><span class="linenos" data-linenos="10 "></span></a>        <span class="n">prime_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
<a id="__codelineno-120-11" name="__codelineno-120-11"></a><a href="#__codelineno-120-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">prime_list</span><span class="p">)</span>
<a id="__codelineno-120-12" name="__codelineno-120-12"></a><a href="#__codelineno-120-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-120-13" name="__codelineno-120-13"></a><a href="#__codelineno-120-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">prime_list</span> <span class="o">=</span> <span class="n">gen</span><span class="p">()</span>
<a id="__codelineno-120-14" name="__codelineno-120-14"></a><a href="#__codelineno-120-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">t</span> <span class="o">=</span> <span class="n">prime_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">prime_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">prime_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">prime_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-120-15" name="__codelineno-120-15"></a><a href="#__codelineno-120-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-120-16" name="__codelineno-120-16"></a><a href="#__codelineno-120-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">t</span>
<a id="__codelineno-120-17" name="__codelineno-120-17"></a><a href="#__codelineno-120-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-120-18" name="__codelineno-120-18"></a><a href="#__codelineno-120-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">c1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">p</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-120-19" name="__codelineno-120-19"></a><a href="#__codelineno-120-19"><span class="linenos" data-linenos="19 "></span></a><span class="n">p1</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-120-20" name="__codelineno-120-20"></a><a href="#__codelineno-120-20"><span class="linenos" data-linenos="20 "></span></a><span class="n">q1</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<a id="__codelineno-120-21" name="__codelineno-120-21"></a><a href="#__codelineno-120-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">N</span> <span class="o">=</span> <span class="n">p1</span><span class="o">*</span><span class="n">q1</span>
<a id="__codelineno-120-22" name="__codelineno-120-22"></a><a href="#__codelineno-120-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">c2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-120-23" name="__codelineno-120-23"></a><a href="#__codelineno-120-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">c3</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-120-24" name="__codelineno-120-24"></a><a href="#__codelineno-120-24"><span class="linenos" data-linenos="24 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-120-25" name="__codelineno-120-25"></a><a href="#__codelineno-120-25"><span class="linenos" data-linenos="25 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;phi = </span><span class="si">{</span><span class="n">phi</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-120-26" name="__codelineno-120-26"></a><a href="#__codelineno-120-26"><span class="linenos" data-linenos="26 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c1 = </span><span class="si">{</span><span class="n">c1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-120-27" name="__codelineno-120-27"></a><a href="#__codelineno-120-27"><span class="linenos" data-linenos="27 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;N = </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-120-28" name="__codelineno-120-28"></a><a href="#__codelineno-120-28"><span class="linenos" data-linenos="28 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c2 = </span><span class="si">{</span><span class="n">c2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-120-29" name="__codelineno-120-29"></a><a href="#__codelineno-120-29"><span class="linenos" data-linenos="29 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;c3 = </span><span class="si">{</span><span class="n">c3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-120-30" name="__codelineno-120-30"></a><a href="#__codelineno-120-30"><span class="linenos" data-linenos="30 "></span></a>
<a id="__codelineno-120-31" name="__codelineno-120-31"></a><a href="#__codelineno-120-31"><span class="linenos" data-linenos="31 "></span></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-120-32" name="__codelineno-120-32"></a><a href="#__codelineno-120-32"><span class="linenos" data-linenos="32 "></span></a><span class="sd">n = 8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span>
<a id="__codelineno-120-33" name="__codelineno-120-33"></a><a href="#__codelineno-120-33"><span class="linenos" data-linenos="33 "></span></a><span class="sd">phi = 8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span>
<a id="__codelineno-120-34" name="__codelineno-120-34"></a><a href="#__codelineno-120-34"><span class="linenos" data-linenos="34 "></span></a><span class="sd">c1 = 78327207863361017953496121356221173288422862370301396867341957979087627011991738176024643637029313969241151622985226595093079857523487726626882109114134910056673489916408854152274726721451884257677533593174371742411008169082367666168983943358876017521749198218529804830864940274185360506199116451280975188409</span>
<a id="__codelineno-120-35" name="__codelineno-120-35"></a><a href="#__codelineno-120-35"><span class="linenos" data-linenos="35 "></span></a><span class="sd">N = 157202814866563156513184271957553223260772141845129283711146204376449001653397810781717934720804041916333174673656579086498762693983380365527400604554663873045166444369504886603233275868192688995284322277504050322927511160583280269073338415758019142878016084536129741435221345599028001581385308324407324725353</span>
<a id="__codelineno-120-36" name="__codelineno-120-36"></a><a href="#__codelineno-120-36"><span class="linenos" data-linenos="36 "></span></a><span class="sd">c2 = 63355788175487221030596314921407476078592001060627033831694843409637965350474955727383434406640075122932939559532216639739294413008164038257338675094324172634789610307227365830016457714456293397466445820352804725466971828172010276387616894829328491068298742711984800900411277550023220538443014162710037992032</span>
<a id="__codelineno-120-37" name="__codelineno-120-37"></a><a href="#__codelineno-120-37"><span class="linenos" data-linenos="37 "></span></a><span class="sd">c3 = 9266334096866207047544089419994475379619964393206968260875878305040712629590906330073542575719856965053269812924808810766674072615270535207284077081944428011398767330973702305174973148018082513467080087706443512285098600431136743009829009567065760786940706627087366702015319792328141978938111501345426931078</span>
<a id="__codelineno-120-38" name="__codelineno-120-38"></a><a href="#__codelineno-120-38"><span class="linenos" data-linenos="38 "></span></a><span class="sd">&#39;&#39;&#39;</span>
</code></pre></div>
<blockquote>
<p>exp.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><a href="#__codelineno-121-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">gcd</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a><a href="#__codelineno-121-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="kn">import</span> <span class="n">isqrt</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><a href="#__codelineno-121-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randrange</span>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a><a href="#__codelineno-121-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">gmpy2</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_prime</span>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a><a href="#__codelineno-121-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a><a href="#__codelineno-121-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a><a href="#__codelineno-121-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">factorize</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a><a href="#__codelineno-121-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a><a href="#__codelineno-121-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="sd">    Recovers the prime factors from a modulus if Euler&#39;s totient is known.</span>
<a id="__codelineno-121-10" name="__codelineno-121-10"></a><a href="#__codelineno-121-10"><span class="linenos" data-linenos="10 "></span></a><span class="sd">    This method only works for a modulus consisting of 2 primes!</span>
<a id="__codelineno-121-11" name="__codelineno-121-11"></a><a href="#__codelineno-121-11"><span class="linenos" data-linenos="11 "></span></a><span class="sd">    :param N: the modulus</span>
<a id="__codelineno-121-12" name="__codelineno-121-12"></a><a href="#__codelineno-121-12"><span class="linenos" data-linenos="12 "></span></a><span class="sd">    :param phi: Euler&#39;s totient, the order of the multiplicative group modulo N</span>
<a id="__codelineno-121-13" name="__codelineno-121-13"></a><a href="#__codelineno-121-13"><span class="linenos" data-linenos="13 "></span></a><span class="sd">    :return: a tuple containing the prime factors, or None if the factors were not found</span>
<a id="__codelineno-121-14" name="__codelineno-121-14"></a><a href="#__codelineno-121-14"><span class="linenos" data-linenos="14 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-121-15" name="__codelineno-121-15"></a><a href="#__codelineno-121-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span>
<a id="__codelineno-121-16" name="__codelineno-121-16"></a><a href="#__codelineno-121-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">s</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">N</span>
<a id="__codelineno-121-17" name="__codelineno-121-17"></a><a href="#__codelineno-121-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-121-18" name="__codelineno-121-18"></a><a href="#__codelineno-121-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">q</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-121-19" name="__codelineno-121-19"></a><a href="#__codelineno-121-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span>
<a id="__codelineno-121-20" name="__codelineno-121-20"></a><a href="#__codelineno-121-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-121-21" name="__codelineno-121-21"></a><a href="#__codelineno-121-21"><span class="linenos" data-linenos="21 "></span></a>
<a id="__codelineno-121-22" name="__codelineno-121-22"></a><a href="#__codelineno-121-22"><span class="linenos" data-linenos="22 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">factorize_multi_prime</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
<a id="__codelineno-121-23" name="__codelineno-121-23"></a><a href="#__codelineno-121-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-121-24" name="__codelineno-121-24"></a><a href="#__codelineno-121-24"><span class="linenos" data-linenos="24 "></span></a><span class="sd">    Recovers the prime factors from a modulus if Euler&#39;s totient is known.</span>
<a id="__codelineno-121-25" name="__codelineno-121-25"></a><a href="#__codelineno-121-25"><span class="linenos" data-linenos="25 "></span></a><span class="sd">    This method works for a modulus consisting of any number of primes, but is considerably be slower than factorize.</span>
<a id="__codelineno-121-26" name="__codelineno-121-26"></a><a href="#__codelineno-121-26"><span class="linenos" data-linenos="26 "></span></a><span class="sd">    More information: Hinek M. J., Low M. K., Teske E., &quot;On Some Attacks on Multi-prime RSA&quot; (Section 3)</span>
<a id="__codelineno-121-27" name="__codelineno-121-27"></a><a href="#__codelineno-121-27"><span class="linenos" data-linenos="27 "></span></a><span class="sd">    :param N: the modulus</span>
<a id="__codelineno-121-28" name="__codelineno-121-28"></a><a href="#__codelineno-121-28"><span class="linenos" data-linenos="28 "></span></a><span class="sd">    :param phi: Euler&#39;s totient, the order of the multiplicative group modulo N</span>
<a id="__codelineno-121-29" name="__codelineno-121-29"></a><a href="#__codelineno-121-29"><span class="linenos" data-linenos="29 "></span></a><span class="sd">    :return: a tuple containing the prime factors</span>
<a id="__codelineno-121-30" name="__codelineno-121-30"></a><a href="#__codelineno-121-30"><span class="linenos" data-linenos="30 "></span></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-121-31" name="__codelineno-121-31"></a><a href="#__codelineno-121-31"><span class="linenos" data-linenos="31 "></span></a>    <span class="n">prime_factors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<a id="__codelineno-121-32" name="__codelineno-121-32"></a><a href="#__codelineno-121-32"><span class="linenos" data-linenos="32 "></span></a>    <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span>
<a id="__codelineno-121-33" name="__codelineno-121-33"></a><a href="#__codelineno-121-33"><span class="linenos" data-linenos="33 "></span></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-121-34" name="__codelineno-121-34"></a><a href="#__codelineno-121-34"><span class="linenos" data-linenos="34 "></span></a>        <span class="c1">## Element to factorize.</span>
<a id="__codelineno-121-35" name="__codelineno-121-35"></a><a href="#__codelineno-121-35"><span class="linenos" data-linenos="35 "></span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-121-36" name="__codelineno-121-36"></a><a href="#__codelineno-121-36"><span class="linenos" data-linenos="36 "></span></a>
<a id="__codelineno-121-37" name="__codelineno-121-37"></a><a href="#__codelineno-121-37"><span class="linenos" data-linenos="37 "></span></a>        <span class="n">w</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-121-38" name="__codelineno-121-38"></a><a href="#__codelineno-121-38"><span class="linenos" data-linenos="38 "></span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-121-39" name="__codelineno-121-39"></a><a href="#__codelineno-121-39"><span class="linenos" data-linenos="39 "></span></a>        <span class="k">while</span> <span class="n">phi</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-121-40" name="__codelineno-121-40"></a><a href="#__codelineno-121-40"><span class="linenos" data-linenos="40 "></span></a>            <span class="n">sqrt_1</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">phi</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">i</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>
<a id="__codelineno-121-41" name="__codelineno-121-41"></a><a href="#__codelineno-121-41"><span class="linenos" data-linenos="41 "></span></a>            <span class="k">if</span> <span class="n">sqrt_1</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">sqrt_1</span> <span class="o">!=</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-121-42" name="__codelineno-121-42"></a><a href="#__codelineno-121-42"><span class="linenos" data-linenos="42 "></span></a>                <span class="c1">## We can remove the element to factorize now, because we have a factorization.</span>
<a id="__codelineno-121-43" name="__codelineno-121-43"></a><a href="#__codelineno-121-43"><span class="linenos" data-linenos="43 "></span></a>                <span class="n">factors</span> <span class="o">=</span> <span class="n">factors</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<a id="__codelineno-121-44" name="__codelineno-121-44"></a><a href="#__codelineno-121-44"><span class="linenos" data-linenos="44 "></span></a>
<a id="__codelineno-121-45" name="__codelineno-121-45"></a><a href="#__codelineno-121-45"><span class="linenos" data-linenos="45 "></span></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">sqrt_1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-121-46" name="__codelineno-121-46"></a><a href="#__codelineno-121-46"><span class="linenos" data-linenos="46 "></span></a>                <span class="n">q</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-121-47" name="__codelineno-121-47"></a><a href="#__codelineno-121-47"><span class="linenos" data-linenos="47 "></span></a>
<a id="__codelineno-121-48" name="__codelineno-121-48"></a><a href="#__codelineno-121-48"><span class="linenos" data-linenos="48 "></span></a>                <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<a id="__codelineno-121-49" name="__codelineno-121-49"></a><a href="#__codelineno-121-49"><span class="linenos" data-linenos="49 "></span></a>                    <span class="n">prime_factors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-121-50" name="__codelineno-121-50"></a><a href="#__codelineno-121-50"><span class="linenos" data-linenos="50 "></span></a>                <span class="k">elif</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-121-51" name="__codelineno-121-51"></a><a href="#__codelineno-121-51"><span class="linenos" data-linenos="51 "></span></a>                    <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-121-52" name="__codelineno-121-52"></a><a href="#__codelineno-121-52"><span class="linenos" data-linenos="52 "></span></a>
<a id="__codelineno-121-53" name="__codelineno-121-53"></a><a href="#__codelineno-121-53"><span class="linenos" data-linenos="53 "></span></a>                <span class="k">if</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
<a id="__codelineno-121-54" name="__codelineno-121-54"></a><a href="#__codelineno-121-54"><span class="linenos" data-linenos="54 "></span></a>                    <span class="n">prime_factors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-121-55" name="__codelineno-121-55"></a><a href="#__codelineno-121-55"><span class="linenos" data-linenos="55 "></span></a>                <span class="k">elif</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-121-56" name="__codelineno-121-56"></a><a href="#__codelineno-121-56"><span class="linenos" data-linenos="56 "></span></a>                    <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-121-57" name="__codelineno-121-57"></a><a href="#__codelineno-121-57"><span class="linenos" data-linenos="57 "></span></a>
<a id="__codelineno-121-58" name="__codelineno-121-58"></a><a href="#__codelineno-121-58"><span class="linenos" data-linenos="58 "></span></a>                <span class="c1">## Continue in the outer loop</span>
<a id="__codelineno-121-59" name="__codelineno-121-59"></a><a href="#__codelineno-121-59"><span class="linenos" data-linenos="59 "></span></a>                <span class="k">break</span>
<a id="__codelineno-121-60" name="__codelineno-121-60"></a><a href="#__codelineno-121-60"><span class="linenos" data-linenos="60 "></span></a>
<a id="__codelineno-121-61" name="__codelineno-121-61"></a><a href="#__codelineno-121-61"><span class="linenos" data-linenos="61 "></span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-121-62" name="__codelineno-121-62"></a><a href="#__codelineno-121-62"><span class="linenos" data-linenos="62 "></span></a>
<a id="__codelineno-121-63" name="__codelineno-121-63"></a><a href="#__codelineno-121-63"><span class="linenos" data-linenos="63 "></span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">)</span>
<a id="__codelineno-121-64" name="__codelineno-121-64"></a><a href="#__codelineno-121-64"><span class="linenos" data-linenos="64 "></span></a>
<a id="__codelineno-121-65" name="__codelineno-121-65"></a><a href="#__codelineno-121-65"><span class="linenos" data-linenos="65 "></span></a><span class="n">n</span> <span class="o">=</span> 
<a id="__codelineno-121-66" name="__codelineno-121-66"></a><a href="#__codelineno-121-66"><span class="linenos" data-linenos="66 "></span></a><span class="n">phi</span> <span class="o">=</span> 
<a id="__codelineno-121-67" name="__codelineno-121-67"></a><a href="#__codelineno-121-67"><span class="linenos" data-linenos="67 "></span></a><span class="n">prime_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">factorize_multi_prime</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">phi</span><span class="p">))</span>
<a id="__codelineno-121-68" name="__codelineno-121-68"></a><a href="#__codelineno-121-68"><span class="linenos" data-linenos="68 "></span></a><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">s</span> <span class="o">=</span> <span class="n">prime_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">prime_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">prime_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">prime_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div>
<h3 id="5edn">5.已知e,d分解n<a class="headerlink" href="#5edn" title="Permanent link">&para;</a></h3>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><a href="#__codelineno-122-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a><a href="#__codelineno-122-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">gmpy2</span>
<a id="__codelineno-122-3" name="__codelineno-122-3"></a><a href="#__codelineno-122-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-122-4" name="__codelineno-122-4"></a><a href="#__codelineno-122-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">divide_pq</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-122-5" name="__codelineno-122-5"></a><a href="#__codelineno-122-5"><span class="linenos" data-linenos=" 5 "></span></a>    <span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">*</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-122-6" name="__codelineno-122-6"></a><a href="#__codelineno-122-6"><span class="linenos" data-linenos=" 6 "></span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-122-7" name="__codelineno-122-7"></a><a href="#__codelineno-122-7"><span class="linenos" data-linenos=" 7 "></span></a>        <span class="n">g</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-122-8" name="__codelineno-122-8"></a><a href="#__codelineno-122-8"><span class="linenos" data-linenos=" 8 "></span></a>        <span class="n">t</span> <span class="o">=</span> <span class="n">k</span>
<a id="__codelineno-122-9" name="__codelineno-122-9"></a><a href="#__codelineno-122-9"><span class="linenos" data-linenos=" 9 "></span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-122-10" name="__codelineno-122-10"></a><a href="#__codelineno-122-10"><span class="linenos" data-linenos="10 "></span></a>            <span class="k">if</span> <span class="n">t</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-122-11" name="__codelineno-122-11"></a><a href="#__codelineno-122-11"><span class="linenos" data-linenos="11 "></span></a>                <span class="k">break</span>
<a id="__codelineno-122-12" name="__codelineno-122-12"></a><a href="#__codelineno-122-12"><span class="linenos" data-linenos="12 "></span></a>            <span class="n">t</span> <span class="o">//=</span> <span class="mi">2</span>
<a id="__codelineno-122-13" name="__codelineno-122-13"></a><a href="#__codelineno-122-13"><span class="linenos" data-linenos="13 "></span></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-122-14" name="__codelineno-122-14"></a><a href="#__codelineno-122-14"><span class="linenos" data-linenos="14 "></span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-122-15" name="__codelineno-122-15"></a><a href="#__codelineno-122-15"><span class="linenos" data-linenos="15 "></span></a>                <span class="n">p</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-122-16" name="__codelineno-122-16"></a><a href="#__codelineno-122-16"><span class="linenos" data-linenos="16 "></span></a>                <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span><span class="p">)</span>
</code></pre></div>
<h2 id="_29">二十二、不知道叫什么分类的题目<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h2>
<h3 id="p-q">给出p + q低位<a class="headerlink" href="#p-q" title="Permanent link">&para;</a></h3>
<p>题目改编自2024XYCTF——铜匠——part2</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><a href="#__codelineno-123-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a><a href="#__codelineno-123-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><a href="#__codelineno-123-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-123-4" name="__codelineno-123-4"></a><a href="#__codelineno-123-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-123-5" name="__codelineno-123-5"></a><a href="#__codelineno-123-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-123-6" name="__codelineno-123-6"></a><a href="#__codelineno-123-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-123-7" name="__codelineno-123-7"></a><a href="#__codelineno-123-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-123-8" name="__codelineno-123-8"></a><a href="#__codelineno-123-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-123-9" name="__codelineno-123-9"></a><a href="#__codelineno-123-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-123-10" name="__codelineno-123-10"></a><a href="#__codelineno-123-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-123-11" name="__codelineno-123-11"></a><a href="#__codelineno-123-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-123-12" name="__codelineno-123-12"></a><a href="#__codelineno-123-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<a id="__codelineno-123-13" name="__codelineno-123-13"></a><a href="#__codelineno-123-13"><span class="linenos" data-linenos="13 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">624</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-123-14" name="__codelineno-123-14"></a><a href="#__codelineno-123-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-123-15" name="__codelineno-123-15"></a><a href="#__codelineno-123-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hint = </span><span class="si">{</span><span class="n">hint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-123-16" name="__codelineno-123-16"></a><a href="#__codelineno-123-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-123-17" name="__codelineno-123-17"></a><a href="#__codelineno-123-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-123-18" name="__codelineno-123-18"></a><a href="#__codelineno-123-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">c = 15315623227108436291858457034857784719507552879018189851637500530704870673436079954784519165863568569923075589417879105802430194799540543536178163710092884414704414320471378011034947694757321045648672645088739109820484000260862752393231610482665197130322211444656668269314857325584729333799747940039582233403795688967132390847508527859286606080564369696319857802230684766189133382904414261588681956483620140766886760632093938290509495921191051004955960321224324525865371027175220422824090922909186107029324403060456677201122370380708945945621513853659281202197178155661602947407740113932985040400431009519035927170893</span>
<a id="__codelineno-123-19" name="__codelineno-123-19"></a><a href="#__codelineno-123-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">hint = 24765551240982534917083490896297931130347202481167225145278716583234238038819431100154290815134734511033735464993876484465992525732351399544319245104113383110187111270727627683278542339074</span>
<a id="__codelineno-123-20" name="__codelineno-123-20"></a><a href="#__codelineno-123-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">n = 17551595965847360101001559529386245228497232313421489853434901311116953087050954433040038840788997073271446971526589676430781788129026667353632541062149232552031818920006832783397173014011531311807992794738323157382559849771809561200626834225824761208921248849766951980339089458227127422515917026821919873970760316856393212652571020677585627719682906485373773819364730302897222175047226443095023421963275036185038777190349527562337069435775581997139041749482233185668100893166822768561406331106814954573421744711888039361670837655170604347860448702902142977569791794645486978083071644858164529311966931143494605467581</span>
<a id="__codelineno-123-21" name="__codelineno-123-21"></a><a href="#__codelineno-123-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>由题意知<span class="arithmatex">\(hint \equiv p+q \mod 2^{624}\)</span></p>
<p>除此之外还可以得到<span class="arithmatex">\(n_{low} \equiv p\times q \mod 2^{624}\)</span></p>
<p>于是有<span class="arithmatex">\(n_{low} \equiv p(hint - p) \mod 2^{624}\)</span>，解这个方程，然后得到p的低位，再用coppersmith</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a><a href="#__codelineno-124-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-124-2" name="__codelineno-124-2"></a><a href="#__codelineno-124-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-124-3" name="__codelineno-124-3"></a><a href="#__codelineno-124-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">c</span> <span class="o">=</span> 
<a id="__codelineno-124-4" name="__codelineno-124-4"></a><a href="#__codelineno-124-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">hint</span> <span class="o">=</span> 
<a id="__codelineno-124-5" name="__codelineno-124-5"></a><a href="#__codelineno-124-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> 
<a id="__codelineno-124-6" name="__codelineno-124-6"></a><a href="#__codelineno-124-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-124-7" name="__codelineno-124-7"></a><a href="#__codelineno-124-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-124-8" name="__codelineno-124-8"></a><a href="#__codelineno-124-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-124-9" name="__codelineno-124-9"></a><a href="#__codelineno-124-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">n_low</span> <span class="o">=</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="o">^</span><span class="mi">624</span>
<a id="__codelineno-124-10" name="__codelineno-124-10"></a><a href="#__codelineno-124-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">var</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
<a id="__codelineno-124-11" name="__codelineno-124-11"></a><a href="#__codelineno-124-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">hint</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">n_low</span>
<a id="__codelineno-124-12" name="__codelineno-124-12"></a><a href="#__codelineno-124-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">solve_mod</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">2</span><span class="o">^</span><span class="mi">624</span><span class="p">)</span>
<a id="__codelineno-124-13" name="__codelineno-124-13"></a><a href="#__codelineno-124-13"><span class="linenos" data-linenos="13 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
<a id="__codelineno-124-14" name="__codelineno-124-14"></a><a href="#__codelineno-124-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">plow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-124-15" name="__codelineno-124-15"></a><a href="#__codelineno-124-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-124-16" name="__codelineno-124-16"></a><a href="#__codelineno-124-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">f2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="o">^</span><span class="mi">624</span> <span class="o">+</span> <span class="n">plow</span>
<a id="__codelineno-124-17" name="__codelineno-124-17"></a><a href="#__codelineno-124-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">f2</span> <span class="o">=</span> <span class="n">f2</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-124-18" name="__codelineno-124-18"></a><a href="#__codelineno-124-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="n">root</span> <span class="o">=</span> <span class="n">f2</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">400</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<a id="__codelineno-124-19" name="__codelineno-124-19"></a><a href="#__codelineno-124-19"><span class="linenos" data-linenos="19 "></span></a>    <span class="k">if</span> <span class="n">root</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-124-20" name="__codelineno-124-20"></a><a href="#__codelineno-124-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">2</span><span class="o">^</span><span class="mi">624</span> <span class="o">+</span> <span class="n">plow</span>
<a id="__codelineno-124-21" name="__codelineno-124-21"></a><a href="#__codelineno-124-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-124-22" name="__codelineno-124-22"></a><a href="#__codelineno-124-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-124-23" name="__codelineno-124-23"></a><a href="#__codelineno-124-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-124-24" name="__codelineno-124-24"></a><a href="#__codelineno-124-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="p-q_1">给出p + q高位<a class="headerlink" href="#p-q_1" title="Permanent link">&para;</a></h3>
<p>题目改编自2023贵阳大数据安全精英赛——childrsa</p>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><a href="#__codelineno-125-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-125-2" name="__codelineno-125-2"></a><a href="#__codelineno-125-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">uuid</span><span class="w"> </span><span class="kn">import</span> <span class="n">uuid4</span>
<a id="__codelineno-125-3" name="__codelineno-125-3"></a><a href="#__codelineno-125-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-125-4" name="__codelineno-125-4"></a><a href="#__codelineno-125-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;flag{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
<a id="__codelineno-125-5" name="__codelineno-125-5"></a><a href="#__codelineno-125-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-125-6" name="__codelineno-125-6"></a><a href="#__codelineno-125-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-125-7" name="__codelineno-125-7"></a><a href="#__codelineno-125-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-125-8" name="__codelineno-125-8"></a><a href="#__codelineno-125-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-125-9" name="__codelineno-125-9"></a><a href="#__codelineno-125-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-125-10" name="__codelineno-125-10"></a><a href="#__codelineno-125-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span>
<a id="__codelineno-125-11" name="__codelineno-125-11"></a><a href="#__codelineno-125-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-125-12" name="__codelineno-125-12"></a><a href="#__codelineno-125-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">hint</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">400</span>
<a id="__codelineno-125-13" name="__codelineno-125-13"></a><a href="#__codelineno-125-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-125-14" name="__codelineno-125-14"></a><a href="#__codelineno-125-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;c = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-125-15" name="__codelineno-125-15"></a><a href="#__codelineno-125-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hint = </span><span class="si">{</span><span class="n">hint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-125-16" name="__codelineno-125-16"></a><a href="#__codelineno-125-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-125-17" name="__codelineno-125-17"></a><a href="#__codelineno-125-17"><span class="linenos" data-linenos="17 "></span></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-125-18" name="__codelineno-125-18"></a><a href="#__codelineno-125-18"><span class="linenos" data-linenos="18 "></span></a><span class="sd">c = 9968814618309288374765866491408679544255429893255485341540355195679112942954793887247314436025657932769746362042585414910893400260770578028623836705800055045072907439444477587736093915786634848757052762926680474130492661750432044025559425178180215747669943104929529122332455902347039817592660193268467698523220383789551009222998925658852390205657636722754375420684776093364112335355059660951403603124371637134722485720098467185512008162108300224681045740170399118079432119176169258163078208915377786922862558709935512780853980376778422910630993460815435812492821018759585591884031366023668940372754253922297009332299</span>
<a id="__codelineno-125-19" name="__codelineno-125-19"></a><a href="#__codelineno-125-19"><span class="linenos" data-linenos="19 "></span></a><span class="sd">hint = 105339843160443546161059100165057877716740618426298713183228594499797346255161510101279378179555206038228997256205578377516899889823785206924887213498045434452190147663923551839494492842528</span>
<a id="__codelineno-125-20" name="__codelineno-125-20"></a><a href="#__codelineno-125-20"><span class="linenos" data-linenos="20 "></span></a><span class="sd">n = 18082068933780051996564597024915927694586996785675007728934595064379707482865414885175435323040864143693167921685287351955951750372213399691641808639756160589090710830417826035004009898533761679036070970158874299127191974011618903726273713888134189317545858033157115955525192756551460792306555827664839412205373639439765940037587708927072607585261515428021124875200073775443189376478576573477677951404802079319347815808709279487553524912259078196698834492416001870786404364835221144821510700252279703537618579227763205158431798627532437072037863851605556234186314341793234064284447561153310642226744523000217117902339</span>
<a id="__codelineno-125-21" name="__codelineno-125-21"></a><a href="#__codelineno-125-21"><span class="linenos" data-linenos="21 "></span></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<p>我们可以联立<span class="arithmatex">\(p+q\)</span>的高位和<span class="arithmatex">\(n = p \times q\)</span>解方程组，此时解出来的<span class="arithmatex">\(p\)</span>和正确的<span class="arithmatex">\(p\)</span>高位是一样的，最后再用coppersmith去解低400位</p>
<p>实际测试发现，解方程可能存在误差，所以最后用copper处理低405位</p>
<blockquote>
<p>Exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><a href="#__codelineno-126-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a><a href="#__codelineno-126-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><a href="#__codelineno-126-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">c</span> <span class="o">=</span> 
<a id="__codelineno-126-4" name="__codelineno-126-4"></a><a href="#__codelineno-126-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">hint</span> <span class="o">=</span> 
<a id="__codelineno-126-5" name="__codelineno-126-5"></a><a href="#__codelineno-126-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">n</span> <span class="o">=</span> 
<a id="__codelineno-126-6" name="__codelineno-126-6"></a><a href="#__codelineno-126-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-126-7" name="__codelineno-126-7"></a><a href="#__codelineno-126-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-126-8" name="__codelineno-126-8"></a><a href="#__codelineno-126-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">RealField</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span>
<a id="__codelineno-126-9" name="__codelineno-126-9"></a><a href="#__codelineno-126-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-126-10" name="__codelineno-126-10"></a><a href="#__codelineno-126-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">f</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="p">((</span><span class="n">hint</span> <span class="o">&lt;&lt;</span> <span class="mi">400</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>
<a id="__codelineno-126-11" name="__codelineno-126-11"></a><a href="#__codelineno-126-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<a id="__codelineno-126-12" name="__codelineno-126-12"></a><a href="#__codelineno-126-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
<a id="__codelineno-126-13" name="__codelineno-126-13"></a><a href="#__codelineno-126-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">phigh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;&gt;</span> <span class="mi">405</span> <span class="o">&lt;&lt;</span> <span class="mi">405</span>
<a id="__codelineno-126-14" name="__codelineno-126-14"></a><a href="#__codelineno-126-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">PR</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-126-15" name="__codelineno-126-15"></a><a href="#__codelineno-126-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">f1</span> <span class="o">=</span> <span class="n">phigh</span> <span class="o">+</span> <span class="n">x</span>
<a id="__codelineno-126-16" name="__codelineno-126-16"></a><a href="#__codelineno-126-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">res1</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">405</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<a id="__codelineno-126-17" name="__codelineno-126-17"></a><a href="#__codelineno-126-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">if</span> <span class="n">res1</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-126-18" name="__codelineno-126-18"></a><a href="#__codelineno-126-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">phigh</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">res1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-126-19" name="__codelineno-126-19"></a><a href="#__codelineno-126-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">p</span>
<a id="__codelineno-126-20" name="__codelineno-126-20"></a><a href="#__codelineno-126-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-126-21" name="__codelineno-126-21"></a><a href="#__codelineno-126-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-126-22" name="__codelineno-126-22"></a><a href="#__codelineno-126-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</code></pre></div>
<h3 id="p2-q2n-pq">已知p^2 + q^2分解n = p*q<a class="headerlink" href="#p2-q2n-pq" title="Permanent link">&para;</a></h3>
<p>利用sagemath自带函数<code>two_squares()</code>，甚至有<code>three_squares()</code></p>
<h2 id="_30">二十三、私钥文件提取参数<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h2>
<p>常考的就是PKCS1形式的私钥文件，参考:<a href="https://blog.csdn.net/he25819/article/details/119467334">参考文章</a></p>
<p>先生成私钥文件</p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a><a href="#__codelineno-127-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-127-2" name="__codelineno-127-2"></a><a href="#__codelineno-127-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-127-3" name="__codelineno-127-3"></a><a href="#__codelineno-127-3"><span class="linenos" data-linenos=" 3 "></span></a>
<a id="__codelineno-127-4" name="__codelineno-127-4"></a><a href="#__codelineno-127-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">p</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-127-5" name="__codelineno-127-5"></a><a href="#__codelineno-127-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="n">getPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-127-6" name="__codelineno-127-6"></a><a href="#__codelineno-127-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
<a id="__codelineno-127-7" name="__codelineno-127-7"></a><a href="#__codelineno-127-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-127-8" name="__codelineno-127-8"></a><a href="#__codelineno-127-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-127-9" name="__codelineno-127-9"></a><a href="#__codelineno-127-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-127-10" name="__codelineno-127-10"></a><a href="#__codelineno-127-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-11" name="__codelineno-127-11"></a><a href="#__codelineno-127-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-12" name="__codelineno-127-12"></a><a href="#__codelineno-127-12"><span class="linenos" data-linenos="12 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p = </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-13" name="__codelineno-127-13"></a><a href="#__codelineno-127-13"><span class="linenos" data-linenos="13 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;q = </span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-14" name="__codelineno-127-14"></a><a href="#__codelineno-127-14"><span class="linenos" data-linenos="14 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dp = </span><span class="si">{</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-15" name="__codelineno-127-15"></a><a href="#__codelineno-127-15"><span class="linenos" data-linenos="15 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dq = </span><span class="si">{</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-16" name="__codelineno-127-16"></a><a href="#__codelineno-127-16"><span class="linenos" data-linenos="16 "></span></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inv = </span><span class="si">{</span><span class="n">inverse</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-127-17" name="__codelineno-127-17"></a><a href="#__codelineno-127-17"><span class="linenos" data-linenos="17 "></span></a>
<a id="__codelineno-127-18" name="__codelineno-127-18"></a><a href="#__codelineno-127-18"><span class="linenos" data-linenos="18 "></span></a><span class="n">privatekey</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
<a id="__codelineno-127-19" name="__codelineno-127-19"></a><a href="#__codelineno-127-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-127-20" name="__codelineno-127-20"></a><a href="#__codelineno-127-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;privatekey.pem&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
<a id="__codelineno-127-21" name="__codelineno-127-21"></a><a href="#__codelineno-127-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">f2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">privatekey</span><span class="o">.</span><span class="n">export_key</span><span class="p">())</span>
</code></pre></div>
<p>得到</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><a href="#__codelineno-128-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="o">-----</span><span class="n">BEGIN</span> <span class="n">RSA</span> <span class="n">PRIVATE</span> <span class="n">KEY</span><span class="o">-----</span>
<a id="__codelineno-128-2" name="__codelineno-128-2"></a><a href="#__codelineno-128-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">MIIEogIBAAKCAQEAhgPB1hHIr7An3HDG1dqJo8UQu</span><span class="o">+</span><span class="mi">5</span><span class="n">oOLOA119z0rZESozrr1ox</span>
<a id="__codelineno-128-3" name="__codelineno-128-3"></a><a href="#__codelineno-128-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="mi">3</span><span class="n">g0Ku86t1X1OpbawWr8cFzXgYsDtgZPWhEExbsU</span><span class="o">/</span><span class="n">qHGZXewo8ofe</span><span class="o">/</span><span class="mi">4</span><span class="n">Sa</span><span class="o">/</span><span class="n">s1DOpUm</span>
<a id="__codelineno-128-4" name="__codelineno-128-4"></a><a href="#__codelineno-128-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">ZIFsM</span><span class="o">/</span><span class="n">YAtWEex</span><span class="o">+</span><span class="n">aTwA9FT</span><span class="o">+</span><span class="mi">6</span><span class="n">EZ3OYJatmY9iq9ewnAjeCdBwll04C8vT9Ke73Xndn</span>
<a id="__codelineno-128-5" name="__codelineno-128-5"></a><a href="#__codelineno-128-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">B8tTtL2S4hIcuz7vVd1HTZSfQ</span><span class="o">+</span><span class="n">ousLUM5OuTe0361NFqp4RFhhHjtM9cuvyaPaMF</span>
<a id="__codelineno-128-6" name="__codelineno-128-6"></a><a href="#__codelineno-128-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">vRFoemXyCH8pfxgl4llFSBJitPAeLBxHpV9PjlLBp4kYIzPrYDMp1AF2seQyvb8W</span>
<a id="__codelineno-128-7" name="__codelineno-128-7"></a><a href="#__codelineno-128-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">NujFcu0ZvOZRuHxULiUT2RI2srZ6eyAoq7RXiwIDAQABAoIBAE</span><span class="o">/</span><span class="n">yw9tqZpfw9ga7</span>
<a id="__codelineno-128-8" name="__codelineno-128-8"></a><a href="#__codelineno-128-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">PNNteTk7Ih2LP5</span><span class="o">+</span><span class="mi">77</span><span class="n">nwN1LH6zEjRQvUsUJ2QmDusM</span><span class="o">+</span><span class="n">YtyBJyJ0krw51RJdikEcyA</span>
<a id="__codelineno-128-9" name="__codelineno-128-9"></a><a href="#__codelineno-128-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">nrPtlIjpoW1iv8TZUyBE0FMND848NAQp4GqLDzr8YjXSh6NnufMU6RujRlfVDQpD</span>
<a id="__codelineno-128-10" name="__codelineno-128-10"></a><a href="#__codelineno-128-10"><span class="linenos" data-linenos="10 "></span></a><span class="mi">82</span><span class="n">RTaMInLKpU5T1RYVefUYERiEpQCJjzDd2fb1UlCJx6XZguTXTsqCmhr7Lr6xN1</span>
<a id="__codelineno-128-11" name="__codelineno-128-11"></a><a href="#__codelineno-128-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">WvSdTY2a7cPxnusggrCaiYxoCjJQRPl</span><span class="o">+</span><span class="n">Z4O33gHkXNbZnch5YlEQui1</span><span class="o">+</span><span class="n">fanofKuk</span>
<a id="__codelineno-128-12" name="__codelineno-128-12"></a><a href="#__codelineno-128-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">lK3mAbqBwo</span><span class="o">/</span><span class="n">lfXXAu5GbhMdIZ6Iw68vAiFJQtuwvOYE1h6sN3EHsjnfkbfgC</span><span class="o">+</span><span class="n">uu4</span>
<a id="__codelineno-128-13" name="__codelineno-128-13"></a><a href="#__codelineno-128-13"><span class="linenos" data-linenos="13 "></span></a><span class="mi">1</span><span class="n">QQfAvECgYEAyBFidz8w3ijHW</span><span class="o">+</span><span class="n">XDcH20JhHxEMAmFTUf0fXI11x3ECk</span><span class="o">+</span><span class="mi">6</span><span class="n">c2yAH1v</span>
<a id="__codelineno-128-14" name="__codelineno-128-14"></a><a href="#__codelineno-128-14"><span class="linenos" data-linenos="14 "></span></a><span class="n">DHM4rr3KHspVhEJzyNVsVBg1I4JF5gSkPWsygjdoyMPqjQ9M0YP2Qho6iiiz20c3</span>
<a id="__codelineno-128-15" name="__codelineno-128-15"></a><a href="#__codelineno-128-15"><span class="linenos" data-linenos="15 "></span></a><span class="n">w</span><span class="o">+</span><span class="n">K9cBezTNtDn</span><span class="o">+</span><span class="n">N</span><span class="o">/</span><span class="n">gqOrJLBGOpru1zwpfroS4ie76QNpAUZ83OQUVrkCgYEAq3sG</span>
<a id="__codelineno-128-16" name="__codelineno-128-16"></a><a href="#__codelineno-128-16"><span class="linenos" data-linenos="16 "></span></a><span class="n">B0rZvn3</span><span class="o">+</span><span class="n">LbQ3S</span><span class="o">/</span><span class="n">AlydpnZYf6e85FUt3fQukRBI4vLl6SpOMJSZfQQUnM</span><span class="o">+</span><span class="n">P09t2z7</span>
<a id="__codelineno-128-17" name="__codelineno-128-17"></a><a href="#__codelineno-128-17"><span class="linenos" data-linenos="17 "></span></a><span class="n">rH3w4QLOYbfEndt1I</span><span class="o">/</span><span class="n">MMhfWb7a96I</span><span class="o">/</span><span class="n">Cfw9mW48RIUrk4MUtV</span><span class="o">/</span><span class="n">Pq7bKz0vzq</span><span class="o">/</span><span class="n">DBnA</span>
<a id="__codelineno-128-18" name="__codelineno-128-18"></a><a href="#__codelineno-128-18"><span class="linenos" data-linenos="18 "></span></a><span class="mi">44</span><span class="n">nAsa46bb9ysjJ6</span><span class="o">+</span><span class="n">fcnLWNLWz4O9</span><span class="o">+</span><span class="n">vBeFaGPmMCgYB</span><span class="o">+</span><span class="n">vnSwsrmUpCTX1REhPKFZ</span>
<a id="__codelineno-128-19" name="__codelineno-128-19"></a><a href="#__codelineno-128-19"><span class="linenos" data-linenos="19 "></span></a><span class="mi">1</span><span class="n">NfxEqmNmeAUtS6NMKjE9jxDBeqUYOJu8regC9</span><span class="o">/</span><span class="mi">17</span><span class="n">ZyLc0XCn2JHTCat3iPF</span><span class="o">+</span><span class="n">n7J</span>
<a id="__codelineno-128-20" name="__codelineno-128-20"></a><a href="#__codelineno-128-20"><span class="linenos" data-linenos="20 "></span></a><span class="mi">4</span><span class="n">hVXZR7ewS7gOiciPAVQDymyyOJYMh</span><span class="o">/</span><span class="n">j2srELl</span><span class="o">+</span><span class="n">KewW2TvtCmckcLwfurKROenCX</span>
<a id="__codelineno-128-21" name="__codelineno-128-21"></a><a href="#__codelineno-128-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">Ne4sk5t5nI1zH2KO1XcFEQKBgH9DeD</span><span class="o">/</span><span class="n">lPyBu5TsKKpfDDGh4HJBvkGhdt3k</span><span class="o">+</span><span class="n">jLld</span>
<a id="__codelineno-128-22" name="__codelineno-128-22"></a><a href="#__codelineno-128-22"><span class="linenos" data-linenos="22 "></span></a><span class="n">u3GEDGP</span><span class="o">/</span><span class="n">cBnLHVNuxfIOUX7ggvMkgMuNVD3KFVzUQ6lb</span><span class="o">+</span><span class="mi">93</span><span class="n">IPZ0VoLmPp7gQlqGF</span>
<a id="__codelineno-128-23" name="__codelineno-128-23"></a><a href="#__codelineno-128-23"><span class="linenos" data-linenos="23 "></span></a><span class="n">VMSJIZuzNo7u</span><span class="o">+</span><span class="n">Ewd0QdgfOuHL85NNqgnzciQI3DbysWRTU9CK</span><span class="o">+</span><span class="n">M1c</span><span class="o">/</span><span class="n">GtZvJ8F0O2</span>
<a id="__codelineno-128-24" name="__codelineno-128-24"></a><a href="#__codelineno-128-24"><span class="linenos" data-linenos="24 "></span></a><span class="n">Az89AoGAILpBAbTHYaBpdXrN4axCm9wbJzEJlk0Pv9BvNXly5LiU</span><span class="o">/</span><span class="n">xJsgppP</span><span class="o">/</span><span class="n">gmP</span>
<a id="__codelineno-128-25" name="__codelineno-128-25"></a><a href="#__codelineno-128-25"><span class="linenos" data-linenos="25 "></span></a><span class="mi">9</span><span class="n">NmUN8QKmp3dmxM9Ub36DYGpZRyPKbKfjKQfSraLXwokr7aIm4jc7Ow0NBBgTsfS</span>
<a id="__codelineno-128-26" name="__codelineno-128-26"></a><a href="#__codelineno-128-26"><span class="linenos" data-linenos="26 "></span></a><span class="n">EaqTgYiY9axcqaYS9I5iyfQZt9Kl</span><span class="o">/</span><span class="n">hJX6aT9s2M</span><span class="o">+</span><span class="n">DQfchzaFWkQ</span><span class="o">=</span>
<a id="__codelineno-128-27" name="__codelineno-128-27"></a><a href="#__codelineno-128-27"><span class="linenos" data-linenos="27 "></span></a><span class="o">-----</span><span class="n">END</span> <span class="n">RSA</span> <span class="n">PRIVATE</span> <span class="n">KEY</span><span class="o">-----</span>
</code></pre></div>
<p>解base64再转16进制得到下面的内容</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a><a href="#__codelineno-129-1"><span class="linenos" data-linenos="1 "></span></a>30 82 04 a2 02 01 00 02 82 01 01 00 86 03 c1 d6 11 c8 af b0 27 dc 70 c6 d5 da 89 a3 c5 10 bb ee 68 38 b3 80 d7 5f 73 d2 b6 44 4a 8c eb af 5a 31 de 0d 0a bb ce ad d5 7d 4e a5 b6 b0 5a bf 1c 17 35 e0 62 c0 ed 81 93 d6 84 41 31 6e c5 3f a8 71 99 5d ec 28 f2 87 de ff 84 9a fe cd 43 3a 95 26 64 81 6c 33 f6 00 b5 61 1e c7 e6 93 c0 0f 45 4f ee 84 67 73 98 25 ab 66 63 d8 aa f5 ec 27 02 37 82 74 1c 25 97 4e 02 f2 f4 fd 29 ee f7 5e 77 67 07 cb 53 b4 bd 92 e2 12 1c bb 3e ef 55 dd 47 4d 94 9f 43 ea 2e b0 b5 0c e4 eb 93 7b 4d fa d4 d1 6a a7 84 45 86 11 e3 b4 cf 5c ba fc 9a 3d a3 05 bd 11 68 7a 65 f2 08 7f 29 7f 18 25 e2 59 45 48 12 62 b4 f0 1e 2c 1c 47 a5 5f 4f 8e 52 c1 a7 89 18 23 33 eb 60 33 29 d4 01 76 b1 e4 32 bd bf 16 36 e8 c5 72 ed 19 bc e6 51 b8 7c 54 2e 25 13 d9 12 36 b2 b6 7a 7b 20 28 ab b4 57 8b 02 03 01 00 01 02 82 01 00 4f f2 c3 db 6a 66 97 f0 f6 06 bb 3c d3 6d 79 39 3b 22 1d 8b 3f 9f bb ee 7c 0d d4 b1 fa cc 48 d1 42 f5 2c 50 9d 90 98 3b ac 33 e6 2d c8 12 72 27 49 2b c3 9d 51 25 d8 a4 11 cc 80 9e b3 ed 94 88 e9 a1 6d 62 bf c4 d9 53 20 44 d0 53 0d 0f ce 3c 34 04 29 e0 6a 8b 0f 3a fc 62 35 d2 87 a3 67 b9 f3 14 e9 1b a3 46 57 d5 0d 0a 43 f3 64 53 68 c2 27 2c aa 54 e5 3d 51 61 57 9f 51 81 11 88 4a 50 08 98 f3 0d dd 9f 6f 55 25 08 9c 7a 5d 98 2e 4d 74 ec a8 29 a1 af b2 eb eb 13 75 5a f4 9d 4d 8d 9a ed c3 f1 9e eb 20 82 b0 9a 89 8c 68 0a 32 50 44 f9 7e 67 83 b7 de 01 e4 5c d6 d9 9d c8 79 62 51 10 ba 2d 7e 7d a9 e8 7c ab a4 94 ad e6 01 ba 81 c2 8f e5 7d 75 c0 bb 91 9b 84 c7 48 67 a2 30 eb cb c0 88 52 50 b6 ec 2f 39 81 35 87 ab 0d dc 41 ec 8e 77 e4 6d f8 02 fa eb b8 d5 04 1f 02 f1 02 81 81 00 c8 11 62 77 3f 30 de 28 c7 5b e5 c3 70 7d b4 26 11 f1 10 c0 26 15 35 1f d1 f5 c8 d7 5c 77 10 29 3e e9 cd b2 00 7d 6f 0c 73 38 ae bd ca 1e ca 55 84 42 73 c8 d5 6c 54 18 35 23 82 45 e6 04 a4 3d 6b 32 82 37 68 c8 c3 ea 8d 0f 4c d1 83 f6 42 1a 3a 8a 28 b3 db 47 37 c3 e2 bd 70 17 b3 4c db 43 9f e3 7f 82 a3 ab 24 b0 46 3a 9a ee d7 3c 29 7e ba 12 e2 27 bb e9 03 69 01 46 7c dc e4 14 56 b9 02 81 81 00 ab 7b 06 07 4a d9 be 7d fe 2d b4 37 4b f0 25 c9 da 67 65 87 fa 7b ce 45 52 dd df 42 e9 11 04 8e 2f 2e 5e 92 a4 e3 09 49 97 d0 41 49 cc f8 fd 3d b7 6c fb ac 7d f0 e1 02 ce 61 b7 c4 9d db 75 23 f3 0c 85 f5 9b ed af 7a 23 f0 9f c3 d9 96 e3 c4 48 52 b9 38 31 4b 55 fc fa bb 6c ac f4 bf 3a bf 0c 19 c0 e3 89 c0 b1 ae 3a 6d bf 72 b2 32 7a f9 f7 27 2d 63 4b 5b 3e 0e f7 eb c1 78 56 86 3e 63 02 81 80 7e be 74 b0 b2 b9 94 a4 24 d7 d5 11 21 3c a1 59 d4 d7 f1 12 a9 8d 99 e0 14 b5 2e 8d 30 a8 c4 f6 3c 43 05 ea 94 60 e2 6e f2 b7 a0 0b df f5 ed 9c 8b 73 45 c2 9f 62 47 4c 26 ad de 23 c5 fa 7e c9 e2 15 57 65 1e de c1 2e e0 3a 27 22 3c 05 50 0f 29 b2 c8 e2 58 32 1f e3 da ca c4 2e 5f 8a 7b 05 b6 4e fb 42 99 c9 1c 2f 07 ee ac a4 4e 7a 70 97 35 ee 2c 93 9b 79 9c 8d 73 1f 62 8e d5 77 05 11 02 81 80 7f 43 78 3f e5 3f 20 6e e5 3b 0a 2a 97 c3 0c 68 78 1c 90 6f 90 68 5d b7 79 3e 8c b9 5d bb 71 84 0c 63 ff 70 19 cb 1d 53 6e c5 f2 0e 51 7e e0 82 f3 24 80 cb 8d 54 3d ca 15 5c d4 43 a9 5b fb dd c8 3d 9d 15 a0 b9 8f a7 b8 10 96 a1 85 54 c4 89 21 9b b3 36 8e ee f8 4c 1d d1 07 60 7c eb 87 2f ce 4d 36 a8 27 cd c8 90 23 70 db ca c5 91 4d 4f 42 2b e3 35 73 f1 ad 66 f2 7c 17 43 b6 03 3f 3d 02 81 80 20 ba 41 01 b4 c7 61 a0 69 75 7a cd e1 ac 42 9b dc 1b 27 31 09 96 4d 0f bf d0 6f 35 79 72 e4 b8 94 ff 12 6c 82 9a 4f fe 09 8f f4 d9 94 37 c4 0a 9a 9d dd 9b 13 3d 51 bd fa 0d 81 a9 65 1c 8f 29 b2 9f 8c a4 1f 4a b6 8b 5f 0a 24 af b6 88 9b 88 dc ec ec 34 34 10 60 4e c7 d2 11 aa 93 81 88 98 f5 ac 5c a9 a6 12 f4 8e 62 c9 f4 19 b7 d2 a5 fe 12 57 e9 a4 fd b3 63 3e 0d 07 dc 87 36 85 5a 44
</code></pre></div>
<p>对其格式化</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a><a href="#__codelineno-130-1"><span class="linenos" data-linenos=" 1 "></span></a>30 82 04 a2 
<a id="__codelineno-130-2" name="__codelineno-130-2"></a><a href="#__codelineno-130-2"><span class="linenos" data-linenos=" 2 "></span></a>    02 01 
<a id="__codelineno-130-3" name="__codelineno-130-3"></a><a href="#__codelineno-130-3"><span class="linenos" data-linenos=" 3 "></span></a>        00 
<a id="__codelineno-130-4" name="__codelineno-130-4"></a><a href="#__codelineno-130-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-130-5" name="__codelineno-130-5"></a><a href="#__codelineno-130-5"><span class="linenos" data-linenos=" 5 "></span></a>    02 82 01 01 
<a id="__codelineno-130-6" name="__codelineno-130-6"></a><a href="#__codelineno-130-6"><span class="linenos" data-linenos=" 6 "></span></a>        00 86 03 c1 d6 11 c8 af b0 27 dc 70 c6 d5 da 89 a3 c5 10 bb ee 68 38 b3 80 d7 5f 73 d2 b6 44 4a 8c eb af 5a 31 de 0d 0a bb ce ad d5 7d 4e a5 b6 b0 5a bf 1c 17 35 e0 62 c0 ed 81 93 d6 84 41 31 6e c5 3f a8 71 99 5d ec 28 f2 87 de ff 84 9a fe cd 43 3a 95 26 64 81 6c 33 f6 00 b5 61 1e c7 e6 93 c0 0f 45 4f ee 84 67 73 98 25 ab 66 63 d8 aa f5 ec 27 02 37 82 74 1c 25 97 4e 02 f2 f4 fd 29 ee f7 5e 77 67 07 cb 53 b4 bd 92 e2 12 1c bb 3e ef 55 dd 47 4d 94 9f 43 ea 2e b0 b5 0c e4 eb 93 7b 4d fa d4 d1 6a a7 84 45 86 11 e3 b4 cf 5c ba fc 9a 3d a3 05 bd 11 68 7a 65 f2 08 7f 29 7f 18 25 e2 59 45 48 12 62 b4 f0 1e 2c 1c 47 a5 5f 4f 8e 52 c1 a7 89 18 23 33 eb 60 33 29 d4 01 76 b1 e4 32 bd bf 16 36 e8 c5 72 ed 19 bc e6 51 b8 7c 54 2e 25 13 d9 12 36 b2 b6 7a 7b 20 28 ab b4 57 8b 
<a id="__codelineno-130-7" name="__codelineno-130-7"></a><a href="#__codelineno-130-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-130-8" name="__codelineno-130-8"></a><a href="#__codelineno-130-8"><span class="linenos" data-linenos=" 8 "></span></a>    02 03 
<a id="__codelineno-130-9" name="__codelineno-130-9"></a><a href="#__codelineno-130-9"><span class="linenos" data-linenos=" 9 "></span></a>        01 00 01 
<a id="__codelineno-130-10" name="__codelineno-130-10"></a><a href="#__codelineno-130-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-130-11" name="__codelineno-130-11"></a><a href="#__codelineno-130-11"><span class="linenos" data-linenos="11 "></span></a>    02 82 01 00 
<a id="__codelineno-130-12" name="__codelineno-130-12"></a><a href="#__codelineno-130-12"><span class="linenos" data-linenos="12 "></span></a>        4f f2 c3 db 6a 66 97 f0 f6 06 bb 3c d3 6d 79 39 3b 22 1d 8b 3f 9f bb ee 7c 0d d4 b1 fa cc 48 d1 42 f5 2c 50 9d 90 98 3b ac 33 e6 2d c8 12 72 27 49 2b c3 9d 51 25 d8 a4 11 cc 80 9e b3 ed 94 88 e9 a1 6d 62 bf c4 d9 53 20 44 d0 53 0d 0f ce 3c 34 04 29 e0 6a 8b 0f 3a fc 62 35 d2 87 a3 67 b9 f3 14 e9 1b a3 46 57 d5 0d 0a 43 f3 64 53 68 c2 27 2c aa 54 e5 3d 51 61 57 9f 51 81 11 88 4a 50 08 98 f3 0d dd 9f 6f 55 25 08 9c 7a 5d 98 2e 4d 74 ec a8 29 a1 af b2 eb eb 13 75 5a f4 9d 4d 8d 9a ed c3 f1 9e eb 20 82 b0 9a 89 8c 68 0a 32 50 44 f9 7e 67 83 b7 de 01 e4 5c d6 d9 9d c8 79 62 51 10 ba 2d 7e 7d a9 e8 7c ab a4 94 ad e6 01 ba 81 c2 8f e5 7d 75 c0 bb 91 9b 84 c7 48 67 a2 30 eb cb c0 88 52 50 b6 ec 2f 39 81 35 87 ab 0d dc 41 ec 8e 77 e4 6d f8 02 fa eb b8 d5 04 1f 02 f1 
<a id="__codelineno-130-13" name="__codelineno-130-13"></a><a href="#__codelineno-130-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-130-14" name="__codelineno-130-14"></a><a href="#__codelineno-130-14"><span class="linenos" data-linenos="14 "></span></a>    02 81 81 00 
<a id="__codelineno-130-15" name="__codelineno-130-15"></a><a href="#__codelineno-130-15"><span class="linenos" data-linenos="15 "></span></a>        c8 11 62 77 3f 30 de 28 c7 5b e5 c3 70 7d b4 26 11 f1 10 c0 26 15 35 1f d1 f5 c8 d7 5c 77 10 29 3e e9 cd b2 00 7d 6f 0c 73 38 ae bd ca 1e ca 55 84 42 73 c8 d5 6c 54 18 35 23 82 45 e6 04 a4 3d 6b 32 82 37 68 c8 c3 ea 8d 0f 4c d1 83 f6 42 1a 3a 8a 28 b3 db 47 37 c3 e2 bd 70 17 b3 4c db 43 9f e3 7f 82 a3 ab 24 b0 46 3a 9a ee d7 3c 29 7e ba 12 e2 27 bb e9 03 69 01 46 7c dc e4 14 56 b9 
<a id="__codelineno-130-16" name="__codelineno-130-16"></a><a href="#__codelineno-130-16"><span class="linenos" data-linenos="16 "></span></a>
<a id="__codelineno-130-17" name="__codelineno-130-17"></a><a href="#__codelineno-130-17"><span class="linenos" data-linenos="17 "></span></a>    02 81 81 00 
<a id="__codelineno-130-18" name="__codelineno-130-18"></a><a href="#__codelineno-130-18"><span class="linenos" data-linenos="18 "></span></a>        ab 7b 06 07 4a d9 be 7d fe 2d b4 37 4b f0 25 c9 da 67 65 87 fa 7b ce 45 52 dd df 42 e9 11 04 8e 2f 2e 5e 92 a4 e3 09 49 97 d0 41 49 cc f8 fd 3d b7 6c fb ac 7d f0 e1 02 ce 61 b7 c4 9d db 75 23 f3 0c 85 f5 9b ed af 7a 23 f0 9f c3 d9 96 e3 c4 48 52 b9 38 31 4b 55 fc fa bb 6c ac f4 bf 3a bf 0c 19 c0 e3 89 c0 b1 ae 3a 6d bf 72 b2 32 7a f9 f7 27 2d 63 4b 5b 3e 0e f7 eb c1 78 56 86 3e 63 
<a id="__codelineno-130-19" name="__codelineno-130-19"></a><a href="#__codelineno-130-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-130-20" name="__codelineno-130-20"></a><a href="#__codelineno-130-20"><span class="linenos" data-linenos="20 "></span></a>    02 81 80 
<a id="__codelineno-130-21" name="__codelineno-130-21"></a><a href="#__codelineno-130-21"><span class="linenos" data-linenos="21 "></span></a>        7e be 74 b0 b2 b9 94 a4 24 d7 d5 11 21 3c a1 59 d4 d7 f1 12 a9 8d 99 e0 14 b5 2e 8d 30 a8 c4 f6 3c 43 05 ea 94 60 e2 6e f2 b7 a0 0b df f5 ed 9c 8b 73 45 c2 9f 62 47 4c 26 ad de 23 c5 fa 7e c9 e2 15 57 65 1e de c1 2e e0 3a 27 22 3c 05 50 0f 29 b2 c8 e2 58 32 1f e3 da ca c4 2e 5f 8a 7b 05 b6 4e fb 42 99 c9 1c 2f 07 ee ac a4 4e 7a 70 97 35 ee 2c 93 9b 79 9c 8d 73 1f 62 8e d5 77 05 11 
<a id="__codelineno-130-22" name="__codelineno-130-22"></a><a href="#__codelineno-130-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-130-23" name="__codelineno-130-23"></a><a href="#__codelineno-130-23"><span class="linenos" data-linenos="23 "></span></a>    02 81 80 
<a id="__codelineno-130-24" name="__codelineno-130-24"></a><a href="#__codelineno-130-24"><span class="linenos" data-linenos="24 "></span></a>        7f 43 78 3f e5 3f 20 6e e5 3b 0a 2a 97 c3 0c 68 78 1c 90 6f 90 68 5d b7 79 3e 8c b9 5d bb 71 84 0c 63 ff 70 19 cb 1d 53 6e c5 f2 0e 51 7e e0 82 f3 24 80 cb 8d 54 3d ca 15 5c d4 43 a9 5b fb dd c8 3d 9d 15 a0 b9 8f a7 b8 10 96 a1 85 54 c4 89 21 9b b3 36 8e ee f8 4c 1d d1 07 60 7c eb 87 2f ce 4d 36 a8 27 cd c8 90 23 70 db ca c5 91 4d 4f 42 2b e3 35 73 f1 ad 66 f2 7c 17 43 b6 03 3f 3d 
<a id="__codelineno-130-25" name="__codelineno-130-25"></a><a href="#__codelineno-130-25"><span class="linenos" data-linenos="25 "></span></a>
<a id="__codelineno-130-26" name="__codelineno-130-26"></a><a href="#__codelineno-130-26"><span class="linenos" data-linenos="26 "></span></a>    02 81 80 
<a id="__codelineno-130-27" name="__codelineno-130-27"></a><a href="#__codelineno-130-27"><span class="linenos" data-linenos="27 "></span></a>        20 ba 41 01 b4 c7 61 a0 69 75 7a cd e1 ac 42 9b dc 1b 27 31 09 96 4d 0f bf d0 6f 35 79 72 e4 b8 94 ff 12 6c 82 9a 4f fe 09 8f f4 d9 94 37 c4 0a 9a 9d dd 9b 13 3d 51 bd fa 0d 81 a9 65 1c 8f 29 b2 9f 8c a4 1f 4a b6 8b 5f 0a 24 af b6 88 9b 88 dc ec ec 34 34 10 60 4e c7 d2 11 aa 93 81 88 98 f5 ac 5c a9 a6 12 f4 8e 62 c9 f4 19 b7 d2 a5 fe 12 57 e9 a4 fd b3 63 3e 0d 07 dc 87 36 85 5a 44
</code></pre></div>
<p>再通过OpenSSL来查看一下密钥的各参数情况</p>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a><a href="#__codelineno-131-1"><span class="linenos" data-linenos="1 "></span></a>openssl<span class="w"> </span>rsa<span class="w"> </span>-in<span class="w"> </span>文件名<span class="w"> </span>-text<span class="w"> </span>-noout
</code></pre></div>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><a href="#__codelineno-132-1"><span class="linenos" data-linenos=" 1 "></span></a>Private-Key:<span class="w"> </span><span class="o">(</span><span class="m">2048</span><span class="w"> </span>bit,<span class="w"> </span><span class="m">2</span><span class="w"> </span>primes<span class="o">)</span>
<a id="__codelineno-132-2" name="__codelineno-132-2"></a><a href="#__codelineno-132-2"><span class="linenos" data-linenos=" 2 "></span></a>modulus:
<a id="__codelineno-132-3" name="__codelineno-132-3"></a><a href="#__codelineno-132-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="w">    </span><span class="m">00</span>:86:03:c1:d6:11:c8:af:b0:27:dc:70:c6:d5:da:
<a id="__codelineno-132-4" name="__codelineno-132-4"></a><a href="#__codelineno-132-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="w">    </span><span class="m">89</span>:a3:c5:10:bb:ee:68:38:b3:80:d7:5f:73:d2:b6:
<a id="__codelineno-132-5" name="__codelineno-132-5"></a><a href="#__codelineno-132-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="w">    </span><span class="m">44</span>:4a:8c:eb:af:5a:31:de:0d:0a:bb:ce:ad:d5:7d:
<a id="__codelineno-132-6" name="__codelineno-132-6"></a><a href="#__codelineno-132-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="w">    </span>4e:a5:b6:b0:5a:bf:1c:17:35:e0:62:c0:ed:81:93:
<a id="__codelineno-132-7" name="__codelineno-132-7"></a><a href="#__codelineno-132-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="w">    </span>d6:84:41:31:6e:c5:3f:a8:71:99:5d:ec:28:f2:87:
<a id="__codelineno-132-8" name="__codelineno-132-8"></a><a href="#__codelineno-132-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="w">    </span>de:ff:84:9a:fe:cd:43:3a:95:26:64:81:6c:33:f6:
<a id="__codelineno-132-9" name="__codelineno-132-9"></a><a href="#__codelineno-132-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="w">    </span><span class="m">00</span>:b5:61:1e:c7:e6:93:c0:0f:45:4f:ee:84:67:73:
<a id="__codelineno-132-10" name="__codelineno-132-10"></a><a href="#__codelineno-132-10"><span class="linenos" data-linenos="10 "></span></a><span class="w">    </span><span class="m">98</span>:25:ab:66:63:d8:aa:f5:ec:27:02:37:82:74:1c:
<a id="__codelineno-132-11" name="__codelineno-132-11"></a><a href="#__codelineno-132-11"><span class="linenos" data-linenos="11 "></span></a><span class="w">    </span><span class="m">25</span>:97:4e:02:f2:f4:fd:29:ee:f7:5e:77:67:07:cb:
<a id="__codelineno-132-12" name="__codelineno-132-12"></a><a href="#__codelineno-132-12"><span class="linenos" data-linenos="12 "></span></a><span class="w">    </span><span class="m">53</span>:b4:bd:92:e2:12:1c:bb:3e:ef:55:dd:47:4d:94:
<a id="__codelineno-132-13" name="__codelineno-132-13"></a><a href="#__codelineno-132-13"><span class="linenos" data-linenos="13 "></span></a><span class="w">    </span>9f:43:ea:2e:b0:b5:0c:e4:eb:93:7b:4d:fa:d4:d1:
<a id="__codelineno-132-14" name="__codelineno-132-14"></a><a href="#__codelineno-132-14"><span class="linenos" data-linenos="14 "></span></a><span class="w">    </span>6a:a7:84:45:86:11:e3:b4:cf:5c:ba:fc:9a:3d:a3:
<a id="__codelineno-132-15" name="__codelineno-132-15"></a><a href="#__codelineno-132-15"><span class="linenos" data-linenos="15 "></span></a><span class="w">    </span><span class="m">05</span>:bd:11:68:7a:65:f2:08:7f:29:7f:18:25:e2:59:
<a id="__codelineno-132-16" name="__codelineno-132-16"></a><a href="#__codelineno-132-16"><span class="linenos" data-linenos="16 "></span></a><span class="w">    </span><span class="m">45</span>:48:12:62:b4:f0:1e:2c:1c:47:a5:5f:4f:8e:52:
<a id="__codelineno-132-17" name="__codelineno-132-17"></a><a href="#__codelineno-132-17"><span class="linenos" data-linenos="17 "></span></a><span class="w">    </span>c1:a7:89:18:23:33:eb:60:33:29:d4:01:76:b1:e4:
<a id="__codelineno-132-18" name="__codelineno-132-18"></a><a href="#__codelineno-132-18"><span class="linenos" data-linenos="18 "></span></a><span class="w">    </span><span class="m">32</span>:bd:bf:16:36:e8:c5:72:ed:19:bc:e6:51:b8:7c:
<a id="__codelineno-132-19" name="__codelineno-132-19"></a><a href="#__codelineno-132-19"><span class="linenos" data-linenos="19 "></span></a><span class="w">    </span><span class="m">54</span>:2e:25:13:d9:12:36:b2:b6:7a:7b:20:28:ab:b4:
<a id="__codelineno-132-20" name="__codelineno-132-20"></a><a href="#__codelineno-132-20"><span class="linenos" data-linenos="20 "></span></a><span class="w">    </span><span class="m">57</span>:8b
<a id="__codelineno-132-21" name="__codelineno-132-21"></a><a href="#__codelineno-132-21"><span class="linenos" data-linenos="21 "></span></a>publicExponent:<span class="w"> </span><span class="m">65537</span><span class="w"> </span><span class="o">(</span>0x10001<span class="o">)</span>
<a id="__codelineno-132-22" name="__codelineno-132-22"></a><a href="#__codelineno-132-22"><span class="linenos" data-linenos="22 "></span></a>privateExponent:
<a id="__codelineno-132-23" name="__codelineno-132-23"></a><a href="#__codelineno-132-23"><span class="linenos" data-linenos="23 "></span></a><span class="w">    </span>4f:f2:c3:db:6a:66:97:f0:f6:06:bb:3c:d3:6d:79:
<a id="__codelineno-132-24" name="__codelineno-132-24"></a><a href="#__codelineno-132-24"><span class="linenos" data-linenos="24 "></span></a><span class="w">    </span><span class="m">39</span>:3b:22:1d:8b:3f:9f:bb:ee:7c:0d:d4:b1:fa:cc:
<a id="__codelineno-132-25" name="__codelineno-132-25"></a><a href="#__codelineno-132-25"><span class="linenos" data-linenos="25 "></span></a><span class="w">    </span><span class="m">48</span>:d1:42:f5:2c:50:9d:90:98:3b:ac:33:e6:2d:c8:
<a id="__codelineno-132-26" name="__codelineno-132-26"></a><a href="#__codelineno-132-26"><span class="linenos" data-linenos="26 "></span></a><span class="w">    </span><span class="m">12</span>:72:27:49:2b:c3:9d:51:25:d8:a4:11:cc:80:9e:
<a id="__codelineno-132-27" name="__codelineno-132-27"></a><a href="#__codelineno-132-27"><span class="linenos" data-linenos="27 "></span></a><span class="w">    </span>b3:ed:94:88:e9:a1:6d:62:bf:c4:d9:53:20:44:d0:
<a id="__codelineno-132-28" name="__codelineno-132-28"></a><a href="#__codelineno-132-28"><span class="linenos" data-linenos="28 "></span></a><span class="w">    </span><span class="m">53</span>:0d:0f:ce:3c:34:04:29:e0:6a:8b:0f:3a:fc:62:
<a id="__codelineno-132-29" name="__codelineno-132-29"></a><a href="#__codelineno-132-29"><span class="linenos" data-linenos="29 "></span></a><span class="w">    </span><span class="m">35</span>:d2:87:a3:67:b9:f3:14:e9:1b:a3:46:57:d5:0d:
<a id="__codelineno-132-30" name="__codelineno-132-30"></a><a href="#__codelineno-132-30"><span class="linenos" data-linenos="30 "></span></a><span class="w">    </span>0a:43:f3:64:53:68:c2:27:2c:aa:54:e5:3d:51:61:
<a id="__codelineno-132-31" name="__codelineno-132-31"></a><a href="#__codelineno-132-31"><span class="linenos" data-linenos="31 "></span></a><span class="w">    </span><span class="m">57</span>:9f:51:81:11:88:4a:50:08:98:f3:0d:dd:9f:6f:
<a id="__codelineno-132-32" name="__codelineno-132-32"></a><a href="#__codelineno-132-32"><span class="linenos" data-linenos="32 "></span></a><span class="w">    </span><span class="m">55</span>:25:08:9c:7a:5d:98:2e:4d:74:ec:a8:29:a1:af:
<a id="__codelineno-132-33" name="__codelineno-132-33"></a><a href="#__codelineno-132-33"><span class="linenos" data-linenos="33 "></span></a><span class="w">    </span>b2:eb:eb:13:75:5a:f4:9d:4d:8d:9a:ed:c3:f1:9e:
<a id="__codelineno-132-34" name="__codelineno-132-34"></a><a href="#__codelineno-132-34"><span class="linenos" data-linenos="34 "></span></a><span class="w">    </span>eb:20:82:b0:9a:89:8c:68:0a:32:50:44:f9:7e:67:
<a id="__codelineno-132-35" name="__codelineno-132-35"></a><a href="#__codelineno-132-35"><span class="linenos" data-linenos="35 "></span></a><span class="w">    </span><span class="m">83</span>:b7:de:01:e4:5c:d6:d9:9d:c8:79:62:51:10:ba:
<a id="__codelineno-132-36" name="__codelineno-132-36"></a><a href="#__codelineno-132-36"><span class="linenos" data-linenos="36 "></span></a><span class="w">    </span>2d:7e:7d:a9:e8:7c:ab:a4:94:ad:e6:01:ba:81:c2:
<a id="__codelineno-132-37" name="__codelineno-132-37"></a><a href="#__codelineno-132-37"><span class="linenos" data-linenos="37 "></span></a><span class="w">    </span>8f:e5:7d:75:c0:bb:91:9b:84:c7:48:67:a2:30:eb:
<a id="__codelineno-132-38" name="__codelineno-132-38"></a><a href="#__codelineno-132-38"><span class="linenos" data-linenos="38 "></span></a><span class="w">    </span>cb:c0:88:52:50:b6:ec:2f:39:81:35:87:ab:0d:dc:
<a id="__codelineno-132-39" name="__codelineno-132-39"></a><a href="#__codelineno-132-39"><span class="linenos" data-linenos="39 "></span></a><span class="w">    </span><span class="m">41</span>:ec:8e:77:e4:6d:f8:02:fa:eb:b8:d5:04:1f:02:
<a id="__codelineno-132-40" name="__codelineno-132-40"></a><a href="#__codelineno-132-40"><span class="linenos" data-linenos="40 "></span></a><span class="w">    </span>f1
<a id="__codelineno-132-41" name="__codelineno-132-41"></a><a href="#__codelineno-132-41"><span class="linenos" data-linenos="41 "></span></a>prime1:
<a id="__codelineno-132-42" name="__codelineno-132-42"></a><a href="#__codelineno-132-42"><span class="linenos" data-linenos="42 "></span></a><span class="w">    </span><span class="m">00</span>:c8:11:62:77:3f:30:de:28:c7:5b:e5:c3:70:7d:
<a id="__codelineno-132-43" name="__codelineno-132-43"></a><a href="#__codelineno-132-43"><span class="linenos" data-linenos="43 "></span></a><span class="w">    </span>b4:26:11:f1:10:c0:26:15:35:1f:d1:f5:c8:d7:5c:
<a id="__codelineno-132-44" name="__codelineno-132-44"></a><a href="#__codelineno-132-44"><span class="linenos" data-linenos="44 "></span></a><span class="w">    </span><span class="m">77</span>:10:29:3e:e9:cd:b2:00:7d:6f:0c:73:38:ae:bd:
<a id="__codelineno-132-45" name="__codelineno-132-45"></a><a href="#__codelineno-132-45"><span class="linenos" data-linenos="45 "></span></a><span class="w">    </span>ca:1e:ca:55:84:42:73:c8:d5:6c:54:18:35:23:82:
<a id="__codelineno-132-46" name="__codelineno-132-46"></a><a href="#__codelineno-132-46"><span class="linenos" data-linenos="46 "></span></a><span class="w">    </span><span class="m">45</span>:e6:04:a4:3d:6b:32:82:37:68:c8:c3:ea:8d:0f:
<a id="__codelineno-132-47" name="__codelineno-132-47"></a><a href="#__codelineno-132-47"><span class="linenos" data-linenos="47 "></span></a><span class="w">    </span>4c:d1:83:f6:42:1a:3a:8a:28:b3:db:47:37:c3:e2:
<a id="__codelineno-132-48" name="__codelineno-132-48"></a><a href="#__codelineno-132-48"><span class="linenos" data-linenos="48 "></span></a><span class="w">    </span>bd:70:17:b3:4c:db:43:9f:e3:7f:82:a3:ab:24:b0:
<a id="__codelineno-132-49" name="__codelineno-132-49"></a><a href="#__codelineno-132-49"><span class="linenos" data-linenos="49 "></span></a><span class="w">    </span><span class="m">46</span>:3a:9a:ee:d7:3c:29:7e:ba:12:e2:27:bb:e9:03:
<a id="__codelineno-132-50" name="__codelineno-132-50"></a><a href="#__codelineno-132-50"><span class="linenos" data-linenos="50 "></span></a><span class="w">    </span><span class="m">69</span>:01:46:7c:dc:e4:14:56:b9
<a id="__codelineno-132-51" name="__codelineno-132-51"></a><a href="#__codelineno-132-51"><span class="linenos" data-linenos="51 "></span></a>prime2:
<a id="__codelineno-132-52" name="__codelineno-132-52"></a><a href="#__codelineno-132-52"><span class="linenos" data-linenos="52 "></span></a><span class="w">    </span><span class="m">00</span>:ab:7b:06:07:4a:d9:be:7d:fe:2d:b4:37:4b:f0:
<a id="__codelineno-132-53" name="__codelineno-132-53"></a><a href="#__codelineno-132-53"><span class="linenos" data-linenos="53 "></span></a><span class="w">    </span><span class="m">25</span>:c9:da:67:65:87:fa:7b:ce:45:52:dd:df:42:e9:
<a id="__codelineno-132-54" name="__codelineno-132-54"></a><a href="#__codelineno-132-54"><span class="linenos" data-linenos="54 "></span></a><span class="w">    </span><span class="m">11</span>:04:8e:2f:2e:5e:92:a4:e3:09:49:97:d0:41:49:
<a id="__codelineno-132-55" name="__codelineno-132-55"></a><a href="#__codelineno-132-55"><span class="linenos" data-linenos="55 "></span></a><span class="w">    </span>cc:f8:fd:3d:b7:6c:fb:ac:7d:f0:e1:02:ce:61:b7:
<a id="__codelineno-132-56" name="__codelineno-132-56"></a><a href="#__codelineno-132-56"><span class="linenos" data-linenos="56 "></span></a><span class="w">    </span>c4:9d:db:75:23:f3:0c:85:f5:9b:ed:af:7a:23:f0:
<a id="__codelineno-132-57" name="__codelineno-132-57"></a><a href="#__codelineno-132-57"><span class="linenos" data-linenos="57 "></span></a><span class="w">    </span>9f:c3:d9:96:e3:c4:48:52:b9:38:31:4b:55:fc:fa:
<a id="__codelineno-132-58" name="__codelineno-132-58"></a><a href="#__codelineno-132-58"><span class="linenos" data-linenos="58 "></span></a><span class="w">    </span>bb:6c:ac:f4:bf:3a:bf:0c:19:c0:e3:89:c0:b1:ae:
<a id="__codelineno-132-59" name="__codelineno-132-59"></a><a href="#__codelineno-132-59"><span class="linenos" data-linenos="59 "></span></a><span class="w">    </span>3a:6d:bf:72:b2:32:7a:f9:f7:27:2d:63:4b:5b:3e:
<a id="__codelineno-132-60" name="__codelineno-132-60"></a><a href="#__codelineno-132-60"><span class="linenos" data-linenos="60 "></span></a><span class="w">    </span>0e:f7:eb:c1:78:56:86:3e:63
<a id="__codelineno-132-61" name="__codelineno-132-61"></a><a href="#__codelineno-132-61"><span class="linenos" data-linenos="61 "></span></a>exponent1:
<a id="__codelineno-132-62" name="__codelineno-132-62"></a><a href="#__codelineno-132-62"><span class="linenos" data-linenos="62 "></span></a><span class="w">    </span>7e:be:74:b0:b2:b9:94:a4:24:d7:d5:11:21:3c:a1:
<a id="__codelineno-132-63" name="__codelineno-132-63"></a><a href="#__codelineno-132-63"><span class="linenos" data-linenos="63 "></span></a><span class="w">    </span><span class="m">59</span>:d4:d7:f1:12:a9:8d:99:e0:14:b5:2e:8d:30:a8:
<a id="__codelineno-132-64" name="__codelineno-132-64"></a><a href="#__codelineno-132-64"><span class="linenos" data-linenos="64 "></span></a><span class="w">    </span>c4:f6:3c:43:05:ea:94:60:e2:6e:f2:b7:a0:0b:df:
<a id="__codelineno-132-65" name="__codelineno-132-65"></a><a href="#__codelineno-132-65"><span class="linenos" data-linenos="65 "></span></a><span class="w">    </span>f5:ed:9c:8b:73:45:c2:9f:62:47:4c:26:ad:de:23:
<a id="__codelineno-132-66" name="__codelineno-132-66"></a><a href="#__codelineno-132-66"><span class="linenos" data-linenos="66 "></span></a><span class="w">    </span>c5:fa:7e:c9:e2:15:57:65:1e:de:c1:2e:e0:3a:27:
<a id="__codelineno-132-67" name="__codelineno-132-67"></a><a href="#__codelineno-132-67"><span class="linenos" data-linenos="67 "></span></a><span class="w">    </span><span class="m">22</span>:3c:05:50:0f:29:b2:c8:e2:58:32:1f:e3:da:ca:
<a id="__codelineno-132-68" name="__codelineno-132-68"></a><a href="#__codelineno-132-68"><span class="linenos" data-linenos="68 "></span></a><span class="w">    </span>c4:2e:5f:8a:7b:05:b6:4e:fb:42:99:c9:1c:2f:07:
<a id="__codelineno-132-69" name="__codelineno-132-69"></a><a href="#__codelineno-132-69"><span class="linenos" data-linenos="69 "></span></a><span class="w">    </span>ee:ac:a4:4e:7a:70:97:35:ee:2c:93:9b:79:9c:8d:
<a id="__codelineno-132-70" name="__codelineno-132-70"></a><a href="#__codelineno-132-70"><span class="linenos" data-linenos="70 "></span></a><span class="w">    </span><span class="m">73</span>:1f:62:8e:d5:77:05:11
<a id="__codelineno-132-71" name="__codelineno-132-71"></a><a href="#__codelineno-132-71"><span class="linenos" data-linenos="71 "></span></a>exponent2:
<a id="__codelineno-132-72" name="__codelineno-132-72"></a><a href="#__codelineno-132-72"><span class="linenos" data-linenos="72 "></span></a><span class="w">    </span>7f:43:78:3f:e5:3f:20:6e:e5:3b:0a:2a:97:c3:0c:
<a id="__codelineno-132-73" name="__codelineno-132-73"></a><a href="#__codelineno-132-73"><span class="linenos" data-linenos="73 "></span></a><span class="w">    </span><span class="m">68</span>:78:1c:90:6f:90:68:5d:b7:79:3e:8c:b9:5d:bb:
<a id="__codelineno-132-74" name="__codelineno-132-74"></a><a href="#__codelineno-132-74"><span class="linenos" data-linenos="74 "></span></a><span class="w">    </span><span class="m">71</span>:84:0c:63:ff:70:19:cb:1d:53:6e:c5:f2:0e:51:
<a id="__codelineno-132-75" name="__codelineno-132-75"></a><a href="#__codelineno-132-75"><span class="linenos" data-linenos="75 "></span></a><span class="w">    </span>7e:e0:82:f3:24:80:cb:8d:54:3d:ca:15:5c:d4:43:
<a id="__codelineno-132-76" name="__codelineno-132-76"></a><a href="#__codelineno-132-76"><span class="linenos" data-linenos="76 "></span></a><span class="w">    </span>a9:5b:fb:dd:c8:3d:9d:15:a0:b9:8f:a7:b8:10:96:
<a id="__codelineno-132-77" name="__codelineno-132-77"></a><a href="#__codelineno-132-77"><span class="linenos" data-linenos="77 "></span></a><span class="w">    </span>a1:85:54:c4:89:21:9b:b3:36:8e:ee:f8:4c:1d:d1:
<a id="__codelineno-132-78" name="__codelineno-132-78"></a><a href="#__codelineno-132-78"><span class="linenos" data-linenos="78 "></span></a><span class="w">    </span><span class="m">07</span>:60:7c:eb:87:2f:ce:4d:36:a8:27:cd:c8:90:23:
<a id="__codelineno-132-79" name="__codelineno-132-79"></a><a href="#__codelineno-132-79"><span class="linenos" data-linenos="79 "></span></a><span class="w">    </span><span class="m">70</span>:db:ca:c5:91:4d:4f:42:2b:e3:35:73:f1:ad:66:
<a id="__codelineno-132-80" name="__codelineno-132-80"></a><a href="#__codelineno-132-80"><span class="linenos" data-linenos="80 "></span></a><span class="w">    </span>f2:7c:17:43:b6:03:3f:3d
<a id="__codelineno-132-81" name="__codelineno-132-81"></a><a href="#__codelineno-132-81"><span class="linenos" data-linenos="81 "></span></a>coefficient:
<a id="__codelineno-132-82" name="__codelineno-132-82"></a><a href="#__codelineno-132-82"><span class="linenos" data-linenos="82 "></span></a><span class="w">    </span><span class="m">20</span>:ba:41:01:b4:c7:61:a0:69:75:7a:cd:e1:ac:42:
<a id="__codelineno-132-83" name="__codelineno-132-83"></a><a href="#__codelineno-132-83"><span class="linenos" data-linenos="83 "></span></a><span class="w">    </span>9b:dc:1b:27:31:09:96:4d:0f:bf:d0:6f:35:79:72:
<a id="__codelineno-132-84" name="__codelineno-132-84"></a><a href="#__codelineno-132-84"><span class="linenos" data-linenos="84 "></span></a><span class="w">    </span>e4:b8:94:ff:12:6c:82:9a:4f:fe:09:8f:f4:d9:94:
<a id="__codelineno-132-85" name="__codelineno-132-85"></a><a href="#__codelineno-132-85"><span class="linenos" data-linenos="85 "></span></a><span class="w">    </span><span class="m">37</span>:c4:0a:9a:9d:dd:9b:13:3d:51:bd:fa:0d:81:a9:
<a id="__codelineno-132-86" name="__codelineno-132-86"></a><a href="#__codelineno-132-86"><span class="linenos" data-linenos="86 "></span></a><span class="w">    </span><span class="m">65</span>:1c:8f:29:b2:9f:8c:a4:1f:4a:b6:8b:5f:0a:24:
<a id="__codelineno-132-87" name="__codelineno-132-87"></a><a href="#__codelineno-132-87"><span class="linenos" data-linenos="87 "></span></a><span class="w">    </span>af:b6:88:9b:88:dc:ec:ec:34:34:10:60:4e:c7:d2:
<a id="__codelineno-132-88" name="__codelineno-132-88"></a><a href="#__codelineno-132-88"><span class="linenos" data-linenos="88 "></span></a><span class="w">    </span><span class="m">11</span>:aa:93:81:88:98:f5:ac:5c:a9:a6:12:f4:8e:62:
<a id="__codelineno-132-89" name="__codelineno-132-89"></a><a href="#__codelineno-132-89"><span class="linenos" data-linenos="89 "></span></a><span class="w">    </span>c9:f4:19:b7:d2:a5:fe:12:57:e9:a4:fd:b3:63:3e:
<a id="__codelineno-132-90" name="__codelineno-132-90"></a><a href="#__codelineno-132-90"><span class="linenos" data-linenos="90 "></span></a><span class="w">    </span>0d:07:dc:87:36:85:5a:44
</code></pre></div>
<p>经过对比可以知道，结构为</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1"></a><a href="#__codelineno-133-1"><span class="linenos" data-linenos=" 1 "></span></a>RSAPrivateKey ::= SEQUENCE {
<a id="__codelineno-133-2" name="__codelineno-133-2"></a><a href="#__codelineno-133-2"><span class="linenos" data-linenos=" 2 "></span></a> version Version,
<a id="__codelineno-133-3" name="__codelineno-133-3"></a><a href="#__codelineno-133-3"><span class="linenos" data-linenos=" 3 "></span></a> modulus INTEGER, -- n
<a id="__codelineno-133-4" name="__codelineno-133-4"></a><a href="#__codelineno-133-4"><span class="linenos" data-linenos=" 4 "></span></a> publicExponent INTEGER, -- e
<a id="__codelineno-133-5" name="__codelineno-133-5"></a><a href="#__codelineno-133-5"><span class="linenos" data-linenos=" 5 "></span></a> privateExponent INTEGER, -- d
<a id="__codelineno-133-6" name="__codelineno-133-6"></a><a href="#__codelineno-133-6"><span class="linenos" data-linenos=" 6 "></span></a> prime1 INTEGER, -- p
<a id="__codelineno-133-7" name="__codelineno-133-7"></a><a href="#__codelineno-133-7"><span class="linenos" data-linenos=" 7 "></span></a> prime2 INTEGER, -- q
<a id="__codelineno-133-8" name="__codelineno-133-8"></a><a href="#__codelineno-133-8"><span class="linenos" data-linenos=" 8 "></span></a> exponent1 INTEGER, -- d mod (p-1)
<a id="__codelineno-133-9" name="__codelineno-133-9"></a><a href="#__codelineno-133-9"><span class="linenos" data-linenos=" 9 "></span></a> exponent2 INTEGER, -- d mod (q-1)
<a id="__codelineno-133-10" name="__codelineno-133-10"></a><a href="#__codelineno-133-10"><span class="linenos" data-linenos="10 "></span></a> coefficient INTEGER -- (inverse of q) mod p 
<a id="__codelineno-133-11" name="__codelineno-133-11"></a><a href="#__codelineno-133-11"><span class="linenos" data-linenos="11 "></span></a>}
</code></pre></div>
<p>2048bit的私钥文件和1024bit的私钥文件对比</p>
<table>
<thead>
<tr>
<th>2048</th>
<th>02820101(n)</th>
<th>0203(e)</th>
<th>028201(d)</th>
<th>028181(p)</th>
<th>028181(q)</th>
<th>028180(d % (p-1))</th>
<th>028180(d % (q-1))</th>
<th>028180(invert(q,p))</th>
</tr>
</thead>
<tbody>
<tr>
<td>1024</td>
<td>028181(n)</td>
<td>0203(e)</td>
<td>028180(d)</td>
<td>024100(p)</td>
<td>024100(q)</td>
<td>0240</td>
<td>0240</td>
<td>0240</td>
</tr>
</tbody>
</table>
<p>这个表也没权威性，找参数就找02这样的分隔符就好了。</p>
<h3 id="nssctfround16break">NSSCTFRound16——break<a class="headerlink" href="#nssctfround16break" title="Permanent link">&para;</a></h3>
<p>题目给出如下文件:</p>
<blockquote>
<p>pri-break.pem</p>
</blockquote>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1"></a><a href="#__codelineno-134-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="n">Bc8tSTrvGJm2oYuCzIz</span><span class="o">+</span><span class="n">Yg4nwwKBgQDiYUawe5Y</span><span class="o">+</span><span class="n">rPbFhVOMVB8ZByfMa4LjeSDd</span>
<a id="__codelineno-134-2" name="__codelineno-134-2"></a><a href="#__codelineno-134-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="n">Z23jEGvylBHSeyvFCQq3ISUE40k1D2XmmeaZML3a1nUn6ORIWGaG2phcwrWLkR6n</span>
<a id="__codelineno-134-3" name="__codelineno-134-3"></a><a href="#__codelineno-134-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">ubVmb1QJSzgzmFHGnL56KHByZxD9q6DPB</span><span class="o">+</span><span class="n">o6gGWt8</span><span class="o">/</span><span class="mi">6</span><span class="n">ddBl2NIZU</span><span class="o">/</span><span class="mi">1</span><span class="n">btdPQgojfA</span>
<a id="__codelineno-134-4" name="__codelineno-134-4"></a><a href="#__codelineno-134-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">XXJFzR92RQKBgQC7qlB0U7m2U4FdG9eelSd</span><span class="o">+</span><span class="n">WSKNUVllZAuHji7jgh7Ox6La9xN5</span>
<a id="__codelineno-134-5" name="__codelineno-134-5"></a><a href="#__codelineno-134-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">miGZ1yvP44yX218OJ9Zi08o6vIrM6Eil45KzTtGm4iuIn8CMpox</span><span class="o">+</span><span class="mi">5</span><span class="n">eUtoxyvxa9r</span>
<a id="__codelineno-134-6" name="__codelineno-134-6"></a><a href="#__codelineno-134-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">s2Wu</span><span class="o">+</span><span class="n">IRZN9zCME</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="n">qI8</span><span class="o">/</span><span class="n">TG27dIyDzsdgNqcUo8ESls7uW5</span><span class="o">/</span><span class="n">FEA7bYTCiQKBgQC7</span>
<a id="__codelineno-134-7" name="__codelineno-134-7"></a><a href="#__codelineno-134-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="mi">1</span><span class="n">KybeB</span><span class="o">+</span><span class="n">kZ0zlfIdi8tVOpeI</span><span class="o">+</span><span class="n">uaHDbdh3</span><span class="o">+/</span><span class="mi">5</span><span class="n">wHUsD3hmfg7VAag0q</span><span class="o">/</span><span class="mi">2</span><span class="n">RA1vkB</span><span class="o">/</span><span class="n">oG1</span>
<a id="__codelineno-134-8" name="__codelineno-134-8"></a><a href="#__codelineno-134-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">QVLVHl0Yu0I</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="n">u5jyeakrtClAegAsvlrK</span><span class="o">+</span><span class="mi">3</span><span class="n">i321rGS4YpTPb3SX1P</span><span class="o">/</span><span class="n">f3GZ7o7Ds</span>
<a id="__codelineno-134-9" name="__codelineno-134-9"></a><a href="#__codelineno-134-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">touA</span><span class="o">+</span><span class="n">NHk8IL9T7xkmJYw5h</span><span class="o">/</span><span class="n">RLG32ucH6aU6MXfLR5QKBgD</span><span class="o">/</span><span class="n">skfdFxGWxhHk6U1mS</span>
<a id="__codelineno-134-10" name="__codelineno-134-10"></a><a href="#__codelineno-134-10"><span class="linenos" data-linenos="10 "></span></a><span class="mi">27</span><span class="n">IM9jJNg9xLz5nxzkqPPhLn</span><span class="o">+</span><span class="n">rdgIIuTuQtv</span><span class="o">++</span><span class="n">eEjEP</span><span class="o">++</span><span class="mi">7</span><span class="n">ZV10rg5yKVJd</span><span class="o">/</span><span class="n">bxy8H</span>
<a id="__codelineno-134-11" name="__codelineno-134-11"></a><a href="#__codelineno-134-11"><span class="linenos" data-linenos="11 "></span></a><span class="mi">2</span><span class="n">IN7aQo7kZWulHTQDZMFwgOhn0u6glJi</span><span class="o">+</span><span class="n">qC8bWzYDFOQSFrY9XQ3vwKMspqm</span><span class="o">+</span><span class="mi">697</span>
<a id="__codelineno-134-12" name="__codelineno-134-12"></a><a href="#__codelineno-134-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">xM</span><span class="o">+</span><span class="n">dMUW0LML6oUE9ZjEiAY</span><span class="o">/</span><span class="mi">5</span>
<a id="__codelineno-134-13" name="__codelineno-134-13"></a><a href="#__codelineno-134-13"><span class="linenos" data-linenos="13 "></span></a><span class="o">-----</span><span class="n">END</span> <span class="n">PRIVATE</span> <span class="n">KEY</span><span class="o">-----</span>
</code></pre></div>
<blockquote>
<p>cipher.txt</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1"></a><a href="#__codelineno-135-1"><span class="linenos" data-linenos="1 "></span></a>6081370370545409218106271903400346695565292992689150366474451604281551878507114813906275593034729563149286993189430514737137534129570304832172520820901940874698337733991868650159489601159238582002010625666203730677577976307606665760650563172302688129824842780090723167480409842707790983962415315804311334507726664838464859751689906850572044873633896253285381878416855505301919877714965930289139921111644393144686543207867970807469735534838601255712764863973853116693691206791007433101433703535127367245739289103650669095061417223994665200039533840922696282929063608853551346533188464573323230476645532002621795338655
</code></pre></div>
<p>cipher中这个值是2046bit，可以推出n是2048bit的</p>
<p>这个私钥文件的内容转成16进制得到</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1"></a><a href="#__codelineno-136-1"><span class="linenos" data-linenos=" 1 "></span></a>        05 cf 2d 49 3a ef 18 99 b6 a1 8b 82 cc 8c fe 62 0e 27 c3 
<a id="__codelineno-136-2" name="__codelineno-136-2"></a><a href="#__codelineno-136-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-136-3" name="__codelineno-136-3"></a><a href="#__codelineno-136-3"><span class="linenos" data-linenos=" 3 "></span></a>    02 81 81 00 
<a id="__codelineno-136-4" name="__codelineno-136-4"></a><a href="#__codelineno-136-4"><span class="linenos" data-linenos=" 4 "></span></a>        e2 61 46 b0 7b 96 3e ac f6 c5 85 53 8c 54 1f 19 07 27 cc 6b 82 e3 79 20 dd 67 6d e3 10 6b f2 94 11 d2 7b 2b c5 09 0a b7 21 25 04 e3 49 35 0f 65 e6 99 e6 99 30 bd da d6 75 27 e8 e4 48 58 66 86 da 98 5c c2 b5 8b 91 1e a7 b9 b5 66 6f 54 09 4b 38 33 98 51 c6 9c be 7a 28 70 72 67 10 fd ab a0 cf 07 ea 3a 80 65 ad f3 fe 9d 74 19 76 34 86 54 ff 56 ed 74 f4 20 a2 37 c0 5d 72 45 cd 1f 76 45 
<a id="__codelineno-136-5" name="__codelineno-136-5"></a><a href="#__codelineno-136-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-136-6" name="__codelineno-136-6"></a><a href="#__codelineno-136-6"><span class="linenos" data-linenos=" 6 "></span></a>    02 81 81 00 
<a id="__codelineno-136-7" name="__codelineno-136-7"></a><a href="#__codelineno-136-7"><span class="linenos" data-linenos=" 7 "></span></a>        bb aa 50 74 53 b9 b6 53 81 5d 1b d7 9e 95 27 7e 59 22 8d 51 59 65 64 0b 87 8e 2e e3 82 1e ce c7 a2 da f7 13 79 9a 21 99 d7 2b cf e3 8c 97 db 5f 0e 27 d6 62 d3 ca 3a bc 8a cc e8 48 a5 e3 92 b3 4e d1 a6 e2 2b 88 9f c0 8c a6 8c 7e e5 e5 2d a3 1c af c5 af 6b b3 65 ae f8 84 59 37 dc c2 30 4f a9 fa a2 3c fd 31 b6 ed d2 32 0f 3b 1d 80 da 9c 52 8f 04 4a 5b 3b b9 6e 7f 14 40 3b 6d 84 c2 89 
<a id="__codelineno-136-8" name="__codelineno-136-8"></a><a href="#__codelineno-136-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-136-9" name="__codelineno-136-9"></a><a href="#__codelineno-136-9"><span class="linenos" data-linenos=" 9 "></span></a>    02 81 81 00 
<a id="__codelineno-136-10" name="__codelineno-136-10"></a><a href="#__codelineno-136-10"><span class="linenos" data-linenos="10 "></span></a>        bb d4 ac 9b 78 1f a4 67 4c e5 7c 87 62 f2 d5 4e a5 e2 3e b9 a1 c3 6d d8 77 fb fe 70 1d 4b 03 de 19 9f 83 b5 40 6a 0d 2a ff 64 40 d6 f9 01 fe 81 b5 41 52 d5 1e 5d 18 bb 42 3f d7 fb b9 8f 27 9a 92 bb 42 94 07 a0 02 cb e5 ac af b7 8b 7d b5 ac 64 b8 62 94 cf 6f 74 97 d4 ff df dc 66 7b a3 b0 ec b6 8b 80 f8 d1 e4 f0 82 fd 4f bc 64 98 96 30 e6 1f d1 2c 6d f6 b9 c1 fa 69 4e 8c 5d f2 d1 e5 
<a id="__codelineno-136-11" name="__codelineno-136-11"></a><a href="#__codelineno-136-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-136-12" name="__codelineno-136-12"></a><a href="#__codelineno-136-12"><span class="linenos" data-linenos="12 "></span></a>    02 81 80 
<a id="__codelineno-136-13" name="__codelineno-136-13"></a><a href="#__codelineno-136-13"><span class="linenos" data-linenos="13 "></span></a>        3f ec 91 f7 45 c4 65 b1 84 79 3a 53 59 92 db b2 0c f6 32 4d 83 dc 4b cf 99 f1 ce 4a 8f 3e 12 e7 fa b7 60 20 8b 93 b9 0b 6f fb e7 84 8c 43 fe fb b6 55 d7 4a e0 e7 22 95 25 df db c7 2f 07 d8 83 7b 69 0a 3b 91 95 ae 94 74 d0 0d 93 05 c2 03 a1 9f 4b ba 82 52 62 fa a0 bc 6d 6c d8 0c 53 90 48 5a d8 f5 74 37 bf 02 8c b2 9a a6 fb af 7b c4 cf 9d 31 45 b4 2c c2 fa a1 41 3d 66 31 22 01 8f f9
</code></pre></div>
<p>我们已知<span class="arithmatex">\(q,d_p,d_q,q^{-1}\)</span></p>
<p>直接用<span class="arithmatex">\(m = c^{d_p} \mod p\)</span>解即可</p>
<blockquote>
<p>exp</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1"></a><a href="#__codelineno-137-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-137-2" name="__codelineno-137-2"></a><a href="#__codelineno-137-2"><span class="linenos" data-linenos=" 2 "></span></a>
<a id="__codelineno-137-3" name="__codelineno-137-3"></a><a href="#__codelineno-137-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="n">q</span> <span class="o">=</span> <span class="mh">0xe26146b07b963eacf6c585538c541f190727cc6b82e37920dd676de3106bf29411d27b2bc5090ab7212504e349350f65e699e69930bddad67527e8e448586686da985cc2b58b911ea7b9b5666f54094b38339851c69cbe7a2870726710fdaba0cf07ea3a8065adf3fe9d741976348654ff56ed74f420a237c05d7245cd1f7645</span>
<a id="__codelineno-137-4" name="__codelineno-137-4"></a><a href="#__codelineno-137-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="n">dp</span> <span class="o">=</span> <span class="mh">0xbbaa507453b9b653815d1bd79e95277e59228d515965640b878e2ee3821ecec7a2daf713799a2199d72bcfe38c97db5f0e27d662d3ca3abc8acce848a5e392b34ed1a6e22b889fc08ca68c7ee5e52da31cafc5af6bb365aef8845937dcc2304fa9faa23cfd31b6edd2320f3b1d80da9c528f044a5b3bb96e7f14403b6d84c289</span>
<a id="__codelineno-137-5" name="__codelineno-137-5"></a><a href="#__codelineno-137-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="n">dq</span> <span class="o">=</span> <span class="mh">0xbbd4ac9b781fa4674ce57c8762f2d54ea5e23eb9a1c36dd877fbfe701d4b03de199f83b5406a0d2aff6440d6f901fe81b54152d51e5d18bb423fd7fbb98f279a92bb429407a002cbe5acafb78b7db5ac64b86294cf6f7497d4ffdfdc667ba3b0ecb68b80f8d1e4f082fd4fbc64989630e61fd12c6df6b9c1fa694e8c5df2d1e5</span>
<a id="__codelineno-137-6" name="__codelineno-137-6"></a><a href="#__codelineno-137-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">inv</span> <span class="o">=</span> <span class="mh">0x3fec91f745c465b184793a535992dbb20cf6324d83dc4bcf99f1ce4a8f3e12e7fab760208b93b90b6ffbe7848c43fefbb655d74ae0e7229525dfdbc72f07d8837b690a3b9195ae9474d00d9305c203a19f4bba825262faa0bc6d6cd80c5390485ad8f57437bf028cb29aa6fbaf7bc4cf9d3145b42cc2faa1413d663122018ff9</span>
<a id="__codelineno-137-7" name="__codelineno-137-7"></a><a href="#__codelineno-137-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">6081370370545409218106271903400346695565292992689150366474451604281551878507114813906275593034729563149286993189430514737137534129570304832172520820901940874698337733991868650159489601159238582002010625666203730677577976307606665760650563172302688129824842780090723167480409842707790983962415315804311334507726664838464859751689906850572044873633896253285381878416855505301919877714965930289139921111644393144686543207867970807469735534838601255712764863973853116693691206791007433101433703535127367245739289103650669095061417223994665200039533840922696282929063608853551346533188464573323230476645532002621795338655</span>
<a id="__codelineno-137-8" name="__codelineno-137-8"></a><a href="#__codelineno-137-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-137-9" name="__codelineno-137-9"></a><a href="#__codelineno-137-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">dq</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-137-10" name="__codelineno-137-10"></a><a href="#__codelineno-137-10"><span class="linenos" data-linenos="10 "></span></a><span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
<a id="__codelineno-137-11" name="__codelineno-137-11"></a><a href="#__codelineno-137-11"><span class="linenos" data-linenos="11 "></span></a><span class="c1">## flag{oi!_you_find___what_i_Wa1t_talK_y0n!!!}</span>
</code></pre></div>
<h3 id="2022corrupted_key">2022蓝帽杯——corrupted_key<a class="headerlink" href="#2022corrupted_key" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1"></a><a href="#__codelineno-138-1"><span class="linenos" data-linenos="1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-138-2" name="__codelineno-138-2"></a><a href="#__codelineno-138-2"><span class="linenos" data-linenos="2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<a id="__codelineno-138-3" name="__codelineno-138-3"></a><a href="#__codelineno-138-3"><span class="linenos" data-linenos="3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-138-4" name="__codelineno-138-4"></a><a href="#__codelineno-138-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-138-5" name="__codelineno-138-5"></a><a href="#__codelineno-138-5"><span class="linenos" data-linenos="5 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-138-6" name="__codelineno-138-6"></a><a href="#__codelineno-138-6"><span class="linenos" data-linenos="6 "></span></a><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.enc&quot;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">publickey</span><span class="p">())</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
<a id="__codelineno-138-7" name="__codelineno-138-7"></a><a href="#__codelineno-138-7"><span class="linenos" data-linenos="7 "></span></a><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;priv.pem&#39;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">exportKey</span><span class="p">(</span><span class="s1">&#39;PEM&#39;</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>priv.pem</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1"></a><a href="#__codelineno-139-1"><span class="linenos" data-linenos=" 1 "></span></a>-----BEGIN RSA PRIVATE KEY-----
<a id="__codelineno-139-2" name="__codelineno-139-2"></a><a href="#__codelineno-139-2"><span class="linenos" data-linenos=" 2 "></span></a>MIICXgIBAAKBgQDXFSUGqpzsBeUzXWtG9UkUB8MZn9UQkfH2Aw03YrngP0nJ3NwH
<a id="__codelineno-139-3" name="__codelineno-139-3"></a><a href="#__codelineno-139-3"><span class="linenos" data-linenos=" 3 "></span></a>UFTgzBSLl0tBhUvZO07haiqHbuYgBegO+Aa3qjtksb+bH6dz41PQzbn/l4Pd1fXm
<a id="__codelineno-139-4" name="__codelineno-139-4"></a><a href="#__codelineno-139-4"><span class="linenos" data-linenos=" 4 "></span></a>dJmtEPNh6TjQC4KmpMQqBTXF52cheY6GtFzUuNA7DX51wr6HZqHoQ73GQQIDAQAB
<a id="__codelineno-139-5" name="__codelineno-139-5"></a><a href="#__codelineno-139-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-139-6" name="__codelineno-139-6"></a><a href="#__codelineno-139-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-139-7" name="__codelineno-139-7"></a><a href="#__codelineno-139-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-139-8" name="__codelineno-139-8"></a><a href="#__codelineno-139-8"><span class="linenos" data-linenos=" 8 "></span></a>
<a id="__codelineno-139-9" name="__codelineno-139-9"></a><a href="#__codelineno-139-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-139-10" name="__codelineno-139-10"></a><a href="#__codelineno-139-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-139-11" name="__codelineno-139-11"></a><a href="#__codelineno-139-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-139-12" name="__codelineno-139-12"></a><a href="#__codelineno-139-12"><span class="linenos" data-linenos="12 "></span></a>
<a id="__codelineno-139-13" name="__codelineno-139-13"></a><a href="#__codelineno-139-13"><span class="linenos" data-linenos="13 "></span></a>yQvOzxy6szWFheigQdGxAkEA4wFss2CcHWQ8FnQ5w7k4uIH0I38khg07HLhaYm1c
<a id="__codelineno-139-14" name="__codelineno-139-14"></a><a href="#__codelineno-139-14"><span class="linenos" data-linenos="14 "></span></a>zUcmlk4PgnDWxN+ev+vMU45O5eGntzaO3lHsaukX9461mA==
<a id="__codelineno-139-15" name="__codelineno-139-15"></a><a href="#__codelineno-139-15"><span class="linenos" data-linenos="15 "></span></a>-----END RSA PRIVATE KEY-----
</code></pre></div>
<p>把已有的内容进行解码，可以得到<span class="arithmatex">\(n,e\)</span>，inverse(q,p)，以及<span class="arithmatex">\(d_q\)</span>的低120位</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1"></a><a href="#__codelineno-140-1"><span class="linenos" data-linenos="1 "></span></a>30 82 02 5e 
<a id="__codelineno-140-2" name="__codelineno-140-2"></a><a href="#__codelineno-140-2"><span class="linenos" data-linenos="2 "></span></a>    02 01 
<a id="__codelineno-140-3" name="__codelineno-140-3"></a><a href="#__codelineno-140-3"><span class="linenos" data-linenos="3 "></span></a>        00 
<a id="__codelineno-140-4" name="__codelineno-140-4"></a><a href="#__codelineno-140-4"><span class="linenos" data-linenos="4 "></span></a>
<a id="__codelineno-140-5" name="__codelineno-140-5"></a><a href="#__codelineno-140-5"><span class="linenos" data-linenos="5 "></span></a>    02 81 81 00 
<a id="__codelineno-140-6" name="__codelineno-140-6"></a><a href="#__codelineno-140-6"><span class="linenos" data-linenos="6 "></span></a>        d7 15 25 06 aa 9c ec 05 e5 33 5d 6b 46 f5 49 14 07 c3 19 9f d5 10 91 f1 f6 03 0d 37 62 b9 e0 3f 49 c9 dc dc 07 50 54 e0 cc 14 8b 97 4b 41 85 4b d9 3b 4e e1 6a 2a 87 6e e6 20 05 e8 0e f8 06 b7 aa 3b 64 b1 bf 9b 1f a7 73 e3 53 d0 cd b9 ff 97 83 dd d5 f5 e6 74 99 ad 10 f3 61 e9 38 d0 0b 82 a6 a4 c4 2a 05 35 c5 e7 67 21 79 8e 86 b4 5c d4 b8 d0 3b 0d 7e 75 c2 be 87 66 a1 e8 43 bd c6 41 
<a id="__codelineno-140-7" name="__codelineno-140-7"></a><a href="#__codelineno-140-7"><span class="linenos" data-linenos="7 "></span></a>
<a id="__codelineno-140-8" name="__codelineno-140-8"></a><a href="#__codelineno-140-8"><span class="linenos" data-linenos="8 "></span></a>    02 03 
<a id="__codelineno-140-9" name="__codelineno-140-9"></a><a href="#__codelineno-140-9"><span class="linenos" data-linenos="9 "></span></a>        01 00 01
</code></pre></div>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1"></a><a href="#__codelineno-141-1"><span class="linenos" data-linenos="1 "></span></a>c9 0b ce cf 1c ba b3 35 85 85 e8 a0 41 d1 b1 
<a id="__codelineno-141-2" name="__codelineno-141-2"></a><a href="#__codelineno-141-2"><span class="linenos" data-linenos="2 "></span></a>
<a id="__codelineno-141-3" name="__codelineno-141-3"></a><a href="#__codelineno-141-3"><span class="linenos" data-linenos="3 "></span></a>    02 41 00 
<a id="__codelineno-141-4" name="__codelineno-141-4"></a><a href="#__codelineno-141-4"><span class="linenos" data-linenos="4 "></span></a>        e3 01 6c b3 60 9c 1d 64 3c 16 74 39 c3 b9 38 b8 81 f4 23 7f 24 86 0d 3b 1c b8 5a 62 6d 5c cd 47 26 96 4e 0f 82 70 d6 c4 df 9e bf eb cc 53 8e 4e e5 e1 a7 b7 36 8e de 51 ec 6a e9 17 f7 8e b5 98
</code></pre></div>
<div class="arithmatex">\[
\because d_q \equiv d \mod q-1
\]</div>
<div class="arithmatex">\[
\therefore d_q = d + k(q-1)
\]</div>
<p>两边同乘e</p>
<div class="arithmatex">\[
ed_q = ed + ke(q-1)
\]</div>
<div class="arithmatex">\[
\because ed = k_1(p-1)(q-1) + 1
\]</div>
<div class="arithmatex">\[
\therefore ed_q = k_2(q-1) + 1
\]</div>
<p>即</p>
<div class="arithmatex">\[
ed_q + k_2 - 1 = k_2q
\]</div>
<div class="arithmatex">\[
\therefore ed_q + k_2 -1 \equiv k_2q \mod 2^{120}
\]</div>
<div class="arithmatex">\[
\because dq &lt; q-1 
\]</div>
<div class="arithmatex">\[
\therefore e &gt; k
\]</div>
<p>枚举k，解方程即求出所有<span class="arithmatex">\(q\)</span>的低120位的可能取值</p>
<div class="arithmatex">\[
\because inv ×q \equiv 1 \mod p 
\]</div>
<div class="arithmatex">\[
inv\times q -1 = kp
\]</div>
<p>两边同乘q得到</p>
<div class="arithmatex">\[
inv \times q\times q -q = kn
\]</div>
<p>即</p>
<div class="arithmatex">\[
inv \times q^2 - q \equiv 0 \mod n
\]</div>
<p>然后用coper求解</p>
<blockquote>
<p>exp.sage</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1"></a><a href="#__codelineno-142-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="c1">#sage</span>
<a id="__codelineno-142-2" name="__codelineno-142-2"></a><a href="#__codelineno-142-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-142-3" name="__codelineno-142-3"></a><a href="#__codelineno-142-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<a id="__codelineno-142-4" name="__codelineno-142-4"></a><a href="#__codelineno-142-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">gmpy2</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-142-5" name="__codelineno-142-5"></a><a href="#__codelineno-142-5"><span class="linenos" data-linenos=" 5 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-142-6" name="__codelineno-142-6"></a><a href="#__codelineno-142-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-142-7" name="__codelineno-142-7"></a><a href="#__codelineno-142-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mh">0xd7152506aa9cec05e5335d6b46f5491407c3199fd51091f1f6030d3762b9e03f49c9dcdc075054e0cc148b974b41854bd93b4ee16a2a876ee62005e80ef806b7aa3b64b1bf9b1fa773e353d0cdb9ff9783ddd5f5e67499ad10f361e938d00b82a6a4c42a0535c5e76721798e86b45cd4b8d03b0d7e75c2be8766a1e843bdc641</span>
<a id="__codelineno-142-8" name="__codelineno-142-8"></a><a href="#__codelineno-142-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mh">0x10001</span>
<a id="__codelineno-142-9" name="__codelineno-142-9"></a><a href="#__codelineno-142-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">inv</span> <span class="o">=</span> <span class="mh">0xe3016cb3609c1d643c167439c3b938b881f4237f24860d3b1cb85a626d5ccd4726964e0f8270d6c4df9ebfebcc538e4ee5e1a7b7368ede51ec6ae917f78eb598</span>
<a id="__codelineno-142-10" name="__codelineno-142-10"></a><a href="#__codelineno-142-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">d_low</span> <span class="o">=</span> <span class="mh">0xc90bcecf1cbab3358585e8a041d1b1</span>
<a id="__codelineno-142-11" name="__codelineno-142-11"></a><a href="#__codelineno-142-11"><span class="linenos" data-linenos="11 "></span></a><span class="n">q_low</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-142-12" name="__codelineno-142-12"></a><a href="#__codelineno-142-12"><span class="linenos" data-linenos="12 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.enc&quot;</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-142-13" name="__codelineno-142-13"></a><a href="#__codelineno-142-13"><span class="linenos" data-linenos="13 "></span></a>
<a id="__codelineno-142-14" name="__codelineno-142-14"></a><a href="#__codelineno-142-14"><span class="linenos" data-linenos="14 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-142-15" name="__codelineno-142-15"></a><a href="#__codelineno-142-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-142-16" name="__codelineno-142-16"></a><a href="#__codelineno-142-16"><span class="linenos" data-linenos="16 "></span></a>        <span class="n">q0</span> <span class="o">=</span> <span class="n">invert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">120</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">*</span> <span class="n">d_low</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">^</span> <span class="mi">120</span>
<a id="__codelineno-142-17" name="__codelineno-142-17"></a><a href="#__codelineno-142-17"><span class="linenos" data-linenos="17 "></span></a>        <span class="n">q_low</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span>
<a id="__codelineno-142-18" name="__codelineno-142-18"></a><a href="#__codelineno-142-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-142-19" name="__codelineno-142-19"></a><a href="#__codelineno-142-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="k">continue</span>
<a id="__codelineno-142-20" name="__codelineno-142-20"></a><a href="#__codelineno-142-20"><span class="linenos" data-linenos="20 "></span></a>
<a id="__codelineno-142-21" name="__codelineno-142-21"></a><a href="#__codelineno-142-21"><span class="linenos" data-linenos="21 "></span></a><span class="n">PR</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-142-22" name="__codelineno-142-22"></a><a href="#__codelineno-142-22"><span class="linenos" data-linenos="22 "></span></a>
<a id="__codelineno-142-23" name="__codelineno-142-23"></a><a href="#__codelineno-142-23"><span class="linenos" data-linenos="23 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q_low</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-142-24" name="__codelineno-142-24"></a><a href="#__codelineno-142-24"><span class="linenos" data-linenos="24 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">inv</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="mi">120</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">q_low</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="mi">120</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">q_low</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<a id="__codelineno-142-25" name="__codelineno-142-25"></a><a href="#__codelineno-142-25"><span class="linenos" data-linenos="25 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-142-26" name="__codelineno-142-26"></a><a href="#__codelineno-142-26"><span class="linenos" data-linenos="26 "></span></a>    <span class="n">root</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="mi">120</span><span class="p">))</span>
<a id="__codelineno-142-27" name="__codelineno-142-27"></a><a href="#__codelineno-142-27"><span class="linenos" data-linenos="27 "></span></a>    <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
<a id="__codelineno-142-28" name="__codelineno-142-28"></a><a href="#__codelineno-142-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">120</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">q_low</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-142-29" name="__codelineno-142-29"></a><a href="#__codelineno-142-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">q</span>
<a id="__codelineno-142-30" name="__codelineno-142-30"></a><a href="#__codelineno-142-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="k">if</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
<a id="__codelineno-142-31" name="__codelineno-142-31"></a><a href="#__codelineno-142-31"><span class="linenos" data-linenos="31 "></span></a>            <span class="n">d</span> <span class="o">=</span> <span class="n">gmpy2</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-142-32" name="__codelineno-142-32"></a><a href="#__codelineno-142-32"><span class="linenos" data-linenos="32 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;p = &quot;</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-142-33" name="__codelineno-142-33"></a><a href="#__codelineno-142-33"><span class="linenos" data-linenos="33 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;q = &quot;</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-142-34" name="__codelineno-142-34"></a><a href="#__codelineno-142-34"><span class="linenos" data-linenos="34 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d = &quot;</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
<a id="__codelineno-142-35" name="__codelineno-142-35"></a><a href="#__codelineno-142-35"><span class="linenos" data-linenos="35 "></span></a>            <span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">construct</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">q</span><span class="p">)))</span>
<a id="__codelineno-142-36" name="__codelineno-142-36"></a><a href="#__codelineno-142-36"><span class="linenos" data-linenos="36 "></span></a>            <span class="n">newkey</span> <span class="o">=</span> <span class="n">PKCS1_OAEP</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-142-37" name="__codelineno-142-37"></a><a href="#__codelineno-142-37"><span class="linenos" data-linenos="37 "></span></a>            <span class="n">flag</span> <span class="o">=</span> <span class="n">newkey</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-142-38" name="__codelineno-142-38"></a><a href="#__codelineno-142-38"><span class="linenos" data-linenos="38 "></span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-142-39" name="__codelineno-142-39"></a><a href="#__codelineno-142-39"><span class="linenos" data-linenos="39 "></span></a>            <span class="k">break</span>
</code></pre></div>
<h3 id="2024ciscnezrsa">2024CISCN——ezrsa<a class="headerlink" href="#2024ciscnezrsa" title="Permanent link">&para;</a></h3>
<blockquote>
<p>task.py</p>
</blockquote>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1"></a><a href="#__codelineno-143-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-143-2" name="__codelineno-143-2"></a><a href="#__codelineno-143-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-143-3" name="__codelineno-143-3"></a><a href="#__codelineno-143-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-143-4" name="__codelineno-143-4"></a><a href="#__codelineno-143-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">secret</span><span class="w"> </span><span class="kn">import</span> <span class="n">flag</span>
<a id="__codelineno-143-5" name="__codelineno-143-5"></a><a href="#__codelineno-143-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-143-6" name="__codelineno-143-6"></a><a href="#__codelineno-143-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">m</span> <span class="o">=</span> <span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<a id="__codelineno-143-7" name="__codelineno-143-7"></a><a href="#__codelineno-143-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<a id="__codelineno-143-8" name="__codelineno-143-8"></a><a href="#__codelineno-143-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">passphrase</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">999999</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<a id="__codelineno-143-9" name="__codelineno-143-9"></a><a href="#__codelineno-143-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">output</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">export_key</span><span class="p">(</span><span class="n">passphrase</span><span class="o">=</span><span class="n">passphrase</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-143-10" name="__codelineno-143-10"></a><a href="#__codelineno-143-10"><span class="linenos" data-linenos="10 "></span></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">):</span>
<a id="__codelineno-143-11" name="__codelineno-143-11"></a><a href="#__codelineno-143-11"><span class="linenos" data-linenos="11 "></span></a>    <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">64</span>
<a id="__codelineno-143-12" name="__codelineno-143-12"></a><a href="#__codelineno-143-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;priv.pem&quot;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-143-13" name="__codelineno-143-13"></a><a href="#__codelineno-143-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-143-14" name="__codelineno-143-14"></a><a href="#__codelineno-143-14"><span class="linenos" data-linenos="14 "></span></a>        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-143-15" name="__codelineno-143-15"></a><a href="#__codelineno-143-15"><span class="linenos" data-linenos="15 "></span></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;enc.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-143-16" name="__codelineno-143-16"></a><a href="#__codelineno-143-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">_encrypt</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
</code></pre></div>
<blockquote>
<p>priv.pem</p>
</blockquote>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1"></a><a href="#__codelineno-144-1"><span class="linenos" data-linenos=" 1 "></span></a>-----BEGIN RSA PRIVATE KEY-----
<a id="__codelineno-144-2" name="__codelineno-144-2"></a><a href="#__codelineno-144-2"><span class="linenos" data-linenos=" 2 "></span></a>Proc-Type: 4,ENCRYPTED
<a id="__codelineno-144-3" name="__codelineno-144-3"></a><a href="#__codelineno-144-3"><span class="linenos" data-linenos=" 3 "></span></a>DEK-Info: DES-EDE3-CBC,435BF84C562FE793
<a id="__codelineno-144-4" name="__codelineno-144-4"></a><a href="#__codelineno-144-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-144-5" name="__codelineno-144-5"></a><a href="#__codelineno-144-5"><span class="linenos" data-linenos=" 5 "></span></a>9phAgeyjnJYZ6lgLYflgduBQjdX+V/Ph/fO8QB2ZubhBVOFJMHbwHbtgBaN3eGlh
<a id="__codelineno-144-6" name="__codelineno-144-6"></a><a href="#__codelineno-144-6"><span class="linenos" data-linenos=" 6 "></span></a>WiEFEdQWoOFvpip0whr4r7aGOhavWhIfRjiqfQVcKZx4/f02W4pcWVYo9/p3otdD
<a id="__codelineno-144-7" name="__codelineno-144-7"></a><a href="#__codelineno-144-7"><span class="linenos" data-linenos=" 7 "></span></a>ig+kofIR9Ky8o9vQk7H1eESNMdq3PPmvd7KTE98ZPqtIIrjbSsJ9XRL+gr5a91gH
<a id="__codelineno-144-8" name="__codelineno-144-8"></a><a href="#__codelineno-144-8"><span class="linenos" data-linenos=" 8 "></span></a>****************************************************************
<a id="__codelineno-144-9" name="__codelineno-144-9"></a><a href="#__codelineno-144-9"><span class="linenos" data-linenos=" 9 "></span></a>****************************************************************
<a id="__codelineno-144-10" name="__codelineno-144-10"></a><a href="#__codelineno-144-10"><span class="linenos" data-linenos="10 "></span></a>****************************************************************
<a id="__codelineno-144-11" name="__codelineno-144-11"></a><a href="#__codelineno-144-11"><span class="linenos" data-linenos="11 "></span></a>****************************************************************
<a id="__codelineno-144-12" name="__codelineno-144-12"></a><a href="#__codelineno-144-12"><span class="linenos" data-linenos="12 "></span></a>****************************************************************
<a id="__codelineno-144-13" name="__codelineno-144-13"></a><a href="#__codelineno-144-13"><span class="linenos" data-linenos="13 "></span></a>****************************************************************
<a id="__codelineno-144-14" name="__codelineno-144-14"></a><a href="#__codelineno-144-14"><span class="linenos" data-linenos="14 "></span></a>****************************************************************
<a id="__codelineno-144-15" name="__codelineno-144-15"></a><a href="#__codelineno-144-15"><span class="linenos" data-linenos="15 "></span></a>****************************************************************
<a id="__codelineno-144-16" name="__codelineno-144-16"></a><a href="#__codelineno-144-16"><span class="linenos" data-linenos="16 "></span></a>hQds7ZdA9yv+yKUYv2e4de8RxX356wYq7r8paBHPXisOkGIVEBYNviMSIbgelkSI
<a id="__codelineno-144-17" name="__codelineno-144-17"></a><a href="#__codelineno-144-17"><span class="linenos" data-linenos="17 "></span></a>jLQka+ZmC2YOgY/DgGJ82JmFG8mmYCcSooGL4ytVUY9dZa1khfhceg==
<a id="__codelineno-144-18" name="__codelineno-144-18"></a><a href="#__codelineno-144-18"><span class="linenos" data-linenos="18 "></span></a>-----END RSA PRIVATE KEY-----
</code></pre></div>
<p>类似蓝帽杯2022的corrupted_key</p>
<p>不一样的是，这题得到的pem文件内容是加密的</p>
<p>根据代码</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1"></a><a href="#__codelineno-145-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">key</span><span class="o">.</span><span class="n">export_key</span><span class="p">(</span><span class="n">passphrase</span><span class="o">=</span><span class="n">passphrase</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<p>找到Crypto下的源代码</p>
<blockquote>
<p>RSA.py</p>
</blockquote>
<p><img alt="" src="../../images/CISCN/7.png" /></p>
<p>发现关键代码</p>
<p><img alt="" src="../../images/CISCN/8.png" /></p>
<p>如果passphrase存在，则随机生成一个salt，然后使用PKBDF1方法加密两次拼接得到key。</p>
<p>此时使用的加密方式为3des,模式为cbc,iv为salt</p>
<p>由此我们可以根据passphrase的生成方式来爆破出唯一的passphrase</p>
<p>根据私钥的格式，开头一定是3082，再根据n为1024bit，那么在私钥中n的格式为028181,加密参数e大概率为65537，即0x10001</p>
<p>那么其在私钥中则为 0203010001。</p>
<p>解密后存在如下特征的明文，那么当前的passphrase为所求</p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1"></a><a href="#__codelineno-146-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">DES3</span>
<a id="__codelineno-146-2" name="__codelineno-146-2"></a><a href="#__codelineno-146-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Protocol.KDF</span><span class="w"> </span><span class="kn">import</span> <span class="n">PBKDF1</span>
<a id="__codelineno-146-3" name="__codelineno-146-3"></a><a href="#__codelineno-146-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Hash</span><span class="w"> </span><span class="kn">import</span> <span class="n">MD5</span>
<a id="__codelineno-146-4" name="__codelineno-146-4"></a><a href="#__codelineno-146-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<a id="__codelineno-146-5" name="__codelineno-146-5"></a><a href="#__codelineno-146-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-146-6" name="__codelineno-146-6"></a><a href="#__codelineno-146-6"><span class="linenos" data-linenos=" 6 "></span></a>
<a id="__codelineno-146-7" name="__codelineno-146-7"></a><a href="#__codelineno-146-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">enc1</span> <span class="o">=</span> <span class="s2">&quot;9phAgeyjnJYZ6lgLYflgduBQjdX+V/Ph/fO8QB2ZubhBVOFJMHbwHbtgBaN3eGlhWiEFEdQWoOFvpip0whr4r7aGOhavWhIfRjiqfQVcKZx4/f02W4pcWVYo9/p3otdDig+kofIR9Ky8o9vQk7H1eESNMdq3PPmvd7KTE98ZPqtIIrjbSsJ9XRL+gr5a91gH&quot;</span>
<a id="__codelineno-146-8" name="__codelineno-146-8"></a><a href="#__codelineno-146-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">enc2</span> <span class="o">=</span> <span class="s2">&quot;hQds7ZdA9yv+yKUYv2e4de8RxX356wYq7r8paBHPXisOkGIVEBYNviMSIbgelkSIjLQka+ZmC2YOgY/DgGJ82JmFG8mmYCcSooGL4ytVUY9dZa1khfhceg==&quot;</span>
<a id="__codelineno-146-9" name="__codelineno-146-9"></a><a href="#__codelineno-146-9"><span class="linenos" data-linenos=" 9 "></span></a>
<a id="__codelineno-146-10" name="__codelineno-146-10"></a><a href="#__codelineno-146-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">salt</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s2">&quot;435bf84c562fe793&quot;</span><span class="p">)</span>
<a id="__codelineno-146-11" name="__codelineno-146-11"></a><a href="#__codelineno-146-11"><span class="linenos" data-linenos="11 "></span></a><span class="nb">dict</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000000</span><span class="p">)]</span>
<a id="__codelineno-146-12" name="__codelineno-146-12"></a><a href="#__codelineno-146-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">for</span> <span class="n">passphrase</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-146-13" name="__codelineno-146-13"></a><a href="#__codelineno-146-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">PBKDF1</span><span class="p">(</span><span class="n">passphrase</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MD5</span><span class="p">)</span>
<a id="__codelineno-146-14" name="__codelineno-146-14"></a><a href="#__codelineno-146-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">key</span> <span class="o">+=</span> <span class="n">PBKDF1</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="n">passphrase</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MD5</span><span class="p">)</span>
<a id="__codelineno-146-15" name="__codelineno-146-15"></a><a href="#__codelineno-146-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">cipher</span> <span class="o">=</span> <span class="n">DES3</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">DES3</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
<a id="__codelineno-146-16" name="__codelineno-146-16"></a><a href="#__codelineno-146-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">data</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">enc1</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<a id="__codelineno-146-17" name="__codelineno-146-17"></a><a href="#__codelineno-146-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;3082&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;028181&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="s2">&quot;0203010001&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
<a id="__codelineno-146-18" name="__codelineno-146-18"></a><a href="#__codelineno-146-18"><span class="linenos" data-linenos="18 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-146-19" name="__codelineno-146-19"></a><a href="#__codelineno-146-19"><span class="linenos" data-linenos="19 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">passphrase</span><span class="p">)</span>
<a id="__codelineno-146-20" name="__codelineno-146-20"></a><a href="#__codelineno-146-20"><span class="linenos" data-linenos="20 "></span></a>        <span class="n">data2</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">enc2</span><span class="p">))</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<a id="__codelineno-146-21" name="__codelineno-146-21"></a><a href="#__codelineno-146-21"><span class="linenos" data-linenos="21 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
<a id="__codelineno-146-22" name="__codelineno-146-22"></a><a href="#__codelineno-146-22"><span class="linenos" data-linenos="22 "></span></a>        <span class="k">break</span>
</code></pre></div>
<p>得到</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1"></a><a href="#__codelineno-147-1"><span class="linenos" data-linenos=" 1 "></span></a>30 82 02 5c
<a id="__codelineno-147-2" name="__codelineno-147-2"></a><a href="#__codelineno-147-2"><span class="linenos" data-linenos=" 2 "></span></a>    02 01
<a id="__codelineno-147-3" name="__codelineno-147-3"></a><a href="#__codelineno-147-3"><span class="linenos" data-linenos=" 3 "></span></a>        00       
<a id="__codelineno-147-4" name="__codelineno-147-4"></a><a href="#__codelineno-147-4"><span class="linenos" data-linenos=" 4 "></span></a>
<a id="__codelineno-147-5" name="__codelineno-147-5"></a><a href="#__codelineno-147-5"><span class="linenos" data-linenos=" 5 "></span></a>    02 81 81 00
<a id="__codelineno-147-6" name="__codelineno-147-6"></a><a href="#__codelineno-147-6"><span class="linenos" data-linenos=" 6 "></span></a>a1 8f 01 1b eb ac ce da 1c 68 12 73 0b 9e 62 72 0d 3c bd 68 57 af 2c f8 43 18 60 f5 dc 83 c5 52 0f 24 2f 3b e7 c9 e9 6d 7f 96 b4 18 98 ff 00 0f db 7e 43 ef 6f 1e 71 7b 2b 79 00 f3 56 60 a2 1d 1b 16 b5 18 49 be 97 a0 b0 f7 cb cf 5c fe 0f 00 37 0c ce 61 93 fe fa 1f ed 97 b3 7b d3 67 a6 73 56 51 62 ce 17 b0 22 57 08 c0 32 96 1d 17 5b bc 2c 82 9b f2 e1 6e ab c7 e0 88 1f ec a0 97 5c 81
<a id="__codelineno-147-7" name="__codelineno-147-7"></a><a href="#__codelineno-147-7"><span class="linenos" data-linenos=" 7 "></span></a>
<a id="__codelineno-147-8" name="__codelineno-147-8"></a><a href="#__codelineno-147-8"><span class="linenos" data-linenos=" 8 "></span></a>    02 03 
<a id="__codelineno-147-9" name="__codelineno-147-9"></a><a href="#__codelineno-147-9"><span class="linenos" data-linenos=" 9 "></span></a>        01 00 01
<a id="__codelineno-147-10" name="__codelineno-147-10"></a><a href="#__codelineno-147-10"><span class="linenos" data-linenos="10 "></span></a>
<a id="__codelineno-147-11" name="__codelineno-147-11"></a><a href="#__codelineno-147-11"><span class="linenos" data-linenos="11 "></span></a>6a 03 30 64 c5 a0 dff c8 f2 36 3b 34 0e 50 24 05 f1 52 c4 29 87 1a 7a cd d2 8b e1 b6 43 b4 65 28 00 b8 8a 3d 23 cc 57 47 7d 75 dd 55 55 b6 35 16 76 16 ef 5c 60 9d 69 ce 3c 2a ed cb 03 b6 2f 92 9b bc d8 91 ca dc 0b a0 31 ae 6f ec 8a 21 16 d0 80 80 80 80 80 80 80 8
</code></pre></div>
<p>再根据私钥格式提取<code>n,e,dq,inv</code></p>
<p>因为本题中中间部分的私钥文件缺失，而且加密是cbc的，导致enc2第一块解密的结果错误，需要去掉，也就是说正确的dq只有48bit</p>
<p>因此得到</p>
<div class="language-python highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1"></a><a href="#__codelineno-148-1"><span class="linenos" data-linenos="1 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mh">0xa18f011bebacceda1c6812730b9e62720d3cbd6857af2cf8431860f5dc83c5520f242f3be7c9e96d7f96b41898ff000fdb7e43ef6f1e717b2b7900f35660a21d1b16b51849be97a0b0f7cbcf5cfe0f00370cce6193fefa1fed97b37bd367a673565162ce17b0225708c032961d175bbc2c829bf2e16eabc7e0881feca0975c81</span>
<a id="__codelineno-148-2" name="__codelineno-148-2"></a><a href="#__codelineno-148-2"><span class="linenos" data-linenos="2 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-148-3" name="__codelineno-148-3"></a><a href="#__codelineno-148-3"><span class="linenos" data-linenos="3 "></span></a><span class="n">dq_leak</span><span class="o">=</span> <span class="mh">0x8f2363b340e5</span>
<a id="__codelineno-148-4" name="__codelineno-148-4"></a><a href="#__codelineno-148-4"><span class="linenos" data-linenos="4 "></span></a><span class="n">inv</span> <span class="o">=</span> <span class="mh">0x5f152c429871a7acdd28be1b643b4652800b88a3d23cc57477d75dd5555b635167616ef5c609d69ce3c2aedcb03b62f929bbcd891cadc0ba031ae6fec8a2116d</span>
</code></pre></div>
<div class="arithmatex">\[
\because ed_q = 1 + k(q-1)
\]</div>
<div class="arithmatex">\[
\therefore kq = ed_q +k-1
\]</div>
<p>k可以爆破，但不知道q，所以没办法构造1元coppersmith</p>
<div class="arithmatex">\[
\because inv \times q \equiv 1 \mod p
\]</div>
<div class="arithmatex">\[
\therefore inv \times q - 1 \equiv 0 \mod p
\]</div>
<p>同乘kq</p>
<div class="arithmatex">\[
inv \times q \times kq - kq \equiv 0 \mod n
\]</div>
<p>此时会有个突兀的q，不好处理，我们再同乘k，得到</p>
<div class="arithmatex">\[
inv \times (kq)^2 - k\times kq \equiv 0 \mod n
\]</div>
<p>得到两个式子：</p>
<div class="arithmatex">\[
tmp = e(x + dq_{low})+k-1
\]</div>
<div class="arithmatex">\[
inv\times tmp^2 - k\times tmp \equiv 0 \mod n
\]</div>
<p>恢复出dq之后，<span class="arithmatex">\(q = (ed_q + k - 1) // k\)</span></p>
<div class="language-py highlight"><span class="filename">Python</span><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1"></a><a href="#__codelineno-149-1"><span class="linenos" data-linenos=" 1 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-149-2" name="__codelineno-149-2"></a><a href="#__codelineno-149-2"><span class="linenos" data-linenos=" 2 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-149-3" name="__codelineno-149-3"></a><a href="#__codelineno-149-3"><span class="linenos" data-linenos=" 3 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>
<a id="__codelineno-149-4" name="__codelineno-149-4"></a><a href="#__codelineno-149-4"><span class="linenos" data-linenos=" 4 "></span></a><span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Cipher</span><span class="w"> </span><span class="kn">import</span> <span class="n">PKCS1_OAEP</span>
<a id="__codelineno-149-5" name="__codelineno-149-5"></a><a href="#__codelineno-149-5"><span class="linenos" data-linenos=" 5 "></span></a>
<a id="__codelineno-149-6" name="__codelineno-149-6"></a><a href="#__codelineno-149-6"><span class="linenos" data-linenos=" 6 "></span></a><span class="n">n</span> <span class="o">=</span> <span class="mh">0xa18f011bebacceda1c6812730b9e62720d3cbd6857af2cf8431860f5dc83c5520f242f3be7c9e96d7f96b41898ff000fdb7e43ef6f1e717b2b7900f35660a21d1b16b51849be97a0b0f7cbcf5cfe0f00370cce6193fefa1fed97b37bd367a673565162ce17b0225708c032961d175bbc2c829bf2e16eabc7e0881feca0975c81</span>
<a id="__codelineno-149-7" name="__codelineno-149-7"></a><a href="#__codelineno-149-7"><span class="linenos" data-linenos=" 7 "></span></a><span class="n">e</span> <span class="o">=</span> <span class="mi">65537</span>
<a id="__codelineno-149-8" name="__codelineno-149-8"></a><a href="#__codelineno-149-8"><span class="linenos" data-linenos=" 8 "></span></a><span class="n">dq_leak</span><span class="o">=</span> <span class="mh">0x8f2363b340e5</span>
<a id="__codelineno-149-9" name="__codelineno-149-9"></a><a href="#__codelineno-149-9"><span class="linenos" data-linenos=" 9 "></span></a><span class="n">inv</span> <span class="o">=</span> <span class="mh">0x5f152c429871a7acdd28be1b643b4652800b88a3d23cc57477d75dd5555b635167616ef5c609d69ce3c2aedcb03b62f929bbcd891cadc0ba031ae6fec8a2116d</span>
<a id="__codelineno-149-10" name="__codelineno-149-10"></a><a href="#__codelineno-149-10"><span class="linenos" data-linenos="10 "></span></a><span class="n">c</span> <span class="o">=</span> <span class="mi">55149764057291700808946379593274733093556529902852874590948688362865310469901900909075397929997623185589518643636792828743516623112272635512151466304164301360740002369759704802706396320622342771513106879732891498365431042081036698760861996177532930798842690295051476263556258192509634233232717503575429327989</span>
<a id="__codelineno-149-11" name="__codelineno-149-11"></a><a href="#__codelineno-149-11"><span class="linenos" data-linenos="11 "></span></a>
<a id="__codelineno-149-12" name="__codelineno-149-12"></a><a href="#__codelineno-149-12"><span class="linenos" data-linenos="12 "></span></a><span class="k">def</span><span class="w"> </span><span class="nf">coppersmith</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<a id="__codelineno-149-13" name="__codelineno-149-13"></a><a href="#__codelineno-149-13"><span class="linenos" data-linenos="13 "></span></a>    <span class="n">R</span><span class="o">.&lt;</span><span class="n">x</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">PolynomialRing</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-149-14" name="__codelineno-149-14"></a><a href="#__codelineno-149-14"><span class="linenos" data-linenos="14 "></span></a>    <span class="n">tmp</span> <span class="o">=</span> <span class="n">e</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="o">^</span><span class="mi">48</span> <span class="o">+</span> <span class="n">dq_leak</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span>          <span class="c1">## kq</span>
<a id="__codelineno-149-15" name="__codelineno-149-15"></a><a href="#__codelineno-149-15"><span class="linenos" data-linenos="15 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">inv</span> <span class="o">*</span> <span class="n">tmp</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">tmp</span>
<a id="__codelineno-149-16" name="__codelineno-149-16"></a><a href="#__codelineno-149-16"><span class="linenos" data-linenos="16 "></span></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">monic</span><span class="p">()</span>
<a id="__codelineno-149-17" name="__codelineno-149-17"></a><a href="#__codelineno-149-17"><span class="linenos" data-linenos="17 "></span></a>    <span class="n">x0</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">small_roots</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="o">^</span><span class="mi">464</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">0.09</span><span class="p">)</span>
<a id="__codelineno-149-18" name="__codelineno-149-18"></a><a href="#__codelineno-149-18"><span class="linenos" data-linenos="18 "></span></a>    <span class="k">return</span> <span class="n">x0</span>
<a id="__codelineno-149-19" name="__codelineno-149-19"></a><a href="#__codelineno-149-19"><span class="linenos" data-linenos="19 "></span></a>
<a id="__codelineno-149-20" name="__codelineno-149-20"></a><a href="#__codelineno-149-20"><span class="linenos" data-linenos="20 "></span></a><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">(</span><span class="mi">1</span><span class="err">，</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-149-21" name="__codelineno-149-21"></a><a href="#__codelineno-149-21"><span class="linenos" data-linenos="21 "></span></a>    <span class="n">x0</span> <span class="o">=</span> <span class="n">coppersmith</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-149-22" name="__codelineno-149-22"></a><a href="#__codelineno-149-22"><span class="linenos" data-linenos="22 "></span></a>    <span class="k">if</span> <span class="n">x0</span> <span class="o">!=</span> <span class="p">[]:</span>
<a id="__codelineno-149-23" name="__codelineno-149-23"></a><a href="#__codelineno-149-23"><span class="linenos" data-linenos="23 "></span></a>        <span class="n">dq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span><span class="o">^</span><span class="mi">48</span> <span class="o">+</span> <span class="n">dq_leak</span>
<a id="__codelineno-149-24" name="__codelineno-149-24"></a><a href="#__codelineno-149-24"><span class="linenos" data-linenos="24 "></span></a>        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">*</span><span class="n">dq</span> <span class="o">+</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">k</span>
<a id="__codelineno-149-25" name="__codelineno-149-25"></a><a href="#__codelineno-149-25"><span class="linenos" data-linenos="25 "></span></a>        <span class="c1">## print(f&quot;k = {k}&quot;)</span>
<a id="__codelineno-149-26" name="__codelineno-149-26"></a><a href="#__codelineno-149-26"><span class="linenos" data-linenos="26 "></span></a>        <span class="c1">## k = 47794</span>
<a id="__codelineno-149-27" name="__codelineno-149-27"></a><a href="#__codelineno-149-27"><span class="linenos" data-linenos="27 "></span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">q</span>
<a id="__codelineno-149-28" name="__codelineno-149-28"></a><a href="#__codelineno-149-28"><span class="linenos" data-linenos="28 "></span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">e</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-149-29" name="__codelineno-149-29"></a><a href="#__codelineno-149-29"><span class="linenos" data-linenos="29 "></span></a>        <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<a id="__codelineno-149-30" name="__codelineno-149-30"></a><a href="#__codelineno-149-30"><span class="linenos" data-linenos="30 "></span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
<a id="__codelineno-149-31" name="__codelineno-149-31"></a><a href="#__codelineno-149-31"><span class="linenos" data-linenos="31 "></span></a>        <span class="c1">## b&#39;flag{df4a4054-23eb-4ba4-be5e-15b247d7b819}&#39;</span>
<a id="__codelineno-149-32" name="__codelineno-149-32"></a><a href="#__codelineno-149-32"><span class="linenos" data-linenos="32 "></span></a>        <span class="k">break</span>
</code></pre></div>
<p>参考：<a href="https://4xwi11.github.io/posts/9864757a/#解法二">20220709-蓝帽杯-CryptoSecWriteUp | 4XWi11's Blog</a></p>
<p>在求出q后，其实<code>pow(c,dq,q)</code>也能出flag，不用求p</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年8月2日 11:59:30 UTC">2025年8月2日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="2025年8月2日 11:59:30 UTC">2025年8月2日</span>
  </span>

    
    
    
      
  <span class="md-source-file__fact">
    
      
  <span class="md-icon" title="贡献者">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </span>
  <span>GitHub</span>

    
    <nav>
      
        <a href="https://github.com/coperlm" class="md-author" title="@coperlm">
          
          <img src="https://avatars.githubusercontent.com/u/76933810?v=4&size=72" alt="coperlm">
        </a>
      
      
      
    </nav>
  </span>

    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="01-%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 古典密码">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                古典密码
              </div>
            </div>
          </a>
        
        
          
          <a href="../../05-RE/index.html" class="md-footer__link md-footer__link--next" aria-label="下一页: REVERSE-逆向">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                REVERSE-逆向
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 - Present NISA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.footer", "navigation.prune", "navigation.indexes", "navigation.path", "toc.follow", "navigation.sections"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>